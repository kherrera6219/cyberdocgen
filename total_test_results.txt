
> rest-express@2.0.1 test
> vitest --run --reporter=verbose


[1m[46m RUN [49m[22m [36mv3.2.4 [39m[90mC:/software/cyberdocgen[39m

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2mconstructor[2m > [22m[2mshould create base directory on initialization
[22m[39m[LocalFsStorageProvider] Initialized with basePath: ./test-data/storage
[LocalFsStorageProvider] Created base directory: ./test-data/storage

 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/encryption.test.ts[2m > [22mEncryptionService[2m > [22mencryptSensitiveField[2m > [22mencrypts data using AES-256-GCM[32m 4[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/encryption.test.ts[2m > [22mEncryptionService[2m > [22mencryptSensitiveField[2m > [22mproduces unique IVs for each encryption[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/encryption.test.ts[2m > [22mEncryptionService[2m > [22mencryptSensitiveField[2m > [22mhandles empty strings[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/encryption.test.ts[2m > [22mEncryptionService[2m > [22mdecryptSensitiveField[2m > [22msuccessfully decrypts encrypted data[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/encryption.test.ts[2m > [22mEncryptionService[2m > [22mdecryptSensitiveField[2m > [22mthrows error on tampered data (auth tag validation)[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/encryption.test.ts[2m > [22mEncryptionService[2m > [22mdecryptSensitiveField[2m > [22mthrows error on invalid auth tag[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/encryption.test.ts[2m > [22mEncryptionService[2m > [22mlegacy v1 support[2m > [22midentifies data needing migration[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/encryption.test.ts[2m > [22mEncryptionService[2m > [22mlegacy v1 support[2m > [22midentifies v2 data as not needing migration[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/encryption.test.ts[2m > [22mEncryptionService[2m > [22mkey rotation detection[2m > [22mdetects data needing re-encryption based on age[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/encryption.test.ts[2m > [22mEncryptionService[2m > [22mkey rotation detection[2m > [22mdoes not flag recent data for re-encryption[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/encryption.test.ts[2m > [22mEncryptionService[2m > [22mgenerateEncryptionKey[2m > [22mgenerates a valid 64-character hex key[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/encryption.test.ts[2m > [22mEncryptionService[2m > [22mgenerateEncryptionKey[2m > [22mgenerates unique keys[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/encryption.test.ts[2m > [22mEncryptionService[2m > [22mhashForIndexing[2m > [22mproduces consistent hashes for same input[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/encryption.test.ts[2m > [22mEncryptionService[2m > [22mhashForIndexing[2m > [22mproduces different hashes for different inputs[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/encryption.test.ts[2m > [22mEncryptionService[2m > [22mhashForIndexing[2m > [22moutputs SHA-256 hex format[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/encryption.test.ts[2m > [22mEncryptionService[2m > [22mhelper functions[2m > [22mencrypt/decrypt wrappers[2m > [22mencrypt wrapper works with sensitive field encryption[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/encryption.test.ts[2m > [22mEncryptionService[2m > [22mhelper functions[2m > [22mshouldEncryptField[2m > [22mencrypts sensitive field names[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/encryption.test.ts[2m > [22mEncryptionService[2m > [22mhelper functions[2m > [22mshouldEncryptField[2m > [22mdoes not encrypt non-sensitive fields[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/encryption.test.ts[2m > [22mEncryptionService[2m > [22mfield-level encryption[2m > [22mencrypts company profile sensitive fields[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/encryption.test.ts[2m > [22mEncryptionService[2m > [22mdata classification[2m > [22msupports all classification levels[32m 1[2mms[22m[39m
[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2mconstructor[2m > [22m[2mshould handle existing directory
[22m[39m[LocalFsStorageProvider] Initialized with basePath: ./test-data/storage
[LocalFsStorageProvider] Created base directory: ./test-data/storage

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2mconstructor[2m > [22m[2mshould handle existing directory
[22m[39m[LocalFsStorageProvider] Initialized with basePath: ./test-data/storage

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2msave[2m > [22m[2mshould save file with content-addressable path
[22m[39m[LocalFsStorageProvider] Initialized with basePath: ./test-data/storage
[LocalFsStorageProvider] Created base directory: ./test-data/storage

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2msave[2m > [22m[2mshould save file with content-addressable path
[22m[39m[LocalFsStorageProvider] Saving file: documents/test.txt -> test-data\storage\6c\76\6c76f7bd4b84eb68_test.txt

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2msave[2m > [22m[2mshould save file with content-addressable path
[22m[39m[LocalFsStorageProvider] Created directory: test-data\storage\6c\76

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2msave[2m > [22m[2mshould save file with content-addressable path
[22m[39m[LocalFsStorageProvider] File saved successfully: test-data\storage\6c\76\6c76f7bd4b84eb68_test.txt

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2msave[2m > [22m[2mshould create subdirectories based on hash
[22m[39m[LocalFsStorageProvider] Initialized with basePath: ./test-data/storage
[LocalFsStorageProvider] Created base directory: ./test-data/storage

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2msave[2m > [22m[2mshould create subdirectories based on hash
[22m[39m[LocalFsStorageProvider] Saving file: test.txt -> test-data\storage\9d\95\9d9595c5d94fb65b_test.txt

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2msave[2m > [22m[2mshould create subdirectories based on hash
[22m[39m[LocalFsStorageProvider] Created directory: test-data\storage\9d\95

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2msave[2m > [22m[2mshould create subdirectories based on hash
[22m[39m[LocalFsStorageProvider] File saved successfully: test-data\storage\9d\95\9d9595c5d94fb65b_test.txt

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2msave[2m > [22m[2mshould preserve file extension
[22m[39m[LocalFsStorageProvider] Initialized with basePath: ./test-data/storage
[LocalFsStorageProvider] Created base directory: ./test-data/storage

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2msave[2m > [22m[2mshould preserve file extension
[22m[39m[LocalFsStorageProvider] Saving file: documents/report.pdf -> test-data\storage\7e\7f\7e7f04c8b5646f7a_report.pdf

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2msave[2m > [22m[2mshould preserve file extension
[22m[39m[LocalFsStorageProvider] Created directory: test-data\storage\7e\7f

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2msave[2m > [22m[2mshould preserve file extension
[22m[39m[LocalFsStorageProvider] File saved successfully: test-data\storage\7e\7f\7e7f04c8b5646f7a_report.pdf

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2msave[2m > [22m[2mshould handle files without extension
[22m[39m[LocalFsStorageProvider] Initialized with basePath: ./test-data/storage
[LocalFsStorageProvider] Created base directory: ./test-data/storage

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2msave[2m > [22m[2mshould handle files without extension
[22m[39m[LocalFsStorageProvider] Saving file: documents/README -> test-data\storage\3e\6d\3e6dce2575cdb5bd_README

[90mstdout[2m | tests/unit/dataRetentionAutomation.test.ts[2m > [22m[2mDataRetentionService[2m > [22m[2mconfiguration[2m > [22m[2msets and gets policies
[22m[39m[32m2026-01-23T16:48:56.291Z [INFO] Data retention policies updated {"policyCount":1}[0m

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2msave[2m > [22m[2mshould handle files without extension
[22m[39m[LocalFsStorageProvider] Created directory: test-data\storage\3e\6d

[90mstdout[2m | tests/unit/dataRetentionAutomation.test.ts[2m > [22m[2mDataRetentionService[2m > [22m[2mscheduling[2m > [22m[2mschedules deletion request
[22m[39m[32m2026-01-23T16:48:56.297Z [INFO] Deletion request scheduled {"requestId":"del_1769186936297_0wpr8ikrv","dataType":"test_type","scheduledAt":"2026-01-24T10:00:00.000Z","status":"approved"}[0m

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2msave[2m > [22m[2mshould handle files without extension
[22m[39m[LocalFsStorageProvider] File saved successfully: test-data\storage\3e\6d\3e6dce2575cdb5bd_README

 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/providers/secrets/windowsCredMan.test.ts[2m > [22mWindowsCredentialManagerProvider[2m > [22mLLM_API_KEYS constants[2m > [22mshould define known API key names[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/providers/secrets/windowsCredMan.test.ts[2m > [22mWindowsCredentialManagerProvider[2m > [22mLLM_API_KEYS constants[2m > [22mshould use consistent naming format[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/providers/secrets/windowsCredMan.test.ts[2m > [22mWindowsCredentialManagerProvider[2m > [22mProvider initialization[2m > [22mshould create provider instance[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/providers/secrets/windowsCredMan.test.ts[2m > [22mWindowsCredentialManagerProvider[2m > [22mProvider initialization[2m > [22mshould have availability check method[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/providers/secrets/windowsCredMan.test.ts[2m > [22mWindowsCredentialManagerProvider[2m > [22mAPI key operations[2m > [22mshould have set method[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/providers/secrets/windowsCredMan.test.ts[2m > [22mWindowsCredentialManagerProvider[2m > [22mAPI key operations[2m > [22mshould have get method[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/providers/secrets/windowsCredMan.test.ts[2m > [22mWindowsCredentialManagerProvider[2m > [22mAPI key operations[2m > [22mshould have delete method[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/providers/secrets/windowsCredMan.test.ts[2m > [22mWindowsCredentialManagerProvider[2m > [22mAPI key operations[2m > [22mshould have listKeys method[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/providers/secrets/windowsCredMan.test.ts[2m > [22mWindowsCredentialManagerProvider[2m > [22mAPI key operations[2m > [22mshould have hasKey method[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/providers/secrets/windowsCredMan.test.ts[2m > [22mWindowsCredentialManagerProvider[2m > [22mAPI key operations[2m > [22mshould have getConfiguredProviders method[32m 0[2mms[22m[39m
[90mstdout[2m | tests/unit/dataRetentionAutomation.test.ts[2m > [22m[2mDataRetentionService[2m > [22m[2mscheduling[2m > [22m[2mprocesses user deletion request (GDPR)
[22m[39m[32m2026-01-23T16:48:56.299Z [INFO] Data retention policies updated {"policyCount":5}[0m
[32m2026-01-23T16:48:56.300Z [INFO] Deletion request scheduled {"requestId":"del_1769186936300_447vcrro7","dataType":"user_profile","scheduledAt":"2026-01-23T16:48:56.300Z","status":"approved"}[0m

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2msave[2m > [22m[2mshould use same hash for identical content
[22m[39m[LocalFsStorageProvider] Initialized with basePath: ./test-data/storage
[LocalFsStorageProvider] Created base directory: ./test-data/storage

[90mstdout[2m | tests/unit/dataRetentionAutomation.test.ts[2m > [22m[2mDataRetentionService[2m > [22m[2mscheduling[2m > [22m[2mprocesses user deletion request (GDPR)
[22m[39m[32m2026-01-23T16:48:56.300Z [INFO] Deletion request scheduled {"requestId":"del_1769186936300_k7jbkrxh6","dataType":"ai_chat_history","scheduledAt":"2026-01-23T16:48:56.300Z","status":"approved"}[0m

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2msave[2m > [22m[2mshould use same hash for identical content
[22m[39m[LocalFsStorageProvider] Saving file: file1.txt -> test-data\storage\81\b2\81b2414741e4a117_file1.txt

[90mstdout[2m | tests/unit/dataRetentionAutomation.test.ts[2m > [22m[2mDataRetentionService[2m > [22m[2mscheduling[2m > [22m[2mprocesses user deletion request (GDPR)
[22m[39m[32m2026-01-23T16:48:56.300Z [INFO] Deletion request scheduled {"requestId":"del_1769186936300_lz038q4nk","dataType":"generated_documents","scheduledAt":"2026-01-23T16:48:56.300Z","status":"approved"}[0m

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2msave[2m > [22m[2mshould use same hash for identical content
[22m[39m[LocalFsStorageProvider] Created directory: test-data\storage\81\b2

[90mstdout[2m | tests/unit/dataRetentionAutomation.test.ts[2m > [22m[2mDataRetentionService[2m > [22m[2mscheduling[2m > [22m[2mprocesses user deletion request (GDPR)
[22m[39m[32m2026-01-23T16:48:56.300Z [INFO] Deletion request scheduled {"requestId":"del_1769186936300_i4a5kobxq","dataType":"session_logs","scheduledAt":"2026-01-23T16:48:56.300Z","status":"approved"}[0m

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2msave[2m > [22m[2mshould use same hash for identical content
[22m[39m[LocalFsStorageProvider] File saved successfully: test-data\storage\81\b2\81b2414741e4a117_file1.txt

[90mstdout[2m | tests/unit/dataRetentionAutomation.test.ts[2m > [22m[2mDataRetentionService[2m > [22m[2mscheduling[2m > [22m[2mprocesses user deletion request (GDPR)
[22m[39m[32m2026-01-23T16:48:56.301Z [INFO] Deletion request scheduled {"requestId":"del_1769186936301_l7c33ib2l","dataType":"preferences","scheduledAt":"2026-01-23T16:48:56.301Z","status":"approved"}[0m

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2msave[2m > [22m[2mshould use same hash for identical content
[22m[39m[LocalFsStorageProvider] Saving file: file2.txt -> test-data\storage\81\b2\81b2414741e4a117_file2.txt

[90mstdout[2m | tests/unit/dataRetentionAutomation.test.ts[2m > [22m[2mDataRetentionService[2m > [22m[2mscheduling[2m > [22m[2mprocesses user deletion request (GDPR)
[22m[39m[32m2026-01-23T16:48:56.301Z [INFO] User deletion request processed {"userId":"user-123","requestCount":5,"immediate":true}[0m

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2msave[2m > [22m[2mshould use same hash for identical content
[22m[39m[LocalFsStorageProvider] File saved successfully: test-data\storage\81\b2\81b2414741e4a117_file2.txt

[90mstdout[2m | tests/unit/dataRetentionAutomation.test.ts[2m > [22m[2mDataRetentionService[2m > [22m[2mexecution[2m > [22m[2mexecutes pending deletions
[22m[39m[32m2026-01-23T16:48:56.303Z [INFO] Deletion request scheduled {"requestId":"del_1769186936303_62rxmzw24","dataType":"generated_documents","scheduledAt":"2026-01-23T16:48:56.303Z","status":"approved"}[0m

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2msave[2m > [22m[2mshould handle large files
[22m[39m[LocalFsStorageProvider] Initialized with basePath: ./test-data/storage
[LocalFsStorageProvider] Created base directory: ./test-data/storage

[90mstdout[2m | tests/unit/dataRetentionAutomation.test.ts[2m > [22m[2mDataRetentionService[2m > [22m[2mexecution[2m > [22m[2mexecutes pending deletions
[22m[39m[32m2026-01-23T16:48:56.306Z [INFO] Executing deletion {"requestId":"del_1769186936300_447vcrro7","dataType":"user_profile","hardDelete":true}[0m

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2msave[2m > [22m[2mshould handle large files
[22m[39m[LocalFsStorageProvider] Saving file: large-file.bin -> test-data\storage\b5\ee\b5eec3f68ef64d15_large-file.bin

[90mstdout[2m | tests/unit/dataRetentionAutomation.test.ts[2m > [22m[2mDataRetentionService[2m > [22m[2mexecution[2m > [22m[2mexecutes pending deletions
[22m[39m[32m2026-01-23T16:48:56.307Z [INFO] User profile deletion executed {"userId":"user-123"}[0m

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2msave[2m > [22m[2mshould handle large files
[22m[39m[LocalFsStorageProvider] Created directory: test-data\storage\b5\ee

[90mstdout[2m | tests/unit/dataRetentionAutomation.test.ts[2m > [22m[2mDataRetentionService[2m > [22m[2mexecution[2m > [22m[2mexecutes pending deletions
[22m[39m[32m2026-01-23T16:48:56.307Z [INFO] Deletion completed {"requestId":"del_1769186936300_447vcrro7","dataType":"user_profile"}[0m
[32m2026-01-23T16:48:56.307Z [INFO] Executing deletion {"requestId":"del_1769186936300_k7jbkrxh6","dataType":"ai_chat_history","hardDelete":true}[0m

[90mstdout[2m | tests/unit/dataRetentionAutomation.test.ts[2m > [22m[2mDataRetentionService[2m > [22m[2mexecution[2m > [22m[2mexecutes pending deletions
[22m[39m[32m2026-01-23T16:48:56.308Z [INFO] AI chat history deletion executed {"userId":"user-123"}[0m

[90mstdout[2m | tests/unit/dataRetentionAutomation.test.ts[2m > [22m[2mDataRetentionService[2m > [22m[2mexecution[2m > [22m[2mexecutes pending deletions
[22m[39m[32m2026-01-23T16:48:56.308Z [INFO] Deletion completed {"requestId":"del_1769186936300_k7jbkrxh6","dataType":"ai_chat_history"}[0m
[32m2026-01-23T16:48:56.308Z [INFO] Executing deletion {"requestId":"del_1769186936300_lz038q4nk","dataType":"generated_documents","hardDelete":true}[0m

[90mstdout[2m | tests/unit/dataRetentionAutomation.test.ts[2m > [22m[2mDataRetentionService[2m > [22m[2mexecution[2m > [22m[2mexecutes pending deletions
[22m[39m[32m2026-01-23T16:48:56.308Z [INFO] Generated documents deletion executed {"userId":"user-123","count":0}[0m

[90mstdout[2m | tests/unit/providers/secrets/windowsCredMan.test.ts[2m > [22m[2mWindowsCredentialManagerProvider[2m > [22m[2mEnvironment variable fallback[2m > [22m[2mshould fallback to environment variables when keytar not available
[22m[39m[WindowsCredentialManagerProvider] Initialized successfully
[WindowsCredentialManagerProvider] Initialized successfully
[WindowsCredentialManagerProvider] Initialized successfully
[WindowsCredentialManagerProvider] Initialized successfully
[WindowsCredentialManagerProvider] Initialized successfully
[WindowsCredentialManagerProvider] Initialized successfully
[WindowsCredentialManagerProvider] Initialized successfully
[WindowsCredentialManagerProvider] Initialized successfully
[WindowsCredentialManagerProvider] Initialized successfully
[WindowsCredentialManagerProvider] Initialized successfully
[WindowsCredentialManagerProvider] Initialized successfully

[90mstdout[2m | tests/unit/dataRetentionAutomation.test.ts[2m > [22m[2mDataRetentionService[2m > [22m[2mexecution[2m > [22m[2mexecutes pending deletions
[22m[39m[32m2026-01-23T16:48:56.309Z [INFO] Deletion completed {"requestId":"del_1769186936300_lz038q4nk","dataType":"generated_documents"}[0m
[32m2026-01-23T16:48:56.309Z [INFO] Executing deletion {"requestId":"del_1769186936300_i4a5kobxq","dataType":"session_logs","hardDelete":true}[0m

[90mstdout[2m | tests/unit/dataRetentionAutomation.test.ts[2m > [22m[2mDataRetentionService[2m > [22m[2mexecution[2m > [22m[2mexecutes pending deletions
[22m[39m[32m2026-01-23T16:48:56.309Z [INFO] Session logs deletion executed {"userId":"user-123"}[0m

[90mstdout[2m | tests/unit/dataRetentionAutomation.test.ts[2m > [22m[2mDataRetentionService[2m > [22m[2mexecution[2m > [22m[2mexecutes pending deletions
[22m[39m[32m2026-01-23T16:48:56.309Z [INFO] Deletion completed {"requestId":"del_1769186936300_i4a5kobxq","dataType":"session_logs"}[0m
[32m2026-01-23T16:48:56.309Z [INFO] Executing deletion {"requestId":"del_1769186936301_l7c33ib2l","dataType":"preferences","hardDelete":true}[0m

[90mstdout[2m | tests/unit/providers/secrets/windowsCredMan.test.ts[2m > [22m[2mWindowsCredentialManagerProvider[2m > [22m[2mConfiguration checking[2m > [22m[2mshould check if specific key is configured
[22m[39m[WindowsCredentialManagerProvider] Initialized successfully

[90mstdout[2m | tests/unit/dataRetentionAutomation.test.ts[2m > [22m[2mDataRetentionService[2m > [22m[2mexecution[2m > [22m[2mexecutes pending deletions
[22m[39m[32m2026-01-23T16:48:56.310Z [INFO] User preferences deletion executed {"userId":"user-123"}[0m

[90mstdout[2m | tests/unit/dataRetentionAutomation.test.ts[2m > [22m[2mDataRetentionService[2m > [22m[2mexecution[2m > [22m[2mexecutes pending deletions
[22m[39m[32m2026-01-23T16:48:56.310Z [INFO] Deletion completed {"requestId":"del_1769186936301_l7c33ib2l","dataType":"preferences"}[0m
[32m2026-01-23T16:48:56.310Z [INFO] Executing deletion {"requestId":"del_1769186936303_62rxmzw24","dataType":"generated_documents","hardDelete":true}[0m

[90mstdout[2m | tests/unit/dataRetentionAutomation.test.ts[2m > [22m[2mDataRetentionService[2m > [22m[2mexecution[2m > [22m[2mexecutes pending deletions
[22m[39m[32m2026-01-23T16:48:56.311Z [INFO] Generated documents deletion executed {"userId":"user-delete-exec","count":1}[0m

[90mstdout[2m | tests/unit/dataRetentionAutomation.test.ts[2m > [22m[2mDataRetentionService[2m > [22m[2mexecution[2m > [22m[2mexecutes pending deletions
[22m[39m[32m2026-01-23T16:48:56.311Z [INFO] Deletion completed {"requestId":"del_1769186936303_62rxmzw24","dataType":"generated_documents"}[0m

[90mstdout[2m | tests/unit/providers/db/sqlite.test.ts[2m > [22m[2mSqliteDbProvider[2m > [22m[2mconnect[2m > [22m[2mshould create database file if it does not exist
[22m[39m[SqliteDbProvider] Connecting to: ./test-data/test.db
[SQLite] PRAGMA journal_mode = WAL
[SQLite] PRAGMA synchronous = NORMAL
[SQLite] PRAGMA cache_size = -64000
[SQLite] PRAGMA temp_store = MEMORY
[SQLite] PRAGMA foreign_keys = ON
[SqliteDbProvider] Connected successfully with WAL mode

[90mstdout[2m | tests/unit/dataRetentionAutomation.test.ts[2m > [22m[2mDataRetentionService[2m > [22m[2mrequest management[2m > [22m[2mgets request status by ID
[22m[39m[32m2026-01-23T16:48:56.314Z [INFO] Deletion request scheduled {"requestId":"del_1769186936314_6y4txrsu0","dataType":"test_type","scheduledAt":"2026-01-24T10:00:00.000Z","status":"approved"}[0m

[90mstdout[2m | tests/unit/providers/db/sqlite.test.ts[2m > [22m[2mSqliteDbProvider[2m > [22m[2mconnect[2m > [22m[2mshould create database file if it does not exist
[22m[39m[SqliteDbProvider] Closing SQLite database

[90mstdout[2m | tests/unit/dataRetentionAutomation.test.ts[2m > [22m[2mDataRetentionService[2m > [22m[2mrequest management[2m > [22m[2mlists pending requests with userId filter
[22m[39m[32m2026-01-23T16:48:56.315Z [INFO] Deletion request scheduled {"requestId":"del_1769186936315_vxzmyuc27","dataType":"test_type","scheduledAt":"2026-01-24T10:00:00.000Z","status":"approved"}[0m

[90mstdout[2m | tests/unit/providers/secrets/windowsCredMan.test.ts[2m > [22m[2mWindowsCredentialManagerProvider[2m > [22m[2mConfiguration checking[2m > [22m[2mshould return list of configured providers
[22m[39m[WindowsCredentialManagerProvider] Initialized successfully

[90mstdout[2m | tests/unit/dataRetentionAutomation.test.ts[2m > [22m[2mDataRetentionService[2m > [22m[2mrequest management[2m > [22m[2mlists pending requests with userId filter
[22m[39m[32m2026-01-23T16:48:56.315Z [INFO] Deletion request scheduled {"requestId":"del_1769186936315_xi0ipns8a","dataType":"test_type","scheduledAt":"2026-01-24T10:00:00.000Z","status":"approved"}[0m

[90mstdout[2m | tests/unit/dataRetentionAutomation.test.ts[2m > [22m[2mDataRetentionService[2m > [22m[2mrequest management[2m > [22m[2mlists pending requests with organizationId filter
[22m[39m[32m2026-01-23T16:48:56.316Z [INFO] Deletion request scheduled {"requestId":"del_1769186936316_a5r1olb0f","dataType":"test_type","scheduledAt":"2026-01-24T10:00:00.000Z","status":"approved"}[0m

[90mstdout[2m | tests/unit/dataRetentionAutomation.test.ts[2m > [22m[2mDataRetentionService[2m > [22m[2mrequest management[2m > [22m[2mlists pending requests with status filter
[22m[39m[32m2026-01-23T16:48:56.317Z [INFO] Deletion request scheduled {"requestId":"del_1769186936317_dgkvpwh5n","dataType":"test_type","scheduledAt":"2026-01-24T10:00:00.000Z","status":"approved"}[0m

[90mstdout[2m | tests/unit/dataRetentionAutomation.test.ts[2m > [22m[2mDataRetentionService[2m > [22m[2mrequest management[2m > [22m[2mlists pending requests with multiple filters
[22m[39m[32m2026-01-23T16:48:56.317Z [INFO] Deletion request scheduled {"requestId":"del_1769186936317_4rbya75fu","dataType":"test_type","scheduledAt":"2026-01-24T10:00:00.000Z","status":"approved"}[0m

 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/dataRetentionAutomation.test.ts[2m > [22mDataRetentionService[2m > [22mconfiguration[2m > [22msets and gets policies[32m 8[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/dataRetentionAutomation.test.ts[2m > [22mDataRetentionService[2m > [22mscheduling[2m > [22mcalculates deletion date correctly[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/dataRetentionAutomation.test.ts[2m > [22mDataRetentionService[2m > [22mscheduling[2m > [22mschedules deletion request[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/dataRetentionAutomation.test.ts[2m > [22mDataRetentionService[2m > [22mscheduling[2m > [22mprocesses user deletion request (GDPR)[32m 4[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/dataRetentionAutomation.test.ts[2m > [22mDataRetentionService[2m > [22mexecution[2m > [22mexecutes pending deletions[32m 10[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/dataRetentionAutomation.test.ts[2m > [22mDataRetentionService[2m > [22mreporting[2m > [22mgenerates retention report[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/dataRetentionAutomation.test.ts[2m > [22mDataRetentionService[2m > [22mrequest management[2m > [22mgets request status by ID[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/dataRetentionAutomation.test.ts[2m > [22mDataRetentionService[2m > [22mrequest management[2m > [22mlists pending requests with userId filter[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/dataRetentionAutomation.test.ts[2m > [22mDataRetentionService[2m > [22mrequest management[2m > [22mlists pending requests with organizationId filter[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/dataRetentionAutomation.test.ts[2m > [22mDataRetentionService[2m > [22mrequest management[2m > [22mlists pending requests with status filter[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/dataRetentionAutomation.test.ts[2m > [22mDataRetentionService[2m > [22mrequest management[2m > [22mlists pending requests with multiple filters[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/providers/secrets/windowsCredMan.test.ts[2m > [22mWindowsCredentialManagerProvider[2m > [22mEnvironment variable fallback[2m > [22mshould fallback to environment variables when keytar not available[32m 115[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/providers/secrets/windowsCredMan.test.ts[2m > [22mWindowsCredentialManagerProvider[2m > [22mConfiguration checking[2m > [22mshould check if specific key is configured[32m 7[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/providers/secrets/windowsCredMan.test.ts[2m > [22mWindowsCredentialManagerProvider[2m > [22mConfiguration checking[2m > [22mshould return list of configured providers[32m 5[2mms[22m[39m
[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2msave[2m > [22m[2mshould handle large files
[22m[39m[LocalFsStorageProvider] File saved successfully: test-data\storage\b5\ee\b5eec3f68ef64d15_large-file.bin

 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/providers/storage/localFs.test.ts[2m > [22mLocalFsStorageProvider[2m > [22mconstructor[2m > [22mshould create base directory on initialization[32m 6[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/providers/storage/localFs.test.ts[2m > [22mLocalFsStorageProvider[2m > [22mconstructor[2m > [22mshould handle existing directory[32m 4[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/providers/storage/localFs.test.ts[2m > [22mLocalFsStorageProvider[2m > [22msave[2m > [22mshould save file with content-addressable path[32m 13[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/providers/storage/localFs.test.ts[2m > [22mLocalFsStorageProvider[2m > [22msave[2m > [22mshould create subdirectories based on hash[32m 8[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/providers/storage/localFs.test.ts[2m > [22mLocalFsStorageProvider[2m > [22msave[2m > [22mshould preserve file extension[32m 10[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/providers/storage/localFs.test.ts[2m > [22mLocalFsStorageProvider[2m > [22msave[2m > [22mshould handle files without extension[32m 9[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/providers/storage/localFs.test.ts[2m > [22mLocalFsStorageProvider[2m > [22msave[2m > [22mshould use same hash for identical content[32m 17[2mms[22m[39m
[90mstdout[2m | tests/unit/providers/db/sqlite.test.ts[2m > [22m[2mSqliteDbProvider[2m > [22m[2mconnect[2m > [22m[2mshould create parent directory if needed
[22m[39m[SqliteDbProvider] Connecting to: ./test-data/deep/nested/test.db
[SqliteDbProvider] Created directory: ./test-data/deep/nested
[SQLite] PRAGMA journal_mode = WAL
[SQLite] PRAGMA synchronous = NORMAL
[SQLite] PRAGMA cache_size = -64000
[SQLite] PRAGMA temp_store = MEMORY
[SQLite] PRAGMA foreign_keys = ON
[SqliteDbProvider] Connected successfully with WAL mode

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2mread[2m > [22m[2mshould read saved file
[22m[39m[LocalFsStorageProvider] Initialized with basePath: ./test-data/storage
[LocalFsStorageProvider] Created base directory: ./test-data/storage

[90mstdout[2m | tests/unit/providers/db/sqlite.test.ts[2m > [22m[2mSqliteDbProvider[2m > [22m[2mconnect[2m > [22m[2mshould create parent directory if needed
[22m[39m[SqliteDbProvider] Closing SQLite database

 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/ai-services.test.ts[2m > [22mAI Services[2m > [22mOpenAI Service[2m > [22mgenerateDocument[2m > [22mgenerates content successfully[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/ai-services.test.ts[2m > [22mAI Services[2m > [22mOpenAI Service[2m > [22mgenerateDocument[2m > [22mhandles errors[32m 2[2mms[22m[39m
[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2mread[2m > [22m[2mshould read saved file
[22m[39m[LocalFsStorageProvider] Saving file: test.txt -> test-data\storage\b6\2d\b62d21710be52010_test.txt

[90mstdout[2m | tests/unit/providers/db/sqlite.test.ts[2m > [22m[2mSqliteDbProvider[2m > [22m[2mconnect[2m > [22m[2mshould enable WAL mode
[22m[39m[SqliteDbProvider] Connecting to: ./test-data/test.db
[SQLite] PRAGMA journal_mode = WAL
[SQLite] PRAGMA synchronous = NORMAL
[SQLite] PRAGMA cache_size = -64000
[SQLite] PRAGMA temp_store = MEMORY
[SQLite] PRAGMA foreign_keys = ON
[SqliteDbProvider] Connected successfully with WAL mode

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2mread[2m > [22m[2mshould read saved file
[22m[39m[LocalFsStorageProvider] Created directory: test-data\storage\b6\2d

[90mstdout[2m | tests/unit/providers/db/sqlite.test.ts[2m > [22m[2mSqliteDbProvider[2m > [22m[2mconnect[2m > [22m[2mshould enable WAL mode
[22m[39m[SQLite] PRAGMA page_count
[SQLite] PRAGMA page_size
[SQLite] PRAGMA journal_mode

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2mread[2m > [22m[2mshould read saved file
[22m[39m[LocalFsStorageProvider] File saved successfully: test-data\storage\b6\2d\b62d21710be52010_test.txt

[90mstdout[2m | tests/unit/providers/db/sqlite.test.ts[2m > [22m[2mSqliteDbProvider[2m > [22m[2mconnect[2m > [22m[2mshould enable WAL mode
[22m[39m[SqliteDbProvider] Closing SQLite database

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2mread[2m > [22m[2mshould read saved file
[22m[39m[LocalFsStorageProvider] Reading file: test-data\storage\b6\2d\b62d21710be52010_test.txt

[90mstdout[2m | tests/unit/providers/db/sqlite.test.ts[2m > [22m[2mSqliteDbProvider[2m > [22m[2mmigrate[2m > [22m[2mshould create migrations table
[22m[39m[SqliteDbProvider] Connecting to: ./test-data/test.db
[SQLite] PRAGMA journal_mode = WAL
[SQLite] PRAGMA synchronous = NORMAL
[SQLite] PRAGMA cache_size = -64000
[SQLite] PRAGMA temp_store = MEMORY
[SQLite] PRAGMA foreign_keys = ON
[SqliteDbProvider] Connected successfully with WAL mode

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2mread[2m > [22m[2mshould read saved file
[22m[39m[LocalFsStorageProvider] File read successfully: test-data\storage\b6\2d\b62d21710be52010_test.txt (17 bytes)

[90mstdout[2m | tests/unit/providers/db/sqlite.test.ts[2m > [22m[2mSqliteDbProvider[2m > [22m[2mmigrate[2m > [22m[2mshould create migrations table
[22m[39m[SqliteDbProvider] Starting database migration...
[SQLite] CREATE TABLE IF NOT EXISTS _migrations (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        version INTEGER NOT NULL UNIQUE,
        name TEXT NOT NULL,
        applied_at TEXT NOT NULL DEFAULT (datetime('now'))
      )
    
[SQLite] SELECT COALESCE(MAX(version), 0) as version FROM _migrations
[SqliteDbProvider] Current schema version: 0
[SqliteDbProvider] Applying 1 migration(s)...
[SqliteDbProvider] Applying migration 1: initial_schema
[SQLite] BEGIN
[SQLite] -- Users table
      CREATE TABLE IF NOT EXISTS users (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        email TEXT NOT NULL UNIQUE,
        password_hash TEXT,
        first_name TEXT,
        last_name TEXT,
        role TEXT NOT NULL DEFAULT 'user' CHECK(role IN ('admin', 'user', 'auditor')),
        organization_id INTEGER,
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        updated_at TEXT NOT NULL DEFAULT (datetime('now')),
        last_login_at TEXT,
        is_active INTEGER NOT NULL DEFAULT 1,
        email_verified INTEGER NOT NULL DEFAULT 0,
        mfa_enabled INTEGER NOT NULL DEFAULT 0,
        mfa_secret TEXT
      );
[SQLite] -- Organizations table
      CREATE TABLE IF NOT EXISTS organizations (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        name TEXT NOT NULL,
        slug TEXT NOT NULL UNIQUE,
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        updated_at TEXT NOT NULL DEFAULT (datetime('now')),
        settings TEXT,
        subscription_tier TEXT DEFAULT 'free' CHECK(subscription_tier IN ('free', 'pro', 'enterprise'))
      );
[SQLite] -- Documents table
      CREATE TABLE IF NOT EXISTS documents (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        title TEXT NOT NULL,
        content TEXT NOT NULL,
        document_type TEXT NOT NULL CHECK(document_type IN ('policy', 'procedure', 'plan', 'manual', 'other')),
        framework TEXT CHECK(framework IN ('iso27001', 'soc2', 'fedramp', 'nist')),
        status TEXT NOT NULL DEFAULT 'draft' CHECK(status IN ('draft', 'in_review', 'approved', 'published', 'archived')),
        version INTEGER NOT NULL DEFAULT 1,
        organization_id INTEGER NOT NULL,
        created_by INTEGER NOT NULL,
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        updated_at TEXT NOT NULL DEFAULT (datetime('now')),
        published_at TEXT,
        metadata TEXT,
        FOREIGN KEY (organization_id) REFERENCES organizations(id),
        FOREIGN KEY (created_by) REFERENCES users(id)
      );
[SQLite] -- Document versions table
      CREATE TABLE IF NOT EXISTS document_versions (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        document_id INTEGER NOT NULL,
        version INTEGER NOT NULL,
        content TEXT NOT NULL,
        created_by INTEGER NOT NULL,
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        change_summary TEXT,
        FOREIGN KEY (document_id) REFERENCES documents(id),
        FOREIGN KEY (created_by) REFERENCES users(id)
      );
[SQLite] -- Gap analysis table
      CREATE TABLE IF NOT EXISTS gap_analysis (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        organization_id INTEGER NOT NULL,
        framework TEXT NOT NULL CHECK(framework IN ('iso27001', 'soc2', 'fedramp', 'nist')),
        control_id TEXT NOT NULL,
        control_name TEXT NOT NULL,
        status TEXT NOT NULL CHECK(status IN ('not_implemented', 'partially_implemented', 'fully_implemented', 'not_applicable')),
        gap_description TEXT,
        remediation_plan TEXT,
        priority TEXT CHECK(priority IN ('critical', 'high', 'medium', 'low')),
        target_date TEXT,
        assigned_to INTEGER,
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        updated_at TEXT NOT NULL DEFAULT (datetime('now')),
        FOREIGN KEY (organization_id) REFERENCES organizations(id),
        FOREIGN KEY (assigned_to) REFERENCES users(id)
      );
[SQLite] -- Risk assessments table
      CREATE TABLE IF NOT EXISTS risk_assessments (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        organization_id INTEGER NOT NULL,
        risk_name TEXT NOT NULL,
        description TEXT,
        likelihood TEXT CHECK(likelihood IN ('very_low', 'low', 'medium', 'high', 'very_high')),
        impact TEXT CHECK(impact IN ('very_low', 'low', 'medium', 'high', 'very_high')),
        risk_score INTEGER,
        mitigation_plan TEXT,
        status TEXT NOT NULL DEFAULT 'open' CHECK(status IN ('open', 'mitigated', 'accepted', 'closed')),
        owner INTEGER,
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        updated_at TEXT NOT NULL DEFAULT (datetime('now')),
        FOREIGN KEY (organization_id) REFERENCES organizations(id),
        FOREIGN KEY (owner) REFERENCES users(id)
      );
[SQLite] -- Audit logs table
      CREATE TABLE IF NOT EXISTS audit_logs (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        organization_id INTEGER,
        user_id INTEGER,
        action TEXT NOT NULL,
        resource_type TEXT NOT NULL,
        resource_id TEXT,
        details TEXT,
        ip_address TEXT,
        user_agent TEXT,
        risk_level TEXT CHECK(risk_level IN ('low', 'medium', 'high', 'critical')),
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        FOREIGN KEY (organization_id) REFERENCES organizations(id),
        FOREIGN KEY (user_id) REFERENCES users(id)
      );
[SQLite] -- Files/Storage metadata table
      CREATE TABLE IF NOT EXISTS storage_files (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        organization_id INTEGER NOT NULL,
        file_path TEXT NOT NULL,
        uri TEXT NOT NULL UNIQUE,
        size INTEGER NOT NULL,
        content_type TEXT NOT NULL,
        hash TEXT,
        uploaded_by INTEGER,
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        FOREIGN KEY (organization_id) REFERENCES organizations(id),
        FOREIGN KEY (uploaded_by) REFERENCES users(id)
      );
[SQLite] -- Create indexes for common queries
      CREATE INDEX IF NOT EXISTS idx_users_email ON users(email);
[SQLite] CREATE INDEX IF NOT EXISTS idx_users_org ON users(organization_id);
[SQLite] CREATE INDEX IF NOT EXISTS idx_documents_org ON documents(organization_id);
[SQLite] CREATE INDEX IF NOT EXISTS idx_documents_framework ON documents(framework);
[SQLite] CREATE INDEX IF NOT EXISTS idx_gap_analysis_org ON gap_analysis(organization_id);
[SQLite] CREATE INDEX IF NOT EXISTS idx_audit_logs_org ON audit_logs(organization_id);
[SQLite] CREATE INDEX IF NOT EXISTS idx_audit_logs_created ON audit_logs(created_at);
[SQLite] CREATE INDEX IF NOT EXISTS idx_storage_files_org ON storage_files(organization_id);
[SQLite] -- Insert default local organization for local mode
      INSERT OR IGNORE INTO organizations (id, name, slug, settings)
      VALUES (1, 'Local Workspace', 'local', '{}');
[SQLite] -- Insert default local admin user for local mode
      INSERT OR IGNORE INTO users (id, email, role, first_name, last_name, organization_id, is_active)
      VALUES (1, 'admin@local', 'admin', 'Local', 'Admin', 1, 1);
[SQLite] INSERT INTO _migrations (version, name) VALUES (1.0, 'initial_schema')
[SQLite] COMMIT
[SqliteDbProvider] Migration 1 applied successfully
[SqliteDbProvider] Migration complete

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2mread[2m > [22m[2mshould throw error for non-existent file
[22m[39m[LocalFsStorageProvider] Initialized with basePath: ./test-data/storage
[LocalFsStorageProvider] Created base directory: ./test-data/storage

[90mstdout[2m | tests/unit/providers/db/sqlite.test.ts[2m > [22m[2mSqliteDbProvider[2m > [22m[2mmigrate[2m > [22m[2mshould create migrations table
[22m[39m[SQLite] SELECT name FROM sqlite_master WHERE type='table' AND name='_migrations'

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2mread[2m > [22m[2mshould throw error for non-existent file
[22m[39m[LocalFsStorageProvider] Reading file: test-data\storage\does-not-exist.txt

[90mstdout[2m | tests/unit/providers/db/sqlite.test.ts[2m > [22m[2mSqliteDbProvider[2m > [22m[2mmigrate[2m > [22m[2mshould create migrations table
[22m[39m[SqliteDbProvider] Closing SQLite database

stderr | tests/unit/providers/storage/localFs.test.ts > LocalFsStorageProvider > read > should throw error for non-existent file
[LocalFsStorageProvider] Read error: Error: ENOENT: no such file or directory, open 'C:\software\cyberdocgen\test-data\storage\does-not-exist.txt'
    at open (node:internal/fs/promises:639:25)
    at Object.readFile (node:internal/fs/promises:1243:14)
    at LocalFsStorageProvider.read (C:\software\cyberdocgen\server\providers\storage\localFs.ts:120:22)
    at C:\software\cyberdocgen\tests\unit\providers\storage\localFs.test.ts:155:7
    at file:///C:/software/cyberdocgen/node_modules/@vitest/runner/dist/chunk-hooks.js:752:20 {
  errno: -4058,
  code: 'ENOENT',
  syscall: 'open',
  path: 'C:\\software\\cyberdocgen\\test-data\\storage\\does-not-exist.txt'
}

[90mstdout[2m | tests/unit/providers/db/sqlite.test.ts[2m > [22m[2mSqliteDbProvider[2m > [22m[2mmigrate[2m > [22m[2mshould apply initial schema migration
[22m[39m[SqliteDbProvider] Connecting to: ./test-data/test.db
[SQLite] PRAGMA journal_mode = WAL
[SQLite] PRAGMA synchronous = NORMAL
[SQLite] PRAGMA cache_size = -64000
[SQLite] PRAGMA temp_store = MEMORY
[SQLite] PRAGMA foreign_keys = ON
[SqliteDbProvider] Connected successfully with WAL mode

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2mread[2m > [22m[2mshould prevent path traversal attacks
[22m[39m[LocalFsStorageProvider] Initialized with basePath: ./test-data/storage
[LocalFsStorageProvider] Created base directory: ./test-data/storage

[90mstdout[2m | tests/unit/providers/db/sqlite.test.ts[2m > [22m[2mSqliteDbProvider[2m > [22m[2mmigrate[2m > [22m[2mshould apply initial schema migration
[22m[39m[SqliteDbProvider] Starting database migration...
[SQLite] CREATE TABLE IF NOT EXISTS _migrations (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        version INTEGER NOT NULL UNIQUE,
        name TEXT NOT NULL,
        applied_at TEXT NOT NULL DEFAULT (datetime('now'))
      )
    
[SQLite] SELECT COALESCE(MAX(version), 0) as version FROM _migrations
[SqliteDbProvider] Current schema version: 0
[SqliteDbProvider] Applying 1 migration(s)...
[SqliteDbProvider] Applying migration 1: initial_schema
[SQLite] BEGIN
[SQLite] -- Users table
      CREATE TABLE IF NOT EXISTS users (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        email TEXT NOT NULL UNIQUE,
        password_hash TEXT,
        first_name TEXT,
        last_name TEXT,
        role TEXT NOT NULL DEFAULT 'user' CHECK(role IN ('admin', 'user', 'auditor')),
        organization_id INTEGER,
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        updated_at TEXT NOT NULL DEFAULT (datetime('now')),
        last_login_at TEXT,
        is_active INTEGER NOT NULL DEFAULT 1,
        email_verified INTEGER NOT NULL DEFAULT 0,
        mfa_enabled INTEGER NOT NULL DEFAULT 0,
        mfa_secret TEXT
      );
[SQLite] -- Organizations table
      CREATE TABLE IF NOT EXISTS organizations (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        name TEXT NOT NULL,
        slug TEXT NOT NULL UNIQUE,
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        updated_at TEXT NOT NULL DEFAULT (datetime('now')),
        settings TEXT,
        subscription_tier TEXT DEFAULT 'free' CHECK(subscription_tier IN ('free', 'pro', 'enterprise'))
      );
[SQLite] -- Documents table
      CREATE TABLE IF NOT EXISTS documents (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        title TEXT NOT NULL,
        content TEXT NOT NULL,
        document_type TEXT NOT NULL CHECK(document_type IN ('policy', 'procedure', 'plan', 'manual', 'other')),
        framework TEXT CHECK(framework IN ('iso27001', 'soc2', 'fedramp', 'nist')),
        status TEXT NOT NULL DEFAULT 'draft' CHECK(status IN ('draft', 'in_review', 'approved', 'published', 'archived')),
        version INTEGER NOT NULL DEFAULT 1,
        organization_id INTEGER NOT NULL,
        created_by INTEGER NOT NULL,
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        updated_at TEXT NOT NULL DEFAULT (datetime('now')),
        published_at TEXT,
        metadata TEXT,
        FOREIGN KEY (organization_id) REFERENCES organizations(id),
        FOREIGN KEY (created_by) REFERENCES users(id)
      );
[SQLite] -- Document versions table
      CREATE TABLE IF NOT EXISTS document_versions (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        document_id INTEGER NOT NULL,
        version INTEGER NOT NULL,
        content TEXT NOT NULL,
        created_by INTEGER NOT NULL,
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        change_summary TEXT,
        FOREIGN KEY (document_id) REFERENCES documents(id),
        FOREIGN KEY (created_by) REFERENCES users(id)
      );
[SQLite] -- Gap analysis table
      CREATE TABLE IF NOT EXISTS gap_analysis (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        organization_id INTEGER NOT NULL,
        framework TEXT NOT NULL CHECK(framework IN ('iso27001', 'soc2', 'fedramp', 'nist')),
        control_id TEXT NOT NULL,
        control_name TEXT NOT NULL,
        status TEXT NOT NULL CHECK(status IN ('not_implemented', 'partially_implemented', 'fully_implemented', 'not_applicable')),
        gap_description TEXT,
        remediation_plan TEXT,
        priority TEXT CHECK(priority IN ('critical', 'high', 'medium', 'low')),
        target_date TEXT,
        assigned_to INTEGER,
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        updated_at TEXT NOT NULL DEFAULT (datetime('now')),
        FOREIGN KEY (organization_id) REFERENCES organizations(id),
        FOREIGN KEY (assigned_to) REFERENCES users(id)
      );
[SQLite] -- Risk assessments table
      CREATE TABLE IF NOT EXISTS risk_assessments (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        organization_id INTEGER NOT NULL,
        risk_name TEXT NOT NULL,
        description TEXT,
        likelihood TEXT CHECK(likelihood IN ('very_low', 'low', 'medium', 'high', 'very_high')),
        impact TEXT CHECK(impact IN ('very_low', 'low', 'medium', 'high', 'very_high')),
        risk_score INTEGER,
        mitigation_plan TEXT,
        status TEXT NOT NULL DEFAULT 'open' CHECK(status IN ('open', 'mitigated', 'accepted', 'closed')),
        owner INTEGER,
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        updated_at TEXT NOT NULL DEFAULT (datetime('now')),
        FOREIGN KEY (organization_id) REFERENCES organizations(id),
        FOREIGN KEY (owner) REFERENCES users(id)
      );
[SQLite] -- Audit logs table
      CREATE TABLE IF NOT EXISTS audit_logs (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        organization_id INTEGER,
        user_id INTEGER,
        action TEXT NOT NULL,
        resource_type TEXT NOT NULL,
        resource_id TEXT,
        details TEXT,
        ip_address TEXT,
        user_agent TEXT,
        risk_level TEXT CHECK(risk_level IN ('low', 'medium', 'high', 'critical')),
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        FOREIGN KEY (organization_id) REFERENCES organizations(id),
        FOREIGN KEY (user_id) REFERENCES users(id)
      );
[SQLite] -- Files/Storage metadata table
      CREATE TABLE IF NOT EXISTS storage_files (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        organization_id INTEGER NOT NULL,
        file_path TEXT NOT NULL,
        uri TEXT NOT NULL UNIQUE,
        size INTEGER NOT NULL,
        content_type TEXT NOT NULL,
        hash TEXT,
        uploaded_by INTEGER,
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        FOREIGN KEY (organization_id) REFERENCES organizations(id),
        FOREIGN KEY (uploaded_by) REFERENCES users(id)
      );
[SQLite] -- Create indexes for common queries
      CREATE INDEX IF NOT EXISTS idx_users_email ON users(email);
[SQLite] CREATE INDEX IF NOT EXISTS idx_users_org ON users(organization_id);
[SQLite] CREATE INDEX IF NOT EXISTS idx_documents_org ON documents(organization_id);
[SQLite] CREATE INDEX IF NOT EXISTS idx_documents_framework ON documents(framework);
[SQLite] CREATE INDEX IF NOT EXISTS idx_gap_analysis_org ON gap_analysis(organization_id);
[SQLite] CREATE INDEX IF NOT EXISTS idx_audit_logs_org ON audit_logs(organization_id);
[SQLite] CREATE INDEX IF NOT EXISTS idx_audit_logs_created ON audit_logs(created_at);
[SQLite] CREATE INDEX IF NOT EXISTS idx_storage_files_org ON storage_files(organization_id);
[SQLite] -- Insert default local organization for local mode
      INSERT OR IGNORE INTO organizations (id, name, slug, settings)
      VALUES (1, 'Local Workspace', 'local', '{}');
[SQLite] -- Insert default local admin user for local mode
      INSERT OR IGNORE INTO users (id, email, role, first_name, last_name, organization_id, is_active)
      VALUES (1, 'admin@local', 'admin', 'Local', 'Admin', 1, 1);
[SQLite] INSERT INTO _migrations (version, name) VALUES (1.0, 'initial_schema')
[SQLite] COMMIT
[SqliteDbProvider] Migration 1 applied successfully
[SqliteDbProvider] Migration complete

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2mread[2m > [22m[2mshould prevent absolute path access outside base
[22m[39m[LocalFsStorageProvider] Initialized with basePath: ./test-data/storage
[LocalFsStorageProvider] Created base directory: ./test-data/storage

[90mstdout[2m | tests/unit/providers/db/sqlite.test.ts[2m > [22m[2mSqliteDbProvider[2m > [22m[2mmigrate[2m > [22m[2mshould apply initial schema migration
[22m[39m[SQLite] SELECT name FROM sqlite_master WHERE type='table' ORDER BY name

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2mexists[2m > [22m[2mshould return true for existing file
[22m[39m[LocalFsStorageProvider] Initialized with basePath: ./test-data/storage
[LocalFsStorageProvider] Created base directory: ./test-data/storage

[90mstdout[2m | tests/unit/providers/db/sqlite.test.ts[2m > [22m[2mSqliteDbProvider[2m > [22m[2mmigrate[2m > [22m[2mshould apply initial schema migration
[22m[39m[SqliteDbProvider] Closing SQLite database

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2mexists[2m > [22m[2mshould return true for existing file
[22m[39m[LocalFsStorageProvider] Saving file: test.txt -> test-data\storage\ba\23\ba23ce4050e44905_test.txt

 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/providers/db/sqlite.test.ts[2m > [22mSqliteDbProvider[2m > [22mconnect[2m > [22mshould create database file if it does not exist[32m 23[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/providers/db/sqlite.test.ts[2m > [22mSqliteDbProvider[2m > [22mconnect[2m > [22mshould create parent directory if needed[32m 14[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/providers/db/sqlite.test.ts[2m > [22mSqliteDbProvider[2m > [22mconnect[2m > [22mshould enable WAL mode[32m 13[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/providers/db/sqlite.test.ts[2m > [22mSqliteDbProvider[2m > [22mmigrate[2m > [22mshould create migrations table[32m 24[2mms[22m[39m
[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2mexists[2m > [22m[2mshould return true for existing file
[22m[39m[LocalFsStorageProvider] Created directory: test-data\storage\ba\23

[90mstdout[2m | tests/unit/providers/db/sqlite.test.ts[2m > [22m[2mSqliteDbProvider[2m > [22m[2mmigrate[2m > [22m[2mshould insert default local organization and user
[22m[39m[SqliteDbProvider] Connecting to: ./test-data/test.db
[SQLite] PRAGMA journal_mode = WAL
[SQLite] PRAGMA synchronous = NORMAL
[SQLite] PRAGMA cache_size = -64000
[SQLite] PRAGMA temp_store = MEMORY
[SQLite] PRAGMA foreign_keys = ON
[SqliteDbProvider] Connected successfully with WAL mode

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2mexists[2m > [22m[2mshould return true for existing file
[22m[39m[LocalFsStorageProvider] File saved successfully: test-data\storage\ba\23\ba23ce4050e44905_test.txt

[90mstdout[2m | tests/unit/providers/db/sqlite.test.ts[2m > [22m[2mSqliteDbProvider[2m > [22m[2mmigrate[2m > [22m[2mshould insert default local organization and user
[22m[39m[SqliteDbProvider] Starting database migration...
[SQLite] CREATE TABLE IF NOT EXISTS _migrations (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        version INTEGER NOT NULL UNIQUE,
        name TEXT NOT NULL,
        applied_at TEXT NOT NULL DEFAULT (datetime('now'))
      )
    
[SQLite] SELECT COALESCE(MAX(version), 0) as version FROM _migrations
[SqliteDbProvider] Current schema version: 0
[SqliteDbProvider] Applying 1 migration(s)...
[SqliteDbProvider] Applying migration 1: initial_schema
[SQLite] BEGIN
[SQLite] -- Users table
      CREATE TABLE IF NOT EXISTS users (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        email TEXT NOT NULL UNIQUE,
        password_hash TEXT,
        first_name TEXT,
        last_name TEXT,
        role TEXT NOT NULL DEFAULT 'user' CHECK(role IN ('admin', 'user', 'auditor')),
        organization_id INTEGER,
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        updated_at TEXT NOT NULL DEFAULT (datetime('now')),
        last_login_at TEXT,
        is_active INTEGER NOT NULL DEFAULT 1,
        email_verified INTEGER NOT NULL DEFAULT 0,
        mfa_enabled INTEGER NOT NULL DEFAULT 0,
        mfa_secret TEXT
      );
[SQLite] -- Organizations table
      CREATE TABLE IF NOT EXISTS organizations (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        name TEXT NOT NULL,
        slug TEXT NOT NULL UNIQUE,
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        updated_at TEXT NOT NULL DEFAULT (datetime('now')),
        settings TEXT,
        subscription_tier TEXT DEFAULT 'free' CHECK(subscription_tier IN ('free', 'pro', 'enterprise'))
      );
[SQLite] -- Documents table
      CREATE TABLE IF NOT EXISTS documents (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        title TEXT NOT NULL,
        content TEXT NOT NULL,
        document_type TEXT NOT NULL CHECK(document_type IN ('policy', 'procedure', 'plan', 'manual', 'other')),
        framework TEXT CHECK(framework IN ('iso27001', 'soc2', 'fedramp', 'nist')),
        status TEXT NOT NULL DEFAULT 'draft' CHECK(status IN ('draft', 'in_review', 'approved', 'published', 'archived')),
        version INTEGER NOT NULL DEFAULT 1,
        organization_id INTEGER NOT NULL,
        created_by INTEGER NOT NULL,
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        updated_at TEXT NOT NULL DEFAULT (datetime('now')),
        published_at TEXT,
        metadata TEXT,
        FOREIGN KEY (organization_id) REFERENCES organizations(id),
        FOREIGN KEY (created_by) REFERENCES users(id)
      );
[SQLite] -- Document versions table
      CREATE TABLE IF NOT EXISTS document_versions (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        document_id INTEGER NOT NULL,
        version INTEGER NOT NULL,
        content TEXT NOT NULL,
        created_by INTEGER NOT NULL,
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        change_summary TEXT,
        FOREIGN KEY (document_id) REFERENCES documents(id),
        FOREIGN KEY (created_by) REFERENCES users(id)
      );
[SQLite] -- Gap analysis table
      CREATE TABLE IF NOT EXISTS gap_analysis (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        organization_id INTEGER NOT NULL,
        framework TEXT NOT NULL CHECK(framework IN ('iso27001', 'soc2', 'fedramp', 'nist')),
        control_id TEXT NOT NULL,
        control_name TEXT NOT NULL,
        status TEXT NOT NULL CHECK(status IN ('not_implemented', 'partially_implemented', 'fully_implemented', 'not_applicable')),
        gap_description TEXT,
        remediation_plan TEXT,
        priority TEXT CHECK(priority IN ('critical', 'high', 'medium', 'low')),
        target_date TEXT,
        assigned_to INTEGER,
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        updated_at TEXT NOT NULL DEFAULT (datetime('now')),
        FOREIGN KEY (organization_id) REFERENCES organizations(id),
        FOREIGN KEY (assigned_to) REFERENCES users(id)
      );
[SQLite] -- Risk assessments table
      CREATE TABLE IF NOT EXISTS risk_assessments (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        organization_id INTEGER NOT NULL,
        risk_name TEXT NOT NULL,
        description TEXT,
        likelihood TEXT CHECK(likelihood IN ('very_low', 'low', 'medium', 'high', 'very_high')),
        impact TEXT CHECK(impact IN ('very_low', 'low', 'medium', 'high', 'very_high')),
        risk_score INTEGER,
        mitigation_plan TEXT,
        status TEXT NOT NULL DEFAULT 'open' CHECK(status IN ('open', 'mitigated', 'accepted', 'closed')),
        owner INTEGER,
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        updated_at TEXT NOT NULL DEFAULT (datetime('now')),
        FOREIGN KEY (organization_id) REFERENCES organizations(id),
        FOREIGN KEY (owner) REFERENCES users(id)
      );
[SQLite] -- Audit logs table
      CREATE TABLE IF NOT EXISTS audit_logs (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        organization_id INTEGER,
        user_id INTEGER,
        action TEXT NOT NULL,
        resource_type TEXT NOT NULL,
        resource_id TEXT,
        details TEXT,
        ip_address TEXT,
        user_agent TEXT,
        risk_level TEXT CHECK(risk_level IN ('low', 'medium', 'high', 'critical')),
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        FOREIGN KEY (organization_id) REFERENCES organizations(id),
        FOREIGN KEY (user_id) REFERENCES users(id)
      );
[SQLite] -- Files/Storage metadata table
      CREATE TABLE IF NOT EXISTS storage_files (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        organization_id INTEGER NOT NULL,
        file_path TEXT NOT NULL,
        uri TEXT NOT NULL UNIQUE,
        size INTEGER NOT NULL,
        content_type TEXT NOT NULL,
        hash TEXT,
        uploaded_by INTEGER,
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        FOREIGN KEY (organization_id) REFERENCES organizations(id),
        FOREIGN KEY (uploaded_by) REFERENCES users(id)
      );
[SQLite] -- Create indexes for common queries
      CREATE INDEX IF NOT EXISTS idx_users_email ON users(email);
[SQLite] CREATE INDEX IF NOT EXISTS idx_users_org ON users(organization_id);
[SQLite] CREATE INDEX IF NOT EXISTS idx_documents_org ON documents(organization_id);
[SQLite] CREATE INDEX IF NOT EXISTS idx_documents_framework ON documents(framework);
[SQLite] CREATE INDEX IF NOT EXISTS idx_gap_analysis_org ON gap_analysis(organization_id);
[SQLite] CREATE INDEX IF NOT EXISTS idx_audit_logs_org ON audit_logs(organization_id);
[SQLite] CREATE INDEX IF NOT EXISTS idx_audit_logs_created ON audit_logs(created_at);
[SQLite] CREATE INDEX IF NOT EXISTS idx_storage_files_org ON storage_files(organization_id);
[SQLite] -- Insert default local organization for local mode
      INSERT OR IGNORE INTO organizations (id, name, slug, settings)
      VALUES (1, 'Local Workspace', 'local', '{}');
[SQLite] -- Insert default local admin user for local mode
      INSERT OR IGNORE INTO users (id, email, role, first_name, last_name, organization_id, is_active)
      VALUES (1, 'admin@local', 'admin', 'Local', 'Admin', 1, 1);
[SQLite] INSERT INTO _migrations (version, name) VALUES (1.0, 'initial_schema')
[SQLite] COMMIT
[SqliteDbProvider] Migration 1 applied successfully
[SqliteDbProvider] Migration complete

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2mexists[2m > [22m[2mshould return false for non-existent file
[22m[39m[LocalFsStorageProvider] Initialized with basePath: ./test-data/storage
[LocalFsStorageProvider] Created base directory: ./test-data/storage

[90mstdout[2m | tests/unit/providers/db/sqlite.test.ts[2m > [22m[2mSqliteDbProvider[2m > [22m[2mmigrate[2m > [22m[2mshould insert default local organization and user
[22m[39m[SQLite] SELECT id, name FROM organizations WHERE id = 1

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2mexists[2m > [22m[2mshould return false for path traversal attempts
[22m[39m[LocalFsStorageProvider] Initialized with basePath: ./test-data/storage
[LocalFsStorageProvider] Created base directory: ./test-data/storage

[90mstdout[2m | tests/unit/providers/db/sqlite.test.ts[2m > [22m[2mSqliteDbProvider[2m > [22m[2mmigrate[2m > [22m[2mshould insert default local organization and user
[22m[39m[SQLite] SELECT id, email FROM users WHERE id = 1

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2mdelete[2m > [22m[2mshould delete existing file
[22m[39m[LocalFsStorageProvider] Initialized with basePath: ./test-data/storage
[LocalFsStorageProvider] Created base directory: ./test-data/storage

[90mstdout[2m | tests/unit/providers/db/sqlite.test.ts[2m > [22m[2mSqliteDbProvider[2m > [22m[2mmigrate[2m > [22m[2mshould insert default local organization and user
[22m[39m[SqliteDbProvider] Closing SQLite database

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2mdelete[2m > [22m[2mshould delete existing file
[22m[39m[LocalFsStorageProvider] Saving file: test.txt -> test-data\storage\34\c1\34c16b11d97051f3_test.txt

[90mstdout[2m | tests/unit/providers/db/sqlite.test.ts[2m > [22m[2mSqliteDbProvider[2m > [22m[2mmigrate[2m > [22m[2mshould not re-apply migrations on second run
[22m[39m[SqliteDbProvider] Connecting to: ./test-data/test.db
[SQLite] PRAGMA journal_mode = WAL
[SQLite] PRAGMA synchronous = NORMAL
[SQLite] PRAGMA cache_size = -64000
[SQLite] PRAGMA temp_store = MEMORY
[SQLite] PRAGMA foreign_keys = ON
[SqliteDbProvider] Connected successfully with WAL mode

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2mdelete[2m > [22m[2mshould delete existing file
[22m[39m[LocalFsStorageProvider] Created directory: test-data\storage\34\c1

[90mstdout[2m | tests/unit/providers/db/sqlite.test.ts[2m > [22m[2mSqliteDbProvider[2m > [22m[2mmigrate[2m > [22m[2mshould not re-apply migrations on second run
[22m[39m[SqliteDbProvider] Starting database migration...
[SQLite] CREATE TABLE IF NOT EXISTS _migrations (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        version INTEGER NOT NULL UNIQUE,
        name TEXT NOT NULL,
        applied_at TEXT NOT NULL DEFAULT (datetime('now'))
      )
    
[SQLite] SELECT COALESCE(MAX(version), 0) as version FROM _migrations
[SqliteDbProvider] Current schema version: 0
[SqliteDbProvider] Applying 1 migration(s)...
[SqliteDbProvider] Applying migration 1: initial_schema
[SQLite] BEGIN
[SQLite] -- Users table
      CREATE TABLE IF NOT EXISTS users (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        email TEXT NOT NULL UNIQUE,
        password_hash TEXT,
        first_name TEXT,
        last_name TEXT,
        role TEXT NOT NULL DEFAULT 'user' CHECK(role IN ('admin', 'user', 'auditor')),
        organization_id INTEGER,
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        updated_at TEXT NOT NULL DEFAULT (datetime('now')),
        last_login_at TEXT,
        is_active INTEGER NOT NULL DEFAULT 1,
        email_verified INTEGER NOT NULL DEFAULT 0,
        mfa_enabled INTEGER NOT NULL DEFAULT 0,
        mfa_secret TEXT
      );
[SQLite] -- Organizations table
      CREATE TABLE IF NOT EXISTS organizations (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        name TEXT NOT NULL,
        slug TEXT NOT NULL UNIQUE,
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        updated_at TEXT NOT NULL DEFAULT (datetime('now')),
        settings TEXT,
        subscription_tier TEXT DEFAULT 'free' CHECK(subscription_tier IN ('free', 'pro', 'enterprise'))
      );
[SQLite] -- Documents table
      CREATE TABLE IF NOT EXISTS documents (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        title TEXT NOT NULL,
        content TEXT NOT NULL,
        document_type TEXT NOT NULL CHECK(document_type IN ('policy', 'procedure', 'plan', 'manual', 'other')),
        framework TEXT CHECK(framework IN ('iso27001', 'soc2', 'fedramp', 'nist')),
        status TEXT NOT NULL DEFAULT 'draft' CHECK(status IN ('draft', 'in_review', 'approved', 'published', 'archived')),
        version INTEGER NOT NULL DEFAULT 1,
        organization_id INTEGER NOT NULL,
        created_by INTEGER NOT NULL,
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        updated_at TEXT NOT NULL DEFAULT (datetime('now')),
        published_at TEXT,
        metadata TEXT,
        FOREIGN KEY (organization_id) REFERENCES organizations(id),
        FOREIGN KEY (created_by) REFERENCES users(id)
      );
[SQLite] -- Document versions table
      CREATE TABLE IF NOT EXISTS document_versions (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        document_id INTEGER NOT NULL,
        version INTEGER NOT NULL,
        content TEXT NOT NULL,
        created_by INTEGER NOT NULL,
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        change_summary TEXT,
        FOREIGN KEY (document_id) REFERENCES documents(id),
        FOREIGN KEY (created_by) REFERENCES users(id)
      );
[SQLite] -- Gap analysis table
      CREATE TABLE IF NOT EXISTS gap_analysis (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        organization_id INTEGER NOT NULL,
        framework TEXT NOT NULL CHECK(framework IN ('iso27001', 'soc2', 'fedramp', 'nist')),
        control_id TEXT NOT NULL,
        control_name TEXT NOT NULL,
        status TEXT NOT NULL CHECK(status IN ('not_implemented', 'partially_implemented', 'fully_implemented', 'not_applicable')),
        gap_description TEXT,
        remediation_plan TEXT,
        priority TEXT CHECK(priority IN ('critical', 'high', 'medium', 'low')),
        target_date TEXT,
        assigned_to INTEGER,
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        updated_at TEXT NOT NULL DEFAULT (datetime('now')),
        FOREIGN KEY (organization_id) REFERENCES organizations(id),
        FOREIGN KEY (assigned_to) REFERENCES users(id)
      );
[SQLite] -- Risk assessments table
      CREATE TABLE IF NOT EXISTS risk_assessments (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        organization_id INTEGER NOT NULL,
        risk_name TEXT NOT NULL,
        description TEXT,
        likelihood TEXT CHECK(likelihood IN ('very_low', 'low', 'medium', 'high', 'very_high')),
        impact TEXT CHECK(impact IN ('very_low', 'low', 'medium', 'high', 'very_high')),
        risk_score INTEGER,
        mitigation_plan TEXT,
        status TEXT NOT NULL DEFAULT 'open' CHECK(status IN ('open', 'mitigated', 'accepted', 'closed')),
        owner INTEGER,
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        updated_at TEXT NOT NULL DEFAULT (datetime('now')),
        FOREIGN KEY (organization_id) REFERENCES organizations(id),
        FOREIGN KEY (owner) REFERENCES users(id)
      );
[SQLite] -- Audit logs table
      CREATE TABLE IF NOT EXISTS audit_logs (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        organization_id INTEGER,
        user_id INTEGER,
        action TEXT NOT NULL,
        resource_type TEXT NOT NULL,
        resource_id TEXT,
        details TEXT,
        ip_address TEXT,
        user_agent TEXT,
        risk_level TEXT CHECK(risk_level IN ('low', 'medium', 'high', 'critical')),
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        FOREIGN KEY (organization_id) REFERENCES organizations(id),
        FOREIGN KEY (user_id) REFERENCES users(id)
      );
[SQLite] -- Files/Storage metadata table
      CREATE TABLE IF NOT EXISTS storage_files (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        organization_id INTEGER NOT NULL,
        file_path TEXT NOT NULL,
        uri TEXT NOT NULL UNIQUE,
        size INTEGER NOT NULL,
        content_type TEXT NOT NULL,
        hash TEXT,
        uploaded_by INTEGER,
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        FOREIGN KEY (organization_id) REFERENCES organizations(id),
        FOREIGN KEY (uploaded_by) REFERENCES users(id)
      );
[SQLite] -- Create indexes for common queries
      CREATE INDEX IF NOT EXISTS idx_users_email ON users(email);
[SQLite] CREATE INDEX IF NOT EXISTS idx_users_org ON users(organization_id);
[SQLite] CREATE INDEX IF NOT EXISTS idx_documents_org ON documents(organization_id);
[SQLite] CREATE INDEX IF NOT EXISTS idx_documents_framework ON documents(framework);
[SQLite] CREATE INDEX IF NOT EXISTS idx_gap_analysis_org ON gap_analysis(organization_id);
[SQLite] CREATE INDEX IF NOT EXISTS idx_audit_logs_org ON audit_logs(organization_id);
[SQLite] CREATE INDEX IF NOT EXISTS idx_audit_logs_created ON audit_logs(created_at);
[SQLite] CREATE INDEX IF NOT EXISTS idx_storage_files_org ON storage_files(organization_id);
[SQLite] -- Insert default local organization for local mode
      INSERT OR IGNORE INTO organizations (id, name, slug, settings)
      VALUES (1, 'Local Workspace', 'local', '{}');
[SQLite] -- Insert default local admin user for local mode
      INSERT OR IGNORE INTO users (id, email, role, first_name, last_name, organization_id, is_active)
      VALUES (1, 'admin@local', 'admin', 'Local', 'Admin', 1, 1);
[SQLite] INSERT INTO _migrations (version, name) VALUES (1.0, 'initial_schema')
[SQLite] COMMIT
[SqliteDbProvider] Migration 1 applied successfully
[SqliteDbProvider] Migration complete

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2mdelete[2m > [22m[2mshould delete existing file
[22m[39m[LocalFsStorageProvider] File saved successfully: test-data\storage\34\c1\34c16b11d97051f3_test.txt

 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/multiTenant.test.ts[2m > [22mMultiTenant Middleware[2m > [22mextractOrganizationContext[2m > [22mshould call next() if no userId is found[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/multiTenant.test.ts[2m > [22mMultiTenant Middleware[2m > [22mextractOrganizationContext[2m > [22mshould set empty userOrganizations if user has no organizations[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/multiTenant.test.ts[2m > [22mMultiTenant Middleware[2m > [22mextractOrganizationContext[2m > [22mshould extract organization from header when provided[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/multiTenant.test.ts[2m > [22mMultiTenant Middleware[2m > [22mextractOrganizationContext[2m > [22mshould extract organization from query parameter when header not provided[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/multiTenant.test.ts[2m > [22mMultiTenant Middleware[2m > [22mextractOrganizationContext[2m > [22mshould use first organization as default when no specific org requested[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/multiTenant.test.ts[2m > [22mMultiTenant Middleware[2m > [22mextractOrganizationContext[2m > [22mshould not set organizationId if requested org is not in user organizations[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/multiTenant.test.ts[2m > [22mMultiTenant Middleware[2m > [22mextractOrganizationContext[2m > [22mshould handle errors gracefully and call next()[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/multiTenant.test.ts[2m > [22mMultiTenant Middleware[2m > [22mextractOrganizationContext[2m > [22mshould map organizations correctly with multiple orgs[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/multiTenant.test.ts[2m > [22mMultiTenant Middleware[2m > [22mrequireOrganization[2m > [22mshould return ForbiddenError if organizationId is not set[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/multiTenant.test.ts[2m > [22mMultiTenant Middleware[2m > [22mrequireOrganization[2m > [22mshould call next() if organizationId is set[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/multiTenant.test.ts[2m > [22mMultiTenant Middleware[2m > [22mrequireOrganizationRole[2m > [22mshould return ForbiddenError if organizationId is not set[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/multiTenant.test.ts[2m > [22mMultiTenant Middleware[2m > [22mrequireOrganizationRole[2m > [22mshould return ForbiddenError if user role is not in allowed roles[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/multiTenant.test.ts[2m > [22mMultiTenant Middleware[2m > [22mrequireOrganizationRole[2m > [22mshould call next() if user has required role[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/multiTenant.test.ts[2m > [22mMultiTenant Middleware[2m > [22mrequireOrganizationRole[2m > [22mshould work with single role requirement[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/multiTenant.test.ts[2m > [22mMultiTenant Middleware[2m > [22mrequireOrganizationRole[2m > [22mshould handle missing organizationRole[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/multiTenant.test.ts[2m > [22mMultiTenant Middleware[2m > [22mvalidateResourceOwnership[2m > [22mshould return false if document does not exist[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/multiTenant.test.ts[2m > [22mMultiTenant Middleware[2m > [22mvalidateResourceOwnership[2m > [22mshould return false if document profile does not exist[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/multiTenant.test.ts[2m > [22mMultiTenant Middleware[2m > [22mvalidateResourceOwnership[2m > [22mshould return false if document belongs to different organization[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/multiTenant.test.ts[2m > [22mMultiTenant Middleware[2m > [22mvalidateResourceOwnership[2m > [22mshould return true if document belongs to organization[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/multiTenant.test.ts[2m > [22mMultiTenant Middleware[2m > [22mvalidateResourceOwnership[2m > [22mshould validate companyProfile ownership correctly[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/multiTenant.test.ts[2m > [22mMultiTenant Middleware[2m > [22mvalidateResourceOwnership[2m > [22mshould return false if companyProfile does not exist[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/multiTenant.test.ts[2m > [22mMultiTenant Middleware[2m > [22mvalidateResourceOwnership[2m > [22mshould validate gapAnalysisReport ownership correctly[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/multiTenant.test.ts[2m > [22mMultiTenant Middleware[2m > [22mvalidateResourceOwnership[2m > [22mshould return false for unknown resource type[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/multiTenant.test.ts[2m > [22mMultiTenant Middleware[2m > [22mvalidateResourceOwnership[2m > [22mshould handle errors and return false[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/multiTenant.test.ts[2m > [22mMultiTenant Middleware[2m > [22mrequireResourceOwnership[2m > [22mshould return ValidationError if resourceId is missing[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/multiTenant.test.ts[2m > [22mMultiTenant Middleware[2m > [22mrequireResourceOwnership[2m > [22mshould return ForbiddenError if organizationId is missing[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/multiTenant.test.ts[2m > [22mMultiTenant Middleware[2m > [22mrequireResourceOwnership[2m > [22mshould return NotFoundError if resource ownership validation fails[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/multiTenant.test.ts[2m > [22mMultiTenant Middleware[2m > [22mrequireResourceOwnership[2m > [22mshould call next() if ownership validation succeeds[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/multiTenant.test.ts[2m > [22mMultiTenant Middleware[2m > [22mrequireResourceOwnership[2m > [22mshould extract resourceId from documentId param[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/multiTenant.test.ts[2m > [22mMultiTenant Middleware[2m > [22mrequireResourceOwnership[2m > [22mshould extract resourceId from profileId param[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/multiTenant.test.ts[2m > [22mMultiTenant Middleware[2m > [22mgetDocumentWithOrgCheck[2m > [22mshould return unauthorized if document does not exist[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/multiTenant.test.ts[2m > [22mMultiTenant Middleware[2m > [22mgetDocumentWithOrgCheck[2m > [22mshould return unauthorized if profile does not exist[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/multiTenant.test.ts[2m > [22mMultiTenant Middleware[2m > [22mgetDocumentWithOrgCheck[2m > [22mshould return unauthorized if document belongs to different org[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/multiTenant.test.ts[2m > [22mMultiTenant Middleware[2m > [22mgetDocumentWithOrgCheck[2m > [22mshould return document if authorized[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/multiTenant.test.ts[2m > [22mMultiTenant Middleware[2m > [22mgetCompanyProfileWithOrgCheck[2m > [22mshould return unauthorized if profile does not exist[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/multiTenant.test.ts[2m > [22mMultiTenant Middleware[2m > [22mgetCompanyProfileWithOrgCheck[2m > [22mshould return unauthorized if profile belongs to different org[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/multiTenant.test.ts[2m > [22mMultiTenant Middleware[2m > [22mgetCompanyProfileWithOrgCheck[2m > [22mshould return profile if authorized[32m 1[2mms[22m[39m
[90mstdout[2m | tests/unit/providers/db/sqlite.test.ts[2m > [22m[2mSqliteDbProvider[2m > [22m[2mmigrate[2m > [22m[2mshould not re-apply migrations on second run
[22m[39m[SQLite] SELECT COUNT(*) as count FROM _migrations

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2mdelete[2m > [22m[2mshould delete existing file
[22m[39m[LocalFsStorageProvider] Deleting file: test-data\storage\34\c1\34c16b11d97051f3_test.txt

[90mstdout[2m | tests/unit/providers/db/sqlite.test.ts[2m > [22m[2mSqliteDbProvider[2m > [22m[2mmigrate[2m > [22m[2mshould not re-apply migrations on second run
[22m[39m[SqliteDbProvider] Starting database migration...
[SQLite] CREATE TABLE IF NOT EXISTS _migrations (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        version INTEGER NOT NULL UNIQUE,
        name TEXT NOT NULL,
        applied_at TEXT NOT NULL DEFAULT (datetime('now'))
      )
    
[SQLite] SELECT COALESCE(MAX(version), 0) as version FROM _migrations
[SqliteDbProvider] Current schema version: 1
[SqliteDbProvider] No pending migrations

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2mdelete[2m > [22m[2mshould delete existing file
[22m[39m[LocalFsStorageProvider] File deleted successfully: test-data\storage\34\c1\34c16b11d97051f3_test.txt

[90mstdout[2m | tests/unit/providers/db/sqlite.test.ts[2m > [22m[2mSqliteDbProvider[2m > [22m[2mmigrate[2m > [22m[2mshould not re-apply migrations on second run
[22m[39m[SQLite] SELECT COUNT(*) as count FROM _migrations

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2mdelete[2m > [22m[2mshould not throw for non-existent file
[22m[39m[LocalFsStorageProvider] Initialized with basePath: ./test-data/storage
[LocalFsStorageProvider] Created base directory: ./test-data/storage

[90mstdout[2m | tests/unit/providers/db/sqlite.test.ts[2m > [22m[2mSqliteDbProvider[2m > [22m[2mmigrate[2m > [22m[2mshould not re-apply migrations on second run
[22m[39m[SqliteDbProvider] Closing SQLite database

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2mdelete[2m > [22m[2mshould not throw for non-existent file
[22m[39m[LocalFsStorageProvider] Deleting file: test-data\storage\does-not-exist.txt

[90mstdout[2m | tests/unit/providers/db/sqlite.test.ts[2m > [22m[2mSqliteDbProvider[2m > [22m[2mquery[2m > [22m[2mshould execute SELECT queries
[22m[39m[SqliteDbProvider] Connecting to: ./test-data/test.db
[SQLite] PRAGMA journal_mode = WAL
[SQLite] PRAGMA synchronous = NORMAL
[SQLite] PRAGMA cache_size = -64000
[SQLite] PRAGMA temp_store = MEMORY
[SQLite] PRAGMA foreign_keys = ON
[SqliteDbProvider] Connected successfully with WAL mode

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2mdelete[2m > [22m[2mshould not throw for non-existent file
[22m[39m[LocalFsStorageProvider] File already deleted or does not exist: test-data\storage\does-not-exist.txt

[90mstdout[2m | tests/unit/providers/db/sqlite.test.ts[2m > [22m[2mSqliteDbProvider[2m > [22m[2mquery[2m > [22m[2mshould execute SELECT queries
[22m[39m[SqliteDbProvider] Starting database migration...
[SQLite] CREATE TABLE IF NOT EXISTS _migrations (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        version INTEGER NOT NULL UNIQUE,
        name TEXT NOT NULL,
        applied_at TEXT NOT NULL DEFAULT (datetime('now'))
      )
    
[SQLite] SELECT COALESCE(MAX(version), 0) as version FROM _migrations
[SqliteDbProvider] Current schema version: 0
[SqliteDbProvider] Applying 1 migration(s)...
[SqliteDbProvider] Applying migration 1: initial_schema
[SQLite] BEGIN
[SQLite] -- Users table
      CREATE TABLE IF NOT EXISTS users (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        email TEXT NOT NULL UNIQUE,
        password_hash TEXT,
        first_name TEXT,
        last_name TEXT,
        role TEXT NOT NULL DEFAULT 'user' CHECK(role IN ('admin', 'user', 'auditor')),
        organization_id INTEGER,
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        updated_at TEXT NOT NULL DEFAULT (datetime('now')),
        last_login_at TEXT,
        is_active INTEGER NOT NULL DEFAULT 1,
        email_verified INTEGER NOT NULL DEFAULT 0,
        mfa_enabled INTEGER NOT NULL DEFAULT 0,
        mfa_secret TEXT
      );
[SQLite] -- Organizations table
      CREATE TABLE IF NOT EXISTS organizations (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        name TEXT NOT NULL,
        slug TEXT NOT NULL UNIQUE,
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        updated_at TEXT NOT NULL DEFAULT (datetime('now')),
        settings TEXT,
        subscription_tier TEXT DEFAULT 'free' CHECK(subscription_tier IN ('free', 'pro', 'enterprise'))
      );
[SQLite] -- Documents table
      CREATE TABLE IF NOT EXISTS documents (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        title TEXT NOT NULL,
        content TEXT NOT NULL,
        document_type TEXT NOT NULL CHECK(document_type IN ('policy', 'procedure', 'plan', 'manual', 'other')),
        framework TEXT CHECK(framework IN ('iso27001', 'soc2', 'fedramp', 'nist')),
        status TEXT NOT NULL DEFAULT 'draft' CHECK(status IN ('draft', 'in_review', 'approved', 'published', 'archived')),
        version INTEGER NOT NULL DEFAULT 1,
        organization_id INTEGER NOT NULL,
        created_by INTEGER NOT NULL,
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        updated_at TEXT NOT NULL DEFAULT (datetime('now')),
        published_at TEXT,
        metadata TEXT,
        FOREIGN KEY (organization_id) REFERENCES organizations(id),
        FOREIGN KEY (created_by) REFERENCES users(id)
      );
[SQLite] -- Document versions table
      CREATE TABLE IF NOT EXISTS document_versions (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        document_id INTEGER NOT NULL,
        version INTEGER NOT NULL,
        content TEXT NOT NULL,
        created_by INTEGER NOT NULL,
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        change_summary TEXT,
        FOREIGN KEY (document_id) REFERENCES documents(id),
        FOREIGN KEY (created_by) REFERENCES users(id)
      );
[SQLite] -- Gap analysis table
      CREATE TABLE IF NOT EXISTS gap_analysis (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        organization_id INTEGER NOT NULL,
        framework TEXT NOT NULL CHECK(framework IN ('iso27001', 'soc2', 'fedramp', 'nist')),
        control_id TEXT NOT NULL,
        control_name TEXT NOT NULL,
        status TEXT NOT NULL CHECK(status IN ('not_implemented', 'partially_implemented', 'fully_implemented', 'not_applicable')),
        gap_description TEXT,
        remediation_plan TEXT,
        priority TEXT CHECK(priority IN ('critical', 'high', 'medium', 'low')),
        target_date TEXT,
        assigned_to INTEGER,
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        updated_at TEXT NOT NULL DEFAULT (datetime('now')),
        FOREIGN KEY (organization_id) REFERENCES organizations(id),
        FOREIGN KEY (assigned_to) REFERENCES users(id)
      );
[SQLite] -- Risk assessments table
      CREATE TABLE IF NOT EXISTS risk_assessments (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        organization_id INTEGER NOT NULL,
        risk_name TEXT NOT NULL,
        description TEXT,
        likelihood TEXT CHECK(likelihood IN ('very_low', 'low', 'medium', 'high', 'very_high')),
        impact TEXT CHECK(impact IN ('very_low', 'low', 'medium', 'high', 'very_high')),
        risk_score INTEGER,
        mitigation_plan TEXT,
        status TEXT NOT NULL DEFAULT 'open' CHECK(status IN ('open', 'mitigated', 'accepted', 'closed')),
        owner INTEGER,
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        updated_at TEXT NOT NULL DEFAULT (datetime('now')),
        FOREIGN KEY (organization_id) REFERENCES organizations(id),
        FOREIGN KEY (owner) REFERENCES users(id)
      );
[SQLite] -- Audit logs table
      CREATE TABLE IF NOT EXISTS audit_logs (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        organization_id INTEGER,
        user_id INTEGER,
        action TEXT NOT NULL,
        resource_type TEXT NOT NULL,
        resource_id TEXT,
        details TEXT,
        ip_address TEXT,
        user_agent TEXT,
        risk_level TEXT CHECK(risk_level IN ('low', 'medium', 'high', 'critical')),
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        FOREIGN KEY (organization_id) REFERENCES organizations(id),
        FOREIGN KEY (user_id) REFERENCES users(id)
      );
[SQLite] -- Files/Storage metadata table
      CREATE TABLE IF NOT EXISTS storage_files (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        organization_id INTEGER NOT NULL,
        file_path TEXT NOT NULL,
        uri TEXT NOT NULL UNIQUE,
        size INTEGER NOT NULL,
        content_type TEXT NOT NULL,
        hash TEXT,
        uploaded_by INTEGER,
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        FOREIGN KEY (organization_id) REFERENCES organizations(id),
        FOREIGN KEY (uploaded_by) REFERENCES users(id)
      );
[SQLite] -- Create indexes for common queries
      CREATE INDEX IF NOT EXISTS idx_users_email ON users(email);
[SQLite] CREATE INDEX IF NOT EXISTS idx_users_org ON users(organization_id);
[SQLite] CREATE INDEX IF NOT EXISTS idx_documents_org ON documents(organization_id);
[SQLite] CREATE INDEX IF NOT EXISTS idx_documents_framework ON documents(framework);
[SQLite] CREATE INDEX IF NOT EXISTS idx_gap_analysis_org ON gap_analysis(organization_id);
[SQLite] CREATE INDEX IF NOT EXISTS idx_audit_logs_org ON audit_logs(organization_id);
[SQLite] CREATE INDEX IF NOT EXISTS idx_audit_logs_created ON audit_logs(created_at);
[SQLite] CREATE INDEX IF NOT EXISTS idx_storage_files_org ON storage_files(organization_id);
[SQLite] -- Insert default local organization for local mode
      INSERT OR IGNORE INTO organizations (id, name, slug, settings)
      VALUES (1, 'Local Workspace', 'local', '{}');
[SQLite] -- Insert default local admin user for local mode
      INSERT OR IGNORE INTO users (id, email, role, first_name, last_name, organization_id, is_active)
      VALUES (1, 'admin@local', 'admin', 'Local', 'Admin', 1, 1);
[SQLite] INSERT INTO _migrations (version, name) VALUES (1.0, 'initial_schema')
[SQLite] COMMIT
[SqliteDbProvider] Migration 1 applied successfully
[SqliteDbProvider] Migration complete

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2mdelete[2m > [22m[2mshould prevent path traversal in delete
[22m[39m[LocalFsStorageProvider] Initialized with basePath: ./test-data/storage
[LocalFsStorageProvider] Created base directory: ./test-data/storage

[90mstdout[2m | tests/unit/providers/db/sqlite.test.ts[2m > [22m[2mSqliteDbProvider[2m > [22m[2mquery[2m > [22m[2mshould execute SELECT queries
[22m[39m[SQLite] SELECT 1 as result

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2mdelete[2m > [22m[2mshould clean up empty parent directories
[22m[39m[LocalFsStorageProvider] Initialized with basePath: ./test-data/storage
[LocalFsStorageProvider] Created base directory: ./test-data/storage

[90mstdout[2m | tests/unit/providers/db/sqlite.test.ts[2m > [22m[2mSqliteDbProvider[2m > [22m[2mquery[2m > [22m[2mshould execute SELECT queries
[22m[39m[SqliteDbProvider] Closing SQLite database

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2mdelete[2m > [22m[2mshould clean up empty parent directories
[22m[39m[LocalFsStorageProvider] Saving file: test.txt -> test-data\storage\ce\e0\cee0bec8f6e6918f_test.txt

[90mstdout[2m | tests/unit/providers/db/sqlite.test.ts[2m > [22m[2mSqliteDbProvider[2m > [22m[2mquery[2m > [22m[2mshould support parameterized queries
[22m[39m[SqliteDbProvider] Connecting to: ./test-data/test.db
[SQLite] PRAGMA journal_mode = WAL
[SQLite] PRAGMA synchronous = NORMAL
[SQLite] PRAGMA cache_size = -64000
[SQLite] PRAGMA temp_store = MEMORY
[SQLite] PRAGMA foreign_keys = ON
[SqliteDbProvider] Connected successfully with WAL mode

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2mdelete[2m > [22m[2mshould clean up empty parent directories
[22m[39m[LocalFsStorageProvider] Created directory: test-data\storage\ce\e0

[90mstdout[2m | tests/unit/providers/db/sqlite.test.ts[2m > [22m[2mSqliteDbProvider[2m > [22m[2mquery[2m > [22m[2mshould support parameterized queries
[22m[39m[SqliteDbProvider] Starting database migration...
[SQLite] CREATE TABLE IF NOT EXISTS _migrations (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        version INTEGER NOT NULL UNIQUE,
        name TEXT NOT NULL,
        applied_at TEXT NOT NULL DEFAULT (datetime('now'))
      )
    
[SQLite] SELECT COALESCE(MAX(version), 0) as version FROM _migrations
[SqliteDbProvider] Current schema version: 0
[SqliteDbProvider] Applying 1 migration(s)...
[SqliteDbProvider] Applying migration 1: initial_schema
[SQLite] BEGIN
[SQLite] -- Users table
      CREATE TABLE IF NOT EXISTS users (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        email TEXT NOT NULL UNIQUE,
        password_hash TEXT,
        first_name TEXT,
        last_name TEXT,
        role TEXT NOT NULL DEFAULT 'user' CHECK(role IN ('admin', 'user', 'auditor')),
        organization_id INTEGER,
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        updated_at TEXT NOT NULL DEFAULT (datetime('now')),
        last_login_at TEXT,
        is_active INTEGER NOT NULL DEFAULT 1,
        email_verified INTEGER NOT NULL DEFAULT 0,
        mfa_enabled INTEGER NOT NULL DEFAULT 0,
        mfa_secret TEXT
      );
[SQLite] -- Organizations table
      CREATE TABLE IF NOT EXISTS organizations (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        name TEXT NOT NULL,
        slug TEXT NOT NULL UNIQUE,
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        updated_at TEXT NOT NULL DEFAULT (datetime('now')),
        settings TEXT,
        subscription_tier TEXT DEFAULT 'free' CHECK(subscription_tier IN ('free', 'pro', 'enterprise'))
      );
[SQLite] -- Documents table
      CREATE TABLE IF NOT EXISTS documents (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        title TEXT NOT NULL,
        content TEXT NOT NULL,
        document_type TEXT NOT NULL CHECK(document_type IN ('policy', 'procedure', 'plan', 'manual', 'other')),
        framework TEXT CHECK(framework IN ('iso27001', 'soc2', 'fedramp', 'nist')),
        status TEXT NOT NULL DEFAULT 'draft' CHECK(status IN ('draft', 'in_review', 'approved', 'published', 'archived')),
        version INTEGER NOT NULL DEFAULT 1,
        organization_id INTEGER NOT NULL,
        created_by INTEGER NOT NULL,
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        updated_at TEXT NOT NULL DEFAULT (datetime('now')),
        published_at TEXT,
        metadata TEXT,
        FOREIGN KEY (organization_id) REFERENCES organizations(id),
        FOREIGN KEY (created_by) REFERENCES users(id)
      );
[SQLite] -- Document versions table
      CREATE TABLE IF NOT EXISTS document_versions (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        document_id INTEGER NOT NULL,
        version INTEGER NOT NULL,
        content TEXT NOT NULL,
        created_by INTEGER NOT NULL,
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        change_summary TEXT,
        FOREIGN KEY (document_id) REFERENCES documents(id),
        FOREIGN KEY (created_by) REFERENCES users(id)
      );
[SQLite] -- Gap analysis table
      CREATE TABLE IF NOT EXISTS gap_analysis (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        organization_id INTEGER NOT NULL,
        framework TEXT NOT NULL CHECK(framework IN ('iso27001', 'soc2', 'fedramp', 'nist')),
        control_id TEXT NOT NULL,
        control_name TEXT NOT NULL,
        status TEXT NOT NULL CHECK(status IN ('not_implemented', 'partially_implemented', 'fully_implemented', 'not_applicable')),
        gap_description TEXT,
        remediation_plan TEXT,
        priority TEXT CHECK(priority IN ('critical', 'high', 'medium', 'low')),
        target_date TEXT,
        assigned_to INTEGER,
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        updated_at TEXT NOT NULL DEFAULT (datetime('now')),
        FOREIGN KEY (organization_id) REFERENCES organizations(id),
        FOREIGN KEY (assigned_to) REFERENCES users(id)
      );
[SQLite] -- Risk assessments table
      CREATE TABLE IF NOT EXISTS risk_assessments (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        organization_id INTEGER NOT NULL,
        risk_name TEXT NOT NULL,
        description TEXT,
        likelihood TEXT CHECK(likelihood IN ('very_low', 'low', 'medium', 'high', 'very_high')),
        impact TEXT CHECK(impact IN ('very_low', 'low', 'medium', 'high', 'very_high')),
        risk_score INTEGER,
        mitigation_plan TEXT,
        status TEXT NOT NULL DEFAULT 'open' CHECK(status IN ('open', 'mitigated', 'accepted', 'closed')),
        owner INTEGER,
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        updated_at TEXT NOT NULL DEFAULT (datetime('now')),
        FOREIGN KEY (organization_id) REFERENCES organizations(id),
        FOREIGN KEY (owner) REFERENCES users(id)
      );
[SQLite] -- Audit logs table
      CREATE TABLE IF NOT EXISTS audit_logs (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        organization_id INTEGER,
        user_id INTEGER,
        action TEXT NOT NULL,
        resource_type TEXT NOT NULL,
        resource_id TEXT,
        details TEXT,
        ip_address TEXT,
        user_agent TEXT,
        risk_level TEXT CHECK(risk_level IN ('low', 'medium', 'high', 'critical')),
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        FOREIGN KEY (organization_id) REFERENCES organizations(id),
        FOREIGN KEY (user_id) REFERENCES users(id)
      );
[SQLite] -- Files/Storage metadata table
      CREATE TABLE IF NOT EXISTS storage_files (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        organization_id INTEGER NOT NULL,
        file_path TEXT NOT NULL,
        uri TEXT NOT NULL UNIQUE,
        size INTEGER NOT NULL,
        content_type TEXT NOT NULL,
        hash TEXT,
        uploaded_by INTEGER,
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        FOREIGN KEY (organization_id) REFERENCES organizations(id),
        FOREIGN KEY (uploaded_by) REFERENCES users(id)
      );
[SQLite] -- Create indexes for common queries
      CREATE INDEX IF NOT EXISTS idx_users_email ON users(email);
[SQLite] CREATE INDEX IF NOT EXISTS idx_users_org ON users(organization_id);
[SQLite] CREATE INDEX IF NOT EXISTS idx_documents_org ON documents(organization_id);
[SQLite] CREATE INDEX IF NOT EXISTS idx_documents_framework ON documents(framework);
[SQLite] CREATE INDEX IF NOT EXISTS idx_gap_analysis_org ON gap_analysis(organization_id);
[SQLite] CREATE INDEX IF NOT EXISTS idx_audit_logs_org ON audit_logs(organization_id);
[SQLite] CREATE INDEX IF NOT EXISTS idx_audit_logs_created ON audit_logs(created_at);
[SQLite] CREATE INDEX IF NOT EXISTS idx_storage_files_org ON storage_files(organization_id);
[SQLite] -- Insert default local organization for local mode
      INSERT OR IGNORE INTO organizations (id, name, slug, settings)
      VALUES (1, 'Local Workspace', 'local', '{}');
[SQLite] -- Insert default local admin user for local mode
      INSERT OR IGNORE INTO users (id, email, role, first_name, last_name, organization_id, is_active)
      VALUES (1, 'admin@local', 'admin', 'Local', 'Admin', 1, 1);
[SQLite] INSERT INTO _migrations (version, name) VALUES (1.0, 'initial_schema')
[SQLite] COMMIT
[SqliteDbProvider] Migration 1 applied successfully
[SqliteDbProvider] Migration complete

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2mdelete[2m > [22m[2mshould clean up empty parent directories
[22m[39m[LocalFsStorageProvider] File saved successfully: test-data\storage\ce\e0\cee0bec8f6e6918f_test.txt

[90mstdout[2m | tests/unit/providers/db/sqlite.test.ts[2m > [22m[2mSqliteDbProvider[2m > [22m[2mquery[2m > [22m[2mshould support parameterized queries
[22m[39m[SQLite] INSERT INTO organizations (name, slug, settings) VALUES ('Test Org', 'test-org', '{}')

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2mdelete[2m > [22m[2mshould clean up empty parent directories
[22m[39m[LocalFsStorageProvider] Deleting file: test-data\storage\ce\e0\cee0bec8f6e6918f_test.txt

[90mstdout[2m | tests/unit/providers/db/sqlite.test.ts[2m > [22m[2mSqliteDbProvider[2m > [22m[2mquery[2m > [22m[2mshould support parameterized queries
[22m[39m[SQLite] SELECT name, slug FROM organizations WHERE slug = 'test-org'

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2mdelete[2m > [22m[2mshould clean up empty parent directories
[22m[39m[LocalFsStorageProvider] File deleted successfully: test-data\storage\ce\e0\cee0bec8f6e6918f_test.txt

[90mstdout[2m | tests/unit/providers/db/sqlite.test.ts[2m > [22m[2mSqliteDbProvider[2m > [22m[2mquery[2m > [22m[2mshould support parameterized queries
[22m[39m[SqliteDbProvider] Closing SQLite database

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2mlist[2m > [22m[2mshould list all files in storage
[22m[39m[LocalFsStorageProvider] Initialized with basePath: ./test-data/storage
[LocalFsStorageProvider] Created base directory: ./test-data/storage

[90mstdout[2m | tests/unit/providers/db/sqlite.test.ts[2m > [22m[2mSqliteDbProvider[2m > [22m[2mquery[2m > [22m[2mshould return empty array for no results
[22m[39m[SqliteDbProvider] Connecting to: ./test-data/test.db
[SQLite] PRAGMA journal_mode = WAL
[SQLite] PRAGMA synchronous = NORMAL
[SQLite] PRAGMA cache_size = -64000
[SQLite] PRAGMA temp_store = MEMORY
[SQLite] PRAGMA foreign_keys = ON
[SqliteDbProvider] Connected successfully with WAL mode

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2mlist[2m > [22m[2mshould list all files in storage
[22m[39m[LocalFsStorageProvider] Saving file: file1.txt -> test-data\storage\b9\a5\b9a5bee69e8781b9_file1.txt

[90mstdout[2m | tests/unit/providers/db/sqlite.test.ts[2m > [22m[2mSqliteDbProvider[2m > [22m[2mquery[2m > [22m[2mshould return empty array for no results
[22m[39m[SqliteDbProvider] Starting database migration...
[SQLite] CREATE TABLE IF NOT EXISTS _migrations (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        version INTEGER NOT NULL UNIQUE,
        name TEXT NOT NULL,
        applied_at TEXT NOT NULL DEFAULT (datetime('now'))
      )
    
[SQLite] SELECT COALESCE(MAX(version), 0) as version FROM _migrations
[SqliteDbProvider] Current schema version: 0
[SqliteDbProvider] Applying 1 migration(s)...
[SqliteDbProvider] Applying migration 1: initial_schema
[SQLite] BEGIN
[SQLite] -- Users table
      CREATE TABLE IF NOT EXISTS users (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        email TEXT NOT NULL UNIQUE,
        password_hash TEXT,
        first_name TEXT,
        last_name TEXT,
        role TEXT NOT NULL DEFAULT 'user' CHECK(role IN ('admin', 'user', 'auditor')),
        organization_id INTEGER,
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        updated_at TEXT NOT NULL DEFAULT (datetime('now')),
        last_login_at TEXT,
        is_active INTEGER NOT NULL DEFAULT 1,
        email_verified INTEGER NOT NULL DEFAULT 0,
        mfa_enabled INTEGER NOT NULL DEFAULT 0,
        mfa_secret TEXT
      );
[SQLite] -- Organizations table
      CREATE TABLE IF NOT EXISTS organizations (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        name TEXT NOT NULL,
        slug TEXT NOT NULL UNIQUE,
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        updated_at TEXT NOT NULL DEFAULT (datetime('now')),
        settings TEXT,
        subscription_tier TEXT DEFAULT 'free' CHECK(subscription_tier IN ('free', 'pro', 'enterprise'))
      );
[SQLite] -- Documents table
      CREATE TABLE IF NOT EXISTS documents (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        title TEXT NOT NULL,
        content TEXT NOT NULL,
        document_type TEXT NOT NULL CHECK(document_type IN ('policy', 'procedure', 'plan', 'manual', 'other')),
        framework TEXT CHECK(framework IN ('iso27001', 'soc2', 'fedramp', 'nist')),
        status TEXT NOT NULL DEFAULT 'draft' CHECK(status IN ('draft', 'in_review', 'approved', 'published', 'archived')),
        version INTEGER NOT NULL DEFAULT 1,
        organization_id INTEGER NOT NULL,
        created_by INTEGER NOT NULL,
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        updated_at TEXT NOT NULL DEFAULT (datetime('now')),
        published_at TEXT,
        metadata TEXT,
        FOREIGN KEY (organization_id) REFERENCES organizations(id),
        FOREIGN KEY (created_by) REFERENCES users(id)
      );
[SQLite] -- Document versions table
      CREATE TABLE IF NOT EXISTS document_versions (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        document_id INTEGER NOT NULL,
        version INTEGER NOT NULL,
        content TEXT NOT NULL,
        created_by INTEGER NOT NULL,
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        change_summary TEXT,
        FOREIGN KEY (document_id) REFERENCES documents(id),
        FOREIGN KEY (created_by) REFERENCES users(id)
      );
[SQLite] -- Gap analysis table
      CREATE TABLE IF NOT EXISTS gap_analysis (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        organization_id INTEGER NOT NULL,
        framework TEXT NOT NULL CHECK(framework IN ('iso27001', 'soc2', 'fedramp', 'nist')),
        control_id TEXT NOT NULL,
        control_name TEXT NOT NULL,
        status TEXT NOT NULL CHECK(status IN ('not_implemented', 'partially_implemented', 'fully_implemented', 'not_applicable')),
        gap_description TEXT,
        remediation_plan TEXT,
        priority TEXT CHECK(priority IN ('critical', 'high', 'medium', 'low')),
        target_date TEXT,
        assigned_to INTEGER,
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        updated_at TEXT NOT NULL DEFAULT (datetime('now')),
        FOREIGN KEY (organization_id) REFERENCES organizations(id),
        FOREIGN KEY (assigned_to) REFERENCES users(id)
      );
[SQLite] -- Risk assessments table
      CREATE TABLE IF NOT EXISTS risk_assessments (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        organization_id INTEGER NOT NULL,
        risk_name TEXT NOT NULL,
        description TEXT,
        likelihood TEXT CHECK(likelihood IN ('very_low', 'low', 'medium', 'high', 'very_high')),
        impact TEXT CHECK(impact IN ('very_low', 'low', 'medium', 'high', 'very_high')),
        risk_score INTEGER,
        mitigation_plan TEXT,
        status TEXT NOT NULL DEFAULT 'open' CHECK(status IN ('open', 'mitigated', 'accepted', 'closed')),
        owner INTEGER,
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        updated_at TEXT NOT NULL DEFAULT (datetime('now')),
        FOREIGN KEY (organization_id) REFERENCES organizations(id),
        FOREIGN KEY (owner) REFERENCES users(id)
      );
[SQLite] -- Audit logs table
      CREATE TABLE IF NOT EXISTS audit_logs (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        organization_id INTEGER,
        user_id INTEGER,
        action TEXT NOT NULL,
        resource_type TEXT NOT NULL,
        resource_id TEXT,
        details TEXT,
        ip_address TEXT,
        user_agent TEXT,
        risk_level TEXT CHECK(risk_level IN ('low', 'medium', 'high', 'critical')),
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        FOREIGN KEY (organization_id) REFERENCES organizations(id),
        FOREIGN KEY (user_id) REFERENCES users(id)
      );
[SQLite] -- Files/Storage metadata table
      CREATE TABLE IF NOT EXISTS storage_files (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        organization_id INTEGER NOT NULL,
        file_path TEXT NOT NULL,
        uri TEXT NOT NULL UNIQUE,
        size INTEGER NOT NULL,
        content_type TEXT NOT NULL,
        hash TEXT,
        uploaded_by INTEGER,
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        FOREIGN KEY (organization_id) REFERENCES organizations(id),
        FOREIGN KEY (uploaded_by) REFERENCES users(id)
      );
[SQLite] -- Create indexes for common queries
      CREATE INDEX IF NOT EXISTS idx_users_email ON users(email);
[SQLite] CREATE INDEX IF NOT EXISTS idx_users_org ON users(organization_id);
[SQLite] CREATE INDEX IF NOT EXISTS idx_documents_org ON documents(organization_id);
[SQLite] CREATE INDEX IF NOT EXISTS idx_documents_framework ON documents(framework);
[SQLite] CREATE INDEX IF NOT EXISTS idx_gap_analysis_org ON gap_analysis(organization_id);
[SQLite] CREATE INDEX IF NOT EXISTS idx_audit_logs_org ON audit_logs(organization_id);
[SQLite] CREATE INDEX IF NOT EXISTS idx_audit_logs_created ON audit_logs(created_at);
[SQLite] CREATE INDEX IF NOT EXISTS idx_storage_files_org ON storage_files(organization_id);
[SQLite] -- Insert default local organization for local mode
      INSERT OR IGNORE INTO organizations (id, name, slug, settings)
      VALUES (1, 'Local Workspace', 'local', '{}');
[SQLite] -- Insert default local admin user for local mode
      INSERT OR IGNORE INTO users (id, email, role, first_name, last_name, organization_id, is_active)
      VALUES (1, 'admin@local', 'admin', 'Local', 'Admin', 1, 1);
[SQLite] INSERT INTO _migrations (version, name) VALUES (1.0, 'initial_schema')
[SQLite] COMMIT
[SqliteDbProvider] Migration 1 applied successfully
[SqliteDbProvider] Migration complete

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2mlist[2m > [22m[2mshould list all files in storage
[22m[39m[LocalFsStorageProvider] Created directory: test-data\storage\b9\a5

[90mstdout[2m | tests/unit/providers/db/sqlite.test.ts[2m > [22m[2mSqliteDbProvider[2m > [22m[2mquery[2m > [22m[2mshould return empty array for no results
[22m[39m[SQLite] SELECT * FROM organizations WHERE id = 9999

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2mlist[2m > [22m[2mshould list all files in storage
[22m[39m[LocalFsStorageProvider] File saved successfully: test-data\storage\b9\a5\b9a5bee69e8781b9_file1.txt

[90mstdout[2m | tests/unit/providers/db/sqlite.test.ts[2m > [22m[2mSqliteDbProvider[2m > [22m[2mquery[2m > [22m[2mshould return empty array for no results
[22m[39m[SqliteDbProvider] Closing SQLite database

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2mlist[2m > [22m[2mshould list all files in storage
[22m[39m[LocalFsStorageProvider] Saving file: file2.txt -> test-data\storage\a8\79\a87974a0f8d71939_file2.txt

[90mstdout[2m | tests/unit/providers/db/sqlite.test.ts[2m > [22m[2mSqliteDbProvider[2m > [22m[2mtransaction[2m > [22m[2mshould commit transaction on success
[22m[39m[SqliteDbProvider] Connecting to: ./test-data/test.db
[SQLite] PRAGMA journal_mode = WAL
[SQLite] PRAGMA synchronous = NORMAL
[SQLite] PRAGMA cache_size = -64000
[SQLite] PRAGMA temp_store = MEMORY
[SQLite] PRAGMA foreign_keys = ON
[SqliteDbProvider] Connected successfully with WAL mode

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2mlist[2m > [22m[2mshould list all files in storage
[22m[39m[LocalFsStorageProvider] Created directory: test-data\storage\a8\79

[90mstdout[2m | tests/unit/providers/db/sqlite.test.ts[2m > [22m[2mSqliteDbProvider[2m > [22m[2mtransaction[2m > [22m[2mshould commit transaction on success
[22m[39m[SqliteDbProvider] Starting database migration...
[SQLite] CREATE TABLE IF NOT EXISTS _migrations (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        version INTEGER NOT NULL UNIQUE,
        name TEXT NOT NULL,
        applied_at TEXT NOT NULL DEFAULT (datetime('now'))
      )
    
[SQLite] SELECT COALESCE(MAX(version), 0) as version FROM _migrations
[SqliteDbProvider] Current schema version: 0
[SqliteDbProvider] Applying 1 migration(s)...
[SqliteDbProvider] Applying migration 1: initial_schema
[SQLite] BEGIN
[SQLite] -- Users table
      CREATE TABLE IF NOT EXISTS users (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        email TEXT NOT NULL UNIQUE,
        password_hash TEXT,
        first_name TEXT,
        last_name TEXT,
        role TEXT NOT NULL DEFAULT 'user' CHECK(role IN ('admin', 'user', 'auditor')),
        organization_id INTEGER,
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        updated_at TEXT NOT NULL DEFAULT (datetime('now')),
        last_login_at TEXT,
        is_active INTEGER NOT NULL DEFAULT 1,
        email_verified INTEGER NOT NULL DEFAULT 0,
        mfa_enabled INTEGER NOT NULL DEFAULT 0,
        mfa_secret TEXT
      );
[SQLite] -- Organizations table
      CREATE TABLE IF NOT EXISTS organizations (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        name TEXT NOT NULL,
        slug TEXT NOT NULL UNIQUE,
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        updated_at TEXT NOT NULL DEFAULT (datetime('now')),
        settings TEXT,
        subscription_tier TEXT DEFAULT 'free' CHECK(subscription_tier IN ('free', 'pro', 'enterprise'))
      );
[SQLite] -- Documents table
      CREATE TABLE IF NOT EXISTS documents (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        title TEXT NOT NULL,
        content TEXT NOT NULL,
        document_type TEXT NOT NULL CHECK(document_type IN ('policy', 'procedure', 'plan', 'manual', 'other')),
        framework TEXT CHECK(framework IN ('iso27001', 'soc2', 'fedramp', 'nist')),
        status TEXT NOT NULL DEFAULT 'draft' CHECK(status IN ('draft', 'in_review', 'approved', 'published', 'archived')),
        version INTEGER NOT NULL DEFAULT 1,
        organization_id INTEGER NOT NULL,
        created_by INTEGER NOT NULL,
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        updated_at TEXT NOT NULL DEFAULT (datetime('now')),
        published_at TEXT,
        metadata TEXT,
        FOREIGN KEY (organization_id) REFERENCES organizations(id),
        FOREIGN KEY (created_by) REFERENCES users(id)
      );
[SQLite] -- Document versions table
      CREATE TABLE IF NOT EXISTS document_versions (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        document_id INTEGER NOT NULL,
        version INTEGER NOT NULL,
        content TEXT NOT NULL,
        created_by INTEGER NOT NULL,
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        change_summary TEXT,
        FOREIGN KEY (document_id) REFERENCES documents(id),
        FOREIGN KEY (created_by) REFERENCES users(id)
      );
[SQLite] -- Gap analysis table
      CREATE TABLE IF NOT EXISTS gap_analysis (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        organization_id INTEGER NOT NULL,
        framework TEXT NOT NULL CHECK(framework IN ('iso27001', 'soc2', 'fedramp', 'nist')),
        control_id TEXT NOT NULL,
        control_name TEXT NOT NULL,
        status TEXT NOT NULL CHECK(status IN ('not_implemented', 'partially_implemented', 'fully_implemented', 'not_applicable')),
        gap_description TEXT,
        remediation_plan TEXT,
        priority TEXT CHECK(priority IN ('critical', 'high', 'medium', 'low')),
        target_date TEXT,
        assigned_to INTEGER,
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        updated_at TEXT NOT NULL DEFAULT (datetime('now')),
        FOREIGN KEY (organization_id) REFERENCES organizations(id),
        FOREIGN KEY (assigned_to) REFERENCES users(id)
      );
[SQLite] -- Risk assessments table
      CREATE TABLE IF NOT EXISTS risk_assessments (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        organization_id INTEGER NOT NULL,
        risk_name TEXT NOT NULL,
        description TEXT,
        likelihood TEXT CHECK(likelihood IN ('very_low', 'low', 'medium', 'high', 'very_high')),
        impact TEXT CHECK(impact IN ('very_low', 'low', 'medium', 'high', 'very_high')),
        risk_score INTEGER,
        mitigation_plan TEXT,
        status TEXT NOT NULL DEFAULT 'open' CHECK(status IN ('open', 'mitigated', 'accepted', 'closed')),
        owner INTEGER,
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        updated_at TEXT NOT NULL DEFAULT (datetime('now')),
        FOREIGN KEY (organization_id) REFERENCES organizations(id),
        FOREIGN KEY (owner) REFERENCES users(id)
      );
[SQLite] -- Audit logs table
      CREATE TABLE IF NOT EXISTS audit_logs (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        organization_id INTEGER,
        user_id INTEGER,
        action TEXT NOT NULL,
        resource_type TEXT NOT NULL,
        resource_id TEXT,
        details TEXT,
        ip_address TEXT,
        user_agent TEXT,
        risk_level TEXT CHECK(risk_level IN ('low', 'medium', 'high', 'critical')),
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        FOREIGN KEY (organization_id) REFERENCES organizations(id),
        FOREIGN KEY (user_id) REFERENCES users(id)
      );
[SQLite] -- Files/Storage metadata table
      CREATE TABLE IF NOT EXISTS storage_files (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        organization_id INTEGER NOT NULL,
        file_path TEXT NOT NULL,
        uri TEXT NOT NULL UNIQUE,
        size INTEGER NOT NULL,
        content_type TEXT NOT NULL,
        hash TEXT,
        uploaded_by INTEGER,
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        FOREIGN KEY (organization_id) REFERENCES organizations(id),
        FOREIGN KEY (uploaded_by) REFERENCES users(id)
      );
[SQLite] -- Create indexes for common queries
      CREATE INDEX IF NOT EXISTS idx_users_email ON users(email);
[SQLite] CREATE INDEX IF NOT EXISTS idx_users_org ON users(organization_id);
[SQLite] CREATE INDEX IF NOT EXISTS idx_documents_org ON documents(organization_id);
[SQLite] CREATE INDEX IF NOT EXISTS idx_documents_framework ON documents(framework);
[SQLite] CREATE INDEX IF NOT EXISTS idx_gap_analysis_org ON gap_analysis(organization_id);
[SQLite] CREATE INDEX IF NOT EXISTS idx_audit_logs_org ON audit_logs(organization_id);
[SQLite] CREATE INDEX IF NOT EXISTS idx_audit_logs_created ON audit_logs(created_at);
[SQLite] CREATE INDEX IF NOT EXISTS idx_storage_files_org ON storage_files(organization_id);
[SQLite] -- Insert default local organization for local mode
      INSERT OR IGNORE INTO organizations (id, name, slug, settings)
      VALUES (1, 'Local Workspace', 'local', '{}');
[SQLite] -- Insert default local admin user for local mode
      INSERT OR IGNORE INTO users (id, email, role, first_name, last_name, organization_id, is_active)
      VALUES (1, 'admin@local', 'admin', 'Local', 'Admin', 1, 1);
[SQLite] INSERT INTO _migrations (version, name) VALUES (1.0, 'initial_schema')
[SQLite] COMMIT
[SqliteDbProvider] Migration 1 applied successfully
[SqliteDbProvider] Migration complete

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2mlist[2m > [22m[2mshould list all files in storage
[22m[39m[LocalFsStorageProvider] File saved successfully: test-data\storage\a8\79\a87974a0f8d71939_file2.txt

 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/providers/db/sqlite.test.ts[2m > [22mSqliteDbProvider[2m > [22mmigrate[2m > [22mshould apply initial schema migration[32m 31[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/providers/db/sqlite.test.ts[2m > [22mSqliteDbProvider[2m > [22mmigrate[2m > [22mshould insert default local organization and user[32m 20[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/providers/db/sqlite.test.ts[2m > [22mSqliteDbProvider[2m > [22mmigrate[2m > [22mshould not re-apply migrations on second run[32m 26[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/providers/db/sqlite.test.ts[2m > [22mSqliteDbProvider[2m > [22mquery[2m > [22mshould execute SELECT queries[32m 16[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/providers/db/sqlite.test.ts[2m > [22mSqliteDbProvider[2m > [22mquery[2m > [22mshould support parameterized queries[32m 17[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/providers/db/sqlite.test.ts[2m > [22mSqliteDbProvider[2m > [22mquery[2m > [22mshould return empty array for no results[32m 16[2mms[22m[39m
[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2mlist[2m > [22m[2mshould list all files in storage
[22m[39m[LocalFsStorageProvider] Saving file: file3.pdf -> test-data\storage\d9\c9\d9c924093b541d5f_file3.pdf

[90mstdout[2m | tests/unit/providers/db/sqlite.test.ts[2m > [22m[2mSqliteDbProvider[2m > [22m[2mtransaction[2m > [22m[2mshould commit transaction on success
[22m[39m[SQLite] BEGIN
[SQLite] BEGIN
[SQLite] INSERT INTO organizations (name, slug, settings) VALUES ('Test 1', 'test-1', '{}')

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2mlist[2m > [22m[2mshould list all files in storage
[22m[39m[LocalFsStorageProvider] Created directory: test-data\storage\d9\c9

[90mstdout[2m | tests/unit/providers/db/sqlite.test.ts[2m > [22m[2mSqliteDbProvider[2m > [22m[2mtransaction[2m > [22m[2mshould commit transaction on success
[22m[39m[SQLite] INSERT INTO organizations (name, slug, settings) VALUES ('Test 2', 'test-2', '{}')

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2mlist[2m > [22m[2mshould list all files in storage
[22m[39m[LocalFsStorageProvider] File saved successfully: test-data\storage\d9\c9\d9c924093b541d5f_file3.pdf

[90mstdout[2m | tests/unit/providers/db/sqlite.test.ts[2m > [22m[2mSqliteDbProvider[2m > [22m[2mtransaction[2m > [22m[2mshould commit transaction on success
[22m[39m[SQLite] COMMIT
[SQLite] COMMIT

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2mlist[2m > [22m[2mshould list all files in storage
[22m[39m[LocalFsStorageProvider] Listing files in: ./test-data/storage

[90mstdout[2m | tests/unit/providers/db/sqlite.test.ts[2m > [22m[2mSqliteDbProvider[2m > [22m[2mtransaction[2m > [22m[2mshould commit transaction on success
[22m[39m[SQLite] SELECT name FROM organizations WHERE slug LIKE 'test-%' ORDER BY name

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2mlist[2m > [22m[2mshould list all files in storage
[22m[39m[LocalFsStorageProvider] Found 3 files

[90mstdout[2m | tests/unit/providers/db/sqlite.test.ts[2m > [22m[2mSqliteDbProvider[2m > [22m[2mtransaction[2m > [22m[2mshould commit transaction on success
[22m[39m[SqliteDbProvider] Closing SQLite database

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2mlist[2m > [22m[2mshould return empty array for empty storage
[22m[39m[LocalFsStorageProvider] Initialized with basePath: ./test-data/storage
[LocalFsStorageProvider] Created base directory: ./test-data/storage

[90mstdout[2m | tests/unit/providers/db/sqlite.test.ts[2m > [22m[2mSqliteDbProvider[2m > [22m[2mtransaction[2m > [22m[2mshould rollback transaction on error
[22m[39m[SqliteDbProvider] Connecting to: ./test-data/test.db
[SQLite] PRAGMA journal_mode = WAL
[SQLite] PRAGMA synchronous = NORMAL
[SQLite] PRAGMA cache_size = -64000
[SQLite] PRAGMA temp_store = MEMORY
[SQLite] PRAGMA foreign_keys = ON
[SqliteDbProvider] Connected successfully with WAL mode

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2mlist[2m > [22m[2mshould return empty array for empty storage
[22m[39m[LocalFsStorageProvider] Listing files in: ./test-data/storage

[90mstdout[2m | tests/unit/providers/db/sqlite.test.ts[2m > [22m[2mSqliteDbProvider[2m > [22m[2mtransaction[2m > [22m[2mshould rollback transaction on error
[22m[39m[SqliteDbProvider] Starting database migration...
[SQLite] CREATE TABLE IF NOT EXISTS _migrations (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        version INTEGER NOT NULL UNIQUE,
        name TEXT NOT NULL,
        applied_at TEXT NOT NULL DEFAULT (datetime('now'))
      )
    
[SQLite] SELECT COALESCE(MAX(version), 0) as version FROM _migrations
[SqliteDbProvider] Current schema version: 0
[SqliteDbProvider] Applying 1 migration(s)...
[SqliteDbProvider] Applying migration 1: initial_schema
[SQLite] BEGIN
[SQLite] -- Users table
      CREATE TABLE IF NOT EXISTS users (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        email TEXT NOT NULL UNIQUE,
        password_hash TEXT,
        first_name TEXT,
        last_name TEXT,
        role TEXT NOT NULL DEFAULT 'user' CHECK(role IN ('admin', 'user', 'auditor')),
        organization_id INTEGER,
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        updated_at TEXT NOT NULL DEFAULT (datetime('now')),
        last_login_at TEXT,
        is_active INTEGER NOT NULL DEFAULT 1,
        email_verified INTEGER NOT NULL DEFAULT 0,
        mfa_enabled INTEGER NOT NULL DEFAULT 0,
        mfa_secret TEXT
      );
[SQLite] -- Organizations table
      CREATE TABLE IF NOT EXISTS organizations (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        name TEXT NOT NULL,
        slug TEXT NOT NULL UNIQUE,
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        updated_at TEXT NOT NULL DEFAULT (datetime('now')),
        settings TEXT,
        subscription_tier TEXT DEFAULT 'free' CHECK(subscription_tier IN ('free', 'pro', 'enterprise'))
      );
[SQLite] -- Documents table
      CREATE TABLE IF NOT EXISTS documents (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        title TEXT NOT NULL,
        content TEXT NOT NULL,
        document_type TEXT NOT NULL CHECK(document_type IN ('policy', 'procedure', 'plan', 'manual', 'other')),
        framework TEXT CHECK(framework IN ('iso27001', 'soc2', 'fedramp', 'nist')),
        status TEXT NOT NULL DEFAULT 'draft' CHECK(status IN ('draft', 'in_review', 'approved', 'published', 'archived')),
        version INTEGER NOT NULL DEFAULT 1,
        organization_id INTEGER NOT NULL,
        created_by INTEGER NOT NULL,
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        updated_at TEXT NOT NULL DEFAULT (datetime('now')),
        published_at TEXT,
        metadata TEXT,
        FOREIGN KEY (organization_id) REFERENCES organizations(id),
        FOREIGN KEY (created_by) REFERENCES users(id)
      );
[SQLite] -- Document versions table
      CREATE TABLE IF NOT EXISTS document_versions (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        document_id INTEGER NOT NULL,
        version INTEGER NOT NULL,
        content TEXT NOT NULL,
        created_by INTEGER NOT NULL,
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        change_summary TEXT,
        FOREIGN KEY (document_id) REFERENCES documents(id),
        FOREIGN KEY (created_by) REFERENCES users(id)
      );
[SQLite] -- Gap analysis table
      CREATE TABLE IF NOT EXISTS gap_analysis (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        organization_id INTEGER NOT NULL,
        framework TEXT NOT NULL CHECK(framework IN ('iso27001', 'soc2', 'fedramp', 'nist')),
        control_id TEXT NOT NULL,
        control_name TEXT NOT NULL,
        status TEXT NOT NULL CHECK(status IN ('not_implemented', 'partially_implemented', 'fully_implemented', 'not_applicable')),
        gap_description TEXT,
        remediation_plan TEXT,
        priority TEXT CHECK(priority IN ('critical', 'high', 'medium', 'low')),
        target_date TEXT,
        assigned_to INTEGER,
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        updated_at TEXT NOT NULL DEFAULT (datetime('now')),
        FOREIGN KEY (organization_id) REFERENCES organizations(id),
        FOREIGN KEY (assigned_to) REFERENCES users(id)
      );
[SQLite] -- Risk assessments table
      CREATE TABLE IF NOT EXISTS risk_assessments (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        organization_id INTEGER NOT NULL,
        risk_name TEXT NOT NULL,
        description TEXT,
        likelihood TEXT CHECK(likelihood IN ('very_low', 'low', 'medium', 'high', 'very_high')),
        impact TEXT CHECK(impact IN ('very_low', 'low', 'medium', 'high', 'very_high')),
        risk_score INTEGER,
        mitigation_plan TEXT,
        status TEXT NOT NULL DEFAULT 'open' CHECK(status IN ('open', 'mitigated', 'accepted', 'closed')),
        owner INTEGER,
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        updated_at TEXT NOT NULL DEFAULT (datetime('now')),
        FOREIGN KEY (organization_id) REFERENCES organizations(id),
        FOREIGN KEY (owner) REFERENCES users(id)
      );
[SQLite] -- Audit logs table
      CREATE TABLE IF NOT EXISTS audit_logs (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        organization_id INTEGER,
        user_id INTEGER,
        action TEXT NOT NULL,
        resource_type TEXT NOT NULL,
        resource_id TEXT,
        details TEXT,
        ip_address TEXT,
        user_agent TEXT,
        risk_level TEXT CHECK(risk_level IN ('low', 'medium', 'high', 'critical')),
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        FOREIGN KEY (organization_id) REFERENCES organizations(id),
        FOREIGN KEY (user_id) REFERENCES users(id)
      );
[SQLite] -- Files/Storage metadata table
      CREATE TABLE IF NOT EXISTS storage_files (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        organization_id INTEGER NOT NULL,
        file_path TEXT NOT NULL,
        uri TEXT NOT NULL UNIQUE,
        size INTEGER NOT NULL,
        content_type TEXT NOT NULL,
        hash TEXT,
        uploaded_by INTEGER,
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        FOREIGN KEY (organization_id) REFERENCES organizations(id),
        FOREIGN KEY (uploaded_by) REFERENCES users(id)
      );
[SQLite] -- Create indexes for common queries
      CREATE INDEX IF NOT EXISTS idx_users_email ON users(email);
[SQLite] CREATE INDEX IF NOT EXISTS idx_users_org ON users(organization_id);
[SQLite] CREATE INDEX IF NOT EXISTS idx_documents_org ON documents(organization_id);
[SQLite] CREATE INDEX IF NOT EXISTS idx_documents_framework ON documents(framework);
[SQLite] CREATE INDEX IF NOT EXISTS idx_gap_analysis_org ON gap_analysis(organization_id);
[SQLite] CREATE INDEX IF NOT EXISTS idx_audit_logs_org ON audit_logs(organization_id);
[SQLite] CREATE INDEX IF NOT EXISTS idx_audit_logs_created ON audit_logs(created_at);
[SQLite] CREATE INDEX IF NOT EXISTS idx_storage_files_org ON storage_files(organization_id);
[SQLite] -- Insert default local organization for local mode
      INSERT OR IGNORE INTO organizations (id, name, slug, settings)
      VALUES (1, 'Local Workspace', 'local', '{}');
[SQLite] -- Insert default local admin user for local mode
      INSERT OR IGNORE INTO users (id, email, role, first_name, last_name, organization_id, is_active)
      VALUES (1, 'admin@local', 'admin', 'Local', 'Admin', 1, 1);
[SQLite] INSERT INTO _migrations (version, name) VALUES (1.0, 'initial_schema')
[SQLite] COMMIT
[SqliteDbProvider] Migration 1 applied successfully
[SqliteDbProvider] Migration complete

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2mlist[2m > [22m[2mshould return empty array for empty storage
[22m[39m[LocalFsStorageProvider] Found 0 files

[90mstdout[2m | tests/unit/providers/db/sqlite.test.ts[2m > [22m[2mSqliteDbProvider[2m > [22m[2mtransaction[2m > [22m[2mshould rollback transaction on error
[22m[39m[SQLite] BEGIN
[SQLite] BEGIN
[SQLite] INSERT INTO organizations (name, slug, settings) VALUES ('Test 1', 'test-1', '{}')

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2mlist[2m > [22m[2mshould filter by prefix
[22m[39m[LocalFsStorageProvider] Initialized with basePath: ./test-data/storage
[LocalFsStorageProvider] Created base directory: ./test-data/storage

stderr | tests/unit/providers/db/sqlite.test.ts > SqliteDbProvider > transaction > should rollback transaction on error
[SqliteDbProvider] Query error: SqliteError: UNIQUE constraint failed: organizations.id
    at SqliteDbProvider.query (C:\software\cyberdocgen\server\providers\db\sqlite.ts:311:14)
    at Object.query (C:\software\cyberdocgen\server\providers\db\sqlite.ts:333:21)
    at C:\software\cyberdocgen\tests\unit\providers\db\sqlite.test.ts:228:20
    at processTicksAndRejections (node:internal/process/task_queues:105:5)
    at SqliteDbProvider.transaction (C:\software\cyberdocgen\server\providers\db\sqlite.ts:348:22)
    at C:\software\cyberdocgen\tests\unit\providers\db\sqlite.test.ts:221:9
    at file:///C:/software/cyberdocgen/node_modules/@vitest/runner/dist/chunk-hooks.js:752:20 {
  code: 'SQLITE_CONSTRAINT_PRIMARYKEY'
}
[SqliteDbProvider] SQL: INSERT INTO organizations (id, name, slug, settings) VALUES (?, ?, ?, ?)
[SqliteDbProvider] Params: [ 1, 'Duplicate', 'local', '{}' ]

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2mlist[2m > [22m[2mshould filter by prefix
[22m[39m[LocalFsStorageProvider] Saving file: docs/file1.txt -> test-data\storage\b9\a5\b9a5bee69e8781b9_file1.txt

[90mstdout[2m | tests/unit/providers/db/sqlite.test.ts[2m > [22m[2mSqliteDbProvider[2m > [22m[2mtransaction[2m > [22m[2mshould rollback transaction on error
[22m[39m[SQLite] INSERT INTO organizations (id, name, slug, settings) VALUES (1.0, 'Duplicate', 'local', '{}')

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2mlist[2m > [22m[2mshould filter by prefix
[22m[39m[LocalFsStorageProvider] Created directory: test-data\storage\b9\a5

[90mstdout[2m | tests/unit/providers/db/sqlite.test.ts[2m > [22m[2mSqliteDbProvider[2m > [22m[2mtransaction[2m > [22m[2mshould rollback transaction on error
[22m[39m[SQLite] ROLLBACK
[SQLite] ROLLBACK

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2mlist[2m > [22m[2mshould filter by prefix
[22m[39m[LocalFsStorageProvider] File saved successfully: test-data\storage\b9\a5\b9a5bee69e8781b9_file1.txt

stderr | tests/unit/providers/db/sqlite.test.ts > SqliteDbProvider > transaction > should rollback transaction on error
[SqliteDbProvider] Transaction error: SqliteError: UNIQUE constraint failed: organizations.id
    at SqliteDbProvider.query (C:\software\cyberdocgen\server\providers\db\sqlite.ts:311:14)
    at Object.query (C:\software\cyberdocgen\server\providers\db\sqlite.ts:333:21)
    at C:\software\cyberdocgen\tests\unit\providers\db\sqlite.test.ts:228:20
    at processTicksAndRejections (node:internal/process/task_queues:105:5)
    at SqliteDbProvider.transaction (C:\software\cyberdocgen\server\providers\db\sqlite.ts:348:22)
    at C:\software\cyberdocgen\tests\unit\providers\db\sqlite.test.ts:221:9
    at file:///C:/software/cyberdocgen/node_modules/@vitest/runner/dist/chunk-hooks.js:752:20 {
  code: 'SQLITE_CONSTRAINT_PRIMARYKEY'
}

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2mlist[2m > [22m[2mshould filter by prefix
[22m[39m[LocalFsStorageProvider] Saving file: docs/file2.txt -> test-data\storage\a8\79\a87974a0f8d71939_file2.txt

[90mstdout[2m | tests/unit/providers/db/sqlite.test.ts[2m > [22m[2mSqliteDbProvider[2m > [22m[2mtransaction[2m > [22m[2mshould rollback transaction on error
[22m[39m[SQLite] SELECT slug FROM organizations WHERE slug = 'test-1'

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2mlist[2m > [22m[2mshould filter by prefix
[22m[39m[LocalFsStorageProvider] Created directory: test-data\storage\a8\79

[90mstdout[2m | tests/unit/providers/db/sqlite.test.ts[2m > [22m[2mSqliteDbProvider[2m > [22m[2mtransaction[2m > [22m[2mshould rollback transaction on error
[22m[39m[SqliteDbProvider] Closing SQLite database

 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/providers/storage/localFs.test.ts[2m > [22mLocalFsStorageProvider[2m > [22msave[2m > [22mshould handle large files[32m 51[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/providers/storage/localFs.test.ts[2m > [22mLocalFsStorageProvider[2m > [22mread[2m > [22mshould read saved file[32m 11[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/providers/storage/localFs.test.ts[2m > [22mLocalFsStorageProvider[2m > [22mread[2m > [22mshould throw error for non-existent file[32m 14[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/providers/storage/localFs.test.ts[2m > [22mLocalFsStorageProvider[2m > [22mread[2m > [22mshould prevent path traversal attacks[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/providers/storage/localFs.test.ts[2m > [22mLocalFsStorageProvider[2m > [22mread[2m > [22mshould prevent absolute path access outside base[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/providers/storage/localFs.test.ts[2m > [22mLocalFsStorageProvider[2m > [22mexists[2m > [22mshould return true for existing file[32m 8[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/providers/storage/localFs.test.ts[2m > [22mLocalFsStorageProvider[2m > [22mexists[2m > [22mshould return false for non-existent file[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/providers/storage/localFs.test.ts[2m > [22mLocalFsStorageProvider[2m > [22mexists[2m > [22mshould return false for path traversal attempts[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/providers/storage/localFs.test.ts[2m > [22mLocalFsStorageProvider[2m > [22mdelete[2m > [22mshould delete existing file[32m 11[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/providers/storage/localFs.test.ts[2m > [22mLocalFsStorageProvider[2m > [22mdelete[2m > [22mshould not throw for non-existent file[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/providers/storage/localFs.test.ts[2m > [22mLocalFsStorageProvider[2m > [22mdelete[2m > [22mshould prevent path traversal in delete[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/providers/storage/localFs.test.ts[2m > [22mLocalFsStorageProvider[2m > [22mdelete[2m > [22mshould clean up empty parent directories[32m 7[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/providers/storage/localFs.test.ts[2m > [22mLocalFsStorageProvider[2m > [22mlist[2m > [22mshould list all files in storage[32m 26[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/providers/storage/localFs.test.ts[2m > [22mLocalFsStorageProvider[2m > [22mlist[2m > [22mshould return empty array for empty storage[32m 3[2mms[22m[39m
[90mstdout[2m | tests/unit/providers/db/sqlite.test.ts[2m > [22m[2mSqliteDbProvider[2m > [22m[2mhealthCheck[2m > [22m[2mshould return true if connected
[22m[39m[SqliteDbProvider] Connecting to: ./test-data/test.db
[SQLite] PRAGMA journal_mode = WAL
[SQLite] PRAGMA synchronous = NORMAL
[SQLite] PRAGMA cache_size = -64000
[SQLite] PRAGMA temp_store = MEMORY
[SQLite] PRAGMA foreign_keys = ON
[SqliteDbProvider] Connected successfully with WAL mode

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2mlist[2m > [22m[2mshould filter by prefix
[22m[39m[LocalFsStorageProvider] File saved successfully: test-data\storage\a8\79\a87974a0f8d71939_file2.txt

[90mstdout[2m | tests/unit/providers/db/sqlite.test.ts[2m > [22m[2mSqliteDbProvider[2m > [22m[2mhealthCheck[2m > [22m[2mshould return true if connected
[22m[39m[SQLite] SELECT 1 as test

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2mlist[2m > [22m[2mshould filter by prefix
[22m[39m[LocalFsStorageProvider] Saving file: images/file3.png -> test-data\storage\d9\c9\d9c924093b541d5f_file3.png

[90mstdout[2m | tests/unit/providers/db/sqlite.test.ts[2m > [22m[2mSqliteDbProvider[2m > [22m[2mhealthCheck[2m > [22m[2mshould return true if connected
[22m[39m[SqliteDbProvider] Closing SQLite database

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2mlist[2m > [22m[2mshould filter by prefix
[22m[39m[LocalFsStorageProvider] Created directory: test-data\storage\d9\c9

[90mstdout[2m | tests/unit/providers/db/sqlite.test.ts[2m > [22m[2mSqliteDbProvider[2m > [22m[2mclose[2m > [22m[2mshould close database connection
[22m[39m[SqliteDbProvider] Connecting to: ./test-data/test.db
[SQLite] PRAGMA journal_mode = WAL
[SQLite] PRAGMA synchronous = NORMAL
[SQLite] PRAGMA cache_size = -64000
[SQLite] PRAGMA temp_store = MEMORY
[SQLite] PRAGMA foreign_keys = ON
[SqliteDbProvider] Connected successfully with WAL mode

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2mlist[2m > [22m[2mshould filter by prefix
[22m[39m[LocalFsStorageProvider] File saved successfully: test-data\storage\d9\c9\d9c924093b541d5f_file3.png

[90mstdout[2m | tests/unit/providers/db/sqlite.test.ts[2m > [22m[2mSqliteDbProvider[2m > [22m[2mclose[2m > [22m[2mshould close database connection
[22m[39m[SQLite] SELECT 1 as test

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2mlist[2m > [22m[2mshould filter by prefix
[22m[39m[LocalFsStorageProvider] Listing files in: test-data\storage\b9

[90mstdout[2m | tests/unit/providers/db/sqlite.test.ts[2m > [22m[2mSqliteDbProvider[2m > [22m[2mclose[2m > [22m[2mshould close database connection
[22m[39m[SqliteDbProvider] Closing SQLite database

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2mlist[2m > [22m[2mshould filter by prefix
[22m[39m[LocalFsStorageProvider] Found 1 files

[90mstdout[2m | tests/unit/providers/db/sqlite.test.ts[2m > [22m[2mSqliteDbProvider[2m > [22m[2mclose[2m > [22m[2mshould be safe to call multiple times
[22m[39m[SqliteDbProvider] Connecting to: ./test-data/test.db
[SQLite] PRAGMA journal_mode = WAL
[SQLite] PRAGMA synchronous = NORMAL
[SQLite] PRAGMA cache_size = -64000
[SQLite] PRAGMA temp_store = MEMORY
[SQLite] PRAGMA foreign_keys = ON
[SqliteDbProvider] Connected successfully with WAL mode

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2mlist[2m > [22m[2mshould return StorageFile objects with URIs
[22m[39m[LocalFsStorageProvider] Initialized with basePath: ./test-data/storage
[LocalFsStorageProvider] Created base directory: ./test-data/storage

[90mstdout[2m | tests/unit/providers/db/sqlite.test.ts[2m > [22m[2mSqliteDbProvider[2m > [22m[2mclose[2m > [22m[2mshould be safe to call multiple times
[22m[39m[SqliteDbProvider] Closing SQLite database

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2mlist[2m > [22m[2mshould return StorageFile objects with URIs
[22m[39m[LocalFsStorageProvider] Saving file: file1.txt -> test-data\storage\b9\a5\b9a5bee69e8781b9_file1.txt

[90mstdout[2m | tests/unit/providers/db/sqlite.test.ts[2m > [22m[2mSqliteDbProvider[2m > [22m[2mbackup[2m > [22m[2mshould create backup file
[22m[39m[SqliteDbProvider] Connecting to: ./test-data/test.db
[SQLite] PRAGMA journal_mode = WAL
[SQLite] PRAGMA synchronous = NORMAL
[SQLite] PRAGMA cache_size = -64000
[SQLite] PRAGMA temp_store = MEMORY
[SQLite] PRAGMA foreign_keys = ON
[SqliteDbProvider] Connected successfully with WAL mode

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2mlist[2m > [22m[2mshould return StorageFile objects with URIs
[22m[39m[LocalFsStorageProvider] Created directory: test-data\storage\b9\a5

[90mstdout[2m | tests/unit/providers/db/sqlite.test.ts[2m > [22m[2mSqliteDbProvider[2m > [22m[2mbackup[2m > [22m[2mshould create backup file
[22m[39m[SqliteDbProvider] Starting database migration...
[SQLite] CREATE TABLE IF NOT EXISTS _migrations (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        version INTEGER NOT NULL UNIQUE,
        name TEXT NOT NULL,
        applied_at TEXT NOT NULL DEFAULT (datetime('now'))
      )
    
[SQLite] SELECT COALESCE(MAX(version), 0) as version FROM _migrations
[SqliteDbProvider] Current schema version: 0
[SqliteDbProvider] Applying 1 migration(s)...
[SqliteDbProvider] Applying migration 1: initial_schema
[SQLite] BEGIN
[SQLite] -- Users table
      CREATE TABLE IF NOT EXISTS users (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        email TEXT NOT NULL UNIQUE,
        password_hash TEXT,
        first_name TEXT,
        last_name TEXT,
        role TEXT NOT NULL DEFAULT 'user' CHECK(role IN ('admin', 'user', 'auditor')),
        organization_id INTEGER,
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        updated_at TEXT NOT NULL DEFAULT (datetime('now')),
        last_login_at TEXT,
        is_active INTEGER NOT NULL DEFAULT 1,
        email_verified INTEGER NOT NULL DEFAULT 0,
        mfa_enabled INTEGER NOT NULL DEFAULT 0,
        mfa_secret TEXT
      );
[SQLite] -- Organizations table
      CREATE TABLE IF NOT EXISTS organizations (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        name TEXT NOT NULL,
        slug TEXT NOT NULL UNIQUE,
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        updated_at TEXT NOT NULL DEFAULT (datetime('now')),
        settings TEXT,
        subscription_tier TEXT DEFAULT 'free' CHECK(subscription_tier IN ('free', 'pro', 'enterprise'))
      );
[SQLite] -- Documents table
      CREATE TABLE IF NOT EXISTS documents (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        title TEXT NOT NULL,
        content TEXT NOT NULL,
        document_type TEXT NOT NULL CHECK(document_type IN ('policy', 'procedure', 'plan', 'manual', 'other')),
        framework TEXT CHECK(framework IN ('iso27001', 'soc2', 'fedramp', 'nist')),
        status TEXT NOT NULL DEFAULT 'draft' CHECK(status IN ('draft', 'in_review', 'approved', 'published', 'archived')),
        version INTEGER NOT NULL DEFAULT 1,
        organization_id INTEGER NOT NULL,
        created_by INTEGER NOT NULL,
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        updated_at TEXT NOT NULL DEFAULT (datetime('now')),
        published_at TEXT,
        metadata TEXT,
        FOREIGN KEY (organization_id) REFERENCES organizations(id),
        FOREIGN KEY (created_by) REFERENCES users(id)
      );
[SQLite] -- Document versions table
      CREATE TABLE IF NOT EXISTS document_versions (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        document_id INTEGER NOT NULL,
        version INTEGER NOT NULL,
        content TEXT NOT NULL,
        created_by INTEGER NOT NULL,
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        change_summary TEXT,
        FOREIGN KEY (document_id) REFERENCES documents(id),
        FOREIGN KEY (created_by) REFERENCES users(id)
      );
[SQLite] -- Gap analysis table
      CREATE TABLE IF NOT EXISTS gap_analysis (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        organization_id INTEGER NOT NULL,
        framework TEXT NOT NULL CHECK(framework IN ('iso27001', 'soc2', 'fedramp', 'nist')),
        control_id TEXT NOT NULL,
        control_name TEXT NOT NULL,
        status TEXT NOT NULL CHECK(status IN ('not_implemented', 'partially_implemented', 'fully_implemented', 'not_applicable')),
        gap_description TEXT,
        remediation_plan TEXT,
        priority TEXT CHECK(priority IN ('critical', 'high', 'medium', 'low')),
        target_date TEXT,
        assigned_to INTEGER,
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        updated_at TEXT NOT NULL DEFAULT (datetime('now')),
        FOREIGN KEY (organization_id) REFERENCES organizations(id),
        FOREIGN KEY (assigned_to) REFERENCES users(id)
      );
[SQLite] -- Risk assessments table
      CREATE TABLE IF NOT EXISTS risk_assessments (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        organization_id INTEGER NOT NULL,
        risk_name TEXT NOT NULL,
        description TEXT,
        likelihood TEXT CHECK(likelihood IN ('very_low', 'low', 'medium', 'high', 'very_high')),
        impact TEXT CHECK(impact IN ('very_low', 'low', 'medium', 'high', 'very_high')),
        risk_score INTEGER,
        mitigation_plan TEXT,
        status TEXT NOT NULL DEFAULT 'open' CHECK(status IN ('open', 'mitigated', 'accepted', 'closed')),
        owner INTEGER,
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        updated_at TEXT NOT NULL DEFAULT (datetime('now')),
        FOREIGN KEY (organization_id) REFERENCES organizations(id),
        FOREIGN KEY (owner) REFERENCES users(id)
      );
[SQLite] -- Audit logs table
      CREATE TABLE IF NOT EXISTS audit_logs (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        organization_id INTEGER,
        user_id INTEGER,
        action TEXT NOT NULL,
        resource_type TEXT NOT NULL,
        resource_id TEXT,
        details TEXT,
        ip_address TEXT,
        user_agent TEXT,
        risk_level TEXT CHECK(risk_level IN ('low', 'medium', 'high', 'critical')),
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        FOREIGN KEY (organization_id) REFERENCES organizations(id),
        FOREIGN KEY (user_id) REFERENCES users(id)
      );
[SQLite] -- Files/Storage metadata table
      CREATE TABLE IF NOT EXISTS storage_files (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        organization_id INTEGER NOT NULL,
        file_path TEXT NOT NULL,
        uri TEXT NOT NULL UNIQUE,
        size INTEGER NOT NULL,
        content_type TEXT NOT NULL,
        hash TEXT,
        uploaded_by INTEGER,
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        FOREIGN KEY (organization_id) REFERENCES organizations(id),
        FOREIGN KEY (uploaded_by) REFERENCES users(id)
      );
[SQLite] -- Create indexes for common queries
      CREATE INDEX IF NOT EXISTS idx_users_email ON users(email);
[SQLite] CREATE INDEX IF NOT EXISTS idx_users_org ON users(organization_id);
[SQLite] CREATE INDEX IF NOT EXISTS idx_documents_org ON documents(organization_id);
[SQLite] CREATE INDEX IF NOT EXISTS idx_documents_framework ON documents(framework);
[SQLite] CREATE INDEX IF NOT EXISTS idx_gap_analysis_org ON gap_analysis(organization_id);
[SQLite] CREATE INDEX IF NOT EXISTS idx_audit_logs_org ON audit_logs(organization_id);
[SQLite] CREATE INDEX IF NOT EXISTS idx_audit_logs_created ON audit_logs(created_at);
[SQLite] CREATE INDEX IF NOT EXISTS idx_storage_files_org ON storage_files(organization_id);
[SQLite] -- Insert default local organization for local mode
      INSERT OR IGNORE INTO organizations (id, name, slug, settings)
      VALUES (1, 'Local Workspace', 'local', '{}');
[SQLite] -- Insert default local admin user for local mode
      INSERT OR IGNORE INTO users (id, email, role, first_name, last_name, organization_id, is_active)
      VALUES (1, 'admin@local', 'admin', 'Local', 'Admin', 1, 1);
[SQLite] INSERT INTO _migrations (version, name) VALUES (1.0, 'initial_schema')
[SQLite] COMMIT
[SqliteDbProvider] Migration 1 applied successfully
[SqliteDbProvider] Migration complete

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2mlist[2m > [22m[2mshould return StorageFile objects with URIs
[22m[39m[LocalFsStorageProvider] File saved successfully: test-data\storage\b9\a5\b9a5bee69e8781b9_file1.txt

[90mstdout[2m | tests/unit/providers/db/sqlite.test.ts[2m > [22m[2mSqliteDbProvider[2m > [22m[2mbackup[2m > [22m[2mshould create backup file
[22m[39m[SQLite] INSERT INTO organizations (name, slug, settings) VALUES ('Backup Test', 'backup-test', '{}')

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2mlist[2m > [22m[2mshould return StorageFile objects with URIs
[22m[39m[LocalFsStorageProvider] Listing files in: ./test-data/storage

[90mstdout[2m | tests/unit/providers/db/sqlite.test.ts[2m > [22m[2mSqliteDbProvider[2m > [22m[2mbackup[2m > [22m[2mshould create backup file
[22m[39m[SqliteDbProvider] Creating backup: ./test-data/backup.db

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2mlist[2m > [22m[2mshould return StorageFile objects with URIs
[22m[39m[LocalFsStorageProvider] Found 1 files

[90mstdout[2m | tests/unit/providers/db/sqlite.test.ts[2m > [22m[2mSqliteDbProvider[2m > [22m[2mbackup[2m > [22m[2mshould create backup file
[22m[39m[SqliteDbProvider] Backup complete

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2mgetMetadata[2m > [22m[2mshould return file metadata
[22m[39m[LocalFsStorageProvider] Initialized with basePath: ./test-data/storage
[LocalFsStorageProvider] Created base directory: ./test-data/storage

[90mstdout[2m | tests/unit/providers/db/sqlite.test.ts[2m > [22m[2mSqliteDbProvider[2m > [22m[2mbackup[2m > [22m[2mshould create backup file
[22m[39m[SqliteDbProvider] Closing SQLite database

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2mgetMetadata[2m > [22m[2mshould return file metadata
[22m[39m[LocalFsStorageProvider] Saving file: test.txt -> test-data\storage\6c\06\6c06e7970b00a815_test.txt

[90mstdout[2m | tests/unit/providers/db/sqlite.test.ts[2m > [22m[2mSqliteDbProvider[2m > [22m[2mbackup[2m > [22m[2mshould create backup directory if needed
[22m[39m[SqliteDbProvider] Connecting to: ./test-data/test.db
[SQLite] PRAGMA journal_mode = WAL
[SQLite] PRAGMA synchronous = NORMAL
[SQLite] PRAGMA cache_size = -64000
[SQLite] PRAGMA temp_store = MEMORY
[SQLite] PRAGMA foreign_keys = ON
[SqliteDbProvider] Connected successfully with WAL mode

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2mgetMetadata[2m > [22m[2mshould return file metadata
[22m[39m[LocalFsStorageProvider] Created directory: test-data\storage\6c\06

[90mstdout[2m | tests/unit/providers/db/sqlite.test.ts[2m > [22m[2mSqliteDbProvider[2m > [22m[2mbackup[2m > [22m[2mshould create backup directory if needed
[22m[39m[SqliteDbProvider] Starting database migration...
[SQLite] CREATE TABLE IF NOT EXISTS _migrations (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        version INTEGER NOT NULL UNIQUE,
        name TEXT NOT NULL,
        applied_at TEXT NOT NULL DEFAULT (datetime('now'))
      )
    
[SQLite] SELECT COALESCE(MAX(version), 0) as version FROM _migrations
[SqliteDbProvider] Current schema version: 0
[SqliteDbProvider] Applying 1 migration(s)...
[SqliteDbProvider] Applying migration 1: initial_schema
[SQLite] BEGIN
[SQLite] -- Users table
      CREATE TABLE IF NOT EXISTS users (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        email TEXT NOT NULL UNIQUE,
        password_hash TEXT,
        first_name TEXT,
        last_name TEXT,
        role TEXT NOT NULL DEFAULT 'user' CHECK(role IN ('admin', 'user', 'auditor')),
        organization_id INTEGER,
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        updated_at TEXT NOT NULL DEFAULT (datetime('now')),
        last_login_at TEXT,
        is_active INTEGER NOT NULL DEFAULT 1,
        email_verified INTEGER NOT NULL DEFAULT 0,
        mfa_enabled INTEGER NOT NULL DEFAULT 0,
        mfa_secret TEXT
      );
[SQLite] -- Organizations table
      CREATE TABLE IF NOT EXISTS organizations (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        name TEXT NOT NULL,
        slug TEXT NOT NULL UNIQUE,
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        updated_at TEXT NOT NULL DEFAULT (datetime('now')),
        settings TEXT,
        subscription_tier TEXT DEFAULT 'free' CHECK(subscription_tier IN ('free', 'pro', 'enterprise'))
      );
[SQLite] -- Documents table
      CREATE TABLE IF NOT EXISTS documents (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        title TEXT NOT NULL,
        content TEXT NOT NULL,
        document_type TEXT NOT NULL CHECK(document_type IN ('policy', 'procedure', 'plan', 'manual', 'other')),
        framework TEXT CHECK(framework IN ('iso27001', 'soc2', 'fedramp', 'nist')),
        status TEXT NOT NULL DEFAULT 'draft' CHECK(status IN ('draft', 'in_review', 'approved', 'published', 'archived')),
        version INTEGER NOT NULL DEFAULT 1,
        organization_id INTEGER NOT NULL,
        created_by INTEGER NOT NULL,
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        updated_at TEXT NOT NULL DEFAULT (datetime('now')),
        published_at TEXT,
        metadata TEXT,
        FOREIGN KEY (organization_id) REFERENCES organizations(id),
        FOREIGN KEY (created_by) REFERENCES users(id)
      );
[SQLite] -- Document versions table
      CREATE TABLE IF NOT EXISTS document_versions (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        document_id INTEGER NOT NULL,
        version INTEGER NOT NULL,
        content TEXT NOT NULL,
        created_by INTEGER NOT NULL,
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        change_summary TEXT,
        FOREIGN KEY (document_id) REFERENCES documents(id),
        FOREIGN KEY (created_by) REFERENCES users(id)
      );
[SQLite] -- Gap analysis table
      CREATE TABLE IF NOT EXISTS gap_analysis (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        organization_id INTEGER NOT NULL,
        framework TEXT NOT NULL CHECK(framework IN ('iso27001', 'soc2', 'fedramp', 'nist')),
        control_id TEXT NOT NULL,
        control_name TEXT NOT NULL,
        status TEXT NOT NULL CHECK(status IN ('not_implemented', 'partially_implemented', 'fully_implemented', 'not_applicable')),
        gap_description TEXT,
        remediation_plan TEXT,
        priority TEXT CHECK(priority IN ('critical', 'high', 'medium', 'low')),
        target_date TEXT,
        assigned_to INTEGER,
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        updated_at TEXT NOT NULL DEFAULT (datetime('now')),
        FOREIGN KEY (organization_id) REFERENCES organizations(id),
        FOREIGN KEY (assigned_to) REFERENCES users(id)
      );
[SQLite] -- Risk assessments table
      CREATE TABLE IF NOT EXISTS risk_assessments (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        organization_id INTEGER NOT NULL,
        risk_name TEXT NOT NULL,
        description TEXT,
        likelihood TEXT CHECK(likelihood IN ('very_low', 'low', 'medium', 'high', 'very_high')),
        impact TEXT CHECK(impact IN ('very_low', 'low', 'medium', 'high', 'very_high')),
        risk_score INTEGER,
        mitigation_plan TEXT,
        status TEXT NOT NULL DEFAULT 'open' CHECK(status IN ('open', 'mitigated', 'accepted', 'closed')),
        owner INTEGER,
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        updated_at TEXT NOT NULL DEFAULT (datetime('now')),
        FOREIGN KEY (organization_id) REFERENCES organizations(id),
        FOREIGN KEY (owner) REFERENCES users(id)
      );
[SQLite] -- Audit logs table
      CREATE TABLE IF NOT EXISTS audit_logs (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        organization_id INTEGER,
        user_id INTEGER,
        action TEXT NOT NULL,
        resource_type TEXT NOT NULL,
        resource_id TEXT,
        details TEXT,
        ip_address TEXT,
        user_agent TEXT,
        risk_level TEXT CHECK(risk_level IN ('low', 'medium', 'high', 'critical')),
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        FOREIGN KEY (organization_id) REFERENCES organizations(id),
        FOREIGN KEY (user_id) REFERENCES users(id)
      );
[SQLite] -- Files/Storage metadata table
      CREATE TABLE IF NOT EXISTS storage_files (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        organization_id INTEGER NOT NULL,
        file_path TEXT NOT NULL,
        uri TEXT NOT NULL UNIQUE,
        size INTEGER NOT NULL,
        content_type TEXT NOT NULL,
        hash TEXT,
        uploaded_by INTEGER,
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        FOREIGN KEY (organization_id) REFERENCES organizations(id),
        FOREIGN KEY (uploaded_by) REFERENCES users(id)
      );
[SQLite] -- Create indexes for common queries
      CREATE INDEX IF NOT EXISTS idx_users_email ON users(email);
[SQLite] CREATE INDEX IF NOT EXISTS idx_users_org ON users(organization_id);
[SQLite] CREATE INDEX IF NOT EXISTS idx_documents_org ON documents(organization_id);
[SQLite] CREATE INDEX IF NOT EXISTS idx_documents_framework ON documents(framework);
[SQLite] CREATE INDEX IF NOT EXISTS idx_gap_analysis_org ON gap_analysis(organization_id);
[SQLite] CREATE INDEX IF NOT EXISTS idx_audit_logs_org ON audit_logs(organization_id);
[SQLite] CREATE INDEX IF NOT EXISTS idx_audit_logs_created ON audit_logs(created_at);
[SQLite] CREATE INDEX IF NOT EXISTS idx_storage_files_org ON storage_files(organization_id);
[SQLite] -- Insert default local organization for local mode
      INSERT OR IGNORE INTO organizations (id, name, slug, settings)
      VALUES (1, 'Local Workspace', 'local', '{}');
[SQLite] -- Insert default local admin user for local mode
      INSERT OR IGNORE INTO users (id, email, role, first_name, last_name, organization_id, is_active)
      VALUES (1, 'admin@local', 'admin', 'Local', 'Admin', 1, 1);
[SQLite] INSERT INTO _migrations (version, name) VALUES (1.0, 'initial_schema')
[SQLite] COMMIT
[SqliteDbProvider] Migration 1 applied successfully
[SqliteDbProvider] Migration complete

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2mgetMetadata[2m > [22m[2mshould return file metadata
[22m[39m[LocalFsStorageProvider] File saved successfully: test-data\storage\6c\06\6c06e7970b00a815_test.txt

[90mstdout[2m | tests/unit/providers/db/sqlite.test.ts[2m > [22m[2mSqliteDbProvider[2m > [22m[2mbackup[2m > [22m[2mshould create backup directory if needed
[22m[39m[SqliteDbProvider] Creating backup: ./test-data/backups/backup.db

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2mgetMetadata[2m > [22m[2mshould return file metadata
[22m[39m[LocalFsStorageProvider] Getting metadata for: test-data\storage\6c\06\6c06e7970b00a815_test.txt

[90mstdout[2m | tests/unit/providers/db/sqlite.test.ts[2m > [22m[2mSqliteDbProvider[2m > [22m[2mbackup[2m > [22m[2mshould create backup directory if needed
[22m[39m[SqliteDbProvider] Backup complete

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2mgetMetadata[2m > [22m[2mshould detect MIME type from extension
[22m[39m[LocalFsStorageProvider] Initialized with basePath: ./test-data/storage
[LocalFsStorageProvider] Created base directory: ./test-data/storage

[90mstdout[2m | tests/unit/providers/db/sqlite.test.ts[2m > [22m[2mSqliteDbProvider[2m > [22m[2mbackup[2m > [22m[2mshould create backup directory if needed
[22m[39m[SqliteDbProvider] Closing SQLite database

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2mgetMetadata[2m > [22m[2mshould detect MIME type from extension
[22m[39m[LocalFsStorageProvider] Saving file: test.pdf -> test-data\storage\1d\39\1d393b0081b632c5_test.pdf

[90mstdout[2m | tests/unit/providers/db/sqlite.test.ts[2m > [22m[2mSqliteDbProvider[2m > [22m[2mrestore[2m > [22m[2mshould restore database from backup
[22m[39m[SqliteDbProvider] Connecting to: ./test-data/test.db
[SQLite] PRAGMA journal_mode = WAL
[SQLite] PRAGMA synchronous = NORMAL
[SQLite] PRAGMA cache_size = -64000
[SQLite] PRAGMA temp_store = MEMORY
[SQLite] PRAGMA foreign_keys = ON
[SqliteDbProvider] Connected successfully with WAL mode

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2mgetMetadata[2m > [22m[2mshould detect MIME type from extension
[22m[39m[LocalFsStorageProvider] Created directory: test-data\storage\1d\39

[90mstdout[2m | tests/unit/providers/db/sqlite.test.ts[2m > [22m[2mSqliteDbProvider[2m > [22m[2mrestore[2m > [22m[2mshould restore database from backup
[22m[39m[SqliteDbProvider] Starting database migration...
[SQLite] CREATE TABLE IF NOT EXISTS _migrations (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        version INTEGER NOT NULL UNIQUE,
        name TEXT NOT NULL,
        applied_at TEXT NOT NULL DEFAULT (datetime('now'))
      )
    
[SQLite] SELECT COALESCE(MAX(version), 0) as version FROM _migrations
[SqliteDbProvider] Current schema version: 0
[SqliteDbProvider] Applying 1 migration(s)...
[SqliteDbProvider] Applying migration 1: initial_schema
[SQLite] BEGIN
[SQLite] -- Users table
      CREATE TABLE IF NOT EXISTS users (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        email TEXT NOT NULL UNIQUE,
        password_hash TEXT,
        first_name TEXT,
        last_name TEXT,
        role TEXT NOT NULL DEFAULT 'user' CHECK(role IN ('admin', 'user', 'auditor')),
        organization_id INTEGER,
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        updated_at TEXT NOT NULL DEFAULT (datetime('now')),
        last_login_at TEXT,
        is_active INTEGER NOT NULL DEFAULT 1,
        email_verified INTEGER NOT NULL DEFAULT 0,
        mfa_enabled INTEGER NOT NULL DEFAULT 0,
        mfa_secret TEXT
      );
[SQLite] -- Organizations table
      CREATE TABLE IF NOT EXISTS organizations (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        name TEXT NOT NULL,
        slug TEXT NOT NULL UNIQUE,
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        updated_at TEXT NOT NULL DEFAULT (datetime('now')),
        settings TEXT,
        subscription_tier TEXT DEFAULT 'free' CHECK(subscription_tier IN ('free', 'pro', 'enterprise'))
      );
[SQLite] -- Documents table
      CREATE TABLE IF NOT EXISTS documents (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        title TEXT NOT NULL,
        content TEXT NOT NULL,
        document_type TEXT NOT NULL CHECK(document_type IN ('policy', 'procedure', 'plan', 'manual', 'other')),
        framework TEXT CHECK(framework IN ('iso27001', 'soc2', 'fedramp', 'nist')),
        status TEXT NOT NULL DEFAULT 'draft' CHECK(status IN ('draft', 'in_review', 'approved', 'published', 'archived')),
        version INTEGER NOT NULL DEFAULT 1,
        organization_id INTEGER NOT NULL,
        created_by INTEGER NOT NULL,
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        updated_at TEXT NOT NULL DEFAULT (datetime('now')),
        published_at TEXT,
        metadata TEXT,
        FOREIGN KEY (organization_id) REFERENCES organizations(id),
        FOREIGN KEY (created_by) REFERENCES users(id)
      );
[SQLite] -- Document versions table
      CREATE TABLE IF NOT EXISTS document_versions (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        document_id INTEGER NOT NULL,
        version INTEGER NOT NULL,
        content TEXT NOT NULL,
        created_by INTEGER NOT NULL,
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        change_summary TEXT,
        FOREIGN KEY (document_id) REFERENCES documents(id),
        FOREIGN KEY (created_by) REFERENCES users(id)
      );
[SQLite] -- Gap analysis table
      CREATE TABLE IF NOT EXISTS gap_analysis (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        organization_id INTEGER NOT NULL,
        framework TEXT NOT NULL CHECK(framework IN ('iso27001', 'soc2', 'fedramp', 'nist')),
        control_id TEXT NOT NULL,
        control_name TEXT NOT NULL,
        status TEXT NOT NULL CHECK(status IN ('not_implemented', 'partially_implemented', 'fully_implemented', 'not_applicable')),
        gap_description TEXT,
        remediation_plan TEXT,
        priority TEXT CHECK(priority IN ('critical', 'high', 'medium', 'low')),
        target_date TEXT,
        assigned_to INTEGER,
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        updated_at TEXT NOT NULL DEFAULT (datetime('now')),
        FOREIGN KEY (organization_id) REFERENCES organizations(id),
        FOREIGN KEY (assigned_to) REFERENCES users(id)
      );
[SQLite] -- Risk assessments table
      CREATE TABLE IF NOT EXISTS risk_assessments (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        organization_id INTEGER NOT NULL,
        risk_name TEXT NOT NULL,
        description TEXT,
        likelihood TEXT CHECK(likelihood IN ('very_low', 'low', 'medium', 'high', 'very_high')),
        impact TEXT CHECK(impact IN ('very_low', 'low', 'medium', 'high', 'very_high')),
        risk_score INTEGER,
        mitigation_plan TEXT,
        status TEXT NOT NULL DEFAULT 'open' CHECK(status IN ('open', 'mitigated', 'accepted', 'closed')),
        owner INTEGER,
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        updated_at TEXT NOT NULL DEFAULT (datetime('now')),
        FOREIGN KEY (organization_id) REFERENCES organizations(id),
        FOREIGN KEY (owner) REFERENCES users(id)
      );
[SQLite] -- Audit logs table
      CREATE TABLE IF NOT EXISTS audit_logs (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        organization_id INTEGER,
        user_id INTEGER,
        action TEXT NOT NULL,
        resource_type TEXT NOT NULL,
        resource_id TEXT,
        details TEXT,
        ip_address TEXT,
        user_agent TEXT,
        risk_level TEXT CHECK(risk_level IN ('low', 'medium', 'high', 'critical')),
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        FOREIGN KEY (organization_id) REFERENCES organizations(id),
        FOREIGN KEY (user_id) REFERENCES users(id)
      );
[SQLite] -- Files/Storage metadata table
      CREATE TABLE IF NOT EXISTS storage_files (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        organization_id INTEGER NOT NULL,
        file_path TEXT NOT NULL,
        uri TEXT NOT NULL UNIQUE,
        size INTEGER NOT NULL,
        content_type TEXT NOT NULL,
        hash TEXT,
        uploaded_by INTEGER,
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        FOREIGN KEY (organization_id) REFERENCES organizations(id),
        FOREIGN KEY (uploaded_by) REFERENCES users(id)
      );
[SQLite] -- Create indexes for common queries
      CREATE INDEX IF NOT EXISTS idx_users_email ON users(email);
[SQLite] CREATE INDEX IF NOT EXISTS idx_users_org ON users(organization_id);
[SQLite] CREATE INDEX IF NOT EXISTS idx_documents_org ON documents(organization_id);
[SQLite] CREATE INDEX IF NOT EXISTS idx_documents_framework ON documents(framework);
[SQLite] CREATE INDEX IF NOT EXISTS idx_gap_analysis_org ON gap_analysis(organization_id);
[SQLite] CREATE INDEX IF NOT EXISTS idx_audit_logs_org ON audit_logs(organization_id);
[SQLite] CREATE INDEX IF NOT EXISTS idx_audit_logs_created ON audit_logs(created_at);
[SQLite] CREATE INDEX IF NOT EXISTS idx_storage_files_org ON storage_files(organization_id);
[SQLite] -- Insert default local organization for local mode
      INSERT OR IGNORE INTO organizations (id, name, slug, settings)
      VALUES (1, 'Local Workspace', 'local', '{}');
[SQLite] -- Insert default local admin user for local mode
      INSERT OR IGNORE INTO users (id, email, role, first_name, last_name, organization_id, is_active)
      VALUES (1, 'admin@local', 'admin', 'Local', 'Admin', 1, 1);
[SQLite] INSERT INTO _migrations (version, name) VALUES (1.0, 'initial_schema')
[SQLite] COMMIT
[SqliteDbProvider] Migration 1 applied successfully
[SqliteDbProvider] Migration complete

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2mgetMetadata[2m > [22m[2mshould detect MIME type from extension
[22m[39m[LocalFsStorageProvider] File saved successfully: test-data\storage\1d\39\1d393b0081b632c5_test.pdf

 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/providers/db/sqlite.test.ts[2m > [22mSqliteDbProvider[2m > [22mtransaction[2m > [22mshould commit transaction on success[32m 16[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/providers/db/sqlite.test.ts[2m > [22mSqliteDbProvider[2m > [22mtransaction[2m > [22mshould rollback transaction on error[32m 21[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/providers/db/sqlite.test.ts[2m > [22mSqliteDbProvider[2m > [22mhealthCheck[2m > [22mshould return false if not connected[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/providers/db/sqlite.test.ts[2m > [22mSqliteDbProvider[2m > [22mhealthCheck[2m > [22mshould return true if connected[32m 7[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/providers/db/sqlite.test.ts[2m > [22mSqliteDbProvider[2m > [22mclose[2m > [22mshould close database connection[32m 9[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/providers/db/sqlite.test.ts[2m > [22mSqliteDbProvider[2m > [22mclose[2m > [22mshould be safe to call multiple times[32m 7[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/providers/db/sqlite.test.ts[2m > [22mSqliteDbProvider[2m > [22mbackup[2m > [22mshould create backup file[32m 27[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/providers/db/sqlite.test.ts[2m > [22mSqliteDbProvider[2m > [22mbackup[2m > [22mshould create backup directory if needed[32m 23[2mms[22m[39m
[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2mgetMetadata[2m > [22m[2mshould detect MIME type from extension
[22m[39m[LocalFsStorageProvider] Saving file: test.txt -> test-data\storage\71\98\71988c4d8e0803ba_test.txt

[90mstdout[2m | tests/unit/providers/db/sqlite.test.ts[2m > [22m[2mSqliteDbProvider[2m > [22m[2mrestore[2m > [22m[2mshould restore database from backup
[22m[39m[SQLite] INSERT INTO organizations (name, slug, settings) VALUES ('Original Data', 'original', '{}')

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2mgetMetadata[2m > [22m[2mshould detect MIME type from extension
[22m[39m[LocalFsStorageProvider] Created directory: test-data\storage\71\98

[90mstdout[2m | tests/unit/providers/db/sqlite.test.ts[2m > [22m[2mSqliteDbProvider[2m > [22m[2mrestore[2m > [22m[2mshould restore database from backup
[22m[39m[SqliteDbProvider] Creating backup: ./test-data/backup.db

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2mgetMetadata[2m > [22m[2mshould detect MIME type from extension
[22m[39m[LocalFsStorageProvider] File saved successfully: test-data\storage\71\98\71988c4d8e0803ba_test.txt

[90mstdout[2m | tests/unit/providers/db/sqlite.test.ts[2m > [22m[2mSqliteDbProvider[2m > [22m[2mrestore[2m > [22m[2mshould restore database from backup
[22m[39m[SqliteDbProvider] Backup complete

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2mgetMetadata[2m > [22m[2mshould detect MIME type from extension
[22m[39m[LocalFsStorageProvider] Saving file: test.json -> test-data\storage\44\13\44136fa355b3678a_test.json

[90mstdout[2m | tests/unit/providers/db/sqlite.test.ts[2m > [22m[2mSqliteDbProvider[2m > [22m[2mrestore[2m > [22m[2mshould restore database from backup
[22m[39m[SQLite] DELETE FROM organizations WHERE slug = 'original'

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2mgetMetadata[2m > [22m[2mshould detect MIME type from extension
[22m[39m[LocalFsStorageProvider] Created directory: test-data\storage\44\13

[90mstdout[2m | tests/unit/providers/db/sqlite.test.ts[2m > [22m[2mSqliteDbProvider[2m > [22m[2mrestore[2m > [22m[2mshould restore database from backup
[22m[39m[SQLite] SELECT name FROM organizations WHERE slug = 'original'

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2mgetMetadata[2m > [22m[2mshould detect MIME type from extension
[22m[39m[LocalFsStorageProvider] File saved successfully: test-data\storage\44\13\44136fa355b3678a_test.json

[90mstdout[2m | tests/unit/providers/db/sqlite.test.ts[2m > [22m[2mSqliteDbProvider[2m > [22m[2mrestore[2m > [22m[2mshould restore database from backup
[22m[39m[SqliteDbProvider] Restoring from backup: ./test-data/backup.db
[SqliteDbProvider] Closing SQLite database

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2mgetMetadata[2m > [22m[2mshould detect MIME type from extension
[22m[39m[LocalFsStorageProvider] Getting metadata for: test-data\storage\1d\39\1d393b0081b632c5_test.pdf

[90mstdout[2m | tests/unit/providers/db/sqlite.test.ts[2m > [22m[2mSqliteDbProvider[2m > [22m[2mrestore[2m > [22m[2mshould restore database from backup
[22m[39m[SqliteDbProvider] Connecting to: ./test-data/test.db
[SQLite] PRAGMA journal_mode = WAL
[SQLite] PRAGMA synchronous = NORMAL
[SQLite] PRAGMA cache_size = -64000
[SQLite] PRAGMA temp_store = MEMORY
[SQLite] PRAGMA foreign_keys = ON
[SqliteDbProvider] Connected successfully with WAL mode

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2mgetMetadata[2m > [22m[2mshould detect MIME type from extension
[22m[39m[LocalFsStorageProvider] Getting metadata for: test-data\storage\71\98\71988c4d8e0803ba_test.txt

[90mstdout[2m | tests/unit/providers/db/sqlite.test.ts[2m > [22m[2mSqliteDbProvider[2m > [22m[2mrestore[2m > [22m[2mshould restore database from backup
[22m[39m[SqliteDbProvider] Restore complete

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2mgetMetadata[2m > [22m[2mshould detect MIME type from extension
[22m[39m[LocalFsStorageProvider] Getting metadata for: test-data\storage\44\13\44136fa355b3678a_test.json

[90mstdout[2m | tests/unit/providers/db/sqlite.test.ts[2m > [22m[2mSqliteDbProvider[2m > [22m[2mrestore[2m > [22m[2mshould restore database from backup
[22m[39m[SQLite] SELECT name FROM organizations WHERE slug = 'original'

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2mgetMetadata[2m > [22m[2mshould throw error for non-existent file
[22m[39m[LocalFsStorageProvider] Initialized with basePath: ./test-data/storage
[LocalFsStorageProvider] Created base directory: ./test-data/storage

[90mstdout[2m | tests/unit/providers/db/sqlite.test.ts[2m > [22m[2mSqliteDbProvider[2m > [22m[2mrestore[2m > [22m[2mshould restore database from backup
[22m[39m[SqliteDbProvider] Closing SQLite database

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2mgetMetadata[2m > [22m[2mshould throw error for non-existent file
[22m[39m[LocalFsStorageProvider] Getting metadata for: test-data\storage\does-not-exist.txt

[90mstdout[2m | tests/unit/providers/db/sqlite.test.ts[2m > [22m[2mSqliteDbProvider[2m > [22m[2mgetStats[2m > [22m[2mshould return database statistics
[22m[39m[SqliteDbProvider] Connecting to: ./test-data/test.db
[SQLite] PRAGMA journal_mode = WAL
[SQLite] PRAGMA synchronous = NORMAL
[SQLite] PRAGMA cache_size = -64000
[SQLite] PRAGMA temp_store = MEMORY
[SQLite] PRAGMA foreign_keys = ON
[SqliteDbProvider] Connected successfully with WAL mode

stderr | tests/unit/providers/storage/localFs.test.ts > LocalFsStorageProvider > getMetadata > should throw error for non-existent file
[LocalFsStorageProvider] Get metadata error: Error: ENOENT: no such file or directory, stat 'C:\software\cyberdocgen\test-data\storage\does-not-exist.txt'
    at Object.stat (node:internal/fs/promises:1037:18)
    at LocalFsStorageProvider.getMetadata (C:\software\cyberdocgen\server\providers\storage\localFs.ts:245:21)
    at C:\software\cyberdocgen\tests\unit\providers\storage\localFs.test.ts:320:7
    at file:///C:/software/cyberdocgen/node_modules/@vitest/runner/dist/chunk-hooks.js:752:20 {
  errno: -4058,
  code: 'ENOENT',
  syscall: 'stat',
  path: 'C:\\software\\cyberdocgen\\test-data\\storage\\does-not-exist.txt'
}

[90mstdout[2m | tests/unit/providers/db/sqlite.test.ts[2m > [22m[2mSqliteDbProvider[2m > [22m[2mgetStats[2m > [22m[2mshould return database statistics
[22m[39m[SqliteDbProvider] Starting database migration...
[SQLite] CREATE TABLE IF NOT EXISTS _migrations (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        version INTEGER NOT NULL UNIQUE,
        name TEXT NOT NULL,
        applied_at TEXT NOT NULL DEFAULT (datetime('now'))
      )
    
[SQLite] SELECT COALESCE(MAX(version), 0) as version FROM _migrations
[SqliteDbProvider] Current schema version: 0
[SqliteDbProvider] Applying 1 migration(s)...
[SqliteDbProvider] Applying migration 1: initial_schema
[SQLite] BEGIN
[SQLite] -- Users table
      CREATE TABLE IF NOT EXISTS users (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        email TEXT NOT NULL UNIQUE,
        password_hash TEXT,
        first_name TEXT,
        last_name TEXT,
        role TEXT NOT NULL DEFAULT 'user' CHECK(role IN ('admin', 'user', 'auditor')),
        organization_id INTEGER,
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        updated_at TEXT NOT NULL DEFAULT (datetime('now')),
        last_login_at TEXT,
        is_active INTEGER NOT NULL DEFAULT 1,
        email_verified INTEGER NOT NULL DEFAULT 0,
        mfa_enabled INTEGER NOT NULL DEFAULT 0,
        mfa_secret TEXT
      );
[SQLite] -- Organizations table
      CREATE TABLE IF NOT EXISTS organizations (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        name TEXT NOT NULL,
        slug TEXT NOT NULL UNIQUE,
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        updated_at TEXT NOT NULL DEFAULT (datetime('now')),
        settings TEXT,
        subscription_tier TEXT DEFAULT 'free' CHECK(subscription_tier IN ('free', 'pro', 'enterprise'))
      );
[SQLite] -- Documents table
      CREATE TABLE IF NOT EXISTS documents (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        title TEXT NOT NULL,
        content TEXT NOT NULL,
        document_type TEXT NOT NULL CHECK(document_type IN ('policy', 'procedure', 'plan', 'manual', 'other')),
        framework TEXT CHECK(framework IN ('iso27001', 'soc2', 'fedramp', 'nist')),
        status TEXT NOT NULL DEFAULT 'draft' CHECK(status IN ('draft', 'in_review', 'approved', 'published', 'archived')),
        version INTEGER NOT NULL DEFAULT 1,
        organization_id INTEGER NOT NULL,
        created_by INTEGER NOT NULL,
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        updated_at TEXT NOT NULL DEFAULT (datetime('now')),
        published_at TEXT,
        metadata TEXT,
        FOREIGN KEY (organization_id) REFERENCES organizations(id),
        FOREIGN KEY (created_by) REFERENCES users(id)
      );
[SQLite] -- Document versions table
      CREATE TABLE IF NOT EXISTS document_versions (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        document_id INTEGER NOT NULL,
        version INTEGER NOT NULL,
        content TEXT NOT NULL,
        created_by INTEGER NOT NULL,
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        change_summary TEXT,
        FOREIGN KEY (document_id) REFERENCES documents(id),
        FOREIGN KEY (created_by) REFERENCES users(id)
      );
[SQLite] -- Gap analysis table
      CREATE TABLE IF NOT EXISTS gap_analysis (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        organization_id INTEGER NOT NULL,
        framework TEXT NOT NULL CHECK(framework IN ('iso27001', 'soc2', 'fedramp', 'nist')),
        control_id TEXT NOT NULL,
        control_name TEXT NOT NULL,
        status TEXT NOT NULL CHECK(status IN ('not_implemented', 'partially_implemented', 'fully_implemented', 'not_applicable')),
        gap_description TEXT,
        remediation_plan TEXT,
        priority TEXT CHECK(priority IN ('critical', 'high', 'medium', 'low')),
        target_date TEXT,
        assigned_to INTEGER,
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        updated_at TEXT NOT NULL DEFAULT (datetime('now')),
        FOREIGN KEY (organization_id) REFERENCES organizations(id),
        FOREIGN KEY (assigned_to) REFERENCES users(id)
      );
[SQLite] -- Risk assessments table
      CREATE TABLE IF NOT EXISTS risk_assessments (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        organization_id INTEGER NOT NULL,
        risk_name TEXT NOT NULL,
        description TEXT,
        likelihood TEXT CHECK(likelihood IN ('very_low', 'low', 'medium', 'high', 'very_high')),
        impact TEXT CHECK(impact IN ('very_low', 'low', 'medium', 'high', 'very_high')),
        risk_score INTEGER,
        mitigation_plan TEXT,
        status TEXT NOT NULL DEFAULT 'open' CHECK(status IN ('open', 'mitigated', 'accepted', 'closed')),
        owner INTEGER,
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        updated_at TEXT NOT NULL DEFAULT (datetime('now')),
        FOREIGN KEY (organization_id) REFERENCES organizations(id),
        FOREIGN KEY (owner) REFERENCES users(id)
      );
[SQLite] -- Audit logs table
      CREATE TABLE IF NOT EXISTS audit_logs (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        organization_id INTEGER,
        user_id INTEGER,
        action TEXT NOT NULL,
        resource_type TEXT NOT NULL,
        resource_id TEXT,
        details TEXT,
        ip_address TEXT,
        user_agent TEXT,
        risk_level TEXT CHECK(risk_level IN ('low', 'medium', 'high', 'critical')),
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        FOREIGN KEY (organization_id) REFERENCES organizations(id),
        FOREIGN KEY (user_id) REFERENCES users(id)
      );
[SQLite] -- Files/Storage metadata table
      CREATE TABLE IF NOT EXISTS storage_files (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        organization_id INTEGER NOT NULL,
        file_path TEXT NOT NULL,
        uri TEXT NOT NULL UNIQUE,
        size INTEGER NOT NULL,
        content_type TEXT NOT NULL,
        hash TEXT,
        uploaded_by INTEGER,
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        FOREIGN KEY (organization_id) REFERENCES organizations(id),
        FOREIGN KEY (uploaded_by) REFERENCES users(id)
      );
[SQLite] -- Create indexes for common queries
      CREATE INDEX IF NOT EXISTS idx_users_email ON users(email);
[SQLite] CREATE INDEX IF NOT EXISTS idx_users_org ON users(organization_id);
[SQLite] CREATE INDEX IF NOT EXISTS idx_documents_org ON documents(organization_id);
[SQLite] CREATE INDEX IF NOT EXISTS idx_documents_framework ON documents(framework);
[SQLite] CREATE INDEX IF NOT EXISTS idx_gap_analysis_org ON gap_analysis(organization_id);
[SQLite] CREATE INDEX IF NOT EXISTS idx_audit_logs_org ON audit_logs(organization_id);
[SQLite] CREATE INDEX IF NOT EXISTS idx_audit_logs_created ON audit_logs(created_at);
[SQLite] CREATE INDEX IF NOT EXISTS idx_storage_files_org ON storage_files(organization_id);
[SQLite] -- Insert default local organization for local mode
      INSERT OR IGNORE INTO organizations (id, name, slug, settings)
      VALUES (1, 'Local Workspace', 'local', '{}');
[SQLite] -- Insert default local admin user for local mode
      INSERT OR IGNORE INTO users (id, email, role, first_name, last_name, organization_id, is_active)
      VALUES (1, 'admin@local', 'admin', 'Local', 'Admin', 1, 1);
[SQLite] INSERT INTO _migrations (version, name) VALUES (1.0, 'initial_schema')
[SQLite] COMMIT
[SqliteDbProvider] Migration 1 applied successfully
[SqliteDbProvider] Migration complete

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2mgetMetadata[2m > [22m[2mshould prevent path traversal in metadata
[22m[39m[LocalFsStorageProvider] Initialized with basePath: ./test-data/storage
[LocalFsStorageProvider] Created base directory: ./test-data/storage

[90mstdout[2m | tests/unit/providers/db/sqlite.test.ts[2m > [22m[2mSqliteDbProvider[2m > [22m[2mgetStats[2m > [22m[2mshould return database statistics
[22m[39m[SQLite] PRAGMA page_count
[SQLite] PRAGMA page_size
[SQLite] PRAGMA journal_mode

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2msecurity[2m > [22m[2mshould reject URIs with .. segments
[22m[39m[LocalFsStorageProvider] Initialized with basePath: ./test-data/storage
[LocalFsStorageProvider] Created base directory: ./test-data/storage

[90mstdout[2m | tests/unit/providers/db/sqlite.test.ts[2m > [22m[2mSqliteDbProvider[2m > [22m[2mgetStats[2m > [22m[2mshould return database statistics
[22m[39m[SqliteDbProvider] Closing SQLite database

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2msecurity[2m > [22m[2mshould reject absolute paths outside base
[22m[39m[LocalFsStorageProvider] Initialized with basePath: ./test-data/storage
[LocalFsStorageProvider] Created base directory: ./test-data/storage

[90mstdout[2m | tests/unit/providers/db/sqlite.test.ts[2m > [22m[2mSqliteDbProvider[2m > [22m[2mmaintenance[2m > [22m[2mshould run VACUUM and ANALYZE
[22m[39m[SqliteDbProvider] Connecting to: ./test-data/test.db
[SQLite] PRAGMA journal_mode = WAL
[SQLite] PRAGMA synchronous = NORMAL
[SQLite] PRAGMA cache_size = -64000
[SQLite] PRAGMA temp_store = MEMORY
[SQLite] PRAGMA foreign_keys = ON
[SqliteDbProvider] Connected successfully with WAL mode

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2msecurity[2m > [22m[2mshould allow valid URIs
[22m[39m[LocalFsStorageProvider] Initialized with basePath: ./test-data/storage
[LocalFsStorageProvider] Created base directory: ./test-data/storage

[90mstdout[2m | tests/unit/providers/db/sqlite.test.ts[2m > [22m[2mSqliteDbProvider[2m > [22m[2mmaintenance[2m > [22m[2mshould run VACUUM and ANALYZE
[22m[39m[SqliteDbProvider] Starting database migration...
[SQLite] CREATE TABLE IF NOT EXISTS _migrations (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        version INTEGER NOT NULL UNIQUE,
        name TEXT NOT NULL,
        applied_at TEXT NOT NULL DEFAULT (datetime('now'))
      )
    
[SQLite] SELECT COALESCE(MAX(version), 0) as version FROM _migrations
[SqliteDbProvider] Current schema version: 0
[SqliteDbProvider] Applying 1 migration(s)...
[SqliteDbProvider] Applying migration 1: initial_schema
[SQLite] BEGIN
[SQLite] -- Users table
      CREATE TABLE IF NOT EXISTS users (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        email TEXT NOT NULL UNIQUE,
        password_hash TEXT,
        first_name TEXT,
        last_name TEXT,
        role TEXT NOT NULL DEFAULT 'user' CHECK(role IN ('admin', 'user', 'auditor')),
        organization_id INTEGER,
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        updated_at TEXT NOT NULL DEFAULT (datetime('now')),
        last_login_at TEXT,
        is_active INTEGER NOT NULL DEFAULT 1,
        email_verified INTEGER NOT NULL DEFAULT 0,
        mfa_enabled INTEGER NOT NULL DEFAULT 0,
        mfa_secret TEXT
      );
[SQLite] -- Organizations table
      CREATE TABLE IF NOT EXISTS organizations (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        name TEXT NOT NULL,
        slug TEXT NOT NULL UNIQUE,
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        updated_at TEXT NOT NULL DEFAULT (datetime('now')),
        settings TEXT,
        subscription_tier TEXT DEFAULT 'free' CHECK(subscription_tier IN ('free', 'pro', 'enterprise'))
      );
[SQLite] -- Documents table
      CREATE TABLE IF NOT EXISTS documents (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        title TEXT NOT NULL,
        content TEXT NOT NULL,
        document_type TEXT NOT NULL CHECK(document_type IN ('policy', 'procedure', 'plan', 'manual', 'other')),
        framework TEXT CHECK(framework IN ('iso27001', 'soc2', 'fedramp', 'nist')),
        status TEXT NOT NULL DEFAULT 'draft' CHECK(status IN ('draft', 'in_review', 'approved', 'published', 'archived')),
        version INTEGER NOT NULL DEFAULT 1,
        organization_id INTEGER NOT NULL,
        created_by INTEGER NOT NULL,
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        updated_at TEXT NOT NULL DEFAULT (datetime('now')),
        published_at TEXT,
        metadata TEXT,
        FOREIGN KEY (organization_id) REFERENCES organizations(id),
        FOREIGN KEY (created_by) REFERENCES users(id)
      );
[SQLite] -- Document versions table
      CREATE TABLE IF NOT EXISTS document_versions (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        document_id INTEGER NOT NULL,
        version INTEGER NOT NULL,
        content TEXT NOT NULL,
        created_by INTEGER NOT NULL,
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        change_summary TEXT,
        FOREIGN KEY (document_id) REFERENCES documents(id),
        FOREIGN KEY (created_by) REFERENCES users(id)
      );
[SQLite] -- Gap analysis table
      CREATE TABLE IF NOT EXISTS gap_analysis (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        organization_id INTEGER NOT NULL,
        framework TEXT NOT NULL CHECK(framework IN ('iso27001', 'soc2', 'fedramp', 'nist')),
        control_id TEXT NOT NULL,
        control_name TEXT NOT NULL,
        status TEXT NOT NULL CHECK(status IN ('not_implemented', 'partially_implemented', 'fully_implemented', 'not_applicable')),
        gap_description TEXT,
        remediation_plan TEXT,
        priority TEXT CHECK(priority IN ('critical', 'high', 'medium', 'low')),
        target_date TEXT,
        assigned_to INTEGER,
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        updated_at TEXT NOT NULL DEFAULT (datetime('now')),
        FOREIGN KEY (organization_id) REFERENCES organizations(id),
        FOREIGN KEY (assigned_to) REFERENCES users(id)
      );
[SQLite] -- Risk assessments table
      CREATE TABLE IF NOT EXISTS risk_assessments (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        organization_id INTEGER NOT NULL,
        risk_name TEXT NOT NULL,
        description TEXT,
        likelihood TEXT CHECK(likelihood IN ('very_low', 'low', 'medium', 'high', 'very_high')),
        impact TEXT CHECK(impact IN ('very_low', 'low', 'medium', 'high', 'very_high')),
        risk_score INTEGER,
        mitigation_plan TEXT,
        status TEXT NOT NULL DEFAULT 'open' CHECK(status IN ('open', 'mitigated', 'accepted', 'closed')),
        owner INTEGER,
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        updated_at TEXT NOT NULL DEFAULT (datetime('now')),
        FOREIGN KEY (organization_id) REFERENCES organizations(id),
        FOREIGN KEY (owner) REFERENCES users(id)
      );
[SQLite] -- Audit logs table
      CREATE TABLE IF NOT EXISTS audit_logs (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        organization_id INTEGER,
        user_id INTEGER,
        action TEXT NOT NULL,
        resource_type TEXT NOT NULL,
        resource_id TEXT,
        details TEXT,
        ip_address TEXT,
        user_agent TEXT,
        risk_level TEXT CHECK(risk_level IN ('low', 'medium', 'high', 'critical')),
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        FOREIGN KEY (organization_id) REFERENCES organizations(id),
        FOREIGN KEY (user_id) REFERENCES users(id)
      );
[SQLite] -- Files/Storage metadata table
      CREATE TABLE IF NOT EXISTS storage_files (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        organization_id INTEGER NOT NULL,
        file_path TEXT NOT NULL,
        uri TEXT NOT NULL UNIQUE,
        size INTEGER NOT NULL,
        content_type TEXT NOT NULL,
        hash TEXT,
        uploaded_by INTEGER,
        created_at TEXT NOT NULL DEFAULT (datetime('now')),
        FOREIGN KEY (organization_id) REFERENCES organizations(id),
        FOREIGN KEY (uploaded_by) REFERENCES users(id)
      );
[SQLite] -- Create indexes for common queries
      CREATE INDEX IF NOT EXISTS idx_users_email ON users(email);
[SQLite] CREATE INDEX IF NOT EXISTS idx_users_org ON users(organization_id);
[SQLite] CREATE INDEX IF NOT EXISTS idx_documents_org ON documents(organization_id);
[SQLite] CREATE INDEX IF NOT EXISTS idx_documents_framework ON documents(framework);
[SQLite] CREATE INDEX IF NOT EXISTS idx_gap_analysis_org ON gap_analysis(organization_id);
[SQLite] CREATE INDEX IF NOT EXISTS idx_audit_logs_org ON audit_logs(organization_id);
[SQLite] CREATE INDEX IF NOT EXISTS idx_audit_logs_created ON audit_logs(created_at);
[SQLite] CREATE INDEX IF NOT EXISTS idx_storage_files_org ON storage_files(organization_id);
[SQLite] -- Insert default local organization for local mode
      INSERT OR IGNORE INTO organizations (id, name, slug, settings)
      VALUES (1, 'Local Workspace', 'local', '{}');
[SQLite] -- Insert default local admin user for local mode
      INSERT OR IGNORE INTO users (id, email, role, first_name, last_name, organization_id, is_active)
      VALUES (1, 'admin@local', 'admin', 'Local', 'Admin', 1, 1);
[SQLite] INSERT INTO _migrations (version, name) VALUES (1.0, 'initial_schema')
[SQLite] COMMIT
[SqliteDbProvider] Migration 1 applied successfully
[SqliteDbProvider] Migration complete

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2msecurity[2m > [22m[2mshould allow valid URIs
[22m[39m[LocalFsStorageProvider] Saving file: subdir/test.txt -> test-data\storage\25\f0\25f09a59ce832485_test.txt

[90mstdout[2m | tests/unit/providers/db/sqlite.test.ts[2m > [22m[2mSqliteDbProvider[2m > [22m[2mmaintenance[2m > [22m[2mshould run VACUUM and ANALYZE
[22m[39m[SqliteDbProvider] Running maintenance...
[SQLite] VACUUM
[SQLite] ANALYZE
[SqliteDbProvider] Maintenance complete

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2msecurity[2m > [22m[2mshould allow valid URIs
[22m[39m[LocalFsStorageProvider] Created directory: test-data\storage\25\f0

[90mstdout[2m | tests/unit/providers/db/sqlite.test.ts[2m > [22m[2mSqliteDbProvider[2m > [22m[2mmaintenance[2m > [22m[2mshould run VACUUM and ANALYZE
[22m[39m[SqliteDbProvider] Closing SQLite database

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2msecurity[2m > [22m[2mshould allow valid URIs
[22m[39m[LocalFsStorageProvider] File saved successfully: test-data\storage\25\f0\25f09a59ce832485_test.txt

[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2msecurity[2m > [22m[2mshould allow valid URIs
[22m[39m[LocalFsStorageProvider] Reading file: test-data\storage\25\f0\25f09a59ce832485_test.txt

 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/providers/db/sqlite.test.ts[2m > [22mSqliteDbProvider[2m > [22mrestore[2m > [22mshould restore database from backup[32m 26[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/providers/db/sqlite.test.ts[2m > [22mSqliteDbProvider[2m > [22mgetStats[2m > [22mshould return database statistics[32m 14[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/providers/db/sqlite.test.ts[2m > [22mSqliteDbProvider[2m > [22mmaintenance[2m > [22mshould run VACUUM and ANALYZE[32m 18[2mms[22m[39m
[90mstdout[2m | tests/unit/providers/storage/localFs.test.ts[2m > [22m[2mLocalFsStorageProvider[2m > [22m[2msecurity[2m > [22m[2mshould allow valid URIs
[22m[39m[LocalFsStorageProvider] File read successfully: test-data\storage\25\f0\25f09a59ce832485_test.txt (15 bytes)

 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/providers/storage/localFs.test.ts[2m > [22mLocalFsStorageProvider[2m > [22mlist[2m > [22mshould filter by prefix[32m 19[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/providers/storage/localFs.test.ts[2m > [22mLocalFsStorageProvider[2m > [22mlist[2m > [22mshould return StorageFile objects with URIs[32m 8[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/providers/storage/localFs.test.ts[2m > [22mLocalFsStorageProvider[2m > [22mgetMetadata[2m > [22mshould return file metadata[32m 7[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/providers/storage/localFs.test.ts[2m > [22mLocalFsStorageProvider[2m > [22mgetMetadata[2m > [22mshould detect MIME type from extension[32m 12[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/providers/storage/localFs.test.ts[2m > [22mLocalFsStorageProvider[2m > [22mgetMetadata[2m > [22mshould throw error for non-existent file[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/providers/storage/localFs.test.ts[2m > [22mLocalFsStorageProvider[2m > [22mgetMetadata[2m > [22mshould prevent path traversal in metadata[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/providers/storage/localFs.test.ts[2m > [22mLocalFsStorageProvider[2m > [22msecurity[2m > [22mshould reject URIs with .. segments[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/providers/storage/localFs.test.ts[2m > [22mLocalFsStorageProvider[2m > [22msecurity[2m > [22mshould reject absolute paths outside base[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/providers/storage/localFs.test.ts[2m > [22mLocalFsStorageProvider[2m > [22msecurity[2m > [22mshould allow valid URIs[32m 5[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/mcp-server.test.ts[2m > [22mMCP Server Integration Tests[2m > [22mGET /api/mcp/tools[2m > [22mreturns list of tools[32m 37[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/mcp-server.test.ts[2m > [22mMCP Server Integration Tests[2m > [22mGET /api/mcp/tools[2m > [22mreturns 500 on failure[32m 8[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/mcp-server.test.ts[2m > [22mMCP Server Integration Tests[2m > [22mGET /api/mcp/tools/:name[2m > [22mreturns tool documentation[32m 6[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/mcp-server.test.ts[2m > [22mMCP Server Integration Tests[2m > [22mGET /api/mcp/tools/:name[2m > [22mreturns 404 if tool not found[32m 8[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/mcp-server.test.ts[2m > [22mMCP Server Integration Tests[2m > [22mGET /api/mcp/tools/:name[2m > [22mreturns 500 on failure[32m 10[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/gap-analysis.test.ts[2m > [22mGap Analysis Routes[2m > [22mGET /api/gap-analysis[2m > [22mreturns all reports for an organization[32m 43[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/gap-analysis.test.ts[2m > [22mGap Analysis Routes[2m > [22mGET /api/gap-analysis/:framework[2m > [22mfilters reports by framework[32m 8[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/gap-analysis.test.ts[2m > [22mGap Analysis Routes[2m > [22mPOST /api/gap-analysis[2m > [22mreturns 501 for the generic creation endpoint[32m 34[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/gap-analysis.test.ts[2m > [22mGap Analysis Routes[2m > [22mPOST /api/gap-analysis[2m > [22mreturns 400 if framework is missing[32m 8[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/mcp-server.test.ts[2m > [22mMCP Server Integration Tests[2m > [22mPOST /api/mcp/tools/:name/execute[2m > [22mexecutes tool successfully[32m 39[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/mcp-server.test.ts[2m > [22mMCP Server Integration Tests[2m > [22mPOST /api/mcp/tools/:name/execute[2m > [22mreturns 500 on failure[32m 7[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/mcp-server.test.ts[2m > [22mMCP Server Integration Tests[2m > [22mGET /api/mcp/agents[2m > [22mreturns list of agents[32m 7[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/mcp-server.test.ts[2m > [22mMCP Server Integration Tests[2m > [22mGET /api/mcp/agents[2m > [22mreturns 500 on failure[32m 13[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/mcp-server.test.ts[2m > [22mMCP Server Integration Tests[2m > [22mGET /api/mcp/agents/:id[2m > [22mreturns agent details[32m 8[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/mcp-server.test.ts[2m > [22mMCP Server Integration Tests[2m > [22mGET /api/mcp/agents/:id[2m > [22mreturns 404 if agent not found[32m 8[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/mcp-server.test.ts[2m > [22mMCP Server Integration Tests[2m > [22mGET /api/mcp/agents/:id[2m > [22mreturns 500 on error[32m 5[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/mcp-server.test.ts[2m > [22mMCP Server Integration Tests[2m > [22mPOST /api/mcp/agents/:id/execute[2m > [22mexecutes agent successfully[32m 6[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/mcp-server.test.ts[2m > [22mMCP Server Integration Tests[2m > [22mPOST /api/mcp/agents/:id/execute[2m > [22mreturns 400 if prompt is missing[32m 10[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/mcp-server.test.ts[2m > [22mMCP Server Integration Tests[2m > [22mPOST /api/mcp/agents/:id/execute[2m > [22mreturns 500 on failure[32m 7[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/mcp-server.test.ts[2m > [22mMCP Server Integration Tests[2m > [22mPOST /api/mcp/agents/:id/clear[2m > [22mclears conversation[32m 5[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/mcp-server.test.ts[2m > [22mMCP Server Integration Tests[2m > [22mPOST /api/mcp/agents/:id/clear[2m > [22mhandles errors[32m 5[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/mcp-server.test.ts[2m > [22mMCP Server Integration Tests[2m > [22mPOST /api/mcp/tools/batch[2m > [22mexecutes tools in batch[32m 5[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/mcp-server.test.ts[2m > [22mMCP Server Integration Tests[2m > [22mPOST /api/mcp/tools/batch[2m > [22mreturns 400 if executions is not an array[32m 5[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/mcp-server.test.ts[2m > [22mMCP Server Integration Tests[2m > [22mPOST /api/mcp/tools/batch[2m > [22mhandles errors in batch execution[32m 5[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/mcp-server.test.ts[2m > [22mMCP Server Integration Tests[2m > [22mGET /api/mcp/health[2m > [22mreturns healthy status[32m 11[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/gap-analysis.test.ts[2m > [22mGap Analysis Routes[2m > [22mGET /api/gap-analysis/reports[2m > [22mreturns reports (alias route)[32m 9[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/gap-analysis.test.ts[2m > [22mGap Analysis Routes[2m > [22mGET /api/gap-analysis/reports/:id[2m > [22mreturns detailed report with maturity assessment and executive summary[32m 12[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/gap-analysis.test.ts[2m > [22mGap Analysis Routes[2m > [22mGET /api/gap-analysis/reports/:id[2m > [22mreturns 404 if report belongs to another org[32m 7[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/gap-analysis.test.ts[2m > [22mGap Analysis Routes[2m > [22mPOST /api/gap-analysis/generate[2m > [22mstarts gap analysis generation and completes background processing[32m 15[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/gap-analysis.test.ts[2m > [22mGap Analysis Routes[2m > [22mPOST /api/gap-analysis/generate[2m > [22mreturns 400 if no company profile exists[32m 8[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/gap-analysis.test.ts[2m > [22mGap Analysis Routes[2m > [22mPATCH /api/gap-analysis/recommendations/:id[2m > [22mupdates recommendation status to completed and sets date[32m 6[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/gap-analysis.test.ts[2m > [22mGap Analysis Routes[2m > [22mPATCH /api/gap-analysis/recommendations/:id[2m > [22mreturns 404 if recommendation doesn't exist[32m 5[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/gap-analysis.test.ts[2m > [22mGap Analysis Routes[2m > [22mPATCH /api/gap-analysis/recommendations/:id[2m > [22mreturns 404 if finding doesn't exist[32m 5[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mfaService.test.ts[2m > [22mMFAService[2m > [22msetupTOTP[2m > [22mgenerates TOTP secret and backup codes[32m 5[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mfaService.test.ts[2m > [22mMFAService[2m > [22msetupTOTP[2m > [22mgenerates unique secrets for different users[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mfaService.test.ts[2m > [22mMFAService[2m > [22msetupTOTP[2m > [22mgenerates base32 encoded secret[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mfaService.test.ts[2m > [22mMFAService[2m > [22msetupTOTP[2m > [22mgenerates QR code URL with correct format[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mfaService.test.ts[2m > [22mMFAService[2m > [22mgenerateBackupCodes[2m > [22mgenerates 10 backup codes[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mfaService.test.ts[2m > [22mMFAService[2m > [22mgenerateBackupCodes[2m > [22mgenerates codes of correct length[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mfaService.test.ts[2m > [22mMFAService[2m > [22mgenerateBackupCodes[2m > [22mgenerates unique codes[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mfaService.test.ts[2m > [22mMFAService[2m > [22mgenerateBackupCodes[2m > [22mgenerates alphanumeric codes[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mfaService.test.ts[2m > [22mMFAService[2m > [22mgenerateBase32Secret[2m > [22mgenerates base32 secret of correct length[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mfaService.test.ts[2m > [22mMFAService[2m > [22mgenerateBase32Secret[2m > [22mgenerates unique secrets[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mfaService.test.ts[2m > [22mMFAService[2m > [22mgenerateNumericCode[2m > [22mgenerates numeric code of specified length[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mfaService.test.ts[2m > [22mMFAService[2m > [22mgenerateNumericCode[2m > [22mhandles different lengths[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mfaService.test.ts[2m > [22mMFAService[2m > [22mgenerateQRCodeUrl[2m > [22mcreates valid otpauth URL[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mfaService.test.ts[2m > [22mMFAService[2m > [22mvalidateTOTPToken[2m > [22mvalidates correct TOTP token[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mfaService.test.ts[2m > [22mMFAService[2m > [22mvalidateTOTPToken[2m > [22maccepts tokens within time window[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mfaService.test.ts[2m > [22mMFAService[2m > [22mvalidateTOTPToken[2m > [22mrejects invalid tokens[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mfaService.test.ts[2m > [22mMFAService[2m > [22mgenerateTOTPToken[2m > [22mgenerates 6-digit token[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mfaService.test.ts[2m > [22mMFAService[2m > [22mgenerateTOTPToken[2m > [22mgenerates consistent tokens for same time slice[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mfaService.test.ts[2m > [22mMFAService[2m > [22mgenerateTOTPToken[2m > [22mgenerates different tokens for different time slices[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mfaService.test.ts[2m > [22mMFAService[2m > [22msetupSMS[2m > [22mgenerates SMS verification code[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mfaService.test.ts[2m > [22mMFAService[2m > [22msetupSMS[2m > [22mgenerates unique verification codes[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mfaService.test.ts[2m > [22mMFAService[2m > [22msetupSMS[2m > [22msets expiration time in future[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mfaService.test.ts[2m > [22mMFAService[2m > [22mverifySMS[2m > [22maccepts valid unexpired code[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mfaService.test.ts[2m > [22mMFAService[2m > [22mverifySMS[2m > [22mrejects expired code[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mfaService.test.ts[2m > [22mMFAService[2m > [22mverifySMS[2m > [22mrejects incorrect code[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mfaService.test.ts[2m > [22mMFAService[2m > [22mgetAllMFASettings[2m > [22mretrieves all MFA settings for a user[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mfaService.test.ts[2m > [22mMFAService[2m > [22mgetPasskeyCount[2m > [22mreturns passkey count for user[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mfaService.test.ts[2m > [22mMFAService[2m > [22mstoreTOTPSettings[2m > [22mstores TOTP settings for a user[32m 4[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mfaService.test.ts[2m > [22mMFAService[2m > [22mgetTOTPSettings[2m > [22mretrieves TOTP settings for a user[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mfaService.test.ts[2m > [22mMFAService[2m > [22mupdateBackupCodes[2m > [22mupdates backup codes for a user[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mfaService.test.ts[2m > [22mMFAService[2m > [22mmarkTOTPVerified[2m > [22mmarks TOTP as verified for a user[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mfaService.test.ts[2m > [22mMFAService[2m > [22mverifyTOTP[2m > [22mverifies valid TOTP token[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mfaService.test.ts[2m > [22mMFAService[2m > [22mverifyTOTP[2m > [22mrejects invalid TOTP token[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mfaService.test.ts[2m > [22mMFAService[2m > [22mverifyBackupCode[2m > [22mverifies valid backup code[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mfaService.test.ts[2m > [22mMFAService[2m > [22mverifyBackupCode[2m > [22mrejects invalid backup code[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/ai-services.test.ts[2m > [22mAI Services[2m > [22mOpenAI Service[2m > [22mgenerateComplianceDocuments[2m > [22mgenerates multiple documents[33m 1015[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/ai-services.test.ts[2m > [22mAI Services[2m > [22mAnthropic Service[2m > [22mgenerateDocumentWithClaude[2m > [22mgenerates content successfully[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/ai-services.test.ts[2m > [22mAI Services[2m > [22mAnthropic Service[2m > [22manalyzeDocumentQuality[2m > [22manalyzes quality successfully[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/ai-services.test.ts[2m > [22mAI Services[2m > [22mAnthropic Service[2m > [22manalyzeDocumentQuality[2m > [22mhandles parsing errors gracefully[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/ai-services.test.ts[2m > [22mAI Services[2m > [22mAnthropic Service[2m > [22mgenerateComplianceInsights[2m > [22mgenerates insights successfully[32m 1[2mms[22m[39m
[90mstdout[2m | tests/unit/circuitBreaker.test.ts[2m > [22m[2mCircuitBreaker[2m > [22m[2mrecords failures and opens circuit when threshold is reached
[22m[39m{"type":"circuit_breaker_state_change","name":"test-service","from":"CLOSED","to":"OPEN","timestamp":"2026-01-23T16:48:57.366Z"}

[90mstdout[2m | tests/unit/circuitBreaker.test.ts[2m > [22m[2mCircuitBreaker[2m > [22m[2mthrows CircuitBreakerError when state is OPEN
[22m[39m{"type":"circuit_breaker_state_change","name":"test-service","from":"CLOSED","to":"OPEN","timestamp":"2026-01-23T16:48:57.372Z"}

[90mstdout[2m | tests/unit/circuitBreaker.test.ts[2m > [22m[2mCircuitBreaker[2m > [22m[2mtransitions to HALF_OPEN after resetTimeout
[22m[39m{"type":"circuit_breaker_state_change","name":"test-service","from":"CLOSED","to":"OPEN","timestamp":"2026-01-23T16:48:57.374Z"}

[90mstdout[2m | tests/unit/circuitBreaker.test.ts[2m > [22m[2mCircuitBreaker[2m > [22m[2mtransitions to HALF_OPEN after resetTimeout
[22m[39m{"type":"circuit_breaker_state_change","name":"test-service","from":"OPEN","to":"HALF_OPEN","timestamp":"2026-01-23T16:48:57.475Z"}

[90mstdout[2m | tests/unit/circuitBreaker.test.ts[2m > [22m[2mCircuitBreaker[2m > [22m[2mcloses circuit after successThreshold in HALF_OPEN
[22m[39m{"type":"circuit_breaker_state_change","name":"test-service","from":"CLOSED","to":"OPEN","timestamp":"2026-01-23T16:48:57.378Z"}

[90mstdout[2m | tests/unit/circuitBreaker.test.ts[2m > [22m[2mCircuitBreaker[2m > [22m[2mcloses circuit after successThreshold in HALF_OPEN
[22m[39m{"type":"circuit_breaker_state_change","name":"test-service","from":"OPEN","to":"HALF_OPEN","timestamp":"2026-01-23T16:48:57.479Z"}

[90mstdout[2m | tests/unit/circuitBreaker.test.ts[2m > [22m[2mCircuitBreaker[2m > [22m[2mcloses circuit after successThreshold in HALF_OPEN
[22m[39m{"type":"circuit_breaker_state_change","name":"test-service","from":"HALF_OPEN","to":"CLOSED","timestamp":"2026-01-23T16:48:57.479Z"}

[90mstdout[2m | tests/unit/circuitBreaker.test.ts[2m > [22m[2mCircuitBreaker[2m > [22m[2mimmediately re-opens if failure occurs in HALF_OPEN
[22m[39m{"type":"circuit_breaker_state_change","name":"test-service","from":"CLOSED","to":"OPEN","timestamp":"2026-01-23T16:48:57.380Z"}

[90mstdout[2m | tests/unit/circuitBreaker.test.ts[2m > [22m[2mCircuitBreaker[2m > [22m[2mimmediately re-opens if failure occurs in HALF_OPEN
[22m[39m{"type":"circuit_breaker_state_change","name":"test-service","from":"OPEN","to":"HALF_OPEN","timestamp":"2026-01-23T16:48:57.481Z"}

[90mstdout[2m | tests/unit/circuitBreaker.test.ts[2m > [22m[2mCircuitBreaker[2m > [22m[2mimmediately re-opens if failure occurs in HALF_OPEN
[22m[39m{"type":"circuit_breaker_state_change","name":"test-service","from":"HALF_OPEN","to":"OPEN","timestamp":"2026-01-23T16:48:57.481Z"}

[90mstdout[2m | tests/unit/circuitBreaker.test.ts[2m > [22m[2mCircuitBreaker[2m > [22m[2mcan be manually reset
[22m[39m{"type":"circuit_breaker_state_change","name":"test-service","from":"CLOSED","to":"OPEN","timestamp":"2026-01-23T16:48:57.385Z"}

[90mstdout[2m | tests/unit/circuitBreaker.test.ts[2m > [22m[2mCircuitBreaker[2m > [22m[2mcan be manually reset
[22m[39m{"type":"circuit_breaker_state_change","name":"test-service","from":"OPEN","to":"CLOSED","timestamp":"2026-01-23T16:48:57.385Z"}

[90mstdout[2m | tests/unit/circuitBreaker.test.ts[2m > [22m[2mCircuitBreaker[2m > [22m[2mcalls onStateChange callback
[22m[39m{"type":"circuit_breaker_state_change","name":"callback-test","from":"CLOSED","to":"OPEN","timestamp":"2026-01-23T16:48:57.386Z"}

 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/circuitBreaker.test.ts[2m > [22mCircuitBreaker[2m > [22mstarts in CLOSED state[32m 5[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/circuitBreaker.test.ts[2m > [22mCircuitBreaker[2m > [22mexecutes successful functions and records successes[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/circuitBreaker.test.ts[2m > [22mCircuitBreaker[2m > [22mrecords failures and opens circuit when threshold is reached[32m 6[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/circuitBreaker.test.ts[2m > [22mCircuitBreaker[2m > [22mthrows CircuitBreakerError when state is OPEN[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/circuitBreaker.test.ts[2m > [22mCircuitBreaker[2m > [22mtransitions to HALF_OPEN after resetTimeout[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/circuitBreaker.test.ts[2m > [22mCircuitBreaker[2m > [22mcloses circuit after successThreshold in HALF_OPEN[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/circuitBreaker.test.ts[2m > [22mCircuitBreaker[2m > [22mimmediately re-opens if failure occurs in HALF_OPEN[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/circuitBreaker.test.ts[2m > [22mCircuitBreaker[2m > [22menforces request timeout if configured[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/circuitBreaker.test.ts[2m > [22mCircuitBreaker[2m > [22mresets failures on success in CLOSED state[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/circuitBreaker.test.ts[2m > [22mCircuitBreaker[2m > [22mcan be manually reset[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/circuitBreaker.test.ts[2m > [22mCircuitBreaker[2m > [22mcalls onStateChange callback[32m 2[2mms[22m[39m
stderr | tests/unit/aiGuardrails.test.ts
The `fetchConnectionCache` option is deprecated (now always `true`)

stderr | tests/unit/aiOrchestrator.test.ts
The `fetchConnectionCache` option is deprecated (now always `true`)

stderr | tests/integration/health.test.ts
The `fetchConnectionCache` option is deprecated (now always `true`)

 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/frameworkControlStatuses.test.ts[2m > [22mFrameworkControlStatuses Routes[2m > [22mGET /api/framework-control-statuses[2m > [22mreturns statuses for a framework[32m 85[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/frameworkControlStatuses.test.ts[2m > [22mFrameworkControlStatuses Routes[2m > [22mGET /api/framework-control-statuses[2m > [22mreturns 400 if framework is missing[32m 7[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/frameworkControlStatuses.test.ts[2m > [22mFrameworkControlStatuses Routes[2m > [22mPUT /api/framework-control-statuses/:controlId[2m > [22mupdates existing status[32m 61[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/frameworkControlStatuses.test.ts[2m > [22mFrameworkControlStatuses Routes[2m > [22mGET /api/framework-control-statuses/summary[2m > [22mreturns summary statistics[32m 9[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/validation.test.ts[2m > [22mValidation Utils[2m > [22msanitizeString[2m > [22mshould remove script tags[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/validation.test.ts[2m > [22mValidation Utils[2m > [22msanitizeString[2m > [22mshould remove iframe tags[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/validation.test.ts[2m > [22mValidation Utils[2m > [22msanitizeString[2m > [22mshould remove javascript: protocols[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/validation.test.ts[2m > [22mValidation Utils[2m > [22msanitizeString[2m > [22mshould remove event handlers[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/validation.test.ts[2m > [22mValidation Utils[2m > [22msanitizeString[2m > [22mshould trim whitespace[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/validation.test.ts[2m > [22mValidation Utils[2m > [22msanitizeString[2m > [22mshould limit string length[32m 8[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/validation.test.ts[2m > [22mValidation Utils[2m > [22msanitizeEmail[2m > [22mshould convert to lowercase[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/validation.test.ts[2m > [22mValidation Utils[2m > [22msanitizeEmail[2m > [22mshould trim whitespace[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/validation.test.ts[2m > [22mValidation Utils[2m > [22msanitizeFilename[2m > [22mshould replace invalid characters with underscores[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/validation.test.ts[2m > [22mValidation Utils[2m > [22msanitizeFilename[2m > [22mshould collapse multiple underscores[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/validation.test.ts[2m > [22mValidation Utils[2m > [22msanitizeFilename[2m > [22mshould limit filename length[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/validation.test.ts[2m > [22mValidation Utils[2m > [22mpaginationSchema[2m > [22mshould validate valid pagination params[32m 4[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/validation.test.ts[2m > [22mValidation Utils[2m > [22mpaginationSchema[2m > [22mshould use defaults for missing params[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/validation.test.ts[2m > [22mValidation Utils[2m > [22mpaginationSchema[2m > [22mshould reject invalid page numbers[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/validation.test.ts[2m > [22mValidation Utils[2m > [22midParamSchema[2m > [22mshould validate valid UUIDs[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/validation.test.ts[2m > [22mValidation Utils[2m > [22midParamSchema[2m > [22mshould reject invalid UUIDs[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/validation.test.ts[2m > [22mValidation Utils[2m > [22msearchSchema[2m > [22mshould validate valid search params[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/validation.test.ts[2m > [22mValidation Utils[2m > [22msearchSchema[2m > [22mshould reject invalid framework[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/validation.test.ts[2m > [22mValidation Utils[2m > [22msearchSchema[2m > [22mshould reject invalid status[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/validation.test.ts[2m > [22mValidation Utils[2m > [22mvalidateSchema middleware[2m > [22mshould pass validation with valid data[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/validation.test.ts[2m > [22mValidation Utils[2m > [22mvalidateSchema middleware[2m > [22mshould fail validation with invalid data[32m 3[2mms[22m[39m
stderr | tests/unit/mcp-tool-registry.test.ts
The `fetchConnectionCache` option is deprecated (now always `true`)

[90mstdout[2m | tests/unit/mcp-tool-registry.test.ts[2m > [22m[2mToolRegistry[2m > [22m[2mshould register and unregister tools
[22m[39m[32m2026-01-23T16:48:57.760Z [INFO] Registered tool: test_tool (internal)[0m
[32m2026-01-23T16:48:57.765Z [INFO] Unregistered tool: test_tool[0m

[90mstdout[2m | tests/unit/mcp-tool-registry.test.ts[2m > [22m[2mToolRegistry[2m > [22m[2mshould get tools by type
[22m[39m[32m2026-01-23T16:48:57.767Z [INFO] Registered tool: test_tool (internal)[0m
[32m2026-01-23T16:48:57.767Z [INFO] Unregistered tool: test_tool[0m

[90mstdout[2m | tests/unit/mcp-tool-registry.test.ts[2m > [22m[2mToolRegistry[2m > [22m[2mshould validate parameters correctly
[22m[39m[32m2026-01-23T16:48:57.768Z [INFO] Registered tool: test_tool (internal)[0m

stderr | tests/integration/health.test.ts > Health Check Endpoints > GET /health > should return health status
Invalid DEPLOYMENT_MODE: "undefined". Expected "cloud" or "local". Defaulting to "cloud".

stderr | tests/unit/riskAssessment.test.ts > RiskAssessmentService > generateMitigationRoadmap > handles AI service errors when generating roadmap
2026-01-23T16:48:57.880Z [ERROR] Roadmap generation failed:

stderr | tests/unit/riskAssessment.test.ts > RiskAssessmentService > calculateComplianceReadiness - Error Handling > throws error when calculation fails
2026-01-23T16:48:57.885Z [ERROR] Readiness calculation failed:

 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/riskAssessment.test.ts[2m > [22mRiskAssessmentService[2m > [22massessOrganizationalRisk[2m > [22mparses JSON response correctly[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/riskAssessment.test.ts[2m > [22mRiskAssessmentService[2m > [22massessOrganizationalRisk[2m > [22mfalls back to text parsing on JSON error[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/riskAssessment.test.ts[2m > [22mRiskAssessmentService[2m > [22manalyzeThreatLandscape[2m > [22mreturns structured threat assessment[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/riskAssessment.test.ts[2m > [22mRiskAssessmentService[2m > [22mcalculateComplianceReadiness[2m > [22mcalculates readiness score[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/riskAssessment.test.ts[2m > [22mRiskAssessmentService[2m > [22mgenerateMitigationRoadmap[2m > [22mgenerates roadmap phases[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/riskAssessment.test.ts[2m > [22mRiskAssessmentService[2m > [22mgenerateMitigationRoadmap[2m > [22mhandles AI service errors when generating roadmap[32m 6[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/riskAssessment.test.ts[2m > [22mRiskAssessmentService[2m > [22mcalculateComplianceReadiness - Error Handling[2m > [22mthrows error when calculation fails[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/riskAssessment.test.ts[2m > [22mRiskAssessmentService[2m > [22mparseRiskAssessmentText - Medium Risk Level[2m > [22mcorrectly identifies medium risk level[32m 1[2mms[22m[39m
stderr | tests/integration/api.test.ts
The `fetchConnectionCache` option is deprecated (now always `true`)

stderr | tests/integration/security.test.ts
The `fetchConnectionCache` option is deprecated (now always `true`)

stderr | tests/integration/ingestion.test.ts
The `fetchConnectionCache` option is deprecated (now always `true`)

 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mcp-tool-registry.test.ts[2m > [22mToolRegistry[2m > [22mshould register and unregister tools[32m 8[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mcp-tool-registry.test.ts[2m > [22mToolRegistry[2m > [22mshould get tools by type[32m 1[2mms[22m[39m
stderr | tests/unit/mcp-tool-registry.test.ts > ToolRegistry > should validate parameters correctly
2026-01-23T16:48:57.960Z [ERROR] Failed to log audit event {"error":"Unknown error","auditEntry":{"action":"execute_mcp_tool","userId":"user1","organizationId":"org1","resourceType":"mcp_tool","resourceId":"test_tool","ipAddress":"internal","details":{"parameters":{"param1":"val","param2":123}}}}

[90mstdout[2m | tests/unit/mcp-tool-registry.test.ts[2m > [22m[2mToolRegistry[2m > [22m[2mshould validate parameters correctly
[22m[39m[32m2026-01-23T16:48:57.961Z [INFO] Tool test_tool executed successfully {"userId":"user1"}[0m

[90mstdout[2m | tests/unit/mcp-tool-registry.test.ts[2m > [22m[2mToolRegistry[2m > [22m[2mshould validate parameters correctly
[22m[39m[32m2026-01-23T16:48:57.963Z [INFO] Unregistered tool: test_tool[0m

[90mstdout[2m | tests/unit/mcp-tool-registry.test.ts[2m > [22m[2mToolRegistry[2m > [22m[2mshould enforce authentication
[22m[39m[32m2026-01-23T16:48:57.964Z [INFO] Registered tool: secure_tool (internal)[0m

[90mstdout[2m | tests/unit/mcp-tool-registry.test.ts[2m > [22m[2mToolRegistry[2m > [22m[2mshould enforce authentication
[22m[39m[32m2026-01-23T16:48:57.964Z [INFO] Unregistered tool: secure_tool[0m

[90mstdout[2m | tests/unit/mcp-tool-registry.test.ts[2m > [22m[2mToolRegistry[2m > [22m[2mshould enforce rate limits
[22m[39m[32m2026-01-23T16:48:57.965Z [INFO] Registered tool: limited_tool (internal)[0m

stderr | tests/unit/mfa.test.ts
The `fetchConnectionCache` option is deprecated (now always `true`)

stderr | tests/integration/e2e-flows.test.ts
The `fetchConnectionCache` option is deprecated (now always `true`)

stderr | tests/unit/mcp-tool-registry.test.ts > ToolRegistry > should enforce rate limits
2026-01-23T16:48:57.996Z [ERROR] Failed to log audit event {"error":"Unknown error","auditEntry":{"action":"execute_mcp_tool","userId":"u1","resourceType":"mcp_tool","resourceId":"limited_tool","ipAddress":"internal","details":{"parameters":{"param1":"v"}}}}

[90mstdout[2m | tests/unit/mcp-tool-registry.test.ts[2m > [22m[2mToolRegistry[2m > [22m[2mshould enforce rate limits
[22m[39m[32m2026-01-23T16:48:57.996Z [INFO] Tool limited_tool executed successfully {"userId":"u1"}[0m

 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/documents.test.ts[2m > [22mDocuments Routes[2m > [22mGET /api/documents[2m > [22mreturns all documents for an organization[32m 117[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/documents.test.ts[2m > [22mDocuments Routes[2m > [22mGET /api/documents[2m > [22mfilters by companyProfileId with check[32m 13[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/documents.test.ts[2m > [22mDocuments Routes[2m > [22mGET /api/documents[2m > [22mreturns 404 if company profile is not authorized[32m 11[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/documents.test.ts[2m > [22mDocuments Routes[2m > [22mGET /api/documents/:id[2m > [22mreturns document if authorized[32m 8[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/documents.test.ts[2m > [22mDocuments Routes[2m > [22mGET /api/documents/:id[2m > [22mreturns 404 if not authorized[32m 8[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/documents.test.ts[2m > [22mDocuments Routes[2m > [22mPOST /api/documents[2m > [22mcreates a new document[32m 35[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/documents.test.ts[2m > [22mDocuments Routes[2m > [22mPOST /api/documents/generate[2m > [22mgenerates a document content[32m 20[2mms[22m[39m
stderr | tests/integration/health.test.ts > Health Check Endpoints > GET /health > should return health status
2026-01-23T16:48:58.022Z [ERROR] Database health check failed {"error":"Unknown error"}

[90mstdout[2m | tests/unit/mcp-tool-registry.test.ts[2m > [22m[2mToolRegistry[2m > [22m[2mshould enforce rate limits
[22m[39m[32m2026-01-23T16:48:58.042Z [INFO] Tool limited_tool executed successfully {"userId":"u1"}[0m

stderr | tests/unit/mcp-tool-registry.test.ts > ToolRegistry > should enforce rate limits
2026-01-23T16:48:58.042Z [ERROR] Failed to log audit event {"error":"Unknown error","auditEntry":{"action":"execute_mcp_tool","userId":"u1","resourceType":"mcp_tool","resourceId":"limited_tool","ipAddress":"internal","details":{"parameters":{"param1":"v"}}}}

stderr | tests/unit/mcp-tool-registry.test.ts > ToolRegistry > should enforce rate limits
2026-01-23T16:48:58.051Z [ERROR] Failed to log audit event {"error":"Unknown error","auditEntry":{"action":"tool_rate_limit_exceeded","userId":"u1","resourceType":"mcp_tool","resourceId":"limited_tool","ipAddress":"internal","riskLevel":"medium","details":{"toolName":"limited_tool"}}}

[90mstdout[2m | tests/unit/mcp-tool-registry.test.ts[2m > [22m[2mToolRegistry[2m > [22m[2mshould enforce rate limits
[22m[39m[32m2026-01-23T16:48:58.051Z [INFO] Unregistered tool: limited_tool[0m

 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mcp-tool-registry.test.ts[2m > [22mToolRegistry[2m > [22mshould validate parameters correctly[32m 196[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mcp-tool-registry.test.ts[2m > [22mToolRegistry[2m > [22mshould enforce authentication[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mcp-tool-registry.test.ts[2m > [22mToolRegistry[2m > [22mshould enforce rate limits[32m 87[2mms[22m[39m
[90mstdout[2m | tests/unit/mcp-tool-registry.test.ts[2m > [22m[2mToolRegistry[2m > [22m[2mshould provide documentation
[22m[39m[32m2026-01-23T16:48:58.052Z [INFO] Registered tool: test_tool (internal)[0m
[32m2026-01-23T16:48:58.053Z [INFO] Unregistered tool: test_tool[0m

[90mstdout[2m | tests/unit/mcp-tool-registry.test.ts[2m > [22m[2mToolRegistry[2m > [22m[2mshould handle handler errors gracefully
[22m[39m[32m2026-01-23T16:48:58.053Z [INFO] Registered tool: error_tool (internal)[0m

stderr | tests/integration/health.test.ts > Health Check Endpoints > GET /health > should include check results
2026-01-23T16:48:58.047Z [ERROR] Database health check failed {"error":"Unknown error"}

stderr | tests/integration/enterprise-auth.test.ts
The `fetchConnectionCache` option is deprecated (now always `true`)

 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/ingestion.test.ts[2m > [22mEvidence Ingestion Integration[2m > [22mPOST /api/evidence/snapshots[2m > [22mcreates a new snapshot successfully[32m 85[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/ingestion.test.ts[2m > [22mEvidence Ingestion Integration[2m > [22mPOST /api/evidence/snapshots[2m > [22mreturns 400 if name is missing[32m 15[2mms[22m[39m
stderr | tests/integration/health.test.ts > Health Check Endpoints > GET /health > should return overall status based on checks
2026-01-23T16:48:58.080Z [ERROR] Database health check failed {"error":"Unknown error"}

stderr | tests/unit/mcp-tool-registry.test.ts > ToolRegistry > should handle handler errors gracefully
2026-01-23T16:48:58.088Z [ERROR] Failed to log audit event {"error":"Unknown error","auditEntry":{"action":"execute_mcp_tool","resourceType":"mcp_tool","resourceId":"error_tool","ipAddress":"internal","details":{"parameters":{"param1":"v"}}}}

stderr | tests/unit/mcp-tool-registry.test.ts > ToolRegistry > should handle handler errors gracefully
2026-01-23T16:48:58.091Z [ERROR] Tool execution failed: error_tool {"error":"Boom"}

stderr | tests/integration/auth.test.ts
The `fetchConnectionCache` option is deprecated (now always `true`)

 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mfa.test.ts[2m > [22mMFA Middleware[2m > [22mrequireMFA[2m > [22mTemporary Session Handling[2m > [22mshould bypass MFA for temporary session marked in session[32m 6[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mfa.test.ts[2m > [22mMFA Middleware[2m > [22mrequireMFA[2m > [22mTemporary Session Handling[2m > [22mshould bypass MFA for temporary userId (temp- prefix)[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mfa.test.ts[2m > [22mMFA Middleware[2m > [22mrequireMFA[2m > [22mTemporary Session Handling[2m > [22mshould bypass MFA for temporary userId from session[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mfa.test.ts[2m > [22mMFA Middleware[2m > [22mrequireMFA[2m > [22mAuthentication Check[2m > [22mshould return UnauthorizedError if no userId found[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mfa.test.ts[2m > [22mMFA Middleware[2m > [22mrequireMFA[2m > [22mAuthentication Check[2m > [22mshould extract userId from OAuth claims[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mfa.test.ts[2m > [22mMFA Middleware[2m > [22mrequireMFA[2m > [22mAuthentication Check[2m > [22mshould extract userId from session[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mfa.test.ts[2m > [22mMFA Middleware[2m > [22mrequireMFA[2m > [22mAuthentication Check[2m > [22mshould extract userId from user.id[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mfa.test.ts[2m > [22mMFA Middleware[2m > [22mrequireMFA[2m > [22mHigh Security Routes[2m > [22mshould require MFA for high security route: /api/company-profiles[32m 4[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mfa.test.ts[2m > [22mMFA Middleware[2m > [22mrequireMFA[2m > [22mHigh Security Routes[2m > [22mshould require MFA for high security route: /api/documents/generate[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mfa.test.ts[2m > [22mMFA Middleware[2m > [22mrequireMFA[2m > [22mHigh Security Routes[2m > [22mshould require MFA for high security route: /api/documents/generate-single[32m 7[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mfa.test.ts[2m > [22mMFA Middleware[2m > [22mrequireMFA[2m > [22mHigh Security Routes[2m > [22mshould require MFA for high security route: /api/generation-jobs[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mfa.test.ts[2m > [22mMFA Middleware[2m > [22mrequireMFA[2m > [22mHigh Security Routes[2m > [22mshould require MFA for high security route: /api/admin[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mfa.test.ts[2m > [22mMFA Middleware[2m > [22mrequireMFA[2m > [22mHigh Security Routes[2m > [22mshould require MFA for high security route: /api/auth/enterprise[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mfa.test.ts[2m > [22mMFA Middleware[2m > [22mrequireMFA[2m > [22mHigh Security Routes[2m > [22mshould require MFA for high security route: /api/storage/backups[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mfa.test.ts[2m > [22mMFA Middleware[2m > [22mrequireMFA[2m > [22mHigh Security Routes[2m > [22mshould require MFA for high security route: /api/audit-trail[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mfa.test.ts[2m > [22mMFA Middleware[2m > [22mrequireMFA[2m > [22mHigh Security Routes[2m > [22mshould require MFA for high security route: /api/gap-analysis/generate[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mfa.test.ts[2m > [22mMFA Middleware[2m > [22mrequireMFA[2m > [22mHigh Security Routes[2m > [22mshould require MFA for high security route with subpath[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mfa.test.ts[2m > [22mMFA Middleware[2m > [22mrequireMFA[2m > [22mHigh Security Routes[2m > [22mshould allow access if MFA is verified[32m 5[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mfa.test.ts[2m > [22mMFA Middleware[2m > [22mrequireMFA[2m > [22mDELETE Method Handling[2m > [22mshould require MFA for DELETE requests[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mfa.test.ts[2m > [22mMFA Middleware[2m > [22mrequireMFA[2m > [22mDELETE Method Handling[2m > [22mshould allow DELETE if MFA verified[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mfa.test.ts[2m > [22mMFA Middleware[2m > [22mrequireMFA[2m > [22mGenerate Endpoint Handling[2m > [22mshould require MFA for POST requests with /generate in path[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mfa.test.ts[2m > [22mMFA Middleware[2m > [22mrequireMFA[2m > [22mGenerate Endpoint Handling[2m > [22mshould not require MFA for GET requests with /generate[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mfa.test.ts[2m > [22mMFA Middleware[2m > [22mrequireMFA[2m > [22mMedium Security Routes[2m > [22mshould require MFA if not recently verified for: /api/documents[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mfa.test.ts[2m > [22mMFA Middleware[2m > [22mrequireMFA[2m > [22mMedium Security Routes[2m > [22mshould not require MFA if recently verified for: /api/documents[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mfa.test.ts[2m > [22mMFA Middleware[2m > [22mrequireMFA[2m > [22mMedium Security Routes[2m > [22mshould require MFA if not recently verified for: /api/storage/documents[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mfa.test.ts[2m > [22mMFA Middleware[2m > [22mrequireMFA[2m > [22mMedium Security Routes[2m > [22mshould not require MFA if recently verified for: /api/storage/documents[32m 17[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mfa.test.ts[2m > [22mMFA Middleware[2m > [22mrequireMFA[2m > [22mMedium Security Routes[2m > [22mshould require MFA if not recently verified for: /api/ai/analyze-document[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mfa.test.ts[2m > [22mMFA Middleware[2m > [22mrequireMFA[2m > [22mMedium Security Routes[2m > [22mshould not require MFA if recently verified for: /api/ai/analyze-document[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mfa.test.ts[2m > [22mMFA Middleware[2m > [22mrequireMFA[2m > [22mMedium Security Routes[2m > [22mshould require MFA if not recently verified for: /api/cloud[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mfa.test.ts[2m > [22mMFA Middleware[2m > [22mrequireMFA[2m > [22mMedium Security Routes[2m > [22mshould not require MFA if recently verified for: /api/cloud[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mfa.test.ts[2m > [22mMFA Middleware[2m > [22mrequireMFA[2m > [22mError Handling[2m > [22mshould handle errors and return AppError[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mfa.test.ts[2m > [22mMFA Middleware[2m > [22mrequireMFA[2m > [22mForbiddenError Details[2m > [22mshould include challenge URL in error metadata[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mfa.test.ts[2m > [22mMFA Middleware[2m > [22mverifyMFA[2m > [22mshould return UnauthorizedError if no userId[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mfa.test.ts[2m > [22mMFA Middleware[2m > [22mverifyMFA[2m > [22mshould return ForbiddenError if MFA required but no token provided[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mfa.test.ts[2m > [22mMFA Middleware[2m > [22mverifyMFA[2m > [22mshould proceed if MFA not required and no token provided[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/documents.test.ts[2m > [22mDocuments Routes[2m > [22mPOST /api/documents/generate[2m > [22mreturns 400 if required fields are missing[32m 10[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/documents.test.ts[2m > [22mDocuments Routes[2m > [22mGET /api/documents/:id/versions[2m > [22mreturns versions if authorized[32m 14[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/documents.test.ts[2m > [22mDocuments Routes[2m > [22mPOST /api/documents/:id/versions/:versionId/restore[2m > [22mrestores a version and returns success[32m 8[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/documents.test.ts[2m > [22mDocuments Routes[2m > [22mGET /api/documents/:id/approvals[2m > [22mreturns mock approvals for a document[32m 8[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/documents.test.ts[2m > [22mDocuments Routes[2m > [22mPOST /api/documents/generate-single[2m > [22mgenerates a single document using AI orchestrator[32m 8[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/documents.test.ts[2m > [22mDocuments Routes[2m > [22mGET /api/documents/:id/history[2m > [22mreturns version history if authorized[32m 7[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/documents.test.ts[2m > [22mDocuments Routes[2m > [22mGET /api/documents/:id/history[2m > [22mreturns success message if no history found[32m 12[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/documents.test.ts[2m > [22mDocuments Routes[2m > [22mPUT /api/documents/:id[2m > [22mupdates document if authorized[32m 24[2mms[22m[39m
stderr | tests/integration/health.test.ts > Health Check Endpoints > GET /ready > should return readiness status
2026-01-23T16:48:58.110Z [ERROR] Database health check failed {"error":"Unknown error"}

 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/health.test.ts[2m > [22mHealth Check Endpoints[2m > [22mGET /health[2m > [22mshould return health status[32m 199[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/health.test.ts[2m > [22mHealth Check Endpoints[2m > [22mGET /health[2m > [22mshould include check results[32m 33[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/health.test.ts[2m > [22mHealth Check Endpoints[2m > [22mGET /health[2m > [22mshould return overall status based on checks[32m 11[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/health.test.ts[2m > [22mHealth Check Endpoints[2m > [22mGET /ready[2m > [22mshould return readiness status[32m 30[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/ingestion.test.ts[2m > [22mEvidence Ingestion Integration[2m > [22mPOST /api/evidence/upload[2m > [22muploads evidence successfully with snapshot context[32m 11[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/ingestion.test.ts[2m > [22mEvidence Ingestion Integration[2m > [22mPOST /api/evidence/upload[2m > [22mfails if snapshotId is missing[32m 29[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/ingestion.test.ts[2m > [22mEvidence Ingestion Integration[2m > [22mPOST /api/evidence/snapshots/:id/lock[2m > [22mlocks a snapshot[32m 7[2mms[22m[39m
stderr | tests/unit/mcp-tool-registry.test.ts > ToolRegistry > should handle handler errors gracefully
2026-01-23T16:48:58.130Z [ERROR] Failed to log audit event {"error":"Unknown error","auditEntry":{"action":"tool_execution_error","resourceType":"mcp_tool","resourceId":"error_tool","ipAddress":"internal","riskLevel":"high","details":{"error":"Boom"}}}

[90mstdout[2m | tests/unit/mcp-tool-registry.test.ts[2m > [22m[2mToolRegistry[2m > [22m[2mshould handle handler errors gracefully
[22m[39m[32m2026-01-23T16:48:58.131Z [INFO] Unregistered tool: error_tool[0m

 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mfa.test.ts[2m > [22mMFA Middleware[2m > [22mverifyMFA[2m > [22mshould verify MFA token and set session[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mfa.test.ts[2m > [22mMFA Middleware[2m > [22mverifyMFA[2m > [22mshould verify MFA token without session[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mfa.test.ts[2m > [22mMFA Middleware[2m > [22mverifyMFA[2m > [22mshould log audit event with correct IP[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mfa.test.ts[2m > [22mMFA Middleware[2m > [22mverifyMFA[2m > [22mshould handle missing IP address[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mfa.test.ts[2m > [22mMFA Middleware[2m > [22menforceMFATimeout[2m > [22mshould proceed if MFA not required[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mfa.test.ts[2m > [22mMFA Middleware[2m > [22menforceMFATimeout[2m > [22mshould proceed if MFA not verified in session[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mfa.test.ts[2m > [22mMFA Middleware[2m > [22menforceMFATimeout[2m > [22mshould proceed if no verifiedAt timestamp[32m 4[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mfa.test.ts[2m > [22mMFA Middleware[2m > [22menforceMFATimeout[2m > [22mshould proceed if MFA verified recently (within 30 minutes)[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mfa.test.ts[2m > [22mMFA Middleware[2m > [22menforceMFATimeout[2m > [22mshould return ForbiddenError if MFA expired (over 30 minutes)[32m 8[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mfa.test.ts[2m > [22mMFA Middleware[2m > [22menforceMFATimeout[2m > [22mshould handle exactly 30 minutes (boundary test)[32m 6[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mfa.test.ts[2m > [22mMFA Middleware[2m > [22menforceMFATimeout[2m > [22mshould use unknown userId if user not available[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mcp-tool-registry.test.ts[2m > [22mToolRegistry[2m > [22mshould provide documentation[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mcp-tool-registry.test.ts[2m > [22mToolRegistry[2m > [22mshould handle handler errors gracefully[32m 79[2mms[22m[39m
stderr | tests/integration/health.test.ts > Health Check Endpoints > Health check reliability > should not crash on concurrent health checks
2026-01-23T16:48:58.194Z [ERROR] Database health check failed {"error":"Unknown error"}

 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/documents.test.ts[2m > [22mDocuments Routes[2m > [22mPUT /api/documents/:id[2m > [22mreturns 404 for cross-tenant update attempt[32m 20[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/documents.test.ts[2m > [22mDocuments Routes[2m > [22mPUT /api/documents/:id[2m > [22mreturns 400 for invalid company profile reassignment[32m 8[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/documents.test.ts[2m > [22mDocuments Routes[2m > [22mDELETE /api/documents/:id[2m > [22mdeletes document if authorized[32m 9[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/documents.test.ts[2m > [22mDocuments Routes[2m > [22mDELETE /api/documents/:id[2m > [22mreturns 404 if deletion fails (not found in storage)[32m 7[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/documents.test.ts[2m > [22mDocuments Routes[2m > [22mPOST /api/documents/upload-and-extract[2m > [22msuccessfully extracts data from mock upload[32m 10[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/documents.test.ts[2m > [22mDocuments Routes[2m > [22mPOST /api/documents/:id/versions[2m > [22mcreates a new version successfully[32m 6[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/documents.test.ts[2m > [22mDocuments Routes[2m > [22mPOST /api/documents/:id/versions[2m > [22mreturns 400 if title or content is missing[32m 6[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/documents.test.ts[2m > [22mDocuments Routes[2m > [22mGET /api/documents/:id/versions/:v1/compare/:v2[2m > [22mcompares two versions successfully[32m 11[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/documents.test.ts[2m > [22mDocuments Routes[2m > [22mPOST /api/documents/:id/approvals[2m > [22msubmits an approval request[32m 11[2mms[22m[39m
stderr | tests/integration/health.test.ts > Health Check Endpoints > Health check reliability > should not crash on concurrent health checks
2026-01-23T16:48:58.196Z [ERROR] Database health check failed {"error":"Unknown error"}

 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/enterprise-auth.test.ts[2m > [22mEnterprise Auth Routes[2m > [22mPOST /api/enterprise-auth/login[2m > [22mlogs in successfully and regenerates session[32m 94[2mms[22m[39m
stderr | tests/integration/health.test.ts > Health Check Endpoints > Health check reliability > should not crash on concurrent health checks
2026-01-23T16:48:58.198Z [ERROR] Database health check failed {"error":"Unknown error"}

stderr | tests/integration/health.test.ts > Health Check Endpoints > Health check reliability > should not crash on concurrent health checks
2026-01-23T16:48:58.200Z [ERROR] Database health check failed {"error":"Unknown error"}

stderr | tests/integration/health.test.ts > Health Check Endpoints > Health check reliability > should not crash on concurrent health checks
2026-01-23T16:48:58.201Z [ERROR] Database health check failed {"error":"Unknown error"}

stderr | tests/integration/health.test.ts > Health Check Endpoints > Health check reliability > should not crash on concurrent health checks
2026-01-23T16:48:58.203Z [ERROR] Database health check failed {"error":"Unknown error"}

stderr | tests/integration/health.test.ts > Health Check Endpoints > Health check reliability > should not crash on concurrent health checks
2026-01-23T16:48:58.204Z [ERROR] Database health check failed {"error":"Unknown error"}

stderr | tests/integration/health.test.ts > Health Check Endpoints > Health check reliability > should not crash on concurrent health checks
2026-01-23T16:48:58.205Z [ERROR] Database health check failed {"error":"Unknown error"}

stderr | tests/integration/health.test.ts > Health Check Endpoints > Health check reliability > should not crash on concurrent health checks
2026-01-23T16:48:58.206Z [ERROR] Database health check failed {"error":"Unknown error"}

stderr | tests/integration/health.test.ts > Health Check Endpoints > Health check reliability > should not crash on concurrent health checks
2026-01-23T16:48:58.209Z [ERROR] Database health check failed {"error":"Unknown error"}

 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/health.test.ts[2m > [22mHealth Check Endpoints[2m > [22mGET /live[2m > [22mshould return liveness status[32m 11[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/health.test.ts[2m > [22mHealth Check Endpoints[2m > [22mGET /live[2m > [22mshould have positive uptime[32m 5[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/health.test.ts[2m > [22mHealth Check Endpoints[2m > [22mHealth check reliability[2m > [22mshould respond consistently to multiple requests[32m 15[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/health.test.ts[2m > [22mHealth Check Endpoints[2m > [22mHealth check reliability[2m > [22mshould not crash on concurrent health checks[32m 77[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/aiGuardrails.test.ts[2m > [22mAIGuardrailsService[2m > [22mcheckGuardrails[2m > [22mPrompt Injection Detection[2m > [22mshould block obvious injection attempts[32m 13[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/aiGuardrails.test.ts[2m > [22mAIGuardrailsService[2m > [22mcheckGuardrails[2m > [22mPrompt Injection Detection[2m > [22mshould block jailbreak attempts[32m 6[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/aiGuardrails.test.ts[2m > [22mAIGuardrailsService[2m > [22mcheckGuardrails[2m > [22mPrompt Injection Detection[2m > [22mshould flag system command attempts[32m 4[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/aiGuardrails.test.ts[2m > [22mAIGuardrailsService[2m > [22mcheckGuardrails[2m > [22mPrompt Injection Detection[2m > [22mshould allow safe prompts[32m 4[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/aiGuardrails.test.ts[2m > [22mAIGuardrailsService[2m > [22mcheckGuardrails[2m > [22mPII Detection and Redaction[2m > [22mshould detect and redact email addresses[32m 5[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/aiGuardrails.test.ts[2m > [22mAIGuardrailsService[2m > [22mcheckGuardrails[2m > [22mPII Detection and Redaction[2m > [22mshould detect and redact phone numbers[32m 6[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/aiGuardrails.test.ts[2m > [22mAIGuardrailsService[2m > [22mcheckGuardrails[2m > [22mPII Detection and Redaction[2m > [22mshould detect and redact SSN[32m 8[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/aiGuardrails.test.ts[2m > [22mAIGuardrailsService[2m > [22mcheckGuardrails[2m > [22mPII Detection and Redaction[2m > [22mshould detect and redact credit card numbers[32m 4[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/aiGuardrails.test.ts[2m > [22mAIGuardrailsService[2m > [22mcheckGuardrails[2m > [22mPII Detection and Redaction[2m > [22mshould detect multiple PII types[32m 5[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/aiGuardrails.test.ts[2m > [22mAIGuardrailsService[2m > [22mcheckGuardrails[2m > [22mPII Detection and Redaction[2m > [22mshould not flag non-PII data[32m 4[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/aiGuardrails.test.ts[2m > [22mAIGuardrailsService[2m > [22mcheckGuardrails[2m > [22mResponse Analysis[2m > [22mshould analyze response content for harmful material[32m 5[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/aiGuardrails.test.ts[2m > [22mAIGuardrailsService[2m > [22mcheckGuardrails[2m > [22mResponse Analysis[2m > [22mshould detect PII in responses[32m 5[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/aiGuardrails.test.ts[2m > [22mAIGuardrailsService[2m > [22mcheckGuardrails[2m > [22mResponse Analysis[2m > [22mshould allow safe responses[32m 9[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/aiGuardrails.test.ts[2m > [22mAIGuardrailsService[2m > [22mcheckGuardrails[2m > [22mRisk Scoring[2m > [22mshould assign low risk to safe prompts[32m 6[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/aiGuardrails.test.ts[2m > [22mAIGuardrailsService[2m > [22mcheckGuardrails[2m > [22mRisk Scoring[2m > [22mshould assign medium risk to moderately concerning prompts[32m 7[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/aiGuardrails.test.ts[2m > [22mAIGuardrailsService[2m > [22mcheckGuardrails[2m > [22mRisk Scoring[2m > [22mshould assign high risk to dangerous prompts[32m 6[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/enterprise-auth.test.ts[2m > [22mEnterprise Auth Routes[2m > [22mPOST /api/enterprise-auth/login[2m > [22mreturns 401 on failed authentication[32m 16[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/enterprise-auth.test.ts[2m > [22mEnterprise Auth Routes[2m > [22mPOST /api/enterprise-auth/signup[2m > [22mcreates an account and sends verification email[32m 12[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/enterprise-auth.test.ts[2m > [22mEnterprise Auth Routes[2m > [22mPOST /api/enterprise-auth/setup-google-authenticator[2m > [22minitiates GA setup[32m 14[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/enterprise-auth.test.ts[2m > [22mEnterprise Auth Routes[2m > [22mPOST /api/enterprise-auth/logout[2m > [22mdestroys session and clears cookie[32m 14[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/enterprise-auth.test.ts[2m > [22mEnterprise Auth Routes[2m > [22mGET /api/enterprise-auth/methods/:userId[2m > [22mreturns available auth methods[32m 8[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/enterprise-auth.test.ts[2m > [22mEnterprise Auth Routes[2m > [22mPOST /api/enterprise-auth/signup[2m > [22mreturns 409 if account already exists[32m 7[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/enterprise-auth.test.ts[2m > [22mEnterprise Auth Routes[2m > [22mPOST /api/enterprise-auth/verify-email[2m > [22mreturns 400 for invalid token[32m 8[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/enterprise-auth.test.ts[2m > [22mEnterprise Auth Routes[2m > [22mGET /api/enterprise-auth/verify-email[2m > [22mredirects with verified status on success[32m 12[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/enterprise-auth.test.ts[2m > [22mEnterprise Auth Routes[2m > [22mGET /api/enterprise-auth/verify-email[2m > [22mreturns 400 for missing token[32m 8[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/auditService.test.ts[2m > [22mAuditService[2m > [22mlogAuditEvent[2m > [22mshould log an audit event successfully[32m 5[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/auditService.test.ts[2m > [22mAuditService[2m > [22mlogAuditEvent[2m > [22mshould log high risk event with warning[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/auditService.test.ts[2m > [22mAuditService[2m > [22mlogAuditEvent[2m > [22mshould handle missing optional fields[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/auditService.test.ts[2m > [22mAuditService[2m > [22mlogAuditEvent[2m > [22mshould include additional context when provided[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/auditService.test.ts[2m > [22mAuditService[2m > [22mauditFromRequest[2m > [22mshould calculate risk level correctly for DELETE action[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/auditService.test.ts[2m > [22mAuditService[2m > [22mauditFromRequest[2m > [22mshould calculate risk level correctly for FAILED_LOGIN[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/auditService.test.ts[2m > [22mAuditService[2m > [22mauditFromRequest[2m > [22mshould calculate risk level correctly for READ action[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/auditService.test.ts[2m > [22mAuditService[2m > [22mauditFromRequest[2m > [22mshould handle request without user[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/auditService.test.ts[2m > [22mAuditService[2m > [22mauditFromRequest[2m > [22mshould handle missing IP address[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/auditService.test.ts[2m > [22mAuditService[2m > [22mauditDataAccess[2m > [22mshould log data access event[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/auditService.test.ts[2m > [22mAuditService[2m > [22mauditAuthEvent[2m > [22mshould log successful login[32m 5[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/auditService.test.ts[2m > [22mAuditService[2m > [22mauditAuthEvent[2m > [22mshould log failed login with higher risk[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/auditService.test.ts[2m > [22mAuditService[2m > [22mauditAuthEvent[2m > [22mshould log logout event[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/auditService.test.ts[2m > [22mAuditService[2m > [22mgetAuditLogs[2m > [22mshould retrieve audit logs with filters[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/auditService.test.ts[2m > [22mAuditService[2m > [22mgetAuditLogs[2m > [22mshould apply date filters[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/auditService.test.ts[2m > [22mAuditService[2m > [22mgetAuditLogs[2m > [22mshould apply action filter[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/auditService.test.ts[2m > [22mAuditService[2m > [22mgetAuditLogs[2m > [22mshould apply entity type filter[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/auditService.test.ts[2m > [22mAuditService[2m > [22mgetAuditStats[2m > [22mshould get audit statistics for organization[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/auditService.test.ts[2m > [22mAuditService[2m > [22mgetAuditById[2m > [22mshould retrieve specific audit log by ID[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/auditService.test.ts[2m > [22mAuditService[2m > [22mRisk Level Assignment[2m > [22mshould assign CRITICAL risk for delete user actions[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/auditService.test.ts[2m > [22mAuditService[2m > [22mRisk Level Assignment[2m > [22mshould assign HIGH risk for delete actions[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/auditService.test.ts[2m > [22mAuditService[2m > [22mRisk Level Assignment[2m > [22mshould not warn for MEDIUM risk events[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/auditService.test.ts[2m > [22mAuditService[2m > [22mRisk Level Assignment[2m > [22mshould not warn for LOW risk events[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/auditService.test.ts[2m > [22mAuditService[2m > [22mHigh-Volume Logging[2m > [22mshould handle multiple audit events[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/enterprise-auth.test.ts[2m > [22mEnterprise Auth Routes[2m > [22mPOST /api/enterprise-auth/forgot-password[2m > [22msuccessfully initiates reset and hides token in non-dev[32m 29[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/enterprise-auth.test.ts[2m > [22mEnterprise Auth Routes[2m > [22mPOST /api/enterprise-auth/reset-password[2m > [22mreturns 400 for invalid token[32m 5[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/enterprise-auth.test.ts[2m > [22mEnterprise Auth Routes[2m > [22mPOST /api/enterprise-auth/verify-google-authenticator[2m > [22mverifies TOTP successfully[32m 9[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/enterprise-auth.test.ts[2m > [22mEnterprise Auth Routes[2m > [22mPOST /api/enterprise-auth/verify-google-authenticator[2m > [22mreturns 400 for invalid TOTP[32m 6[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/enterprise-auth.test.ts[2m > [22mEnterprise Auth Routes[2m > [22mPOST /api/enterprise-auth/register-passkey[2m > [22mregisters passkey successfully[32m 7[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/enterprise-auth.test.ts[2m > [22mEnterprise Auth Routes[2m > [22mPOST /api/enterprise-auth/register-passkey[2m > [22mreturns 400 if registration fails[32m 40[2mms[22m[39m
[90mstdout[2m | tests/unit/complianceGapAnalysis.test.ts[2m > [22m[2mComplianceGapAnalysisService[2m > [22m[2manalyzeComplianceGaps[2m > [22m[2msuccessfully performs gap analysis with maturity assessment
[22m[39m[32m2026-01-23T16:48:58.394Z [INFO] Starting compliance gap analysis {"organizationId":"org-1","framework":"iso27001"}[0m

[90mstdout[2m | tests/unit/complianceGapAnalysis.test.ts[2m > [22m[2mComplianceGapAnalysisService[2m > [22m[2manalyzeComplianceGaps[2m > [22m[2msuccessfully performs gap analysis with maturity assessment
[22m[39m[32m2026-01-23T16:48:58.401Z [INFO] Compliance gap analysis completed {"organizationId":"org-1","overallScore":65,"findingsCount":2,"recommendationsCount":1}[0m

[90mstdout[2m | tests/unit/complianceGapAnalysis.test.ts[2m > [22m[2mComplianceGapAnalysisService[2m > [22m[2manalyzeComplianceGaps[2m > [22m[2mhandles unsupported frameworks gracefully
[22m[39m[32m2026-01-23T16:48:58.405Z [INFO] Starting compliance gap analysis {"organizationId":"org-1","framework":"invalid-framework"}[0m

stderr | tests/unit/complianceGapAnalysis.test.ts > ComplianceGapAnalysisService > analyzeComplianceGaps > handles unsupported frameworks gracefully
2026-01-23T16:48:58.405Z [ERROR] Error in compliance gap analysis {"organizationId":"org-1","framework":"invalid-framework","error":"Framework invalid-framework not supported"}

 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/security.test.ts[2m > [22mSecurity Middleware[2m > [22msecurityHeaders[2m > [22msets standard security headers[32m 86[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/security.test.ts[2m > [22mSecurity Middleware[2m > [22msecurityHeaders[2m > [22msets HSTS in production[32m 9[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/aiGuardrails.test.ts[2m > [22mAIGuardrailsService[2m > [22mcheckGuardrails[2m > [22mRisk Scoring[2m > [22mshould combine prompt and response risk scores[32m 9[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/aiGuardrails.test.ts[2m > [22mAIGuardrailsService[2m > [22mcheckGuardrails[2m > [22mAction Determination[2m > [22mshould allow when risk is low[32m 26[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/aiGuardrails.test.ts[2m > [22mAIGuardrailsService[2m > [22mcheckGuardrails[2m > [22mAction Determination[2m > [22mshould block when risk is critical[32m 4[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/aiGuardrails.test.ts[2m > [22mAIGuardrailsService[2m > [22mcheckGuardrails[2m > [22mAction Determination[2m > [22mshould flag for human review when appropriate[32m 4[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/aiGuardrails.test.ts[2m > [22mAIGuardrailsService[2m > [22mcheckGuardrails[2m > [22mAction Determination[2m > [22mshould redact PII but allow request[32m 4[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/aiGuardrails.test.ts[2m > [22mAIGuardrailsService[2m > [22mcheckGuardrails[2m > [22mModeration Flags[2m > [22mshould flag hate speech content[32m 5[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/aiGuardrails.test.ts[2m > [22mAIGuardrailsService[2m > [22mcheckGuardrails[2m > [22mModeration Flags[2m > [22mshould flag violent content[32m 4[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/aiGuardrails.test.ts[2m > [22mAIGuardrailsService[2m > [22mcheckGuardrails[2m > [22mModeration Flags[2m > [22mshould not flag safe business content[32m 4[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/aiGuardrails.test.ts[2m > [22mAIGuardrailsService[2m > [22mcheckGuardrails[2m > [22mLogging and Audit Trail[2m > [22mshould log all guardrail checks[32m 4[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/aiGuardrails.test.ts[2m > [22mAIGuardrailsService[2m > [22mcheckGuardrails[2m > [22mLogging and Audit Trail[2m > [22mshould include request context in logs[32m 4[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/aiGuardrails.test.ts[2m > [22mAIGuardrailsService[2m > [22mcheckGuardrails[2m > [22mLogging and Audit Trail[2m > [22mshould return log ID in result[32m 4[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/aiGuardrails.test.ts[2m > [22mAIGuardrailsService[2m > [22mcheckGuardrails[2m > [22mLogging and Audit Trail[2m > [22mshould log blocked requests[32m 4[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/aiGuardrails.test.ts[2m > [22mAIGuardrailsService[2m > [22mcheckGuardrails[2m > [22mEdge Cases[2m > [22mshould handle empty prompts[32m 5[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/aiGuardrails.test.ts[2m > [22mAIGuardrailsService[2m > [22mcheckGuardrails[2m > [22mEdge Cases[2m > [22mshould handle very long prompts[32m 6[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/aiGuardrails.test.ts[2m > [22mAIGuardrailsService[2m > [22mcheckGuardrails[2m > [22mEdge Cases[2m > [22mshould handle null response[32m 4[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/aiGuardrails.test.ts[2m > [22mAIGuardrailsService[2m > [22mcheckGuardrails[2m > [22mEdge Cases[2m > [22mshould handle special characters in prompts[32m 6[2mms[22m[39m
[90mstdout[2m | tests/unit/complianceGapAnalysis.test.ts[2m > [22m[2mComplianceGapAnalysisService[2m > [22m[2manalyzeComplianceGaps[2m > [22m[2mhandles AI service errors
[22m[39m[32m2026-01-23T16:48:58.408Z [INFO] Starting compliance gap analysis {"organizationId":"org-1","framework":"soc2"}[0m

stderr | tests/unit/complianceGapAnalysis.test.ts > ComplianceGapAnalysisService > analyzeComplianceGaps > handles AI service errors
2026-01-23T16:48:58.408Z [ERROR] Error in compliance gap analysis {"organizationId":"org-1","framework":"soc2","error":"AI Service Down"}

[90mstdout[2m | tests/unit/complianceGapAnalysis.test.ts[2m > [22m[2mComplianceGapAnalysisService[2m > [22m[2manalyzeComplianceGaps[2m > [22m[2mhandles malformed AI response
[22m[39m[32m2026-01-23T16:48:58.409Z [INFO] Starting compliance gap analysis {"organizationId":"org-1","framework":"iso27001"}[0m

stderr | tests/unit/complianceGapAnalysis.test.ts > ComplianceGapAnalysisService > analyzeComplianceGaps > handles malformed AI response
2026-01-23T16:48:58.410Z [ERROR] Error parsing AI analysis results {"error":"No valid JSON found in AI response"}

stderr | tests/unit/complianceGapAnalysis.test.ts > ComplianceGapAnalysisService > analyzeComplianceGaps > handles malformed AI response
2026-01-23T16:48:58.410Z [ERROR] Error in compliance gap analysis {"organizationId":"org-1","framework":"iso27001","error":"Failed to parse gap analysis results"}

[90mstdout[2m | tests/unit/complianceGapAnalysis.test.ts[2m > [22m[2mComplianceGapAnalysisService[2m > [22m[2manalyzeComplianceGaps[2m > [22m[2mcalculates executive summary correctly
[22m[39m[32m2026-01-23T16:48:58.411Z [INFO] Starting compliance gap analysis {"organizationId":"org-1","framework":"iso27001"}[0m

[90mstdout[2m | tests/unit/complianceGapAnalysis.test.ts[2m > [22m[2mComplianceGapAnalysisService[2m > [22m[2manalyzeComplianceGaps[2m > [22m[2mcalculates executive summary correctly
[22m[39m[32m2026-01-23T16:48:58.412Z [INFO] Compliance gap analysis completed {"organizationId":"org-1","overallScore":65,"findingsCount":2,"recommendationsCount":1}[0m

[90mstdout[2m | tests/unit/complianceGapAnalysis.test.ts[2m > [22m[2mComplianceGapAnalysisService[2m > [22m[2manalyzeComplianceGaps[2m > [22m[2mhandles remediation generation errors gracefully
[22m[39m[32m2026-01-23T16:48:58.413Z [INFO] Starting compliance gap analysis {"organizationId":"org-1","framework":"iso27001"}[0m

stderr | tests/unit/complianceGapAnalysis.test.ts > ComplianceGapAnalysisService > analyzeComplianceGaps > handles remediation generation errors gracefully
2026-01-23T16:48:58.413Z [WARN] Failed to generate remediation for finding {"controlId":"A.5.1","error":"Remediation generation failed"}

[90mstdout[2m | tests/unit/complianceGapAnalysis.test.ts[2m > [22m[2mComplianceGapAnalysisService[2m > [22m[2manalyzeComplianceGaps[2m > [22m[2mhandles remediation generation errors gracefully
[22m[39m[32m2026-01-23T16:48:58.414Z [INFO] Compliance gap analysis completed {"organizationId":"org-1","overallScore":65,"findingsCount":2,"recommendationsCount":0}[0m

 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/complianceGapAnalysis.test.ts[2m > [22mComplianceGapAnalysisService[2m > [22manalyzeComplianceGaps[2m > [22msuccessfully performs gap analysis with maturity assessment[32m 12[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/complianceGapAnalysis.test.ts[2m > [22mComplianceGapAnalysisService[2m > [22manalyzeComplianceGaps[2m > [22mhandles unsupported frameworks gracefully[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/complianceGapAnalysis.test.ts[2m > [22mComplianceGapAnalysisService[2m > [22manalyzeComplianceGaps[2m > [22mhandles AI service errors[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/complianceGapAnalysis.test.ts[2m > [22mComplianceGapAnalysisService[2m > [22manalyzeComplianceGaps[2m > [22mhandles malformed AI response[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/complianceGapAnalysis.test.ts[2m > [22mComplianceGapAnalysisService[2m > [22manalyzeComplianceGaps[2m > [22mcalculates executive summary correctly[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/complianceGapAnalysis.test.ts[2m > [22mComplianceGapAnalysisService[2m > [22manalyzeComplianceGaps[2m > [22mhandles remediation generation errors gracefully[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/security.test.ts[2m > [22mSecurity Middleware[2m > [22mcsrfProtection[2m > [22mskips CSRF check in test environment (default)[32m 11[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/security.test.ts[2m > [22mSecurity Middleware[2m > [22mcsrfProtection[2m > [22menforces CSRF when NODE_ENV is not test[32m 6[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/security.test.ts[2m > [22mSecurity Middleware[2m > [22mcsrfProtection[2m > [22msets CSRF cookie on GET requests[32m 8[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/security.test.ts[2m > [22mSecurity Middleware[2m > [22mthreatDetection[2m > [22mblocks requests identified as threats[32m 9[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/security.test.ts[2m > [22mSecurity Middleware[2m > [22mthreatDetection[2m > [22mallows clean requests[32m 7[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/security.test.ts[2m > [22mSecurity Middleware[2m > [22merrorHandler[2m > [22mhandles generic errors with 500 status[32m 16[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/security.test.ts[2m > [22mSecurity Middleware[2m > [22merrorHandler[2m > [22mhandles validation errors[32m 9[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/security.test.ts[2m > [22mSecurity Middleware[2m > [22mrequestLogger[2m > [22mlogs requests[32m 9[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/aiGuardrails.test.ts[2m > [22mAIGuardrailsService[2m > [22mcheckGuardrails[2m > [22mEdge Cases[2m > [22mshould handle unicode characters[32m 8[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/aiGuardrails.test.ts[2m > [22mAIGuardrailsService[2m > [22mcheckGuardrails[2m > [22mPerformance[2m > [22mshould complete guardrail check quickly[32m 7[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/aiGuardrails.test.ts[2m > [22mAIGuardrailsService[2m > [22mcheckGuardrails[2m > [22mPerformance[2m > [22mshould handle concurrent checks[32m 5[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/aiGuardrails.test.ts[2m > [22mAIGuardrailsService[2m > [22mcheckGuardrails[2m > [22mContext Validation[2m > [22mshould require requestId in context[32m 6[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/aiGuardrails.test.ts[2m > [22mAIGuardrailsService[2m > [22mcheckGuardrails[2m > [22mContext Validation[2m > [22mshould work without optional context fields[32m 8[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/aiGuardrails.test.ts[2m > [22mAIGuardrailsService[2m > [22mcheckGuardrails[2m > [22mSeverity Classification[2m > [22mshould correctly classify low severity[32m 9[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/aiGuardrails.test.ts[2m > [22mAIGuardrailsService[2m > [22mcheckGuardrails[2m > [22mSeverity Classification[2m > [22mshould correctly classify critical severity[32m 19[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/aiGuardrails.test.ts[2m > [22mAIGuardrailsService[2m > [22mcheckGuardrails[2m > [22mSeverity Classification[2m > [22mshould escalate severity with multiple risk factors[32m 5[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/errorHandling.test.ts[2m > [22merrorHandling[2m > [22mcreateErrorResponse[2m > [22mformats AppError correctly[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/errorHandling.test.ts[2m > [22merrorHandling[2m > [22mcreateErrorResponse[2m > [22mformats ZodError correctly[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/errorHandling.test.ts[2m > [22merrorHandling[2m > [22mcreateErrorResponse[2m > [22muses default values for generic Errors[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/errorHandling.test.ts[2m > [22merrorHandling[2m > [22mcreateSuccessResponse[2m > [22mformats success response correctly[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/errorHandling.test.ts[2m > [22merrorHandling[2m > [22msecureHandler[2m > [22mexecutes the handler and sends no error if successful[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/errorHandling.test.ts[2m > [22merrorHandling[2m > [22msecureHandler[2m > [22mcatches and formats errors[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/errorHandling.test.ts[2m > [22merrorHandling[2m > [22msecureHandler[2m > [22mlogs audit action if configured[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/errorHandling.test.ts[2m > [22merrorHandling[2m > [22mvalidateInput[2m > [22mcalls next if validation passes[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/errorHandling.test.ts[2m > [22merrorHandling[2m > [22mvalidateInput[2m > [22mreturns 400 if validation fails[32m 3[2mms[22m[39m
[90mstdout[2m | tests/unit/encryptionService.test.ts[2m > [22m[2mEncryptionService[2m > [22m[2mencrypts and decrypts sensitive field
[22m[39m[32m2026-01-23T16:48:58.672Z [INFO] Data encrypted successfully with AES-256-GCM {"classification":"confidential","encryptionVersion":2}[0m

[90mstdout[2m | tests/unit/encryptionService.test.ts[2m > [22m[2mEncryptionService[2m > [22m[2mencrypts and decrypts sensitive field
[22m[39m[32m2026-01-23T16:48:58.677Z [INFO] Data decrypted successfully with AES-256-GCM {"encryptionVersion":2}[0m

[90mstdout[2m | tests/unit/encryptionService.test.ts[2m > [22m[2mEncryptionService[2m > [22m[2mdetects when migration is not needed
[22m[39m[32m2026-01-23T16:48:58.679Z [INFO] Data encrypted successfully with AES-256-GCM {"classification":"public","encryptionVersion":2}[0m

[90mstdout[2m | tests/unit/encryptionService.test.ts[2m > [22m[2mEncryptionService[2m > [22m[2mencryptDataAtRest Helper[2m > [22m[2mencrypts object fields matching criteria
[22m[39m[32m2026-01-23T16:48:58.682Z [INFO] Data encrypted successfully with AES-256-GCM {"classification":"restricted","encryptionVersion":2}[0m

[90mstdout[2m | tests/unit/encryptionService.test.ts[2m > [22m[2mEncryptionService[2m > [22m[2mencryptDataAtRest Helper[2m > [22m[2mdecrypts object fields
[22m[39m[32m2026-01-23T16:48:58.684Z [INFO] Data encrypted successfully with AES-256-GCM {"classification":"restricted","encryptionVersion":2}[0m

[90mstdout[2m | tests/unit/encryptionService.test.ts[2m > [22m[2mEncryptionService[2m > [22m[2mencryptDataAtRest Helper[2m > [22m[2mdecrypts object fields
[22m[39m[32m2026-01-23T16:48:58.685Z [INFO] Data decrypted successfully with AES-256-GCM {"encryptionVersion":2}[0m

 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/logger.test.ts[2m > [22mLogger[2m > [22merror logging[2m > [22mshould log error messages[32m 11[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/logger.test.ts[2m > [22mLogger[2m > [22merror logging[2m > [22mshould include context in error logs[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/logger.test.ts[2m > [22mLogger[2m > [22merror logging[2m > [22mshould include request information when provided[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/logger.test.ts[2m > [22mLogger[2m > [22mwarn logging[2m > [22mshould log warning messages[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/logger.test.ts[2m > [22mLogger[2m > [22minfo logging[2m > [22mshould log info messages[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/logger.test.ts[2m > [22mLogger[2m > [22mdebug logging[2m > [22mshould log debug messages in development[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/logger.test.ts[2m > [22mLogger[2m > [22mdebug logging[2m > [22mshould not log debug messages in production[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/logger.test.ts[2m > [22mLogger[2m > [22maudit logging[2m > [22mshould format audit logs correctly[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/logger.test.ts[2m > [22mLogger[2m > [22msecurity logging[2m > [22mshould log high severity security events as errors[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/logger.test.ts[2m > [22mLogger[2m > [22msecurity logging[2m > [22mshould log medium severity security events as warnings[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/logger.test.ts[2m > [22mLogger[2m > [22msecurity logging[2m > [22mshould log low severity security events as info[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/logger.test.ts[2m > [22mLogger[2m > [22mlog formatting[2m > [22mshould include timestamp in logs[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/logger.test.ts[2m > [22mLogger[2m > [22mlog formatting[2m > [22mshould format log levels consistently[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/encryptionService.test.ts[2m > [22mEncryptionService[2m > [22mencrypts and decrypts sensitive field[32m 11[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/encryptionService.test.ts[2m > [22mEncryptionService[2m > [22mgenerates unique encryption keys[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/encryptionService.test.ts[2m > [22mEncryptionService[2m > [22mdetects when migration is not needed[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/encryptionService.test.ts[2m > [22mEncryptionService[2m > [22mhashes for indexing deterministically[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/encryptionService.test.ts[2m > [22mEncryptionService[2m > [22mencryptDataAtRest Helper[2m > [22mencrypts object fields matching criteria[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/encryptionService.test.ts[2m > [22mEncryptionService[2m > [22mencryptDataAtRest Helper[2m > [22mdecrypts object fields[32m 2[2mms[22m[39m
 [2m[90mÎ“Ã¥Ã´[39m[22m [30m[42m unit [49m[39m tests/unit/encryptionService.test.ts[2m > [22mEncryptionService[2m > [22mthrows error if ENCRYPTION_KEY is missing
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/aiOrchestrator.test.ts[2m > [22mAIOrchestrator[2m > [22mgenerateDocument[2m > [22mgenerates document using optimal model (Claude for Policy)[32m 4[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/aiOrchestrator.test.ts[2m > [22mAIOrchestrator[2m > [22mgenerateDocument[2m > [22mfails gracefully if guardrails block input[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/aiOrchestrator.test.ts[2m > [22mAIOrchestrator[2m > [22mgenerateDocument[2m > [22mfalls back to OpenAI if Claude fails[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/aiOrchestrator.test.ts[2m > [22mAIOrchestrator[2m > [22mgenerateContent[2m > [22mgenerates content successfully[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/aiOrchestrator.test.ts[2m > [22mAIOrchestrator[2m > [22mgenerateContent[2m > [22mgenerates content successfully with Anthropic fallback[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/aiOrchestrator.test.ts[2m > [22mAIOrchestrator[2m > [22mgenerateComplianceDocuments[2m > [22mgenerates multiple documents for a framework[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/aiOrchestrator.test.ts[2m > [22mAIOrchestrator[2m > [22mhealthCheck[2m > [22mreturns healthy status when models are responsive[32m 0[2mms[22m[39m
stderr | tests/integration/aiRoutes.test.ts
The `fetchConnectionCache` option is deprecated (now always `true`)

 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/aiOrchestrator.test.ts[2m > [22mAIOrchestrator[2m > [22mhealthCheck[2m > [22mperforms real health checks if NODE_ENV is not test[33m 358[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/aiOrchestrator.test.ts[2m > [22mAIOrchestrator[2m > [22mselectOptimalModel[2m > [22mselects Claude for Policies[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/aiOrchestrator.test.ts[2m > [22mAIOrchestrator[2m > [22mselectOptimalModel[2m > [22mselects OpenAI for technical documents[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/aiOrchestrator.test.ts[2m > [22mAIOrchestrator[2m > [22manalyzeQuality[2m > [22manalyzes document quality[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/aiOrchestrator.test.ts[2m > [22mAIOrchestrator[2m > [22mgetAvailableModels[2m > [22mreturns the list of supported models[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/geminiVision.test.ts[2m > [22mgeminiVision[2m > [22manalyzeImage[2m > [22manalyzes image successfully[32m 6[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/geminiVision.test.ts[2m > [22mgeminiVision[2m > [22manalyzeImage[2m > [22mhandles compliance analysis[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/geminiVision.test.ts[2m > [22mgeminiVision[2m > [22manalyzeImage[2m > [22mhandles diagram analysis[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/geminiVision.test.ts[2m > [22mgeminiVision[2m > [22manalyzeImage[2m > [22mhandles document analysis[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/geminiVision.test.ts[2m > [22mgeminiVision[2m > [22manalyzeImage[2m > [22mthrows on invalid image format[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/geminiVision.test.ts[2m > [22mgeminiVision[2m > [22manalyzeImage[2m > [22mhandles raw base64 without prefix[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/geminiVision.test.ts[2m > [22mgeminiVision[2m > [22manalyzeMultipleImages[2m > [22mprocesses multiple images[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/geminiVision.test.ts[2m > [22mgeminiVision[2m > [22manalyzeMultipleImages[2m > [22mhandles errors gracefully in batch[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/aiRoutes.test.ts[2m > [22mAI Routes[2m > [22mPOST /api/ai/generate-compliance-docs[2m > [22mstarts a generation job[32m 144[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/aiRoutes.test.ts[2m > [22mAI Routes[2m > [22mGET /api/ai/generation-jobs/:id[2m > [22mreturns job status[32m 19[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/aiRoutes.test.ts[2m > [22mAI Routes[2m > [22mGET /api/ai/generation-jobs/:id[2m > [22mreturns 404 for non-existent job[32m 13[2mms[22m[39m
stderr | tests/unit/gap-analysis.test.ts
The `fetchConnectionCache` option is deprecated (now always `true`)

 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/gap-analysis.test.ts[2m > [22mGap Analysis Unit Tests[2m > [22mGap Analysis Report Operations[2m > [22mshould create a gap analysis report[32m 7[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/gap-analysis.test.ts[2m > [22mGap Analysis Unit Tests[2m > [22mGap Analysis Report Operations[2m > [22mshould retrieve gap analysis reports by organization[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/gap-analysis.test.ts[2m > [22mGap Analysis Unit Tests[2m > [22mGap Analysis Report Operations[2m > [22mshould get a single gap analysis report[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/gap-analysis.test.ts[2m > [22mGap Analysis Unit Tests[2m > [22mGap Analysis Report Operations[2m > [22mshould update gap analysis report status[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/gap-analysis.test.ts[2m > [22mGap Analysis Unit Tests[2m > [22mGap Analysis Findings[2m > [22mshould create a gap analysis finding[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/gap-analysis.test.ts[2m > [22mGap Analysis Unit Tests[2m > [22mGap Analysis Findings[2m > [22mshould get findings for a report[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/gap-analysis.test.ts[2m > [22mGap Analysis Unit Tests[2m > [22mGap Analysis Findings[2m > [22mshould handle different risk levels[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/gap-analysis.test.ts[2m > [22mGap Analysis Unit Tests[2m > [22mRemediation Recommendations[2m > [22mshould create a remediation recommendation[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/gap-analysis.test.ts[2m > [22mGap Analysis Unit Tests[2m > [22mRemediation Recommendations[2m > [22mshould get recommendations for a finding[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/gap-analysis.test.ts[2m > [22mGap Analysis Unit Tests[2m > [22mRemediation Recommendations[2m > [22mshould update recommendation status[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/gap-analysis.test.ts[2m > [22mGap Analysis Unit Tests[2m > [22mRemediation Recommendations[2m > [22mshould handle different timeframes[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/gap-analysis.test.ts[2m > [22mGap Analysis Unit Tests[2m > [22mCompliance Maturity Assessment[2m > [22mshould create compliance maturity assessment[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/gap-analysis.test.ts[2m > [22mGap Analysis Unit Tests[2m > [22mCompliance Maturity Assessment[2m > [22mshould get compliance maturity assessment by org and framework[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/gap-analysis.test.ts[2m > [22mGap Analysis Unit Tests[2m > [22mFramework-Specific Gap Analysis[2m > [22mshould create gap analysis for soc2[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/gap-analysis.test.ts[2m > [22mGap Analysis Unit Tests[2m > [22mFramework-Specific Gap Analysis[2m > [22mshould create gap analysis for iso27001[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/gap-analysis.test.ts[2m > [22mGap Analysis Unit Tests[2m > [22mFramework-Specific Gap Analysis[2m > [22mshould create gap analysis for fedramp[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/gap-analysis.test.ts[2m > [22mGap Analysis Unit Tests[2m > [22mFramework-Specific Gap Analysis[2m > [22mshould create gap analysis for nist[32m 0[2mms[22m[39m
stderr | tests/unit/agent-client.test.ts
The `fetchConnectionCache` option is deprecated (now always `true`)

[90mstdout[2m | tests/unit/agent-client.test.ts[2m > [22m[2mAgentClient[2m > [22m[2mshould register and list agents
[22m[39m[32m2026-01-23T16:48:59.672Z [INFO] Registered agent: Agent One (agent1)[0m

[90mstdout[2m | tests/unit/agent-client.test.ts[2m > [22m[2mAgentClient[2m > [22m[2mshould execute OpenAI agent requests
[22m[39m[32m2026-01-23T16:48:59.682Z [INFO] Registered agent: OA (oa1)[0m

[90mstdout[2m | tests/unit/agent-client.test.ts[2m > [22m[2mAgentClient[2m > [22m[2mshould execute Anthropic agent requests
[22m[39m[32m2026-01-23T16:48:59.684Z [INFO] Registered agent: AN (an1)[0m

[90mstdout[2m | tests/unit/agent-client.test.ts[2m > [22m[2mAgentClient[2m > [22m[2mshould handle tool calls in execution loop
[22m[39m[32m2026-01-23T16:48:59.686Z [INFO] Registered agent: TA (tool-agent)[0m

[90mstdout[2m | tests/unit/agent-client.test.ts[2m > [22m[2mAgentClient[2m > [22m[2mshould handle tool calls in execution loop
[22m[39m[32m2026-01-23T16:48:59.686Z [INFO] Executing tool {"toolName":"t1","agentId":"tool-agent"}[0m

stderr | tests/unit/agent-client.test.ts > AgentClient > should handle agent execution errors
2026-01-23T16:48:59.692Z [ERROR] OpenAI agent execution failed {"error":"AI failed","agentId":"oa1"}

 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/agent-client.test.ts[2m > [22mAgentClient[2m > [22mshould register and list agents[32m 8[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/agent-client.test.ts[2m > [22mAgentClient[2m > [22mshould manage conversation history[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/agent-client.test.ts[2m > [22mAgentClient[2m > [22mshould prepare tools for agents[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/agent-client.test.ts[2m > [22mAgentClient[2m > [22mshould execute OpenAI agent requests[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/agent-client.test.ts[2m > [22mAgentClient[2m > [22mshould execute Anthropic agent requests[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/agent-client.test.ts[2m > [22mAgentClient[2m > [22mshould handle tool calls in execution loop[32m 5[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/agent-client.test.ts[2m > [22mAgentClient[2m > [22mshould handle agent execution errors[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/agent-client.test.ts[2m > [22mAgentClient[2m > [22mshould throw if agent not found[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/emailService.test.ts[2m > [22mEmailService[2m > [22mconfiguration[2m > [22mskips email if API key is missing[32m 5[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/emailService.test.ts[2m > [22mEmailService[2m > [22msendVerificationEmail[2m > [22msends email successfully[32m 5[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/emailService.test.ts[2m > [22mEmailService[2m > [22msendVerificationEmail[2m > [22mhandles API failure[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/emailService.test.ts[2m > [22mEmailService[2m > [22msendVerificationEmail[2m > [22mhandles network error[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/emailService.test.ts[2m > [22mEmailService[2m > [22msendPasswordResetEmail[2m > [22msends email successfully[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/ai/evaluation-suite.test.ts[2m > [22mAI Safety Guardrails[2m > [22mPrompt Injection Detection[2m > [22mshould block: 'Prompt injection attempt - ignore insÎ“Ã‡Âª'[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/ai/evaluation-suite.test.ts[2m > [22mAI Safety Guardrails[2m > [22mPrompt Injection Detection[2m > [22mshould block: 'Prompt injection attempt - system oveÎ“Ã‡Âª'[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/ai/evaluation-suite.test.ts[2m > [22mAI Safety Guardrails[2m > [22mPrompt Injection Detection[2m > [22mshould allow safe compliance questions[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/ai/evaluation-suite.test.ts[2m > [22mAI Safety Guardrails[2m > [22mPII Detection and Redaction[2m > [22mshould redact PII: 'PII in input - SSN'[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/ai/evaluation-suite.test.ts[2m > [22mAI Safety Guardrails[2m > [22mPII Detection and Redaction[2m > [22mshould redact PII: 'PII in input - Credit Card'[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/ai/evaluation-suite.test.ts[2m > [22mAI Safety Guardrails[2m > [22mPII Detection and Redaction[2m > [22mshould not redact non-PII content[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/ai/evaluation-suite.test.ts[2m > [22mAI Safety Guardrails[2m > [22mOutput Moderation[2m > [22mshould pass safe AI output[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/ai/evaluation-suite.test.ts[2m > [22mAI Safety Guardrails[2m > [22mOutput Moderation[2m > [22mshould flag harmful content in output[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/ai/evaluation-suite.test.ts[2m > [22mAI Quality Metrics[2m > [22mDocument Generation Quality[2m > [22mshould include expected sections: 'Document generation - policy'[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/ai/evaluation-suite.test.ts[2m > [22mAI Quality Metrics[2m > [22mDocument Generation Quality[2m > [22mshould generate properly formatted markdown[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/ai/evaluation-suite.test.ts[2m > [22mAI Quality Metrics[2m > [22mResponse Latency[2m > [22mshould respond within SLO (30s for AI)[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/ai/evaluation-suite.test.ts[2m > [22mAI Quality Metrics[2m > [22mToken Usage[2m > [22mshould report token usage accurately[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/ai/evaluation-suite.test.ts[2m > [22mAI Quality Metrics[2m > [22mToken Usage[2m > [22mshould not exceed token limits[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/ai/evaluation-suite.test.ts[2m > [22mAI Model Fallback[2m > [22mshould fallback to secondary model on primary failure[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/ai/evaluation-suite.test.ts[2m > [22mAI Model Fallback[2m > [22mshould report error when all models fail[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/ai/evaluation-suite.test.ts[2m > [22mCompliance-Specific Tests[2m > [22mFramework Accuracy[2m > [22mshould reference correct SOC 2 trust principles[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/ai/evaluation-suite.test.ts[2m > [22mCompliance-Specific Tests[2m > [22mFramework Accuracy[2m > [22mshould provide accurate ISO 27001 control references[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/enterpriseAuthService.test.ts[2m > [22mEnterpriseAuthService[2m > [22mcreateAccount[2m > [22mcreates a new account successfully[32m 4[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/enterpriseAuthService.test.ts[2m > [22mEnterpriseAuthService[2m > [22mcreateAccount[2m > [22mthrows ConflictError if email already exists[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/enterpriseAuthService.test.ts[2m > [22mEnterpriseAuthService[2m > [22mcreateAccount[2m > [22mwraps unknown errors in AppError[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/enterpriseAuthService.test.ts[2m > [22mEnterpriseAuthService[2m > [22mverifyEmail[2m > [22mverifies email successfully[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/enterpriseAuthService.test.ts[2m > [22mEnterpriseAuthService[2m > [22mverifyEmail[2m > [22mreturns false if token is invalid or already used[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/enterpriseAuthService.test.ts[2m > [22mEnterpriseAuthService[2m > [22mverifyEmail[2m > [22mreturns false if token is expired[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/enterpriseAuthService.test.ts[2m > [22mEnterpriseAuthService[2m > [22minitiatePasswordReset[2m > [22minitiates reset if user exists[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/enterpriseAuthService.test.ts[2m > [22mEnterpriseAuthService[2m > [22minitiatePasswordReset[2m > [22mreturns dummy success if user does not exist[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/enterpriseAuthService.test.ts[2m > [22mEnterpriseAuthService[2m > [22mconfirmPasswordReset[2m > [22mconfirms reset successfully[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/enterpriseAuthService.test.ts[2m > [22mEnterpriseAuthService[2m > [22mconfirmPasswordReset[2m > [22mreturns false if token invalid or expired[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/enterpriseAuthService.test.ts[2m > [22mEnterpriseAuthService[2m > [22msetupGoogleAuthenticator[2m > [22msets up TOTP successfully[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/enterpriseAuthService.test.ts[2m > [22mEnterpriseAuthService[2m > [22msetupGoogleAuthenticator[2m > [22mthrows error if user not found[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/enterpriseAuthService.test.ts[2m > [22mEnterpriseAuthService[2m > [22mauthenticateUser[2m > [22mauthenticates successfully with email[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/enterpriseAuthService.test.ts[2m > [22mEnterpriseAuthService[2m > [22mauthenticateUser[2m > [22mauthenticates successfully with username[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/enterpriseAuthService.test.ts[2m > [22mEnterpriseAuthService[2m > [22mauthenticateUser[2m > [22mthrows UnauthorizedError for invalid password[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/enterpriseAuthService.test.ts[2m > [22mEnterpriseAuthService[2m > [22mauthenticateUser[2m > [22mthrows RateLimitError if account is locked[32m 1[2mms[22m[39m
[90mstdout[2m | tests/unit/pdfSecurityService.test.ts[2m > [22m[2mPDFSecurityService[2m > [22m[2msecurePDF[2m > [22m[2msecures a PDF successfully
[22m[39m[32m2026-01-23T16:49:00.041Z [INFO] Watermark applied to PDF {"pages":0,"text":"CONFIDENTIAL","position":"center","opacity":0.5}[0m

[90mstdout[2m | tests/unit/pdfSecurityService.test.ts[2m > [22m[2mPDFSecurityService[2m > [22m[2msecurePDF[2m > [22m[2msecures a PDF successfully
[22m[39m[32m2026-01-23T16:49:00.046Z [INFO] PDF security settings saved {"fileId":"file-123","securedFilePath":"uploads\\secured-pdfs\\file-123-secured.pdf"}[0m

[90mstdout[2m | tests/unit/pdfSecurityService.test.ts[2m > [22m[2mPDFSecurityService[2m > [22m[2msecurePDF[2m > [22m[2msecures a PDF successfully
[22m[39m[32m2026-01-23T16:49:00.047Z [INFO] PDF security applied {"fileId":"file-123","originalSize":11,"securedSize":3}[0m

stderr | tests/unit/pdfSecurityService.test.ts > PDFSecurityService > securePDF > throws if file metadata not found
2026-01-23T16:49:00.050Z [ERROR] Failed to secure PDF {"fileId":"file-123","error":"Original file metadata not found"}

[90mstdout[2m | tests/unit/pdfSecurityService.test.ts[2m > [22m[2mPDFSecurityService[2m > [22m[2mremovePDFSecurity[2m > [22m[2mremoves security settings
[22m[39m[32m2026-01-23T16:49:00.065Z [INFO] PDF security settings removed {"fileId":"file-123","userId":"user-1"}[0m

 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/pdfSecurityService.test.ts[2m > [22mPDFSecurityService[2m > [22msecurePDF[2m > [22msecures a PDF successfully[32m 11[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/pdfSecurityService.test.ts[2m > [22mPDFSecurityService[2m > [22msecurePDF[2m > [22mthrows if file metadata not found[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/pdfSecurityService.test.ts[2m > [22mPDFSecurityService[2m > [22mremovePDFSecurity[2m > [22mremoves security settings[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/pdfSecurityService.test.ts[2m > [22mPDFSecurityService[2m > [22mremovePDFSecurity[2m > [22mreturns false if settings do not exist[32m 1[2mms[22m[39m
stderr | tests/integration/critical-user-flows.test.ts
The `fetchConnectionCache` option is deprecated (now always `true`)

 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/aiFineTuningService.test.ts[2m > [22mAIFineTuningService[2m > [22mIndustry Configuration[2m > [22mretrieves all configurations[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/aiFineTuningService.test.ts[2m > [22mAIFineTuningService[2m > [22mIndustry Configuration[2m > [22mretrieves specific configuration[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/aiFineTuningService.test.ts[2m > [22mAIFineTuningService[2m > [22mIndustry Configuration[2m > [22mreturns null for invalid industry[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/aiFineTuningService.test.ts[2m > [22mAIFineTuningService[2m > [22mcreateCustomConfiguration[2m > [22mcreates configuration successfully[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/aiFineTuningService.test.ts[2m > [22mAIFineTuningService[2m > [22mcreateCustomConfiguration[2m > [22mthrows error for invalid industry[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/aiFineTuningService.test.ts[2m > [22mAIFineTuningService[2m > [22mgenerateOptimizedDocument[2m > [22mgenerates using Anthropic (preferred)[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/aiFineTuningService.test.ts[2m > [22mAIFineTuningService[2m > [22mgenerateOptimizedDocument[2m > [22mgenerates using OpenAI (preferred)[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/aiFineTuningService.test.ts[2m > [22mAIFineTuningService[2m > [22mgenerateOptimizedDocument[2m > [22mhandles unknown industry defaulting to technology (OpenAI)[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/aiFineTuningService.test.ts[2m > [22mAIFineTuningService[2m > [22massessIndustryRisks[2m > [22mgenerates risk assessment successfully[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/aiFineTuningService.test.ts[2m > [22mAIFineTuningService[2m > [22massessIndustryRisks[2m > [22mthrows on invalid industry[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/critical-user-flows.test.ts[2m > [22mCritical User Flows E2E Tests[2m > [22mFlow 1: New User Onboarding to First Document[2m > [22mshould complete full onboarding flow from registration to document generation[32m 6[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/critical-user-flows.test.ts[2m > [22mCritical User Flows E2E Tests[2m > [22mFlow 2: Bulk AI Document Generation[2m > [22mshould generate multiple documents for selected frameworks[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/critical-user-flows.test.ts[2m > [22mCritical User Flows E2E Tests[2m > [22mFlow 3: Document Review and Approval Workflow[2m > [22mshould complete document review lifecycle from draft to approved[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/critical-user-flows.test.ts[2m > [22mCritical User Flows E2E Tests[2m > [22mFlow 3: Document Review and Approval Workflow[2m > [22mshould handle document rejection and revision flow[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/critical-user-flows.test.ts[2m > [22mCritical User Flows E2E Tests[2m > [22mFlow 4: Gap Analysis and Remediation[2m > [22mshould identify gaps and track remediation progress[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/critical-user-flows.test.ts[2m > [22mCritical User Flows E2E Tests[2m > [22mFlow 5: Multi-User Collaboration[2m > [22mshould support multiple users working on same framework[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/critical-user-flows.test.ts[2m > [22mCritical User Flows E2E Tests[2m > [22mFlow 6: Framework Migration[2m > [22mshould support adding new frameworks and generating documents[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/critical-user-flows.test.ts[2m > [22mCritical User Flows E2E Tests[2m > [22mFlow 7: Document Export and Reporting[2m > [22mshould prepare documents for export and audit[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/critical-user-flows.test.ts[2m > [22mCritical User Flows E2E Tests[2m > [22mFlow 8: Real-time Dashboard Updates[2m > [22mshould track compliance metrics as documents are created[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/critical-user-flows.test.ts[2m > [22mCritical User Flows E2E Tests[2m > [22mFlow 9: Error Recovery and Data Integrity[2m > [22mshould handle errors gracefully and maintain data integrity[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/critical-user-flows.test.ts[2m > [22mCritical User Flows E2E Tests[2m > [22mFlow 10: Complete Compliance Journey[2m > [22mshould track complete journey from onboarding to audit-ready[32m 1[2mms[22m[39m
stderr | tests/unit/routes/localMode.test.ts > Local Mode Routes > Runtime Mode Endpoint > should return runtime configuration
Invalid DEPLOYMENT_MODE: "undefined". Expected "cloud" or "local". Defaulting to "cloud".

stderr | tests/unit/routes/localMode.test.ts > Local Mode Routes > Security Validation > should default to cloud mode if DEPLOYMENT_MODE is invalid
Invalid DEPLOYMENT_MODE: "invalid". Expected "cloud" or "local". Defaulting to "cloud".

 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/routes/localMode.test.ts[2m > [22mLocal Mode Routes[2m > [22mRuntime Mode Endpoint[2m > [22mshould return runtime configuration[32m 4[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/routes/localMode.test.ts[2m > [22mLocal Mode Routes[2m > [22mRuntime Mode Endpoint[2m > [22mshould include deployment mode in response[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/routes/localMode.test.ts[2m > [22mLocal Mode Routes[2m > [22mRuntime Mode Endpoint[2m > [22mshould include features configuration[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/routes/localMode.test.ts[2m > [22mLocal Mode Routes[2m > [22mLocal Mode Configuration[2m > [22mshould use localhost binding in local mode[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/routes/localMode.test.ts[2m > [22mLocal Mode Routes[2m > [22mLocal Mode Configuration[2m > [22mshould use SQLite in local mode[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/routes/localMode.test.ts[2m > [22mLocal Mode Routes[2m > [22mLocal Mode Configuration[2m > [22mshould use local storage in local mode[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/routes/localMode.test.ts[2m > [22mLocal Mode Routes[2m > [22mLocal Mode Configuration[2m > [22mshould disable auth in local mode[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/routes/localMode.test.ts[2m > [22mLocal Mode Routes[2m > [22mLocal Mode Configuration[2m > [22mshould disable enterprise features in local mode[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/routes/localMode.test.ts[2m > [22mLocal Mode Routes[2m > [22mSecurity Validation[2m > [22mshould enforce localhost binding in local mode[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/routes/localMode.test.ts[2m > [22mLocal Mode Routes[2m > [22mSecurity Validation[2m > [22mshould default to cloud mode if DEPLOYMENT_MODE is invalid[32m 1[2mms[22m[39m
[90mstdout[2m | tests/unit/sessionRiskScoringService.test.ts[2m > [22m[2mSessionRiskScoringService[2m > [22m[2mshould return low risk for known context
[22m[39m[32m2026-01-23T16:49:00.236Z [INFO] Calculating session risk score {"userId":"u1","ipAddress":"[IP_REDACTED]"}[0m

[90mstdout[2m | tests/unit/sessionRiskScoringService.test.ts[2m > [22m[2mSessionRiskScoringService[2m > [22m[2mshould return low risk for known context
[22m[39m[32m2026-01-23T16:49:00.242Z [INFO] Risk score calculated {"userId":"u1","score":15,"level":"low","requiresMFA":false,"blockSession":false}[0m

[90mstdout[2m | tests/unit/sessionRiskScoringService.test.ts[2m > [22m[2mSessionRiskScoringService[2m > [22m[2mshould return high risk for new device + new location + impossible travel
[22m[39m[32m2026-01-23T16:49:00.244Z [INFO] Calculating session risk score {"userId":"u1","ipAddress":"[IP_REDACTED]"}[0m

[90mstdout[2m | tests/unit/sessionRiskScoringService.test.ts[2m > [22m[2mSessionRiskScoringService[2m > [22m[2mshould return high risk for new device + new location + impossible travel
[22m[39m[32m2026-01-23T16:49:00.244Z [INFO] Risk score calculated {"userId":"u1","score":80,"level":"critical","requiresMFA":true,"blockSession":true}[0m

[90mstdout[2m | tests/unit/sessionRiskScoringService.test.ts[2m > [22m[2mSessionRiskScoringService[2m > [22m[2mshould penalize recent failed logins
[22m[39m[32m2026-01-23T16:49:00.245Z [INFO] Calculating session risk score {"userId":"u1","ipAddress":"[IP_REDACTED]"}[0m

[90mstdout[2m | tests/unit/sessionRiskScoringService.test.ts[2m > [22m[2mSessionRiskScoringService[2m > [22m[2mshould penalize recent failed logins
[22m[39m[32m2026-01-23T16:49:00.246Z [INFO] Risk score calculated {"userId":"u1","score":35,"level":"low","requiresMFA":false,"blockSession":false}[0m

[90mstdout[2m | tests/unit/sessionRiskScoringService.test.ts[2m > [22m[2mSessionRiskScoringService[2m > [22m[2mshould return critical risk for TOR network
[22m[39m[32m2026-01-23T16:49:00.246Z [INFO] Calculating session risk score {"userId":"u1","ipAddress":"[IP_REDACTED]"}[0m

[90mstdout[2m | tests/unit/sessionRiskScoringService.test.ts[2m > [22m[2mSessionRiskScoringService[2m > [22m[2mshould return critical risk for TOR network
[22m[39m[32m2026-01-23T16:49:00.247Z [INFO] Risk score calculated {"userId":"u1","score":15,"level":"low","requiresMFA":false,"blockSession":false}[0m

 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/sessionRiskScoringService.test.ts[2m > [22mSessionRiskScoringService[2m > [22mshould return low risk for known context[32m 9[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/sessionRiskScoringService.test.ts[2m > [22mSessionRiskScoringService[2m > [22mshould return high risk for new device + new location + impossible travel[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/sessionRiskScoringService.test.ts[2m > [22mSessionRiskScoringService[2m > [22mshould penalize recent failed logins[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/sessionRiskScoringService.test.ts[2m > [22mSessionRiskScoringService[2m > [22mshould return critical risk for TOR network[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/aiGuardrailsService.test.ts[2m > [22mAIGuardrailsService[2m > [22mcheckGuardrails[2m > [22mallows safe prompt[32m 5[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/aiGuardrailsService.test.ts[2m > [22mAIGuardrailsService[2m > [22mcheckGuardrails[2m > [22mblocks high risk keywords (injection)[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/aiGuardrailsService.test.ts[2m > [22mAIGuardrailsService[2m > [22mcheckGuardrails[2m > [22mflags PII[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/aiGuardrailsService.test.ts[2m > [22mAIGuardrailsService[2m > [22mcheckGuardrails[2m > [22mlogs check results to DB[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/aiGuardrailsService.test.ts[2m > [22mAIGuardrailsService[2m > [22mcheckGuardrails[2m > [22mthrows error if missing requestId[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/aiGuardrailsService.test.ts[2m > [22mAIGuardrailsService[2m > [22mgetGuardrailLogs[2m > [22mbuilds query with options[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/aiGuardrailsService.test.ts[2m > [22mAIGuardrailsService[2m > [22msubmitHumanReview[2m > [22mupdates log entry[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/keyRotationService.test.ts[2m > [22mKeyRotationService[2m > [22mrotateEncryptionKey[2m > [22mrotates encryption key and logs audit event[32m 7[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/keyRotationService.test.ts[2m > [22mKeyRotationService[2m > [22mcheckRotationDue[2m > [22mreturns false if recently rotated[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/keyRotationService.test.ts[2m > [22mKeyRotationService[2m > [22mcheckRotationDue[2m > [22mreturns true if never rotated[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/keyRotationService.test.ts[2m > [22mKeyRotationService[2m > [22mperformScheduledRotations[2m > [22mskips if not due[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/keyRotationService.test.ts[2m > [22mKeyRotationService[2m > [22mperformScheduledRotations[2m > [22mrotates if due[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/threatDetectionService.test.ts[2m > [22mThreatDetectionService[2m > [22mSQL Injection Detection[2m > [22mdetects basic SQL injection patterns[32m 6[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/threatDetectionService.test.ts[2m > [22mThreatDetectionService[2m > [22mXSS Detection[2m > [22mdetects script tags[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/threatDetectionService.test.ts[2m > [22mThreatDetectionService[2m > [22mCommand Injection Detection[2m > [22mdetects system command attempts[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/threatDetectionService.test.ts[2m > [22mThreatDetectionService[2m > [22mBrute Force Detection[2m > [22mdetects brute force after threshold[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/threatDetectionService.test.ts[2m > [22mThreatDetectionService[2m > [22mBrute Force Detection[2m > [22mclears suspicious IPs after timeout[32m 4[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/threatDetectionService.test.ts[2m > [22mThreatDetectionService[2m > [22mMetrics[2m > [22mreturns correct metrics structure[32m 1[2mms[22m[39m
stderr | tests/unit/mcp-core.test.ts
The `fetchConnectionCache` option is deprecated (now always `true`)

 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/complianceDeadlineService.test.ts[2m > [22mComplianceDeadlineService[2m > [22mcreateDeadline[2m > [22mcreates and stores a deadline[32m 5[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/complianceDeadlineService.test.ts[2m > [22mComplianceDeadlineService[2m > [22mcheckOverdueDeadlines[2m > [22mmarks pending deadlines as overdue if past due date[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/complianceDeadlineService.test.ts[2m > [22mComplianceDeadlineService[2m > [22mprocessReminders[2m > [22msends reminders when due[32m 2[2mms[22m[39m
stderr | tests/integration/workflow-integration.test.ts
The `fetchConnectionCache` option is deprecated (now always `true`)

 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/workflow-integration.test.ts[2m > [22mWorkflow Integration Tests[2m > [22mComplete Document Generation Workflow[2m > [22mshould complete full document generation from profile to export[32m 4[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/workflow-integration.test.ts[2m > [22mWorkflow Integration Tests[2m > [22mComplete Document Generation Workflow[2m > [22mshould handle document lifecycle with multiple versions[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/workflow-integration.test.ts[2m > [22mWorkflow Integration Tests[2m > [22mGap Analysis Workflow[2m > [22mshould perform gap analysis after document generation[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/workflow-integration.test.ts[2m > [22mWorkflow Integration Tests[2m > [22mGap Analysis Workflow[2m > [22mshould identify gaps in document coverage[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/workflow-integration.test.ts[2m > [22mWorkflow Integration Tests[2m > [22mMulti-Framework Document Workflow[2m > [22mshould generate and manage documents across multiple frameworks[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/workflow-integration.test.ts[2m > [22mWorkflow Integration Tests[2m > [22mMulti-Framework Document Workflow[2m > [22mshould filter documents by multiple criteria[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/workflow-integration.test.ts[2m > [22mWorkflow Integration Tests[2m > [22mAI-Generated Document Tracking[2m > [22mshould track AI-generated documents separately[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/workflow-integration.test.ts[2m > [22mWorkflow Integration Tests[2m > [22mOrganization Multi-User Workflow[2m > [22mshould handle multiple users in same organization[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/workflow-integration.test.ts[2m > [22mWorkflow Integration Tests[2m > [22mDocument Search and Filtering Workflow[2m > [22mshould support filtering by status[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/workflow-integration.test.ts[2m > [22mWorkflow Integration Tests[2m > [22mDocument Search and Filtering Workflow[2m > [22mshould support filtering by framework[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/workflow-integration.test.ts[2m > [22mWorkflow Integration Tests[2m > [22mDocument Search and Filtering Workflow[2m > [22mshould support filtering by category[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/workflow-integration.test.ts[2m > [22mWorkflow Integration Tests[2m > [22mDocument Search and Filtering Workflow[2m > [22mshould return all documents when no filters applied[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/workflow-integration.test.ts[2m > [22mWorkflow Integration Tests[2m > [22mBulk Document Operations Workflow[2m > [22mshould handle bulk document creation[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/workflow-integration.test.ts[2m > [22mWorkflow Integration Tests[2m > [22mBulk Document Operations Workflow[2m > [22mshould handle bulk status updates[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/requestSchemas.test.ts[2m > [22mrequestSchemas[2m > [22mcreateOrganizationSchema[2m > [22mvalidates valid input[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/requestSchemas.test.ts[2m > [22mrequestSchemas[2m > [22mcreateOrganizationSchema[2m > [22mfails on missing name[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/requestSchemas.test.ts[2m > [22mrequestSchemas[2m > [22mcreateOrganizationSchema[2m > [22mvalidates email format[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/requestSchemas.test.ts[2m > [22mrequestSchemas[2m > [22manalyzeQualitySchema[2m > [22mrequires content and framework[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/requestSchemas.test.ts[2m > [22mrequestSchemas[2m > [22mgenerateComplianceDocsSchema[2m > [22mvalidates complex nested structure[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/requestSchemas.test.ts[2m > [22mrequestSchemas[2m > [22mgenerateComplianceDocsSchema[2m > [22menforces array min length[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/requestSchemas.test.ts[2m > [22mrequestSchemas[2m > [22mchatMessageSchema[2m > [22mvalidates message length[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/requestSchemas.test.ts[2m > [22mrequestSchemas[2m > [22mmfaSetupSchema[2m > [22mvalidates method enum[32m 1[2mms[22m[39m
stderr | tests/integration/storage-advanced.test.ts
The `fetchConnectionCache` option is deprecated (now always `true`)

 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/errorHandler.test.ts[2m > [22merrorHandler[2m > [22mhandleError handles explicit Error objects[32m 9[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/errorHandler.test.ts[2m > [22merrorHandler[2m > [22mhandleError handles unknown errors[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/errorHandler.test.ts[2m > [22merrorHandler[2m > [22mcreateErrorHandler returns a middleware function[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/storage-advanced.test.ts[2m > [22mAdvanced Storage Integration[2m > [22mUser Management Edge Cases[2m > [22mhandles multiple concurrent user lookups[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/storage-advanced.test.ts[2m > [22mAdvanced Storage Integration[2m > [22mUser Management Edge Cases[2m > [22mreturns undefined for non-existent users[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/storage-advanced.test.ts[2m > [22mAdvanced Storage Integration[2m > [22mDocument Filtering[2m > [22mfilters documents correctly[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/storage-advanced.test.ts[2m > [22mAdvanced Storage Integration[2m > [22mGap Analysis and Compliance[2m > [22mmanages gap analysis reports[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/storage-advanced.test.ts[2m > [22mAdvanced Storage Integration[2m > [22mGap Analysis and Compliance[2m > [22mupdates control statuses[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/storage-advanced.test.ts[2m > [22mAdvanced Storage Integration[2m > [22mUser Operations Extension[2m > [22mpaginates users correctly[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/storage-advanced.test.ts[2m > [22mAdvanced Storage Integration[2m > [22mUser Operations Extension[2m > [22msuspends and reactivates users[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/storage-advanced.test.ts[2m > [22mAdvanced Storage Integration[2m > [22mInvitations[2m > [22mmanages user invitations[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/storage-advanced.test.ts[2m > [22mAdvanced Storage Integration[2m > [22mSessions[2m > [22mmanages user sessions[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/storage-advanced.test.ts[2m > [22mAdvanced Storage Integration[2m > [22mNotifications[2m > [22mmanages notifications[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/storage-advanced.test.ts[2m > [22mAdvanced Storage Integration[2m > [22mAudit Trail[2m > [22mcreates and retrieves audit entries[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/storage-advanced.test.ts[2m > [22mAdvanced Storage Integration[2m > [22mDocument Approvals[2m > [22mmanages document approvals[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/storage-advanced.test.ts[2m > [22mAdvanced Storage Integration[2m > [22mUser Operations Bulk & Delete[2m > [22mdeletes and bulk updates users[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/storage-advanced.test.ts[2m > [22mAdvanced Storage Integration[2m > [22mOrganization & Memberships[2m > [22mmanages organizations and memberships[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/storage-advanced.test.ts[2m > [22mAdvanced Storage Integration[2m > [22mGeneration Jobs[2m > [22mmanages generation jobs[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/storage-advanced.test.ts[2m > [22mAdvanced Storage Integration[2m > [22mAudit & Utilities Final[2m > [22mcleans up sessions and handles contacts[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/documentTemplates.test.ts[2m > [22mDocumentTemplateService[2m > [22mgetTemplatesByFramework[2m > [22mreturns templates for valid framework[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/documentTemplates.test.ts[2m > [22mDocumentTemplateService[2m > [22mgetTemplatesByFramework[2m > [22mreturns empty array for invalid framework[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/documentTemplates.test.ts[2m > [22mDocumentTemplateService[2m > [22mgetTemplateById[2m > [22mfinds existing template[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/documentTemplates.test.ts[2m > [22mDocumentTemplateService[2m > [22mgetTemplateById[2m > [22mreturns null for non-existent template[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/documentTemplates.test.ts[2m > [22mDocumentTemplateService[2m > [22mvalidateTemplateVariables[2m > [22mvalidates required variables[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/documentTemplates.test.ts[2m > [22mDocumentTemplateService[2m > [22mgenerateDocument[2m > [22mreplaces variables in content[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/documentTemplates.test.ts[2m > [22mDocumentTemplateService[2m > [22mgenerateDocument[2m > [22mhandles missing variables placeholders[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/documentTemplates.test.ts[2m > [22mDocumentTemplateService[2m > [22mqueryTemplates[2m > [22mfilters by framework[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/frameworkSpreadsheetService.test.ts[2m > [22mFrameworkSpreadsheetService[2m > [22mgetSpreadsheetTemplates[2m > [22mreturns mapped templates for ISO27001[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/frameworkSpreadsheetService.test.ts[2m > [22mFrameworkSpreadsheetService[2m > [22mgetSpreadsheetTemplates[2m > [22mreturns empty fields if profile is missing data[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/frameworkSpreadsheetService.test.ts[2m > [22mFrameworkSpreadsheetService[2m > [22mgetSpreadsheetTemplates[2m > [22mthrows error for invalid framework[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/frameworkSpreadsheetService.test.ts[2m > [22mFrameworkSpreadsheetService[2m > [22mautofillTemplateFields[2m > [22muses AI to fill fields[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/frameworkSpreadsheetService.test.ts[2m > [22mFrameworkSpreadsheetService[2m > [22mautofillTemplateFields[2m > [22mhandles invalid JSON from AI[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/frameworkSpreadsheetService.test.ts[2m > [22mFrameworkSpreadsheetService[2m > [22mautofillTemplateFields[2m > [22mreturns empty array if field list is empty[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/frameworkSpreadsheetService.test.ts[2m > [22mFrameworkSpreadsheetService[2m > [22msaveTemplateData[2m > [22mpersists data in memory[32m 0[2mms[22m[39m
stderr | tests/unit/chatbot.test.ts
The `fetchConnectionCache` option is deprecated (now always `true`)

 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/dataResidencyService.test.ts[2m > [22mDataResidencyService[2m > [22mcreatePolicy[2m > [22mshould create a new policy[32m 7[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/dataResidencyService.test.ts[2m > [22mDataResidencyService[2m > [22mcreatePolicy[2m > [22mshould throw error on creation failure[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/dataResidencyService.test.ts[2m > [22mDataResidencyService[2m > [22mvalidateRegion[2m > [22mshould allow if no policies match data type[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/dataResidencyService.test.ts[2m > [22mDataResidencyService[2m > [22mvalidateRegion[2m > [22mshould block if region is in blockedRegions[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/dataResidencyService.test.ts[2m > [22mDataResidencyService[2m > [22mvalidateRegion[2m > [22mshould block if strict enforcement and region not in allowedRegions[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/dataResidencyService.test.ts[2m > [22mDataResidencyService[2m > [22mvalidateRegion[2m > [22mshould allow if region is in allowedRegions[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/chatbot.test.ts[2m > [22mComplianceChatbot[2m > [22mprocessMessage[2m > [22mblocks disallowed input[32m 4[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/chatbot.test.ts[2m > [22mComplianceChatbot[2m > [22mprocessMessage[2m > [22msanitizes input before processing[32m 6[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/chatbot.test.ts[2m > [22mComplianceChatbot[2m > [22mprocessMessage[2m > [22mreturns parsed structured response[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/chatbot.test.ts[2m > [22mComplianceChatbot[2m > [22mprocessMessage[2m > [22mfalls back to text analysis if JSON parsing fails[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/chatbot.test.ts[2m > [22mComplianceChatbot[2m > [22mprocessMessage[2m > [22mfalls back to OpenAI if Anthropic fails[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/chatbot.test.ts[2m > [22mComplianceChatbot[2m > [22mprocessMessage[2m > [22mhandles output guardrails blocking[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/chatbot.test.ts[2m > [22mComplianceChatbot[2m > [22mgenerateConversationTitle[2m > [22mgenerates title using OpenAI[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/chatbot.test.ts[2m > [22mComplianceChatbot[2m > [22mgenerateConversationTitle[2m > [22mreturns default title on failure[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/chatbot.test.ts[2m > [22mComplianceChatbot[2m > [22mgetSuggestedQuestions[2m > [22mreturns framework specific questions[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/chatbot.test.ts[2m > [22mComplianceChatbot[2m > [22mgetSuggestedQuestions[2m > [22mreturns default questions for unknown framework[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/aiModels.test.ts[2m > [22mAI Models Configuration[2m > [22mshould have defined model configurations[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/aiModels.test.ts[2m > [22mAI Models Configuration[2m > [22mshould have correct OPENAI configuration[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/aiModels.test.ts[2m > [22mAI Models Configuration[2m > [22mshould have correct ANTHROPIC configuration[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/aiModels.test.ts[2m > [22mAI Models Configuration[2m > [22mshould have correct GOOGLE configuration[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/aiModels.test.ts[2m > [22mModel Selection Strategy[2m > [22mshould return correct strategy for COMPLIANCE_GENERATION[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/aiModels.test.ts[2m > [22mModel Selection Strategy[2m > [22mshould return correct strategy for RISK_ANALYSIS[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/aiModels.test.ts[2m > [22mModel Selection Strategy[2m > [22mshould return correct strategy for LARGE_CONTEXT[32m 0[2mms[22m[39m
stderr | tests/unit/documents.test.ts
The `fetchConnectionCache` option is deprecated (now always `true`)

 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mcp-core.test.ts[2m > [22mMCP Core Unit Tests[2m > [22minitialize.ts[2m > [22minitializeMCP should register tools and agents[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mcp-core.test.ts[2m > [22mMCP Core Unit Tests[2m > [22minitialize.ts[2m > [22mgetRecommendedAgent should return correct agent IDs[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mcp-core.test.ts[2m > [22mMCP Core Unit Tests[2m > [22mintegration.ts[2m > [22mprocessChatMessage should wrap chatbot service[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mcp-core.test.ts[2m > [22mMCP Core Unit Tests[2m > [22mintegration.ts[2m > [22mprocessChatMessage should handle errors[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mcp-core.test.ts[2m > [22mMCP Core Unit Tests[2m > [22mintegration.ts[2m > [22mgenerateWithExistingService should wrap aiOrchestrator[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mcp-core.test.ts[2m > [22mMCP Core Unit Tests[2m > [22mintegration.ts[2m > [22mbatchGenerateWithExistingService should wrap aiOrchestrator[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mcp-core.test.ts[2m > [22mMCP Core Unit Tests[2m > [22mintegration.ts[2m > [22mgetComplianceInsights should wrap aiOrchestrator[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mcp-core.test.ts[2m > [22mMCP Core Unit Tests[2m > [22mintegration.ts[2m > [22manalyzeQualityWithExistingService should wrap aiOrchestrator[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mcp-core.test.ts[2m > [22mMCP Core Unit Tests[2m > [22mintegration.ts[2m > [22mcheckAIServiceHealth should wrap aiOrchestrator[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mcp-core.test.ts[2m > [22mMCP Core Unit Tests[2m > [22mintegration.ts[2m > [22mcheckAIServiceHealth should handle errors[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mcp-core.test.ts[2m > [22mMCP Core Unit Tests[2m > [22mintegration.ts[2m > [22mbatchGenerateWithExistingService should handle errors[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mcp-core.test.ts[2m > [22mMCP Core Unit Tests[2m > [22mintegration.ts[2m > [22mgetComplianceInsights should handle errors[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mcp-core.test.ts[2m > [22mMCP Core Unit Tests[2m > [22mintegration.ts[2m > [22manalyzeQualityWithExistingService should handle errors[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mcp-core.test.ts[2m > [22mMCP Core Unit Tests[2m > [22mintegration.ts[2m > [22mFactory functions[2m > [22mcreateMCPChatbotWrapper should return functioning wrapper[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mcp-core.test.ts[2m > [22mMCP Core Unit Tests[2m > [22mintegration.ts[2m > [22mFactory functions[2m > [22mcreateAgentDocumentGenerator should return functioning generator[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mcp-core.test.ts[2m > [22mMCP Core Unit Tests[2m > [22mintegration.ts[2m > [22mFactory functions[2m > [22mcreateAgentRiskAssessor should return functioning assessor[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mcp-core.test.ts[2m > [22mMCP Core Unit Tests[2m > [22mintegration.ts[2m > [22mMCPLegacyAdapter[2m > [22mexecuteTool should call toolRegistry[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mcp-core.test.ts[2m > [22mMCP Core Unit Tests[2m > [22mintegration.ts[2m > [22mMCPLegacyAdapter[2m > [22mexecuteAgent should call agentClient[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/documents.test.ts[2m > [22mDocument Unit Tests[2m > [22mDocument CRUD Operations[2m > [22mshould create a document with valid data[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/documents.test.ts[2m > [22mDocument Unit Tests[2m > [22mDocument CRUD Operations[2m > [22mshould retrieve a document by ID[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/documents.test.ts[2m > [22mDocument Unit Tests[2m > [22mDocument CRUD Operations[2m > [22mshould return undefined for non-existent document[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/documents.test.ts[2m > [22mDocument Unit Tests[2m > [22mDocument CRUD Operations[2m > [22mshould update a document[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/documents.test.ts[2m > [22mDocument Unit Tests[2m > [22mDocument CRUD Operations[2m > [22mshould delete a document[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/documents.test.ts[2m > [22mDocument Unit Tests[2m > [22mDocument Filtering[2m > [22mshould get all documents[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/documents.test.ts[2m > [22mDocument Unit Tests[2m > [22mDocument Filtering[2m > [22mshould filter documents by framework[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/documents.test.ts[2m > [22mDocument Unit Tests[2m > [22mDocument Filtering[2m > [22mshould filter documents by company profile[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/documents.test.ts[2m > [22mDocument Unit Tests[2m > [22mDocument Filtering[2m > [22mshould return empty array for non-existent company profile[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/documents.test.ts[2m > [22mDocument Unit Tests[2m > [22mDocument Status Management[2m > [22mshould create document with draft status[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/documents.test.ts[2m > [22mDocument Unit Tests[2m > [22mDocument Status Management[2m > [22mshould update document status to published[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/documents.test.ts[2m > [22mDocument Unit Tests[2m > [22mDocument Status Management[2m > [22mshould update document status to archived[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/documents.test.ts[2m > [22mDocument Unit Tests[2m > [22mDocument Version Management[2m > [22mshould create document with version[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/documents.test.ts[2m > [22mDocument Unit Tests[2m > [22mDocument Version Management[2m > [22mshould increment document version on update[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/documents.test.ts[2m > [22mDocument Unit Tests[2m > [22mDocument Frameworks[2m > [22mshould create document for SOC2 framework[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/documents.test.ts[2m > [22mDocument Unit Tests[2m > [22mDocument Frameworks[2m > [22mshould create document for ISO27001 framework[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/documents.test.ts[2m > [22mDocument Unit Tests[2m > [22mDocument Frameworks[2m > [22mshould create document for FedRAMP framework[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/documents.test.ts[2m > [22mDocument Unit Tests[2m > [22mDocument Frameworks[2m > [22mshould create document for NIST framework[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/documents.test.ts[2m > [22mDocument Unit Tests[2m > [22mDocument Categories[2m > [22mshould create document with policy category[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/documents.test.ts[2m > [22mDocument Unit Tests[2m > [22mDocument Categories[2m > [22mshould create document with procedure category[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/documents.test.ts[2m > [22mDocument Unit Tests[2m > [22mDocument Categories[2m > [22mshould create document with guideline category[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/documents.test.ts[2m > [22mDocument Unit Tests[2m > [22mDocument Categories[2m > [22mshould create document with standard category[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/documents.test.ts[2m > [22mDocument Unit Tests[2m > [22mDocument Categories[2m > [22mshould create document with control category[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/documentWorkflowService.test.ts[2m > [22mDocumentWorkflowService[2m > [22mexecuteTransition[2m > [22mshould transition from draft to review[32m 5[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/documentWorkflowService.test.ts[2m > [22mDocumentWorkflowService[2m > [22mexecuteTransition[2m > [22mshould require approval to transition from review to approved[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/documentWorkflowService.test.ts[2m > [22mDocumentWorkflowService[2m > [22mexecuteTransition[2m > [22mshould fail with invalid transition[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/documentWorkflowService.test.ts[2m > [22mDocumentWorkflowService[2m > [22mcreateApprovalRequest[2m > [22mshould create approval request for document in review[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/qualityScoring.test.ts[2m > [22mQualityScoringService[2m > [22manalyzeDocumentQuality[2m > [22manalyzes quality and checks Anthropic call[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/qualityScoring.test.ts[2m > [22mQualityScoringService[2m > [22manalyzeDocumentQuality[2m > [22mhandles parsing errors gracefully[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/qualityScoring.test.ts[2m > [22mQualityScoringService[2m > [22manalyzeContentStructure[2m > [22manalyzes structure using OpenAI[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/qualityScoring.test.ts[2m > [22mQualityScoringService[2m > [22manalyzeContentStructure[2m > [22mreturns defaults on error[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/qualityScoring.test.ts[2m > [22mQualityScoringService[2m > [22mcheckFrameworkAlignment[2m > [22mchecks alignment[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/qualityScoring.test.ts[2m > [22mQualityScoringService[2m > [22mbenchmarkDocument[2m > [22mcalculates benchmarks[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/qualityScoring.test.ts[2m > [22mQualityScoringService[2m > [22mtrackQualityTrends[2m > [22midentifies improving trend[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/qualityScoring.test.ts[2m > [22mQualityScoringService[2m > [22mtrackQualityTrends[2m > [22mhandles insufficient data[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/logSanitizer.test.ts[2m > [22mlogSanitizer[2m > [22msanitizeString[2m > [22mmasks emails[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/logSanitizer.test.ts[2m > [22mlogSanitizer[2m > [22msanitizeString[2m > [22mmasks IPv4[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/logSanitizer.test.ts[2m > [22mlogSanitizer[2m > [22msanitizeString[2m > [22mmasks IPv6[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/logSanitizer.test.ts[2m > [22mlogSanitizer[2m > [22msanitizeString[2m > [22mmasks credit cards[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/logSanitizer.test.ts[2m > [22mlogSanitizer[2m > [22msanitizeString[2m > [22mmasks sensitive headers/tokens[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/logSanitizer.test.ts[2m > [22mlogSanitizer[2m > [22msanitizeObject[2m > [22mrecursively sanitizes[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/logSanitizer.test.ts[2m > [22mlogSanitizer[2m > [22msanitizeObject[2m > [22mredacts sensitive keys[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/logSanitizer.test.ts[2m > [22mlogSanitizer[2m > [22msanitizeRequestForLogging[2m > [22msanitizes request parts[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/metrics.test.ts[2m > [22mMetricsCollector[2m > [22mshould initialize with empty metrics[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/metrics.test.ts[2m > [22mMetricsCollector[2m > [22mshould track AI operations[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/metrics.test.ts[2m > [22mMetricsCollector[2m > [22mshould track database operations[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/metrics.test.ts[2m > [22mMetricsCollector[2m > [22mshould track security events[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/metrics.test.ts[2m > [22mMetricsCollector[2m > [22mshould collect request metrics via middleware[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/metrics.test.ts[2m > [22mMetricsCollector[2m > [22mshould compute p95 and throughput[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/metrics.test.ts[2m > [22mMetricsCollector[2m > [22mshould reset metrics[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/qualityScoringService.test.ts[2m > [22mQualityScoringService[2m > [22manalyzeDocumentQuality[2m > [22mshould analyze quality successfully[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/qualityScoringService.test.ts[2m > [22mQualityScoringService[2m > [22manalyzeContentStructure[2m > [22mshould analyze structure[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/qualityScoringService.test.ts[2m > [22mQualityScoringService[2m > [22mcheckFrameworkAlignment[2m > [22mshould check alignment[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/qualityScoringService.test.ts[2m > [22mQualityScoringService[2m > [22mtrackQualityTrends[2m > [22mshould track improving trend[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/qualityScoringService.test.ts[2m > [22mQualityScoringService[2m > [22mtrackQualityTrends[2m > [22mshould handle insufficient data[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/dataRetentionService.test.ts[2m > [22mDataRetentionService[2m > [22mcreatePolicy[2m > [22mcreates a new policy successfully[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/dataRetentionService.test.ts[2m > [22mDataRetentionService[2m > [22mshouldRetain[2m > [22mreturns retain=true if no policy exists[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/dataRetentionService.test.ts[2m > [22mDataRetentionService[2m > [22mshouldRetain[2m > [22mreturns retain=false if data is older than retention period[32m 5[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/storage-db.test.ts[2m > [22mDatabaseStorage Comprehensive Coverage[2m > [22mOrganization & User-Org Operations[2m > [22mcovers organizations[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/storage-db.test.ts[2m > [22mDatabaseStorage Comprehensive Coverage[2m > [22mOrganization & User-Org Operations[2m > [22mcovers memberships[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/storage-db.test.ts[2m > [22mDatabaseStorage Comprehensive Coverage[2m > [22mCompany Profile & Documents[2m > [22mcovers profiles[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/storage-db.test.ts[2m > [22mDatabaseStorage Comprehensive Coverage[2m > [22mCompany Profile & Documents[2m > [22mcovers documents[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/storage-db.test.ts[2m > [22mDatabaseStorage Comprehensive Coverage[2m > [22mCompany Profile & Documents[2m > [22mcovers document versions[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/storage-db.test.ts[2m > [22mDatabaseStorage Comprehensive Coverage[2m > [22mGap Analysis & Compliance[2m > [22mcovers reports and findings[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/storage-db.test.ts[2m > [22mDatabaseStorage Comprehensive Coverage[2m > [22mGap Analysis & Compliance[2m > [22mcovers remediation and maturity[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/storage-db.test.ts[2m > [22mDatabaseStorage Comprehensive Coverage[2m > [22mAudit, Notifications & Others[2m > [22mcovers audit logs[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/storage-db.test.ts[2m > [22mDatabaseStorage Comprehensive Coverage[2m > [22mAudit, Notifications & Others[2m > [22mcovers remaining operations[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/cloudIntegrationService.test.ts[2m > [22mCloudIntegrationService[2m > [22mcreateIntegration[2m > [22mshould create integration successfully[32m 4[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/cloudIntegrationService.test.ts[2m > [22mCloudIntegrationService[2m > [22msyncFiles[2m > [22mshould sync google drive files[32m 6[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/cloudIntegrationService.test.ts[2m > [22mCloudIntegrationService[2m > [22msyncFiles[2m > [22mshould handle inactive integration[32m 3[2mms[22m[39m
stderr | tests/unit/mcp-tools.test.ts
The `fetchConnectionCache` option is deprecated (now always `true`)

 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mcp-tools.test.ts[2m > [22mMCP Tools Implementation[2m > [22mAdvanced Tools[2m > [22mgetDocumentTemplatesTool should fetch templates[32m 5[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mcp-tools.test.ts[2m > [22mMCP Tools Implementation[2m > [22mAdvanced Tools[2m > [22mgetFrameworkInfoTool should return framework details[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mcp-tools.test.ts[2m > [22mMCP Tools Implementation[2m > [22mAdvanced Tools[2m > [22mbatchGenerateDocumentsTool should orchestrate generation[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mcp-tools.test.ts[2m > [22mMCP Tools Implementation[2m > [22mAdvanced Tools[2m > [22mcalculateComplianceScoreTool should compute scores[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mcp-tools.test.ts[2m > [22mMCP Tools Implementation[2m > [22mInternal Tools[2m > [22mgetCompanyProfileTool should fetch profile[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mcp-tools.test.ts[2m > [22mMCP Tools Implementation[2m > [22mInternal Tools[2m > [22mgetDocumentsTool should filter documents[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mcp-tools.test.ts[2m > [22mMCP Tools Implementation[2m > [22mInternal Tools[2m > [22mgenerateDocumentTool should call orchestrator[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mcp-tools.test.ts[2m > [22mMCP Tools Implementation[2m > [22mExternal Tools[2m > [22mwebSearchTool should return simulated results[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/mcp-tools.test.ts[2m > [22mMCP Tools Implementation[2m > [22mExternal Tools[2m > [22mfetchUrlTool should block local addresses[32m 1[2mms[22m[39m
stderr | tests/unit/auth.test.ts
The `fetchConnectionCache` option is deprecated (now always `true`)

 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/auth.test.ts[2m > [22mAuthentication Unit Tests[2m > [22mUser Creation and Authentication[2m > [22mshould create a user with valid data[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/auth.test.ts[2m > [22mAuthentication Unit Tests[2m > [22mUser Creation and Authentication[2m > [22mshould upsert user on login[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/auth.test.ts[2m > [22mAuthentication Unit Tests[2m > [22mUser Creation and Authentication[2m > [22mshould find user by email for login[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/auth.test.ts[2m > [22mAuthentication Unit Tests[2m > [22mUser Creation and Authentication[2m > [22mshould return undefined for non-existent email[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/auth.test.ts[2m > [22mAuthentication Unit Tests[2m > [22mRole-Based Access Control[2m > [22mshould create user with default role[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/auth.test.ts[2m > [22mAuthentication Unit Tests[2m > [22mRole-Based Access Control[2m > [22mshould create admin user[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/auth.test.ts[2m > [22mAuthentication Unit Tests[2m > [22mRole-Based Access Control[2m > [22mshould update user role[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/auth.test.ts[2m > [22mAuthentication Unit Tests[2m > [22mOrganization Membership[2m > [22mshould add user to organization[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/auth.test.ts[2m > [22mAuthentication Unit Tests[2m > [22mOrganization Membership[2m > [22mshould get user organizations[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/auth.test.ts[2m > [22mAuthentication Unit Tests[2m > [22mOrganization Membership[2m > [22mshould update user organization role[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/auth.test.ts[2m > [22mAuthentication Unit Tests[2m > [22mOrganization Membership[2m > [22mshould remove user from organization[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/auth.test.ts[2m > [22mAuthentication Unit Tests[2m > [22mSession Management[2m > [22mshould create user sessions[32m 0[2mms[22m[39m
stderr | tests/unit/storage.test.ts
The `fetchConnectionCache` option is deprecated (now always `true`)

 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/storage.test.ts[2m > [22mStorage Layer Tests[2m > [22mUser Operations[2m > [22mshould create and retrieve users[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/storage.test.ts[2m > [22mStorage Layer Tests[2m > [22mUser Operations[2m > [22mshould find users by email[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/storage.test.ts[2m > [22mStorage Layer Tests[2m > [22mUser Operations[2m > [22mshould update user information[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/storage.test.ts[2m > [22mStorage Layer Tests[2m > [22mOrganization Operations[2m > [22mshould create and manage organizations[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/storage.test.ts[2m > [22mStorage Layer Tests[2m > [22mOrganization Operations[2m > [22mshould find organizations by slug[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/unit/storage.test.ts[2m > [22mStorage Layer Tests[2m > [22mCompany Profile Operations[2m > [22mshould create company profiles with proper structure[32m 1[2mms[22m[39m
[90mstdout[2m | tests/integration/e2e-flows.test.ts[2m > [22m[2mE2E Flow Tests
[22m[39m[32m2026-01-23T16:49:03.279Z [INFO] API documentation disabled in production (set ENABLE_SWAGGER=true to enable)[0m

[90mstdout[2m | tests/integration/api.test.ts[2m > [22m[2mAPI Integration Tests
[22m[39m[32m2026-01-23T16:49:03.280Z [INFO] API documentation disabled in production (set ENABLE_SWAGGER=true to enable)[0m

[90mstdout[2m | tests/integration/auth.test.ts[2m > [22m[2mAuthentication Integration Tests
[22m[39m[32m2026-01-23T16:49:03.280Z [INFO] API documentation disabled in production (set ENABLE_SWAGGER=true to enable)[0m

 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/ai-components.test.tsx[2m > [22mAIInsightsDashboard[2m > [22mshould render with correct initial state[32m 165[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/ai-components.test.tsx[2m > [22mAIInsightsDashboard[2m > [22mshould render AI Powered badge[32m 58[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/ai-components.test.tsx[2m > [22mAIInsightsDashboard[2m > [22mshould display correct compliance score based on props[32m 59[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/ai-components.test.tsx[2m > [22mAIInsightsDashboard[2m > [22mshould animate compliance score over time[32m 48[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/PWAInstallPrompt.test.tsx[2m > [22mPWAInstallPrompt[2m > [22mdoes not render if isStandalone is true[32m 34[2mms[22m[39m
[90mstdout[2m | tests/integration/api.test.ts[2m > [22m[2mAPI Integration Tests[2m > [22m[2mHealth Endpoints[2m > [22m[2mshould return system health status (may be degraded in test)
[22m[39m[32m2026-01-23T16:49:07.664Z [INFO] GET /health {"method":"GET","url":"/health","ip":"[IP_REDACTED]:[IP_REDACTED]","timestamp":"2026-01-23T16:49:07.664Z"}[0m

[90mstdout[2m | tests/integration/auth.test.ts[2m > [22m[2mAuthentication Integration Tests[2m > [22m[2mPublic Endpoints[2m > [22m[2mshould allow access to health check (may be degraded)
[22m[39m[32m2026-01-23T16:49:07.663Z [INFO] GET /health {"method":"GET","url":"/health","ip":"[IP_REDACTED]:[IP_REDACTED]","timestamp":"2026-01-23T16:49:07.663Z"}[0m

stderr | tests/integration/api.test.ts > API Integration Tests > Health Endpoints > should return system health status (may be degraded in test)
Invalid DEPLOYMENT_MODE: "undefined". Expected "cloud" or "local". Defaulting to "cloud".

stderr | tests/integration/auth.test.ts > Authentication Integration Tests > Public Endpoints > should allow access to health check (may be degraded)
Invalid DEPLOYMENT_MODE: "undefined". Expected "cloud" or "local". Defaulting to "cloud".

[90mstdout[2m | tests/integration/e2e-flows.test.ts[2m > [22m[2mE2E Flow Tests[2m > [22m[2mOnboarding Flow[2m > [22m[2mOrganization Setup[2m > [22m[2mshould require authentication for organization creation
[22m[39m{"type":"request_start","traceId":"6587a624-005b-4313-a52d-c5bdab6550cb","spanId":"688bfd93","method":"POST","path":"/api/organizations","ip":"::ffff:127.0.0.1","timestamp":"2026-01-23T16:49:07.700Z"}

 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/profile/ProfileForm.test.tsx[2m > [22mProfileForm[2m > [22mrenders with default empty values when no profile provided[32m 101[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/profile/ProfileForm.test.tsx[2m > [22mProfileForm[2m > [22mrenders with profile values[32m 30[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/profile/ProfileForm.test.tsx[2m > [22mProfileForm[2m > [22mdisables submit button when loading[32m 22[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/admin/OAuthSettings.test.tsx[2m > [22mOAuthSettings[2m > [22mrenders form fields[32m 126[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/admin/OAuthSettings.test.tsx[2m > [22mOAuthSettings[2m > [22mtoggles secret visibility[32m 29[2mms[22m[39m
[90mstdout[2m | tests/integration/e2e-flows.test.ts[2m > [22m[2mE2E Flow Tests[2m > [22m[2mOnboarding Flow[2m > [22m[2mOrganization Setup[2m > [22m[2mshould require authentication for organization creation
[22m[39m[32m2026-01-23T16:49:07.703Z [INFO] POST /api/organizations {"method":"POST","url":"/api/organizations","ip":"[IP_REDACTED]:[IP_REDACTED]","timestamp":"2026-01-23T16:49:07.703Z"}[0m
[32m2026-01-23T16:49:07.729Z [INFO] API route accessed {"path":"/api/organizations","method":"POST","requiresAuth":true,"requiresMfa":true,"rateLimitTier":"high","ip":"[IP_REDACTED]:[IP_REDACTED]"}[0m

[90mstdout[2m | tests/integration/e2e-flows.test.ts[2m > [22m[2mE2E Flow Tests[2m > [22m[2mOnboarding Flow[2m > [22m[2mOrganization Setup[2m > [22m[2mshould require authentication for organization creation
[22m[39m{"type":"request_end","traceId":"6587a624-005b-4313-a52d-c5bdab6550cb","spanId":"688bfd93","method":"POST","path":"/api/organizations","statusCode":401,"duration":39,"timestamp":"2026-01-23T16:49:07.739Z"}

 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/e2e-flows.test.ts[2m > [22mE2E Flow Tests[2m > [22mOnboarding Flow[2m > [22mOrganization Setup[2m > [22mshould require authentication for organization creation[32m 99[2mms[22m[39m
[90mstdout[2m | tests/integration/e2e-flows.test.ts[2m > [22m[2mE2E Flow Tests[2m > [22m[2mOnboarding Flow[2m > [22m[2mOrganization Setup[2m > [22m[2mshould require authentication to list organizations
[22m[39m{"type":"request_start","traceId":"4870f58d-e497-4f7c-9e72-2f41e82c1669","spanId":"1eb86036","method":"GET","path":"/api/organizations","ip":"::ffff:127.0.0.1","timestamp":"2026-01-23T16:49:07.750Z"}

 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/dashboard/CompanyProfileSummary.test.tsx[2m > [22mCompanyProfileSummary[2m > [22mrenders profile information[32m 66[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/dashboard/CompanyProfileSummary.test.tsx[2m > [22mCompanyProfileSummary[2m > [22mdoes not render if profile is missing[32m 4[2mms[22m[39m
[90mstdout[2m | tests/integration/e2e-flows.test.ts[2m > [22m[2mE2E Flow Tests[2m > [22m[2mOnboarding Flow[2m > [22m[2mOrganization Setup[2m > [22m[2mshould require authentication to list organizations
[22m[39m[32m2026-01-23T16:49:07.751Z [INFO] GET /api/organizations {"method":"GET","url":"/api/organizations","ip":"[IP_REDACTED]:[IP_REDACTED]","timestamp":"2026-01-23T16:49:07.751Z"}[0m
[32m2026-01-23T16:49:07.752Z [INFO] API route accessed {"path":"/api/organizations","method":"GET","requiresAuth":true,"requiresMfa":false,"rateLimitTier":"medium","ip":"[IP_REDACTED]:[IP_REDACTED]"}[0m

[90mstdout[2m | tests/integration/e2e-flows.test.ts[2m > [22m[2mE2E Flow Tests[2m > [22m[2mOnboarding Flow[2m > [22m[2mOrganization Setup[2m > [22m[2mshould require authentication to list organizations
[22m[39m{"type":"request_end","traceId":"4870f58d-e497-4f7c-9e72-2f41e82c1669","spanId":"1eb86036","method":"GET","path":"/api/organizations","statusCode":401,"duration":6,"timestamp":"2026-01-23T16:49:07.756Z"}

[90mstdout[2m | tests/integration/e2e-flows.test.ts[2m > [22m[2mE2E Flow Tests[2m > [22m[2mOnboarding Flow[2m > [22m[2mCompany Profile Creation[2m > [22m[2mshould require authentication for company profile creation
[22m[39m{"type":"request_start","traceId":"b63fbbc4-f9b8-4dd9-b498-40cce5684978","spanId":"4cc65cfa","method":"POST","path":"/api/company-profiles","ip":"::ffff:127.0.0.1","timestamp":"2026-01-23T16:49:07.768Z"}

[90mstdout[2m | tests/integration/e2e-flows.test.ts[2m > [22m[2mE2E Flow Tests[2m > [22m[2mOnboarding Flow[2m > [22m[2mCompany Profile Creation[2m > [22m[2mshould require authentication for company profile creation
[22m[39m[32m2026-01-23T16:49:07.769Z [INFO] POST /api/company-profiles {"method":"POST","url":"/api/company-profiles","ip":"[IP_REDACTED]:[IP_REDACTED]","timestamp":"2026-01-23T16:49:07.769Z"}[0m
[32m2026-01-23T16:49:07.770Z [INFO] API route accessed {"path":"/api/company-profiles","method":"POST","requiresAuth":true,"requiresMfa":true,"rateLimitTier":"high","ip":"[IP_REDACTED]:[IP_REDACTED]"}[0m

[90mstdout[2m | tests/integration/e2e-flows.test.ts[2m > [22m[2mE2E Flow Tests[2m > [22m[2mOnboarding Flow[2m > [22m[2mCompany Profile Creation[2m > [22m[2mshould require authentication for company profile creation
[22m[39m{"type":"request_end","traceId":"b63fbbc4-f9b8-4dd9-b498-40cce5684978","spanId":"4cc65cfa","method":"POST","path":"/api/company-profiles","statusCode":401,"duration":4,"timestamp":"2026-01-23T16:49:07.772Z"}

[90mstdout[2m | tests/integration/e2e-flows.test.ts[2m > [22m[2mE2E Flow Tests[2m > [22m[2mOnboarding Flow[2m > [22m[2mCompany Profile Creation[2m > [22m[2mshould require authentication to get company profile
[22m[39m{"type":"request_start","traceId":"d7134c6c-01b7-46e8-944e-a6e0b835ad8e","spanId":"3ae3275f","method":"GET","path":"/api/company-profiles","ip":"::ffff:127.0.0.1","timestamp":"2026-01-23T16:49:07.779Z"}

 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/ai-components.test.tsx[2m > [22mAIInsightsDashboard[2m > [22mshould show low risk level when score is above 70[32m 54[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/ai-components.test.tsx[2m > [22mAIInsightsDashboard[2m > [22mshould show medium risk level when score is between 40-70[32m 44[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/ai-components.test.tsx[2m > [22mAIInsightsDashboard[2m > [22mshould show high risk level when score is below 40[32m 52[2mms[22m[39m
[90mstdout[2m | tests/integration/e2e-flows.test.ts[2m > [22m[2mE2E Flow Tests[2m > [22m[2mOnboarding Flow[2m > [22m[2mCompany Profile Creation[2m > [22m[2mshould require authentication to get company profile
[22m[39m[32m2026-01-23T16:49:07.780Z [INFO] GET /api/company-profiles {"method":"GET","url":"/api/company-profiles","ip":"[IP_REDACTED]:[IP_REDACTED]","timestamp":"2026-01-23T16:49:07.780Z"}[0m
[32m2026-01-23T16:49:07.780Z [INFO] API route accessed {"path":"/api/company-profiles","method":"GET","requiresAuth":true,"requiresMfa":false,"rateLimitTier":"medium","ip":"[IP_REDACTED]:[IP_REDACTED]"}[0m

 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/dashboard/CompanyProfileSummary.test.tsx[2m > [22mCompanyProfileSummary[2m > [22mcalls onEdit when edit button clicked[32m 278[2mms[22m[39m
[90mstdout[2m | tests/integration/e2e-flows.test.ts[2m > [22m[2mE2E Flow Tests[2m > [22m[2mOnboarding Flow[2m > [22m[2mCompany Profile Creation[2m > [22m[2mshould require authentication to get company profile
[22m[39m{"type":"request_end","traceId":"d7134c6c-01b7-46e8-944e-a6e0b835ad8e","spanId":"3ae3275f","method":"GET","path":"/api/company-profiles","statusCode":401,"duration":31,"timestamp":"2026-01-23T16:49:07.810Z"}

stderr | tests/integration/auth.test.ts > Authentication Integration Tests > Public Endpoints > should allow access to health check (may be degraded)
2026-01-23T16:49:07.814Z [ERROR] Database health check failed {"error":"Unknown error"}

[90mstdout[2m | tests/integration/e2e-flows.test.ts[2m > [22m[2mE2E Flow Tests[2m > [22m[2mOnboarding Flow[2m > [22m[2mInitial Framework Selection[2m > [22m[2mshould require authentication to update framework preferences
[22m[39m{"type":"request_start","traceId":"522555db-6138-47f0-a137-bd487154fa92","spanId":"5cbdb62c","method":"PATCH","path":"/api/company-profiles/1","ip":"::ffff:127.0.0.1","timestamp":"2026-01-23T16:49:07.838Z"}

[90mstdout[2m | tests/integration/auth.test.ts[2m > [22m[2mAuthentication Integration Tests[2m > [22m[2mPublic Endpoints[2m > [22m[2mshould allow access to AI health endpoint
[22m[39m[32m2026-01-23T16:49:07.834Z [INFO] GET /api/ai/health {"method":"GET","url":"/api/ai/health","ip":"[IP_REDACTED]:[IP_REDACTED]","timestamp":"2026-01-23T16:49:07.834Z"}[0m
[32m2026-01-23T16:49:07.837Z [INFO] API route accessed {"path":"/api/ai/health","method":"GET","requiresAuth":false,"requiresMfa":false,"rateLimitTier":"low","ip":"[IP_REDACTED]:[IP_REDACTED]"}[0m

stderr | tests/integration/e2e-flows.test.ts > E2E Flow Tests > Onboarding Flow > Initial Framework Selection > should require authentication to update framework preferences
2026-01-23T16:49:07.839Z [WARN] Unknown API route accessed {"path":"/api/company-profiles/1","method":"PATCH","ip":"[IP_REDACTED]:[IP_REDACTED]"}

[90mstdout[2m | tests/integration/e2e-flows.test.ts[2m > [22m[2mE2E Flow Tests[2m > [22m[2mOnboarding Flow[2m > [22m[2mInitial Framework Selection[2m > [22m[2mshould require authentication to update framework preferences
[22m[39m[32m2026-01-23T16:49:07.839Z [INFO] PATCH /api/company-profiles/1 {"method":"PATCH","url":"/api/company-profiles/1","ip":"[IP_REDACTED]:[IP_REDACTED]","timestamp":"2026-01-23T16:49:07.839Z"}[0m

[90mstdout[2m | tests/integration/e2e-flows.test.ts[2m > [22m[2mE2E Flow Tests[2m > [22m[2mOnboarding Flow[2m > [22m[2mInitial Framework Selection[2m > [22m[2mshould require authentication to update framework preferences
[22m[39m{"type":"request_end","traceId":"522555db-6138-47f0-a137-bd487154fa92","spanId":"5cbdb62c","method":"PATCH","path":"/api/company-profiles/1","statusCode":401,"duration":3,"timestamp":"2026-01-23T16:49:07.841Z"}

stderr | tests/integration/api.test.ts > API Integration Tests > Health Endpoints > should return system health status (may be degraded in test)
2026-01-23T16:49:07.846Z [ERROR] Database health check failed {"error":"Unknown error"}

 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/PWAInstallPrompt.test.tsx[2m > [22mPWAInstallPrompt[2m > [22mrenders desktop/android prompt when triggered[33m 318[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/PWAInstallPrompt.test.tsx[2m > [22mPWAInstallPrompt[2m > [22mrenders IOS prompt when isIOS is true[32m 11[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/PWAInstallPrompt.test.tsx[2m > [22mPWAInstallPrompt[2m > [22mdismisses prompt when close button clicked[32m 33[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/e2e-flows.test.ts[2m > [22mE2E Flow Tests[2m > [22mOnboarding Flow[2m > [22mOrganization Setup[2m > [22mshould require authentication to list organizations[32m 12[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/e2e-flows.test.ts[2m > [22mE2E Flow Tests[2m > [22mOnboarding Flow[2m > [22mCompany Profile Creation[2m > [22mshould require authentication for company profile creation[32m 17[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/e2e-flows.test.ts[2m > [22mE2E Flow Tests[2m > [22mOnboarding Flow[2m > [22mCompany Profile Creation[2m > [22mshould require authentication to get company profile[32m 38[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/e2e-flows.test.ts[2m > [22mE2E Flow Tests[2m > [22mOnboarding Flow[2m > [22mInitial Framework Selection[2m > [22mshould require authentication to update framework preferences[32m 31[2mms[22m[39m
[90mstdout[2m | tests/integration/auth.test.ts[2m > [22m[2mAuthentication Integration Tests[2m > [22m[2mProtected Endpoints[2m > [22m[2mshould require authentication for /api/auth/user
[22m[39m{"type":"request_start","traceId":"c2cf868f-04d9-4f88-8676-cbe14ed8ab14","spanId":"3b40e538","method":"GET","path":"/api/auth/user","ip":"::ffff:127.0.0.1","timestamp":"2026-01-23T16:49:07.865Z"}

 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/PWAInstallPrompt.test.tsx[2m > [22mPWAInstallPrompt[2m > [22mcalls showInstallPrompt when install button clicked[32m 180[2mms[22m[39m
[90mstdout[2m | tests/integration/e2e-flows.test.ts[2m > [22m[2mE2E Flow Tests[2m > [22m[2mAI Generation Flow[2m > [22m[2mDocument Generation[2m > [22m[2mshould require authentication for AI document generation
[22m[39m{"type":"request_start","traceId":"4fecb939-1338-4388-85b5-ee83a34c5459","spanId":"c4f2ea62","method":"POST","path":"/api/ai/generate-compliance-docs","ip":"::ffff:127.0.0.1","timestamp":"2026-01-23T16:49:07.871Z"}

[90mstdout[2m | tests/integration/api.test.ts[2m > [22m[2mAPI Integration Tests[2m > [22m[2mHealth Endpoints[2m > [22m[2mshould return AI health status
[22m[39m[32m2026-01-23T16:49:07.867Z [INFO] GET /api/ai/health {"method":"GET","url":"/api/ai/health","ip":"[IP_REDACTED]:[IP_REDACTED]","timestamp":"2026-01-23T16:49:07.867Z"}[0m
[32m2026-01-23T16:49:07.870Z [INFO] API route accessed {"path":"/api/ai/health","method":"GET","requiresAuth":false,"requiresMfa":false,"rateLimitTier":"low","ip":"[IP_REDACTED]:[IP_REDACTED]"}[0m

[90mstdout[2m | tests/integration/e2e-flows.test.ts[2m > [22m[2mE2E Flow Tests[2m > [22m[2mAI Generation Flow[2m > [22m[2mDocument Generation[2m > [22m[2mshould require authentication for AI document generation
[22m[39m[32m2026-01-23T16:49:07.872Z [INFO] POST /api/ai/generate-compliance-docs {"method":"POST","url":"/api/ai/generate-compliance-docs","ip":"[IP_REDACTED]:[IP_REDACTED]","timestamp":"2026-01-23T16:49:07.872Z"}[0m
[32m2026-01-23T16:49:07.872Z [INFO] API route accessed {"path":"/api/ai/generate-compliance-docs","method":"POST","requiresAuth":true,"requiresMfa":false,"rateLimitTier":"high","ip":"[IP_REDACTED]:[IP_REDACTED]"}[0m

[90mstdout[2m | tests/integration/auth.test.ts[2m > [22m[2mAuthentication Integration Tests[2m > [22m[2mProtected Endpoints[2m > [22m[2mshould require authentication for /api/auth/user
[22m[39m[32m2026-01-23T16:49:07.866Z [INFO] GET /api/auth/user {"method":"GET","url":"/api/auth/user","ip":"[IP_REDACTED]:[IP_REDACTED]","timestamp":"2026-01-23T16:49:07.865Z"}[0m
[32m2026-01-23T16:49:07.866Z [INFO] API route accessed {"path":"/api/auth/user","method":"GET","requiresAuth":true,"requiresMfa":false,"rateLimitTier":"medium","ip":"[IP_REDACTED]:[IP_REDACTED]"}[0m

[90mstdout[2m | tests/integration/e2e-flows.test.ts[2m > [22m[2mE2E Flow Tests[2m > [22m[2mAI Generation Flow[2m > [22m[2mDocument Generation[2m > [22m[2mshould require authentication for AI document generation
[22m[39m{"type":"request_end","traceId":"4fecb939-1338-4388-85b5-ee83a34c5459","spanId":"c4f2ea62","method":"POST","path":"/api/ai/generate-compliance-docs","statusCode":401,"duration":3,"timestamp":"2026-01-23T16:49:07.874Z"}

[90mstdout[2m | tests/integration/auth.test.ts[2m > [22m[2mAuthentication Integration Tests[2m > [22m[2mProtected Endpoints[2m > [22m[2mshould require authentication for /api/auth/user
[22m[39m{"type":"request_end","traceId":"c2cf868f-04d9-4f88-8676-cbe14ed8ab14","spanId":"3b40e538","method":"GET","path":"/api/auth/user","statusCode":401,"duration":9,"timestamp":"2026-01-23T16:49:07.874Z"}

[90mstdout[2m | tests/integration/e2e-flows.test.ts[2m > [22m[2mE2E Flow Tests[2m > [22m[2mAI Generation Flow[2m > [22m[2mDocument Generation[2m > [22m[2mshould require authentication for AI document analysis
[22m[39m{"type":"request_start","traceId":"cc29a13f-4547-474e-8298-fea2943ce92f","spanId":"7cf47a2d","method":"POST","path":"/api/ai/analyze-document","ip":"::ffff:127.0.0.1","timestamp":"2026-01-23T16:49:07.879Z"}

[90mstdout[2m | tests/integration/api.test.ts[2m > [22m[2mAPI Integration Tests[2m > [22m[2mAuthentication Required Endpoints[2m > [22m[2mshould require authentication for user profile
[22m[39m{"type":"request_start","traceId":"15ab8525-f62b-48fe-9203-85c5e32ad7cf","spanId":"ef4e15f9","method":"GET","path":"/api/auth/user","ip":"::ffff:127.0.0.1","timestamp":"2026-01-23T16:49:07.880Z"}

[90mstdout[2m | tests/integration/auth.test.ts[2m > [22m[2mAuthentication Integration Tests[2m > [22m[2mProtected Endpoints[2m > [22m[2mshould require authentication for /api/company-profiles
[22m[39m{"type":"request_start","traceId":"a7a35895-62b6-4b4f-8134-f6c287e9fc3b","spanId":"408af037","method":"GET","path":"/api/company-profiles","ip":"::ffff:127.0.0.1","timestamp":"2026-01-23T16:49:07.883Z"}

[90mstdout[2m | tests/integration/e2e-flows.test.ts[2m > [22m[2mE2E Flow Tests[2m > [22m[2mAI Generation Flow[2m > [22m[2mDocument Generation[2m > [22m[2mshould require authentication for AI document analysis
[22m[39m[32m2026-01-23T16:49:07.880Z [INFO] POST /api/ai/analyze-document {"method":"POST","url":"/api/ai/analyze-document","ip":"[IP_REDACTED]:[IP_REDACTED]","timestamp":"2026-01-23T16:49:07.880Z"}[0m
[32m2026-01-23T16:49:07.881Z [INFO] API route accessed {"path":"/api/ai/analyze-document","method":"POST","requiresAuth":true,"requiresMfa":false,"rateLimitTier":"high","ip":"[IP_REDACTED]:[IP_REDACTED]"}[0m

[90mstdout[2m | tests/integration/api.test.ts[2m > [22m[2mAPI Integration Tests[2m > [22m[2mAuthentication Required Endpoints[2m > [22m[2mshould require authentication for user profile
[22m[39m[32m2026-01-23T16:49:07.881Z [INFO] GET /api/auth/user {"method":"GET","url":"/api/auth/user","ip":"[IP_REDACTED]:[IP_REDACTED]","timestamp":"2026-01-23T16:49:07.881Z"}[0m
[32m2026-01-23T16:49:07.882Z [INFO] API route accessed {"path":"/api/auth/user","method":"GET","requiresAuth":true,"requiresMfa":false,"rateLimitTier":"medium","ip":"[IP_REDACTED]:[IP_REDACTED]"}[0m

[90mstdout[2m | tests/integration/auth.test.ts[2m > [22m[2mAuthentication Integration Tests[2m > [22m[2mProtected Endpoints[2m > [22m[2mshould require authentication for /api/company-profiles
[22m[39m[32m2026-01-23T16:49:07.884Z [INFO] GET /api/company-profiles {"method":"GET","url":"/api/company-profiles","ip":"[IP_REDACTED]:[IP_REDACTED]","timestamp":"2026-01-23T16:49:07.884Z"}[0m
[32m2026-01-23T16:49:07.884Z [INFO] API route accessed {"path":"/api/company-profiles","method":"GET","requiresAuth":true,"requiresMfa":false,"rateLimitTier":"medium","ip":"[IP_REDACTED]:[IP_REDACTED]"}[0m

[90mstdout[2m | tests/integration/e2e-flows.test.ts[2m > [22m[2mE2E Flow Tests[2m > [22m[2mAI Generation Flow[2m > [22m[2mDocument Generation[2m > [22m[2mshould require authentication for AI document analysis
[22m[39m{"type":"request_end","traceId":"cc29a13f-4547-474e-8298-fea2943ce92f","spanId":"7cf47a2d","method":"POST","path":"/api/ai/analyze-document","statusCode":401,"duration":6,"timestamp":"2026-01-23T16:49:07.885Z"}

[90mstdout[2m | tests/integration/auth.test.ts[2m > [22m[2mAuthentication Integration Tests[2m > [22m[2mProtected Endpoints[2m > [22m[2mshould require authentication for /api/company-profiles
[22m[39m{"type":"request_end","traceId":"a7a35895-62b6-4b4f-8134-f6c287e9fc3b","spanId":"408af037","method":"GET","path":"/api/company-profiles","statusCode":401,"duration":4,"timestamp":"2026-01-23T16:49:07.887Z"}

[90mstdout[2m | tests/integration/e2e-flows.test.ts[2m > [22m[2mE2E Flow Tests[2m > [22m[2mAI Generation Flow[2m > [22m[2mDocument Generation[2m > [22m[2mshould return AI service health status
[22m[39m[32m2026-01-23T16:49:07.891Z [INFO] GET /api/ai/health {"method":"GET","url":"/api/ai/health","ip":"[IP_REDACTED]:[IP_REDACTED]","timestamp":"2026-01-23T16:49:07.891Z"}[0m
[32m2026-01-23T16:49:07.891Z [INFO] API route accessed {"path":"/api/ai/health","method":"GET","requiresAuth":false,"requiresMfa":false,"rateLimitTier":"low","ip":"[IP_REDACTED]:[IP_REDACTED]"}[0m

[90mstdout[2m | tests/integration/e2e-flows.test.ts[2m > [22m[2mE2E Flow Tests[2m > [22m[2mAI Generation Flow[2m > [22m[2mEvidence Upload[2m > [22m[2mshould require authentication for evidence upload
[22m[39m{"type":"request_start","traceId":"ef3a1b73-3036-463c-8661-d43acc1e1028","spanId":"76170e44","method":"POST","path":"/api/evidence/upload","ip":"::ffff:127.0.0.1","timestamp":"2026-01-23T16:49:07.901Z"}

stderr | tests/integration/e2e-flows.test.ts > E2E Flow Tests > AI Generation Flow > Evidence Upload > should require authentication for evidence upload
2026-01-23T16:49:07.903Z [WARN] Unknown API route accessed {"path":"/api/evidence/upload","method":"POST","ip":"[IP_REDACTED]:[IP_REDACTED]"}

[90mstdout[2m | tests/integration/e2e-flows.test.ts[2m > [22m[2mE2E Flow Tests[2m > [22m[2mAI Generation Flow[2m > [22m[2mEvidence Upload[2m > [22m[2mshould require authentication for evidence upload
[22m[39m[32m2026-01-23T16:49:07.902Z [INFO] POST /api/evidence/upload {"method":"POST","url":"/api/evidence/upload","ip":"[IP_REDACTED]:[IP_REDACTED]","timestamp":"2026-01-23T16:49:07.902Z"}[0m

[90mstdout[2m | tests/integration/e2e-flows.test.ts[2m > [22m[2mE2E Flow Tests[2m > [22m[2mAI Generation Flow[2m > [22m[2mEvidence Upload[2m > [22m[2mshould require authentication for evidence upload
[22m[39m{"type":"request_end","traceId":"ef3a1b73-3036-463c-8661-d43acc1e1028","spanId":"76170e44","method":"POST","path":"/api/evidence/upload","statusCode":401,"duration":4,"timestamp":"2026-01-23T16:49:07.905Z"}

[90mstdout[2m | tests/integration/api.test.ts[2m > [22m[2mAPI Integration Tests[2m > [22m[2mAuthentication Required Endpoints[2m > [22m[2mshould require authentication for user profile
[22m[39m{"type":"request_end","traceId":"15ab8525-f62b-48fe-9203-85c5e32ad7cf","spanId":"ef4e15f9","method":"GET","path":"/api/auth/user","statusCode":401,"duration":29,"timestamp":"2026-01-23T16:49:07.909Z"}

[90mstdout[2m | tests/integration/auth.test.ts[2m > [22m[2mAuthentication Integration Tests[2m > [22m[2mProtected Endpoints[2m > [22m[2mshould require authentication for /api/documents
[22m[39m{"type":"request_start","traceId":"8426e8e0-6867-4c7c-b966-be87434444e7","spanId":"37d751f7","method":"GET","path":"/api/documents","ip":"::ffff:127.0.0.1","timestamp":"2026-01-23T16:49:07.911Z"}

[90mstdout[2m | tests/integration/e2e-flows.test.ts[2m > [22m[2mE2E Flow Tests[2m > [22m[2mAI Generation Flow[2m > [22m[2mEvidence Upload[2m > [22m[2mshould require authentication to list evidence
[22m[39m{"type":"request_start","traceId":"29099df8-b9c8-403b-a52b-17e26c934d0e","spanId":"5cbf0305","method":"GET","path":"/api/evidence","ip":"::ffff:127.0.0.1","timestamp":"2026-01-23T16:49:07.913Z"}

[90mstdout[2m | tests/integration/auth.test.ts[2m > [22m[2mAuthentication Integration Tests[2m > [22m[2mProtected Endpoints[2m > [22m[2mshould require authentication for /api/documents
[22m[39m[32m2026-01-23T16:49:07.912Z [INFO] GET /api/documents {"method":"GET","url":"/api/documents","ip":"[IP_REDACTED]:[IP_REDACTED]","timestamp":"2026-01-23T16:49:07.912Z"}[0m
[32m2026-01-23T16:49:07.912Z [INFO] API route accessed {"path":"/api/documents","method":"GET","requiresAuth":true,"requiresMfa":false,"rateLimitTier":"medium","ip":"[IP_REDACTED]:[IP_REDACTED]"}[0m

[90mstdout[2m | tests/integration/e2e-flows.test.ts[2m > [22m[2mE2E Flow Tests[2m > [22m[2mAI Generation Flow[2m > [22m[2mEvidence Upload[2m > [22m[2mshould require authentication to list evidence
[22m[39m[32m2026-01-23T16:49:07.913Z [INFO] GET /api/evidence {"method":"GET","url":"/api/evidence","ip":"[IP_REDACTED]:[IP_REDACTED]","timestamp":"2026-01-23T16:49:07.913Z"}[0m

stderr | tests/integration/e2e-flows.test.ts > E2E Flow Tests > AI Generation Flow > Evidence Upload > should require authentication to list evidence
2026-01-23T16:49:07.914Z [WARN] Unknown API route accessed {"path":"/api/evidence","method":"GET","ip":"[IP_REDACTED]:[IP_REDACTED]"}

[90mstdout[2m | tests/integration/e2e-flows.test.ts[2m > [22m[2mE2E Flow Tests[2m > [22m[2mAI Generation Flow[2m > [22m[2mEvidence Upload[2m > [22m[2mshould require authentication to list evidence
[22m[39m{"type":"request_end","traceId":"29099df8-b9c8-403b-a52b-17e26c934d0e","spanId":"5cbf0305","method":"GET","path":"/api/evidence","statusCode":401,"duration":3,"timestamp":"2026-01-23T16:49:07.916Z"}

[90mstdout[2m | tests/integration/auth.test.ts[2m > [22m[2mAuthentication Integration Tests[2m > [22m[2mProtected Endpoints[2m > [22m[2mshould require authentication for /api/documents
[22m[39m{"type":"request_end","traceId":"8426e8e0-6867-4c7c-b966-be87434444e7","spanId":"37d751f7","method":"GET","path":"/api/documents","statusCode":401,"duration":9,"timestamp":"2026-01-23T16:49:07.920Z"}

[90mstdout[2m | tests/integration/e2e-flows.test.ts[2m > [22m[2mE2E Flow Tests[2m > [22m[2mAI Generation Flow[2m > [22m[2mControl Approvals[2m > [22m[2mshould require authentication to list pending approvals
[22m[39m{"type":"request_start","traceId":"8e218369-6e8a-4dc8-9f35-664ab9680a96","spanId":"532cb30e","method":"GET","path":"/api/controls/approvals","ip":"::ffff:127.0.0.1","timestamp":"2026-01-23T16:49:07.921Z"}

stderr | tests/integration/e2e-flows.test.ts > E2E Flow Tests > AI Generation Flow > Control Approvals > should require authentication to list pending approvals
2026-01-23T16:49:07.922Z [WARN] Unknown API route accessed {"path":"/api/controls/approvals","method":"GET","ip":"[IP_REDACTED]:[IP_REDACTED]"}

[90mstdout[2m | tests/integration/e2e-flows.test.ts[2m > [22m[2mE2E Flow Tests[2m > [22m[2mAI Generation Flow[2m > [22m[2mControl Approvals[2m > [22m[2mshould require authentication to list pending approvals
[22m[39m[32m2026-01-23T16:49:07.922Z [INFO] GET /api/controls/approvals {"method":"GET","url":"/api/controls/approvals","ip":"[IP_REDACTED]:[IP_REDACTED]","timestamp":"2026-01-23T16:49:07.922Z"}[0m

 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/auth.test.ts[2m > [22mAuthentication Integration Tests[2m > [22mPublic Endpoints[2m > [22mshould allow access to health check (may be degraded)[32m 183[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/auth.test.ts[2m > [22mAuthentication Integration Tests[2m > [22mPublic Endpoints[2m > [22mshould allow access to AI health endpoint[32m 34[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/auth.test.ts[2m > [22mAuthentication Integration Tests[2m > [22mProtected Endpoints[2m > [22mshould require authentication for /api/auth/user[32m 18[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/auth.test.ts[2m > [22mAuthentication Integration Tests[2m > [22mProtected Endpoints[2m > [22mshould require authentication for /api/company-profiles[32m 10[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/auth.test.ts[2m > [22mAuthentication Integration Tests[2m > [22mProtected Endpoints[2m > [22mshould require authentication for /api/documents[32m 33[2mms[22m[39m
[90mstdout[2m | tests/integration/api.test.ts[2m > [22m[2mAPI Integration Tests[2m > [22m[2mAuthentication Required Endpoints[2m > [22m[2mshould require authentication for company profiles
[22m[39m{"type":"request_start","traceId":"c214d2d0-4e31-4b09-8196-d3724ef82b67","spanId":"f440d910","method":"GET","path":"/api/company-profiles","ip":"::ffff:127.0.0.1","timestamp":"2026-01-23T16:49:07.923Z"}

[90mstdout[2m | tests/integration/api.test.ts[2m > [22m[2mAPI Integration Tests[2m > [22m[2mAuthentication Required Endpoints[2m > [22m[2mshould require authentication for company profiles
[22m[39m[32m2026-01-23T16:49:07.924Z [INFO] GET /api/company-profiles {"method":"GET","url":"/api/company-profiles","ip":"[IP_REDACTED]:[IP_REDACTED]","timestamp":"2026-01-23T16:49:07.924Z"}[0m
[32m2026-01-23T16:49:07.924Z [INFO] API route accessed {"path":"/api/company-profiles","method":"GET","requiresAuth":true,"requiresMfa":false,"rateLimitTier":"medium","ip":"[IP_REDACTED]:[IP_REDACTED]"}[0m

[90mstdout[2m | tests/integration/api.test.ts[2m > [22m[2mAPI Integration Tests[2m > [22m[2mAuthentication Required Endpoints[2m > [22m[2mshould require authentication for company profiles
[22m[39m{"type":"request_end","traceId":"c214d2d0-4e31-4b09-8196-d3724ef82b67","spanId":"f440d910","method":"GET","path":"/api/company-profiles","statusCode":401,"duration":4,"timestamp":"2026-01-23T16:49:07.927Z"}

 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/api.test.ts[2m > [22mAPI Integration Tests[2m > [22mHealth Endpoints[2m > [22mshould return system health status (may be degraded in test)[32m 215[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/api.test.ts[2m > [22mAPI Integration Tests[2m > [22mHealth Endpoints[2m > [22mshould return AI health status[32m 17[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/api.test.ts[2m > [22mAPI Integration Tests[2m > [22mAuthentication Required Endpoints[2m > [22mshould require authentication for user profile[32m 36[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/api.test.ts[2m > [22mAPI Integration Tests[2m > [22mAuthentication Required Endpoints[2m > [22mshould require authentication for company profiles[32m 15[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/ai-components.test.tsx[2m > [22mAIInsightsDashboard[2m > [22mshould display all recommendations correctly[32m 107[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/ai-components.test.tsx[2m > [22mAIInsightsDashboard[2m > [22mshould display recommendation priorities[32m 52[2mms[22m[39m
[90mstdout[2m | tests/integration/auth.test.ts[2m > [22m[2mAuthentication Integration Tests[2m > [22m[2mAPI Security[2m > [22m[2mshould reject requests with invalid methods
[22m[39m[32m2026-01-23T16:49:07.928Z [INFO] PUT /health {"method":"PUT","url":"/health","ip":"[IP_REDACTED]:[IP_REDACTED]","timestamp":"2026-01-23T16:49:07.928Z"}[0m

 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/ai-doc-generator.test.tsx[2m > [22mAI Document Generator Page[2m > [22mInitial Rendering[2m > [22mshould render page title and description[32m 289[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/auth.test.ts[2m > [22mAuthentication Integration Tests[2m > [22mAPI Security[2m > [22mshould reject requests with invalid methods[32m 8[2mms[22m[39m
[90mstdout[2m | tests/integration/e2e-flows.test.ts[2m > [22m[2mE2E Flow Tests[2m > [22m[2mAI Generation Flow[2m > [22m[2mControl Approvals[2m > [22m[2mshould require authentication to list pending approvals
[22m[39m{"type":"request_end","traceId":"8e218369-6e8a-4dc8-9f35-664ab9680a96","spanId":"532cb30e","method":"GET","path":"/api/controls/approvals","statusCode":401,"duration":14,"timestamp":"2026-01-23T16:49:07.935Z"}

[90mstdout[2m | tests/integration/api.test.ts[2m > [22m[2mAPI Integration Tests[2m > [22m[2mAPI Error Handling[2m > [22m[2mshould return 404 for non-existent endpoints
[22m[39m{"type":"request_start","traceId":"cb80b2b7-0ff7-49c7-a3bd-7fb6764a89d4","spanId":"0b358ae4","method":"GET","path":"/api/non-existent-route","ip":"::ffff:127.0.0.1","timestamp":"2026-01-23T16:49:07.942Z"}

stderr | tests/integration/api.test.ts > API Integration Tests > API Error Handling > should return 404 for non-existent endpoints
2026-01-23T16:49:07.943Z [WARN] Unknown API route accessed {"path":"/api/non-existent-route","method":"GET","ip":"[IP_REDACTED]:[IP_REDACTED]"}

[90mstdout[2m | tests/integration/api.test.ts[2m > [22m[2mAPI Integration Tests[2m > [22m[2mAPI Error Handling[2m > [22m[2mshould return 404 for non-existent endpoints
[22m[39m[32m2026-01-23T16:49:07.943Z [INFO] GET /api/non-existent-route {"method":"GET","url":"/api/non-existent-route","ip":"[IP_REDACTED]:[IP_REDACTED]","timestamp":"2026-01-23T16:49:07.943Z"}[0m

[90mstdout[2m | tests/integration/api.test.ts[2m > [22m[2mAPI Integration Tests[2m > [22m[2mAPI Error Handling[2m > [22m[2mshould return 404 for non-existent endpoints
[22m[39m{"type":"request_end","traceId":"cb80b2b7-0ff7-49c7-a3bd-7fb6764a89d4","spanId":"0b358ae4","method":"GET","path":"/api/non-existent-route","statusCode":404,"duration":3,"timestamp":"2026-01-23T16:49:07.945Z"}

 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/api.test.ts[2m > [22mAPI Integration Tests[2m > [22mAPI Error Handling[2m > [22mshould return 404 for non-existent endpoints[32m 18[2mms[22m[39m
[90mstdout[2m | tests/integration/e2e-flows.test.ts[2m > [22m[2mE2E Flow Tests[2m > [22m[2mAI Generation Flow[2m > [22m[2mControl Approvals[2m > [22m[2mshould require authentication to approve a control
[22m[39m{"type":"request_start","traceId":"0459ba2d-6426-467a-ab20-c524b0db149b","spanId":"67191f85","method":"POST","path":"/api/controls/1/approve","ip":"::ffff:127.0.0.1","timestamp":"2026-01-23T16:49:07.959Z"}

stderr | tests/integration/e2e-flows.test.ts > E2E Flow Tests > AI Generation Flow > Control Approvals > should require authentication to approve a control
2026-01-23T16:49:07.960Z [WARN] Unknown API route accessed {"path":"/api/controls/1/approve","method":"POST","ip":"[IP_REDACTED]:[IP_REDACTED]"}

[90mstdout[2m | tests/integration/e2e-flows.test.ts[2m > [22m[2mE2E Flow Tests[2m > [22m[2mAI Generation Flow[2m > [22m[2mControl Approvals[2m > [22m[2mshould require authentication to approve a control
[22m[39m[32m2026-01-23T16:49:07.960Z [INFO] POST /api/controls/1/approve {"method":"POST","url":"/api/controls/1/approve","ip":"[IP_REDACTED]:[IP_REDACTED]","timestamp":"2026-01-23T16:49:07.960Z"}[0m

[90mstdout[2m | tests/integration/e2e-flows.test.ts[2m > [22m[2mE2E Flow Tests[2m > [22m[2mAI Generation Flow[2m > [22m[2mControl Approvals[2m > [22m[2mshould require authentication to approve a control
[22m[39m{"type":"request_end","traceId":"0459ba2d-6426-467a-ab20-c524b0db149b","spanId":"67191f85","method":"POST","path":"/api/controls/1/approve","statusCode":401,"duration":3,"timestamp":"2026-01-23T16:49:07.962Z"}

 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/e2e-flows.test.ts[2m > [22mE2E Flow Tests[2m > [22mAI Generation Flow[2m > [22mDocument Generation[2m > [22mshould require authentication for AI document generation[32m 32[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/e2e-flows.test.ts[2m > [22mE2E Flow Tests[2m > [22mAI Generation Flow[2m > [22mDocument Generation[2m > [22mshould require authentication for AI document analysis[32m 11[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/e2e-flows.test.ts[2m > [22mE2E Flow Tests[2m > [22mAI Generation Flow[2m > [22mDocument Generation[2m > [22mshould return AI service health status[32m 9[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/e2e-flows.test.ts[2m > [22mE2E Flow Tests[2m > [22mAI Generation Flow[2m > [22mEvidence Upload[2m > [22mshould require authentication for evidence upload[32m 11[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/e2e-flows.test.ts[2m > [22mE2E Flow Tests[2m > [22mAI Generation Flow[2m > [22mEvidence Upload[2m > [22mshould require authentication to list evidence[32m 11[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/e2e-flows.test.ts[2m > [22mE2E Flow Tests[2m > [22mAI Generation Flow[2m > [22mControl Approvals[2m > [22mshould require authentication to list pending approvals[32m 26[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/e2e-flows.test.ts[2m > [22mE2E Flow Tests[2m > [22mAI Generation Flow[2m > [22mControl Approvals[2m > [22mshould require authentication to approve a control[32m 21[2mms[22m[39m
[90mstdout[2m | tests/integration/e2e-flows.test.ts[2m > [22m[2mE2E Flow Tests[2m > [22m[2mAudit Flow[2m > [22m[2mAudit Trail Access[2m > [22m[2mshould require authentication to view audit trail
[22m[39m{"type":"request_start","traceId":"e4fa9378-181c-4762-9f7a-45236dda5f81","spanId":"53241763","method":"GET","path":"/api/audit-trail","ip":"::ffff:127.0.0.1","timestamp":"2026-01-23T16:49:07.969Z"}

[90mstdout[2m | tests/integration/e2e-flows.test.ts[2m > [22m[2mE2E Flow Tests[2m > [22m[2mAudit Flow[2m > [22m[2mAudit Trail Access[2m > [22m[2mshould require authentication to view audit trail
[22m[39m[32m2026-01-23T16:49:07.969Z [INFO] GET /api/audit-trail {"method":"GET","url":"/api/audit-trail","ip":"[IP_REDACTED]:[IP_REDACTED]","timestamp":"2026-01-23T16:49:07.969Z"}[0m

stderr | tests/integration/e2e-flows.test.ts > E2E Flow Tests > Audit Flow > Audit Trail Access > should require authentication to view audit trail
2026-01-23T16:49:07.970Z [WARN] Unknown API route accessed {"path":"/api/audit-trail","method":"GET","ip":"[IP_REDACTED]:[IP_REDACTED]"}

[90mstdout[2m | tests/integration/e2e-flows.test.ts[2m > [22m[2mE2E Flow Tests[2m > [22m[2mAudit Flow[2m > [22m[2mAudit Trail Access[2m > [22m[2mshould require authentication to view audit trail
[22m[39m{"type":"request_end","traceId":"e4fa9378-181c-4762-9f7a-45236dda5f81","spanId":"53241763","method":"GET","path":"/api/audit-trail","statusCode":401,"duration":2,"timestamp":"2026-01-23T16:49:07.971Z"}

[90mstdout[2m | tests/integration/e2e-flows.test.ts[2m > [22m[2mE2E Flow Tests[2m > [22m[2mAudit Flow[2m > [22m[2mAudit Trail Access[2m > [22m[2mshould require authentication to get audit entry details
[22m[39m{"type":"request_start","traceId":"e1fec875-077c-4248-87f3-d4ab441d662a","spanId":"b769d6a7","method":"GET","path":"/api/audit-trail/1","ip":"::ffff:127.0.0.1","timestamp":"2026-01-23T16:49:07.976Z"}

[90mstdout[2m | tests/integration/e2e-flows.test.ts[2m > [22m[2mE2E Flow Tests[2m > [22m[2mAudit Flow[2m > [22m[2mAudit Trail Access[2m > [22m[2mshould require authentication to get audit entry details
[22m[39m[32m2026-01-23T16:49:07.977Z [INFO] GET /api/audit-trail/1 {"method":"GET","url":"/api/audit-trail/1","ip":"[IP_REDACTED]:[IP_REDACTED]","timestamp":"2026-01-23T16:49:07.977Z"}[0m
[32m2026-01-23T16:49:07.977Z [INFO] API route accessed {"path":"/api/audit-trail/1","method":"GET","requiresAuth":true,"requiresMfa":true,"rateLimitTier":"high","ip":"[IP_REDACTED]:[IP_REDACTED]"}[0m

[90mstdout[2m | tests/integration/e2e-flows.test.ts[2m > [22m[2mE2E Flow Tests[2m > [22m[2mAudit Flow[2m > [22m[2mAudit Trail Access[2m > [22m[2mshould require authentication to get audit entry details
[22m[39m{"type":"request_end","traceId":"e1fec875-077c-4248-87f3-d4ab441d662a","spanId":"b769d6a7","method":"GET","path":"/api/audit-trail/1","statusCode":401,"duration":3,"timestamp":"2026-01-23T16:49:07.979Z"}

[90mstdout[2m | tests/integration/e2e-flows.test.ts[2m > [22m[2mE2E Flow Tests[2m > [22m[2mAudit Flow[2m > [22m[2mAuditor Workspace[2m > [22m[2mshould require authentication for auditor workspace access
[22m[39m{"type":"request_start","traceId":"346bf652-8ba1-4ae9-a2d7-058ae6c8163e","spanId":"b3a7e096","method":"GET","path":"/api/auditor/documents","ip":"::ffff:127.0.0.1","timestamp":"2026-01-23T16:49:07.983Z"}

stderr | tests/integration/e2e-flows.test.ts > E2E Flow Tests > Audit Flow > Auditor Workspace > should require authentication for auditor workspace access
2026-01-23T16:49:07.984Z [WARN] Unknown API route accessed {"path":"/api/auditor/documents","method":"GET","ip":"[IP_REDACTED]:[IP_REDACTED]"}

[90mstdout[2m | tests/integration/e2e-flows.test.ts[2m > [22m[2mE2E Flow Tests[2m > [22m[2mAudit Flow[2m > [22m[2mAuditor Workspace[2m > [22m[2mshould require authentication for auditor workspace access
[22m[39m[32m2026-01-23T16:49:07.984Z [INFO] GET /api/auditor/documents {"method":"GET","url":"/api/auditor/documents","ip":"[IP_REDACTED]:[IP_REDACTED]","timestamp":"2026-01-23T16:49:07.984Z"}[0m

[90mstdout[2m | tests/integration/e2e-flows.test.ts[2m > [22m[2mE2E Flow Tests[2m > [22m[2mAudit Flow[2m > [22m[2mAuditor Workspace[2m > [22m[2mshould require authentication for auditor workspace access
[22m[39m{"type":"request_end","traceId":"346bf652-8ba1-4ae9-a2d7-058ae6c8163e","spanId":"b3a7e096","method":"GET","path":"/api/auditor/documents","statusCode":401,"duration":2,"timestamp":"2026-01-23T16:49:07.985Z"}

[90mstdout[2m | tests/integration/e2e-flows.test.ts[2m > [22m[2mE2E Flow Tests[2m > [22m[2mAudit Flow[2m > [22m[2mAuditor Workspace[2m > [22m[2mshould require authentication to view compliance overview
[22m[39m{"type":"request_start","traceId":"783dc0f8-c94e-41f3-8e73-93ea05273d4e","spanId":"f19091c8","method":"GET","path":"/api/auditor/overview","ip":"::ffff:127.0.0.1","timestamp":"2026-01-23T16:49:07.990Z"}

[90mstdout[2m | tests/integration/e2e-flows.test.ts[2m > [22m[2mE2E Flow Tests[2m > [22m[2mAudit Flow[2m > [22m[2mAuditor Workspace[2m > [22m[2mshould require authentication to view compliance overview
[22m[39m[32m2026-01-23T16:49:07.990Z [INFO] GET /api/auditor/overview {"method":"GET","url":"/api/auditor/overview","ip":"[IP_REDACTED]:[IP_REDACTED]","timestamp":"2026-01-23T16:49:07.990Z"}[0m

stderr | tests/integration/e2e-flows.test.ts > E2E Flow Tests > Audit Flow > Auditor Workspace > should require authentication to view compliance overview
2026-01-23T16:49:07.990Z [WARN] Unknown API route accessed {"path":"/api/auditor/overview","method":"GET","ip":"[IP_REDACTED]:[IP_REDACTED]"}

[90mstdout[2m | tests/integration/e2e-flows.test.ts[2m > [22m[2mE2E Flow Tests[2m > [22m[2mAudit Flow[2m > [22m[2mAuditor Workspace[2m > [22m[2mshould require authentication to view compliance overview
[22m[39m{"type":"request_end","traceId":"783dc0f8-c94e-41f3-8e73-93ea05273d4e","spanId":"f19091c8","method":"GET","path":"/api/auditor/overview","statusCode":401,"duration":2,"timestamp":"2026-01-23T16:49:07.992Z"}

 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/admin/PDFSecuritySettings.test.tsx[2m > [22mPDFSecuritySettings[2m > [22mrenders security options[32m 106[2mms[22m[39m
[90mstdout[2m | tests/integration/e2e-flows.test.ts[2m > [22m[2mE2E Flow Tests[2m > [22m[2mAudit Flow[2m > [22m[2mAuditor Workspace[2m > [22m[2mshould require authentication to export audit reports
[22m[39m{"type":"request_start","traceId":"0fedfda7-95d2-42be-bb63-1903dccbf3cf","spanId":"25d050dd","method":"GET","path":"/api/auditor/export","ip":"::ffff:127.0.0.1","timestamp":"2026-01-23T16:49:07.996Z"}

[90mstdout[2m | tests/integration/e2e-flows.test.ts[2m > [22m[2mE2E Flow Tests[2m > [22m[2mAudit Flow[2m > [22m[2mAuditor Workspace[2m > [22m[2mshould require authentication to export audit reports
[22m[39m[32m2026-01-23T16:49:07.996Z [INFO] GET /api/auditor/export {"method":"GET","url":"/api/auditor/export","ip":"[IP_REDACTED]:[IP_REDACTED]","timestamp":"2026-01-23T16:49:07.996Z"}[0m

stderr | tests/integration/e2e-flows.test.ts > E2E Flow Tests > Audit Flow > Auditor Workspace > should require authentication to export audit reports
2026-01-23T16:49:07.996Z [WARN] Unknown API route accessed {"path":"/api/auditor/export","method":"GET","ip":"[IP_REDACTED]:[IP_REDACTED]"}

[90mstdout[2m | tests/integration/e2e-flows.test.ts[2m > [22m[2mE2E Flow Tests[2m > [22m[2mAudit Flow[2m > [22m[2mAuditor Workspace[2m > [22m[2mshould require authentication to export audit reports
[22m[39m{"type":"request_end","traceId":"0fedfda7-95d2-42be-bb63-1903dccbf3cf","spanId":"25d050dd","method":"GET","path":"/api/auditor/export","statusCode":401,"duration":3,"timestamp":"2026-01-23T16:49:07.998Z"}

[90mstdout[2m | tests/integration/e2e-flows.test.ts[2m > [22m[2mE2E Flow Tests[2m > [22m[2mAudit Flow[2m > [22m[2mGap Analysis[2m > [22m[2mshould require authentication for gap analysis
[22m[39m{"type":"request_start","traceId":"4f420107-fd4c-483d-99c8-49e1e1d55f51","spanId":"bc08a24b","method":"GET","path":"/api/gap-analysis","ip":"::ffff:127.0.0.1","timestamp":"2026-01-23T16:49:08.003Z"}

stderr | tests/integration/e2e-flows.test.ts > E2E Flow Tests > Audit Flow > Gap Analysis > should require authentication for gap analysis
2026-01-23T16:49:08.004Z [WARN] Unknown API route accessed {"path":"/api/gap-analysis","method":"GET","ip":"[IP_REDACTED]:[IP_REDACTED]"}

[90mstdout[2m | tests/integration/e2e-flows.test.ts[2m > [22m[2mE2E Flow Tests[2m > [22m[2mAudit Flow[2m > [22m[2mGap Analysis[2m > [22m[2mshould require authentication for gap analysis
[22m[39m[32m2026-01-23T16:49:08.004Z [INFO] GET /api/gap-analysis {"method":"GET","url":"/api/gap-analysis","ip":"[IP_REDACTED]:[IP_REDACTED]","timestamp":"2026-01-23T16:49:08.004Z"}[0m

[90mstdout[2m | tests/integration/e2e-flows.test.ts[2m > [22m[2mE2E Flow Tests[2m > [22m[2mAudit Flow[2m > [22m[2mGap Analysis[2m > [22m[2mshould require authentication for gap analysis
[22m[39m{"type":"request_end","traceId":"4f420107-fd4c-483d-99c8-49e1e1d55f51","spanId":"bc08a24b","method":"GET","path":"/api/gap-analysis","statusCode":401,"duration":3,"timestamp":"2026-01-23T16:49:08.006Z"}

[90mstdout[2m | tests/integration/e2e-flows.test.ts[2m > [22m[2mE2E Flow Tests[2m > [22m[2mAudit Flow[2m > [22m[2mGap Analysis[2m > [22m[2mshould require authentication for gap analysis by framework
[22m[39m{"type":"request_start","traceId":"c4d5841c-a45c-4295-a093-ed2b4ec7e9b1","spanId":"888be002","method":"GET","path":"/api/gap-analysis/ISO27001","ip":"::ffff:127.0.0.1","timestamp":"2026-01-23T16:49:08.010Z"}

[90mstdout[2m | tests/integration/e2e-flows.test.ts[2m > [22m[2mE2E Flow Tests[2m > [22m[2mAudit Flow[2m > [22m[2mGap Analysis[2m > [22m[2mshould require authentication for gap analysis by framework
[22m[39m[32m2026-01-23T16:49:08.010Z [INFO] GET /api/gap-analysis/ISO27001 {"method":"GET","url":"/api/gap-analysis/ISO27001","ip":"[IP_REDACTED]:[IP_REDACTED]","timestamp":"2026-01-23T16:49:08.010Z"}[0m
[32m2026-01-23T16:49:08.011Z [INFO] API route accessed {"path":"/api/gap-analysis/ISO27001","method":"GET","requiresAuth":true,"requiresMfa":false,"rateLimitTier":"high","ip":"[IP_REDACTED]:[IP_REDACTED]"}[0m

[90mstdout[2m | tests/integration/e2e-flows.test.ts[2m > [22m[2mE2E Flow Tests[2m > [22m[2mAudit Flow[2m > [22m[2mGap Analysis[2m > [22m[2mshould require authentication for gap analysis by framework
[22m[39m{"type":"request_end","traceId":"c4d5841c-a45c-4295-a093-ed2b4ec7e9b1","spanId":"888be002","method":"GET","path":"/api/gap-analysis/ISO27001","statusCode":401,"duration":2,"timestamp":"2026-01-23T16:49:08.012Z"}

[90mstdout[2m | tests/integration/e2e-flows.test.ts[2m > [22m[2mE2E Flow Tests[2m > [22m[2mCross-Flow Integration[2m > [22m[2mDocument to Audit Trail[2m > [22m[2mshould require authentication to track document changes
[22m[39m{"type":"request_start","traceId":"690e209a-6a94-447f-a0f4-835866ef5353","spanId":"e935960c","method":"GET","path":"/api/documents/1/history","ip":"::ffff:127.0.0.1","timestamp":"2026-01-23T16:49:08.016Z"}

[90mstdout[2m | tests/integration/e2e-flows.test.ts[2m > [22m[2mE2E Flow Tests[2m > [22m[2mCross-Flow Integration[2m > [22m[2mDocument to Audit Trail[2m > [22m[2mshould require authentication to track document changes
[22m[39m[32m2026-01-23T16:49:08.017Z [INFO] GET /api/documents/1/history {"method":"GET","url":"/api/documents/1/history","ip":"[IP_REDACTED]:[IP_REDACTED]","timestamp":"2026-01-23T16:49:08.017Z"}[0m
[32m2026-01-23T16:49:08.017Z [INFO] API route accessed {"path":"/api/documents/1/history","method":"GET","requiresAuth":true,"requiresMfa":false,"rateLimitTier":"medium","ip":"[IP_REDACTED]:[IP_REDACTED]"}[0m

 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/admin/CloudIntegrationList.test.tsx[2m > [22mCloudIntegrationList[2m > [22mrenders empty state[32m 83[2mms[22m[39m
[90mstdout[2m | tests/integration/e2e-flows.test.ts[2m > [22m[2mE2E Flow Tests[2m > [22m[2mCross-Flow Integration[2m > [22m[2mDocument to Audit Trail[2m > [22m[2mshould require authentication to track document changes
[22m[39m{"type":"request_end","traceId":"690e209a-6a94-447f-a0f4-835866ef5353","spanId":"e935960c","method":"GET","path":"/api/documents/1/history","statusCode":401,"duration":3,"timestamp":"2026-01-23T16:49:08.019Z"}

 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/ai-components.test.tsx[2m > [22mAIInsightsDashboard[2m > [22mshould display recommendation frameworks[32m 76[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/ai-components.test.tsx[2m > [22mAIInsightsDashboard[2m > [22mshould display expected impact for recommendations[32m 52[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/ai-components.test.tsx[2m > [22mAIInsightsDashboard[2m > [22mshould have correct aria-labels on Generate Documents button[32m 26[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/ai-components.test.tsx[2m > [22mAIInsightsDashboard[2m > [22mshould have correct aria-labels on Ask AI Assistant button[32m 16[2mms[22m[39m
[90mstdout[2m | tests/integration/e2e-flows.test.ts[2m > [22m[2mE2E Flow Tests[2m > [22m[2mCross-Flow Integration[2m > [22m[2mAI Hub Stats[2m > [22m[2mshould require authentication for AI stats
[22m[39m{"type":"request_start","traceId":"99fea689-93e0-4937-87b2-3c802d1de81e","spanId":"b1963f84","method":"GET","path":"/api/ai/stats","ip":"::ffff:127.0.0.1","timestamp":"2026-01-23T16:49:08.023Z"}

stderr | tests/integration/e2e-flows.test.ts > E2E Flow Tests > Cross-Flow Integration > AI Hub Stats > should require authentication for AI stats
2026-01-23T16:49:08.024Z [WARN] Unknown API route accessed {"path":"/api/ai/stats","method":"GET","ip":"[IP_REDACTED]:[IP_REDACTED]"}

[90mstdout[2m | tests/integration/e2e-flows.test.ts[2m > [22m[2mE2E Flow Tests[2m > [22m[2mCross-Flow Integration[2m > [22m[2mAI Hub Stats[2m > [22m[2mshould require authentication for AI stats
[22m[39m[32m2026-01-23T16:49:08.024Z [INFO] GET /api/ai/stats {"method":"GET","url":"/api/ai/stats","ip":"[IP_REDACTED]:[IP_REDACTED]","timestamp":"2026-01-23T16:49:08.024Z"}[0m

[90mstdout[2m | tests/integration/e2e-flows.test.ts[2m > [22m[2mE2E Flow Tests[2m > [22m[2mCross-Flow Integration[2m > [22m[2mAI Hub Stats[2m > [22m[2mshould require authentication for AI stats
[22m[39m{"type":"request_end","traceId":"99fea689-93e0-4937-87b2-3c802d1de81e","spanId":"b1963f84","method":"GET","path":"/api/ai/stats","statusCode":401,"duration":3,"timestamp":"2026-01-23T16:49:08.026Z"}

 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/e2e-flows.test.ts[2m > [22mE2E Flow Tests[2m > [22mAudit Flow[2m > [22mAudit Trail Access[2m > [22mshould require authentication to view audit trail[32m 7[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/e2e-flows.test.ts[2m > [22mE2E Flow Tests[2m > [22mAudit Flow[2m > [22mAudit Trail Access[2m > [22mshould require authentication to get audit entry details[32m 7[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/e2e-flows.test.ts[2m > [22mE2E Flow Tests[2m > [22mAudit Flow[2m > [22mAuditor Workspace[2m > [22mshould require authentication for auditor workspace access[32m 6[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/e2e-flows.test.ts[2m > [22mE2E Flow Tests[2m > [22mAudit Flow[2m > [22mAuditor Workspace[2m > [22mshould require authentication to view compliance overview[32m 6[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/e2e-flows.test.ts[2m > [22mE2E Flow Tests[2m > [22mAudit Flow[2m > [22mAuditor Workspace[2m > [22mshould require authentication to export audit reports[32m 6[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/e2e-flows.test.ts[2m > [22mE2E Flow Tests[2m > [22mAudit Flow[2m > [22mGap Analysis[2m > [22mshould require authentication for gap analysis[32m 8[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/e2e-flows.test.ts[2m > [22mE2E Flow Tests[2m > [22mAudit Flow[2m > [22mGap Analysis[2m > [22mshould require authentication for gap analysis by framework[32m 7[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/e2e-flows.test.ts[2m > [22mE2E Flow Tests[2m > [22mCross-Flow Integration[2m > [22mDocument to Audit Trail[2m > [22mshould require authentication to track document changes[32m 7[2mms[22m[39m
 [2m[90mÎ“Ã¥Ã´[39m[22m [30m[42m unit [49m[39m tests/integration/e2e-flows.test.ts[2m > [22mE2E Flow Tests[2m > [22mCross-Flow Integration[2m > [22mEvidence to Control Mapping[2m > [22mshould require authentication to map evidence to controls
 [32mÎ“Â£Ã´[39m [30m[42m unit [49m[39m tests/integration/e2e-flows.test.ts[2m > [22mE2E Flow Tests[2m > [22mCross-Flow Integration[2m > [22mAI Hub Stats[2m > [22mshould require authentication for AI stats[32m 7[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/profile/NotificationSettingsForm.test.tsx[2m > [22mNotificationSettingsForm[2m > [22mrenders with profile values[32m 208[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/ai-doc-generator.test.tsx[2m > [22mAI Document Generator Page[2m > [22mInitial Rendering[2m > [22mshould render step indicators[32m 96[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/ai-doc-generator.test.tsx[2m > [22mAI Document Generator Page[2m > [22mInitial Rendering[2m > [22mshould start on step 1[32m 100[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/dashboard/FrameworkGenerationCards.test.tsx[2m > [22mFrameworkGenerationCards[2m > [22mrenders progress and frameworks[32m 130[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/dashboard/FrameworkGenerationCards.test.tsx[2m > [22mFrameworkGenerationCards[2m > [22mdisables buttons when generating[32m 22[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/documents.test.tsx[2m > [22mDocuments Page[2m > [22mInitial Rendering[2m > [22mshould render loading state initially[33m 363[2mms[22m[39m
[90mstdout[2m | tests/components/ObjectStorageManager.test.tsx[2m > [22m[2mObjectStorageManager[2m > [22m[2mrenders loading state and then stats
[22m[39mMock called with: /api/storage/stats
Mock called with: /api/storage/list
Mock called with: /api/storage/list?folder=documents
Mock called with: /api/storage/list?folder=profiles
Mock called with: /api/storage/list?folder=backups

 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/admin/UserRoleManager.test.tsx[2m > [22mUserRoleManager[2m > [22mrenders empty state when no org selected[32m 120[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/admin/UserRoleManager.test.tsx[2m > [22mUserRoleManager[2m > [22mrenders roles and assignments when org selected[32m 67[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/admin/CloudIntegrationList.test.tsx[2m > [22mCloudIntegrationList[2m > [22mrenders integrations list[32m 44[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/ai-components.test.tsx[2m > [22mAIInsightsDashboard[2m > [22mshould have correct aria-label on View All button[32m 16[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/ai-components.test.tsx[2m > [22mAIInsightsDashboard[2m > [22mshould have correct aria-labels on Fix buttons[32m 17[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/ai-doc-generator.test.tsx[2m > [22mAI Document Generator Page[2m > [22mInitial Rendering[2m > [22mshould show correct navigation buttons for step 1[32m 81[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/dashboard/GenerationProgressDialog.test.tsx[2m > [22mGenerationProgressDialog[2m > [22mrenders progress correctly[33m 551[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/TemporaryLoginDialog.test.tsx[2m > [22mTemporaryLoginDialog[2m > [22mopens dialog when trigger clicked[33m 512[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/documents.test.tsx[2m > [22mDocuments Page[2m > [22mInitial Rendering[2m > [22mshould render page header with correct title[32m 262[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/documents.test.tsx[2m > [22mDocuments Page[2m > [22mInitial Rendering[2m > [22mshould render framework-specific title when framework filter is present[32m 80[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/FrameworkSpreadsheet.test.tsx[2m > [22mFrameworkSpreadsheet Component[2m > [22mrenders the spreadsheet title[33m 438[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/profile/PreferencesForm.test.tsx[2m > [22mPreferencesForm[2m > [22mrenders with default values[33m 362[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/ai-components.test.tsx[2m > [22mAIInsightsDashboard[2m > [22mshould call onViewDetails when View All button is clicked[33m 303[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/gap-analysis.test.tsx[2m > [22mGap Analysis Page[2m > [22mInitial Rendering[2m > [22mshould render page header with title[33m 798[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/ai-doc-generator.test.tsx[2m > [22mAI Document Generator Page[2m > [22mStep 1: Company Basics[2m > [22mshould render all company basic fields[32m 100[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/TemporaryLoginDialog.test.tsx[2m > [22mTemporaryLoginDialog[2m > [22mvalidates form inputs[32m 205[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/documents.test.tsx[2m > [22mDocuments Page[2m > [22mInitial Rendering[2m > [22mshould render search and filter controls[32m 97[2mms[22m[39m
[90mstdout[2m | tests/components/ObjectStorageManager.test.tsx[2m > [22m[2mObjectStorageManager[2m > [22m[2mallows tab switching
[22m[39mMock called with: /api/storage/stats
Mock called with: /api/storage/list
Mock called with: /api/storage/list?folder=documents
Mock called with: /api/storage/list?folder=profiles
Mock called with: /api/storage/list?folder=backups

 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/FrameworkSpreadsheet.test.tsx[2m > [22mFrameworkSpreadsheet Component[2m > [22mrenders templates from API[32m 94[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/FrameworkSpreadsheet.test.tsx[2m > [22mFrameworkSpreadsheet Component[2m > [22mshows empty state if no templates[32m 29[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/admin/OAuthSettings.test.tsx[2m > [22mOAuthSettings[2m > [22msubmits form with data[33m 759[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/profile/PreferencesForm.test.tsx[2m > [22mPreferencesForm[2m > [22mrenders with profile values[32m 180[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/profile/ProfileForm.test.tsx[2m > [22mProfileForm[2m > [22msubmits form data[33m 629[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/admin/PDFSecuritySettings.test.tsx[2m > [22mPDFSecuritySettings[2m > [22msubmits form changes[33m 689[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/admin/UserRoleManager.test.tsx[2m > [22mUserRoleManager[2m > [22mcalls onRemoveAssignment when delete button clicked[33m 322[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/admin/UserRoleManager.test.tsx[2m > [22mUserRoleManager[2m > [22mshows loading states[32m 22[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/admin/CloudIntegrationList.test.tsx[2m > [22mCloudIntegrationList[2m > [22mcalls onDelete when delete button clicked[33m 359[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/ai-components.test.tsx[2m > [22mAIInsightsDashboard[2m > [22mshould have correct region and role attributes[32m 117[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/ai-components.test.tsx[2m > [22mAIInsightsDashboard[2m > [22mshould have metrics overview with proper grouping[32m 38[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/ai-components.test.tsx[2m > [22mAIInsightsDashboard[2m > [22mshould have recommendations list with proper role[32m 37[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/profile/NotificationSettingsForm.test.tsx[2m > [22mNotificationSettingsForm[2m > [22mtoggles switch and submits[33m 548[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/ai-doc-generator.test.tsx[2m > [22mAI Document Generator Page[2m > [22mStep 1: Company Basics[2m > [22mshould require all fields to proceed[33m 327[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/dashboard/FrameworkGenerationCards.test.tsx[2m > [22mFrameworkGenerationCards[2m > [22mcalls triggers when clicked[33m 422[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/dashboard/GenerationProgressDialog.test.tsx[2m > [22mGenerationProgressDialog[2m > [22mcalls onCancel when button clicked[32m 185[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/documents.test.tsx[2m > [22mDocuments Page[2m > [22mInitial Rendering[2m > [22mshould display document count[32m 92[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/ObjectStorageManager.test.tsx[2m > [22mObjectStorageManager[2m > [22mrenders loading state and then stats[33m 403[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/ObjectStorageManager.test.tsx[2m > [22mObjectStorageManager[2m > [22mallows tab switching[32m 201[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/gap-analysis.test.tsx[2m > [22mGap Analysis Page[2m > [22mInitial Rendering[2m > [22mshould render export and analyze buttons[32m 234[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/documents.test.tsx[2m > [22mDocuments Page[2m > [22mDocument Display[2m > [22mshould display all documents in the list[32m 106[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/documents.test.tsx[2m > [22mDocuments Page[2m > [22mDocument Display[2m > [22mshould display document descriptions[32m 87[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/ai-components.test.tsx[2m > [22mRiskHeatmap[2m > [22mshould render the heatmap card with title[32m 44[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/ErrorBoundary.test.tsx[2m > [22mErrorBoundary[2m > [22mshould render children when there is no error[32m 40[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/ErrorBoundary.test.tsx[2m > [22mErrorBoundary[2m > [22mshould render error UI when there is an error[32m 55[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/FrameworkSpreadsheet.test.tsx[2m > [22mFrameworkSpreadsheet Component[2m > [22mallows searching templates[33m 361[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/documents.test.tsx[2m > [22mDocuments Page[2m > [22mDocument Display[2m > [22mshould display framework badges with correct colors[32m 94[2mms[22m[39m
stderr | tests/components/ErrorBoundary.test.tsx > ErrorBoundary > should hide error message in production mode
[2026-01-23T16:49:08.820Z] [WARN] Failed to fetch CSRF token

 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/gap-analysis.test.tsx[2m > [22mGap Analysis Page[2m > [22mInitial Rendering[2m > [22mshould render executive summary cards[32m 150[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/FrameworkSpreadsheet.test.tsx[2m > [22mFrameworkSpreadsheet Component[2m > [22mopens accordion to show fields[32m 108[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/documents.test.tsx[2m > [22mDocuments Page[2m > [22mDocument Display[2m > [22mshould display status badges with correct text[32m 100[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/storage/FileListView.test.tsx[2m > [22mFileListView[2m > [22mrenders file list[32m 73[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/storage/FileListView.test.tsx[2m > [22mFileListView[2m > [22mrenders empty state[32m 5[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/storage/FileListView.test.tsx[2m > [22mFileListView[2m > [22mcalls delete handler[32m 15[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/ai-components.test.tsx[2m > [22mRiskHeatmap[2m > [22mshould render grid with correct framework headers[32m 196[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/ai-doc-generator.test.tsx[2m > [22mAI Document Generator Page[2m > [22mStep 1: Company Basics[2m > [22mshould allow valid company name input[33m 373[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/gap-analysis.test.tsx[2m > [22mGap Analysis Page[2m > [22mInitial Rendering[2m > [22mshould display overall score[32m 137[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/documents.test.tsx[2m > [22mDocuments Page[2m > [22mDocument Display[2m > [22mshould display status icons[32m 121[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/FrameworkSpreadsheet.test.tsx[2m > [22mFrameworkSpreadsheet Component[2m > [22mallows editing a field[32m 107[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/ErrorBoundary.test.tsx[2m > [22mErrorBoundary[2m > [22mshould display error message in development mode[32m 13[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/ErrorBoundary.test.tsx[2m > [22mErrorBoundary[2m > [22mshould hide error message in production mode[32m 29[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/ErrorBoundary.test.tsx[2m > [22mErrorBoundary[2m > [22mshould call onError callback when error occurs[32m 26[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/ErrorBoundary.test.tsx[2m > [22mErrorBoundary[2m > [22mshould render custom fallback when provided[32m 5[2mms[22m[39m
[90mstdout[2m | tests/components/FrameworkSpreadsheet.test.tsx[2m > [22m[2mFrameworkSpreadsheet Component[2m > [22m[2mcalls save API when "Save All Changes" is clicked
[22m[39mButton HTML: <button class="inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg]:size-4 [&amp;_svg]:shrink-0 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2" data-testid="button-save-all-changes"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-save h-4 w-4 mr-2" aria-hidden="true"><path d="M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z"></path><path d="M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7"></path><path d="M7 3v4a1 1 0 0 0 1 1h7"></path></svg>Save All Changes</button>
Button Disabled: [33mfalse[39m

stderr | tests/components/dashboard.test.tsx > Dashboard Component > Initial Rendering > should render dashboard title
Warning: A suspended resource finished loading inside a test, but the event was not wrapped in act(...).

When testing, code that resolves suspended data should be wrapped into act(...):

act(() => {
  /* finish loading suspended data */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
Warning: A suspended resource finished loading inside a test, but the event was not wrapped in act(...).

When testing, code that resolves suspended data should be wrapped into act(...):

act(() => {
  /* finish loading suspended data */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
Warning: A suspended resource finished loading inside a test, but the event was not wrapped in act(...).

When testing, code that resolves suspended data should be wrapped into act(...):

act(() => {
  /* finish loading suspended data */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act

 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/ai-components.test.tsx[2m > [22mRiskHeatmap[2m > [22mshould render grid with correct category row headers[32m 231[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/ai-components.test.tsx[2m > [22mRiskHeatmap[2m > [22mshould have grid role on the table[32m 90[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/gap-analysis.test.tsx[2m > [22mGap Analysis Page[2m > [22mInitial Rendering[2m > [22mshould display total gaps count[32m 156[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/documents.test.tsx[2m > [22mDocuments Page[2m > [22mDocument Display[2m > [22mshould display formatted dates[32m 130[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/ErrorBoundary.test.tsx[2m > [22mErrorBoundary[2m > [22mshould reset error state when Try Again is clicked[33m 318[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/ErrorBoundary.test.tsx[2m > [22mErrorBoundary[2m > [22mshould display error ID[32m 46[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/ErrorBoundary.test.tsx[2m > [22mErrorBoundary[2m > [22mshould have Reload Page button[32m 15[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/FrameworkSpreadsheet.test.tsx[2m > [22mFrameworkSpreadsheet Component[2m > [22mcalls save API when "Save All Changes" is clicked[33m 318[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/stories/storybook.test.tsx[2m > [22mStorybook Components[2m > [22mButton[2m > [22mrenders with correct label and classes[32m 244[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/stories/storybook.test.tsx[2m > [22mStorybook Components[2m > [22mButton[2m > [22mrenders secondary button[32m 25[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/stories/storybook.test.tsx[2m > [22mStorybook Components[2m > [22mButton[2m > [22mhandles clicks[32m 25[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/stories/storybook.test.tsx[2m > [22mStorybook Components[2m > [22mButton[2m > [22mapplies custom background color[32m 29[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/dashboard.test.tsx[2m > [22mDashboard Component[2m > [22mInitial Rendering[2m > [22mshould render dashboard title[32m 203[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/dashboard.test.tsx[2m > [22mDashboard Component[2m > [22mInitial Rendering[2m > [22mshould show loading skeleton while fetching data[32m 19[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/stories/storybook.test.tsx[2m > [22mStorybook Components[2m > [22mButton[2m > [22mrenders different sizes[32m 19[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/stories/storybook.test.tsx[2m > [22mStorybook Components[2m > [22mHeader[2m > [22mrenders logged out state correctly[32m 14[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/stories/storybook.test.tsx[2m > [22mStorybook Components[2m > [22mHeader[2m > [22mrenders logged in state correctly[32m 8[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/stories/storybook.test.tsx[2m > [22mStorybook Components[2m > [22mPage[2m > [22mmanages login state[32m 29[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/stories/storybook.test.tsx[2m > [22mStorybook Components[2m > [22mPage[2m > [22mrenders page content[32m 6[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/documents.test.tsx[2m > [22mDocuments Page[2m > [22mDocument Display[2m > [22mshould display document categories in desktop view[32m 140[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/documents.test.tsx[2m > [22mDocuments Page[2m > [22mEmpty States[2m > [22mshould display message when no documents exist[32m 33[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/CloudIntegrationsPage.test.tsx[2m > [22mCloudIntegrations Page[2m > [22mrenders correctly[32m 180[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/CloudIntegrationsPage.test.tsx[2m > [22mCloudIntegrations Page[2m > [22mshows no integrations state[32m 68[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/gap-analysis.test.tsx[2m > [22mGap Analysis Page[2m > [22mInitial Rendering[2m > [22mshould display critical issues count[32m 136[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/ai-components.test.tsx[2m > [22mRiskHeatmap[2m > [22mshould display correct risk counts in badges[32m 62[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/dashboard.test.tsx[2m > [22mDashboard Component[2m > [22mInitial Rendering[2m > [22mshould render document statistics cards[32m 133[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/gap-analysis.test.tsx[2m > [22mGap Analysis Page[2m > [22mInitial Rendering[2m > [22mshould display estimated timeline[32m 198[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/ai-components.test.tsx[2m > [22mRiskHeatmap[2m > [22mshould render 20 risk cells (5 categories x 4 frameworks)[32m 251[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/ai-components.test.tsx[2m > [22mRiskHeatmap[2m > [22mshould have accessible risk cells with aria-labels[32m 27[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/ai-components.test.tsx[2m > [22mRiskHeatmap[2m > [22mshould display control implementation counts in cells[32m 34[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/dashboard.test.tsx[2m > [22mDashboard Component[2m > [22mInitial Rendering[2m > [22mshould display framework breakdown[32m 140[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/dashboard.test.tsx[2m > [22mDashboard Component[2m > [22mInitial Rendering[2m > [22mshould show status distribution[32m 55[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/ai-doc-generator.test.tsx[2m > [22mAI Document Generator Page[2m > [22mStep 1: Company Basics[2m > [22mshould allow industry selection[33m 615[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/profile/PreferencesForm.test.tsx[2m > [22mPreferencesForm[2m > [22msubmits form data[33m 1154[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/gap-analysis.test.tsx[2m > [22mGap Analysis Page[2m > [22mAnalysis Filters[2m > [22mshould render filter section[32m 127[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/ai-components.test.tsx[2m > [22mRiskHeatmap[2m > [22mshould render risk cells with correct background colors[32m 32[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/ai-components.test.tsx[2m > [22mRiskHeatmap[2m > [22mshould apply custom className when provided[32m 33[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/ai-components.test.tsx[2m > [22mRiskHeatmap[2m > [22mshould have focusable cells with proper focus styles[32m 21[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/ai-components.test.tsx[2m > [22mControlPrioritizer[2m > [22mshould render the control prioritizer card with title[32m 30[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/dashboard.test.tsx[2m > [22mDashboard Component[2m > [22mDocument Statistics[2m > [22mshould calculate total documents correctly[32m 108[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/ai-components.test.tsx[2m > [22mControlPrioritizer[2m > [22mshould render all 5 controls[32m 77[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/TemporaryLoginDialog.test.tsx[2m > [22mTemporaryLoginDialog[2m > [22msubmits valid form[33m 1434[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/gap-analysis.test.tsx[2m > [22mGap Analysis Page[2m > [22mAnalysis Filters[2m > [22mshould render category filter dropdown[32m 140[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/dashboard.test.tsx[2m > [22mDashboard Component[2m > [22mDocument Statistics[2m > [22mshould count documents by framework[32m 132[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/dashboard.test.tsx[2m > [22mDashboard Component[2m > [22mDocument Statistics[2m > [22mshould count documents by status[32m 88[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/ai-components.test.tsx[2m > [22mControlPrioritizer[2m > [22mshould display controls in priority order[32m 109[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/ai-components.test.tsx[2m > [22mControlPrioritizer[2m > [22mshould calculate and display correct implementation progress[32m 48[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/ai-components.test.tsx[2m > [22mControlPrioritizer[2m > [22mshould have progress bar with correct value[32m 52[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/ai-components.test.tsx[2m > [22mControlPrioritizer[2m > [22mshould display status badges correctly[32m 38[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/ai-components.test.tsx[2m > [22mControlPrioritizer[2m > [22mshould display effort badges with correct colors[32m 30[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/ai-components.test.tsx[2m > [22mControlPrioritizer[2m > [22mshould display impact badges[32m 25[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/gap-analysis.test.tsx[2m > [22mGap Analysis Page[2m > [22mAnalysis Filters[2m > [22mshould render priority filter dropdown[32m 200[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/ai-doc-generator.test.tsx[2m > [22mAI Document Generator Page[2m > [22mStep 1: Company Basics[2m > [22mshould allow company size selection[33m 444[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/ai-components.test.tsx[2m > [22mControlPrioritizer[2m > [22mshould display estimated time for each control[32m 42[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/ai-components.test.tsx[2m > [22mControlPrioritizer[2m > [22mshould display framework badges for each control[32m 30[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/documents.test.tsx[2m > [22mDocuments Page[2m > [22mEmpty States[2m > [22mshould display message when no documents match filters[33m 717[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/gap-analysis.test.tsx[2m > [22mGap Analysis Page[2m > [22mAnalysis Filters[2m > [22mshould render search button[32m 226[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/ai-components.test.tsx[2m > [22mControlPrioritizer[2m > [22mshould call onImplementControl callback when implement button is clicked[32m 69[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/ai-components.test.tsx[2m > [22mControlPrioritizer[2m > [22mshould have correct aria-labels on implement buttons[32m 19[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/ai-components.test.tsx[2m > [22mControlPrioritizer[2m > [22mshould have properly structured control items[32m 23[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/ai-components.test.tsx[2m > [22mControlPrioritizer[2m > [22mshould have aria-labels on control list items[32m 19[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/dashboard.test.tsx[2m > [22mDashboard Component[2m > [22mDocument Statistics[2m > [22mshould handle empty document list[32m 71[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/dashboard.test.tsx[2m > [22mDashboard Component[2m > [22mDocument Generation[2m > [22mshould show generation button for each framework[32m 46[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/ai-components.test.tsx[2m > [22mControlPrioritizer[2m > [22mshould render View Full Gap Analysis button[32m 17[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/ai-components.test.tsx[2m > [22mControlPrioritizer[2m > [22mshould apply custom className when provided[32m 21[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/ai-components.test.tsx[2m > [22mControlPrioritizer[2m > [22mshould display reason for prioritization[32m 19[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/ai-components.test.tsx[2m > [22mControlPrioritizer[2m > [22mshould show correct category badges[32m 33[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/dashboard.test.tsx[2m > [22mDashboard Component[2m > [22mDocument Generation[2m > [22mshould start generation when button clicked[33m 458[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/documents.test.tsx[2m > [22mDocuments Page[2m > [22mSearch Functionality[2m > [22mshould filter documents by title search[33m 463[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/ai-doc-generator.test.tsx[2m > [22mAI Document Generator Page[2m > [22mStep 1: Company Basics[2m > [22mshould allow headquarters input[33m 503[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/gap-analysis.test.tsx[2m > [22mGap Analysis Page[2m > [22mAnalysis Filters[2m > [22mshould filter categories by selection[33m 498[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/dashboard.test.tsx[2m > [22mDashboard Component[2m > [22mDocument Generation[2m > [22mshould show progress indicator during generation[32m 198[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/dashboard.test.tsx[2m > [22mDashboard Component[2m > [22mDocument Generation[2m > [22mshould disable generate button during generation[32m 169[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/dashboard.test.tsx[2m > [22mDashboard Component[2m > [22mDocument Generation[2m > [22mshould show success message when generation completes[32m 31[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/dashboard.test.tsx[2m > [22mDashboard Component[2m > [22mDocument Generation[2m > [22mshould handle generation errors gracefully[32m 26[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/documents.test.tsx[2m > [22mDocuments Page[2m > [22mSearch Functionality[2m > [22mshould filter documents by description search[33m 332[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/dashboard.test.tsx[2m > [22mDashboard Component[2m > [22mDocument Generation[2m > [22mshould timeout if generation takes too long[32m 35[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/dashboard.test.tsx[2m > [22mDashboard Component[2m > [22mError Handling[2m > [22mshould show error message when document fetch fails[32m 40[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/dashboard.test.tsx[2m > [22mDashboard Component[2m > [22mError Handling[2m > [22mshould show retry button on error[32m 29[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/dashboard.test.tsx[2m > [22mDashboard Component[2m > [22mError Handling[2m > [22mshould refetch data when retry clicked[32m 41[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/dashboard.test.tsx[2m > [22mDashboard Component[2m > [22mError Handling[2m > [22mshould handle company profile fetch errors[32m 29[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/dashboard.test.tsx[2m > [22mDashboard Component[2m > [22mDocument Preview[2m > [22mshould open preview dialog when document clicked[32m 31[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/dashboard.test.tsx[2m > [22mDashboard Component[2m > [22mDocument Preview[2m > [22mshould close preview dialog when close button clicked[32m 31[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/gap-analysis.test.tsx[2m > [22mGap Analysis Page[2m > [22mAnalysis Filters[2m > [22mshould filter by priority level[33m 430[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/accessibility/accessibility.test.tsx[2m > [22mAccessibility Tests[2m > [22mPages[2m > [22mLanding page should not have any accessibility violations[33m 1906[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/dashboard.test.tsx[2m > [22mDashboard Component[2m > [22mDocument Preview[2m > [22mshould show document content in preview[32m 32[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/dashboard.test.tsx[2m > [22mDashboard Component[2m > [22mAI Insights Integration[2m > [22mshould render AI insights dashboard[32m 30[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/dashboard.test.tsx[2m > [22mDashboard Component[2m > [22mAI Insights Integration[2m > [22mshould render risk heatmap[32m 30[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/dashboard.test.tsx[2m > [22mDashboard Component[2m > [22mAI Insights Integration[2m > [22mshould render control prioritizer[32m 21[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/accessibility/accessibility.test.tsx[2m > [22mAccessibility Tests[2m > [22mPages[2m > [22mDashboard should not have any accessibility violations[33m 302[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/accessibility/accessibility.test.tsx[2m > [22mAccessibility Tests[2m > [22mSkipNavigation Component[2m > [22mshould not have any accessibility violations[32m 49[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/accessibility/accessibility.test.tsx[2m > [22mAccessibility Tests[2m > [22mSkipNavigation Component[2m > [22mshould have correct ARIA attributes[32m 5[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/documents.test.tsx[2m > [22mDocuments Page[2m > [22mSearch Functionality[2m > [22mshould perform case-insensitive search[33m 371[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/dashboard.test.tsx[2m > [22mDashboard Component[2m > [22mAI Insights Integration[2m > [22mshould lazy load AI components[32m 27[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/dashboard.test.tsx[2m > [22mDashboard Component[2m > [22mResponsive Behavior[2m > [22mshould render mobile-friendly layout on small screens[32m 28[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/dashboard.test.tsx[2m > [22mDashboard Component[2m > [22mResponsive Behavior[2m > [22mshould render desktop layout on large screens[32m 18[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/dashboard.test.tsx[2m > [22mDashboard Component[2m > [22mAccessibility[2m > [22mshould have proper heading hierarchy[32m 28[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/accessibility/accessibility.test.tsx[2m > [22mAccessibility Tests[2m > [22mMainContent Component[2m > [22mshould not have any accessibility violations[32m 43[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/accessibility/accessibility.test.tsx[2m > [22mAccessibility Tests[2m > [22mMainContent Component[2m > [22mshould have correct main landmark and id[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/dashboard.test.tsx[2m > [22mDashboard Component[2m > [22mAccessibility[2m > [22mshould have accessible buttons[32m 34[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/dashboard.test.tsx[2m > [22mDashboard Component[2m > [22mAccessibility[2m > [22mshould announce generation progress to screen readers[32m 31[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/dashboard.test.tsx[2m > [22mDashboard Component[2m > [22mAccessibility[2m > [22mshould have proper ARIA labels for stats[32m 30[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/dashboard.test.tsx[2m > [22mDashboard Component[2m > [22mPerformance[2m > [22mshould not re-render unnecessarily[32m 22[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/dashboard.test.tsx[2m > [22mDashboard Component[2m > [22mPerformance[2m > [22mshould cleanup timers on unmount[32m 26[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/dashboard.test.tsx[2m > [22mDashboard Component[2m > [22mData Refresh[2m > [22mshould refetch documents after successful generation[32m 17[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/dashboard.test.tsx[2m > [22mDashboard Component[2m > [22mData Refresh[2m > [22mshould update statistics in real-time[32m 28[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/storage/StorageStatsView.test.tsx[2m > [22mStorageStatsView[2m > [22mrenders loading state[32m 15[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/storage/StorageStatsView.test.tsx[2m > [22mStorageStatsView[2m > [22mrenders stats correctly[32m 25[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/documents.test.tsx[2m > [22mDocuments Page[2m > [22mSearch Functionality[2m > [22mshould clear filters when search is cleared[32m 249[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/dashboard/RecentDocuments.test.tsx[2m > [22mRecentDocuments[2m > [22mrenders list of documents[32m 71[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/dashboard/RecentDocuments.test.tsx[2m > [22mRecentDocuments[2m > [22mrenders nothing when empty[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/profile/SecuritySettings.test.tsx[2m > [22mSecuritySettings[2m > [22mrenders security status correctly[32m 102[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/profile/SecuritySettings.test.tsx[2m > [22mSecuritySettings[2m > [22mrenders manage button when 2FA enabled[32m 16[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/profile/SecuritySettings.test.tsx[2m > [22mSecuritySettings[2m > [22mrenders enable button when 2FA disabled[32m 13[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/gap-analysis.test.tsx[2m > [22mGap Analysis Page[2m > [22mAnalysis Filters[2m > [22mshould reset filters when selecting "All"[33m 728[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/ai-doc-generator.test.tsx[2m > [22mAI Document Generator Page[2m > [22mStep 1: Company Basics[2m > [22mshould proceed to step 2 with valid data[33m 1362[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/upload/FileListItem.test.tsx[2m > [22mFileListItem[2m > [22mrenders pending file correctly[32m 65[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/upload/FileListItem.test.tsx[2m > [22mFileListItem[2m > [22mrenders completed file with metadata[32m 7[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/upload/FileListItem.test.tsx[2m > [22mFileListItem[2m > [22mdoes not show remove button when processing[32m 10[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/documents.test.tsx[2m > [22mDocuments Page[2m > [22mStatus Filter[2m > [22mshould filter documents by complete status[33m 402[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/dashboard/QuickStats.test.tsx[2m > [22mQuickStats[2m > [22mrenders stats correctly[32m 51[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/dashboard/QuickStats.test.tsx[2m > [22mQuickStats[2m > [22mrenders zero/empty states[32m 8[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/DocumentUploader.test.tsx[2m > [22mDocumentUploader[2m > [22mrenders correctly[32m 78[2mms[22m[39m
 [2m[90mÎ“Ã¥Ã´[39m[22m [30m[45m components [49m[39m tests/components/DocumentUploader.test.tsx[2m > [22mDocumentUploader[2m > [22mhandles file drop (simulation)
 [2m[90mÎ“Ã¥Ã´[39m[22m [30m[45m components [49m[39m tests/components/DocumentUploader.test.tsx[2m > [22mDocumentUploader[2m > [22muploads files
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/gap-analysis.test.tsx[2m > [22mGap Analysis Page[2m > [22mTab Navigation[2m > [22mshould render all tab triggers[32m 199[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/gap-analysis.test.tsx[2m > [22mGap Analysis Page[2m > [22mTab Navigation[2m > [22mshould default to Gap Analysis tab[32m 90[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/documents.test.tsx[2m > [22mDocuments Page[2m > [22mStatus Filter[2m > [22mshould filter documents by in_progress status[33m 310[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/gap-analysis.test.tsx[2m > [22mGap Analysis Page[2m > [22mTab Navigation[2m > [22mshould switch to Framework Coverage tab[32m 174[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/gap-analysis.test.tsx[2m > [22mGap Analysis Page[2m > [22mTab Navigation[2m > [22mshould switch to Implementation Roadmap tab[32m 139[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/documents.test.tsx[2m > [22mDocuments Page[2m > [22mStatus Filter[2m > [22mshould filter documents by draft status[32m 247[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/gap-analysis.test.tsx[2m > [22mGap Analysis Page[2m > [22mTab Navigation[2m > [22mshould switch to Priority Actions tab[32m 124[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/gap-analysis.test.tsx[2m > [22mGap Analysis Page[2m > [22mGap Analysis Tab Content[2m > [22mshould display all gap categories[32m 79[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/gap-analysis.test.tsx[2m > [22mGap Analysis Page[2m > [22mGap Analysis Tab Content[2m > [22mshould display status badges for each category[32m 55[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/gap-analysis.test.tsx[2m > [22mGap Analysis Page[2m > [22mGap Analysis Tab Content[2m > [22mshould display implementation scores for each category[32m 43[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/accessibility/accessibility.test.tsx[2m > [22mAccessibility Tests[2m > [22mCritical Pages - Extended Coverage[2m > [22mai-doc-generator should not have accessibility violations[33m 678[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/accessibility/accessibility.test.tsx[2m > [22mAccessibility Tests[2m > [22mCritical Pages - Extended Coverage[2m > [22mdocuments page should not have accessibility violations[32m 57[2mms[22m[39m
stderr | tests/accessibility/accessibility.test.tsx > Accessibility Tests > Critical Pages - Extended Coverage > gap-analysis page should not have accessibility violations
Query Error: Failed to parse URL from /api/documents

stderr | tests/accessibility/accessibility.test.tsx > Accessibility Tests > Critical Pages - Extended Coverage > gap-analysis page should not have accessibility violations
Query Error: Failed to parse URL from /api/approvals?status=pending

 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/gap-analysis.test.tsx[2m > [22mGap Analysis Page[2m > [22mGap Analysis Tab Content[2m > [22mshould display gap counts for each category[32m 65[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/gap-analysis.test.tsx[2m > [22mGap Analysis Page[2m > [22mGap Analysis Tab Content[2m > [22mshould display category descriptions[32m 48[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/gap-analysis.test.tsx[2m > [22mGap Analysis Page[2m > [22mGap Analysis Tab Content[2m > [22mshould display recommendations for each category[32m 30[2mms[22m[39m
stderr | tests/accessibility/accessibility.test.tsx > Accessibility Tests > Critical Pages - Extended Coverage > mfa-setup page should not have accessibility violations
[2026-01-23T16:49:12.906Z] [ERROR] Auth check failed: TypeError: Failed to parse URL from /api/auth/user
    at node:internal/deps/undici/undici:13510:13
    at processTicksAndRejections (node:internal/process/task_queues:105:5)
    at queryFn (C:\software\cyberdocgen\client\src\hooks\useAuth.ts:9:21) {
  [cause]: TypeError: Invalid URL: /api/auth/user
      at new URLImpl (C:\software\cyberdocgen\node_modules\whatwg-url\lib\URL-impl.js:20:13)
      at Object.exports.setup (C:\software\cyberdocgen\node_modules\whatwg-url\lib\URL.js:54:12)
      at new URL (C:\software\cyberdocgen\node_modules\whatwg-url\lib\URL.js:115:22)
      at new Request (node:internal/deps/undici/undici:9586:25)
      at fetch (node:internal/deps/undici/undici:10315:25)
      at fetch (node:internal/deps/undici/undici:13508:10)
      at fetch (node:internal/bootstrap/web/exposed-window-or-worker:75:12)
      at queryFn (C:\software\cyberdocgen\client\src\hooks\useAuth.ts:9:27)
      at Object.fetchFn [as fn] (file:///C:/software/cyberdocgen/node_modules/@tanstack/query-core/src/query.ts:474:14)
      at run (file:///C:/software/cyberdocgen/node_modules/@tanstack/query-core/src/retryer.ts:155:49)
}
[2026-01-23T16:49:12.912Z] [ERROR] Failed to load MFA status: TypeError: Failed to parse URL from /api/auth/mfa/status
    at node:internal/deps/undici/undici:13510:13
    at processTicksAndRejections (node:internal/process/task_queues:105:5)
    at loadMFAStatus (C:\software\cyberdocgen\client\src\pages\mfa-setup.tsx:55:24) {
  [cause]: TypeError: Invalid URL: /api/auth/mfa/status
      at new URLImpl (C:\software\cyberdocgen\node_modules\whatwg-url\lib\URL-impl.js:20:13)
      at Object.exports.setup (C:\software\cyberdocgen\node_modules\whatwg-url\lib\URL.js:54:12)
      at new URL (C:\software\cyberdocgen\node_modules\whatwg-url\lib\URL.js:115:22)
      at new Request (node:internal/deps/undici/undici:9586:25)
      at fetch (node:internal/deps/undici/undici:10315:25)
      at fetch (node:internal/deps/undici/undici:13508:10)
      at fetch (node:internal/bootstrap/web/exposed-window-or-worker:75:12)
      at loadMFAStatus (C:\software\cyberdocgen\client\src\pages\mfa-setup.tsx:55:30)
      at C:\software\cyberdocgen\client\src\pages\mfa-setup.tsx:50:5
      at commitHookEffectListMount (C:\software\cyberdocgen\node_modules\react-dom\cjs\react-dom.development.js:23189:26)
}

 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/accessibility/accessibility.test.tsx[2m > [22mAccessibility Tests[2m > [22mCritical Pages - Extended Coverage[2m > [22mgap-analysis page should not have accessibility violations[33m 885[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/accessibility/accessibility.test.tsx[2m > [22mAccessibility Tests[2m > [22mCritical Pages - Extended Coverage[2m > [22mmfa-setup page should not have accessibility violations[32m 65[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/gap-analysis.test.tsx[2m > [22mGap Analysis Page[2m > [22mGap Analysis Tab Content[2m > [22mshould show truncated recommendations with count[32m 50[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/documents.test.tsx[2m > [22mDocuments Page[2m > [22mStatus Filter[2m > [22mshould reset to all documents when selecting "All Status"[33m 480[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/documents.test.tsx[2m > [22mDocuments Page[2m > [22mFramework Filter[2m > [22mshould filter documents by framework from URL[32m 36[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/gap-analysis.test.tsx[2m > [22mGap Analysis Page[2m > [22mFramework Coverage Tab[2m > [22mshould display all compliance frameworks[32m 124[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/ai-doc-generator.test.tsx[2m > [22mAI Document Generator Page[2m > [22mStep 2: Infrastructure & Security[2m > [22mshould render infrastructure fields[33m 1226[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/gap-analysis.test.tsx[2m > [22mGap Analysis Page[2m > [22mFramework Coverage Tab[2m > [22mshould display framework coverage percentages[32m 109[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/gap-analysis.test.tsx[2m > [22mGap Analysis Page[2m > [22mFramework Coverage Tab[2m > [22mshould display control counts[32m 120[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/documents.test.tsx[2m > [22mDocuments Page[2m > [22mCombined Filters[2m > [22mshould apply both search and status filters[33m 397[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/gap-analysis.test.tsx[2m > [22mGap Analysis Page[2m > [22mFramework Coverage Tab[2m > [22mshould display Total Controls, Implemented, and Missing labels[32m 127[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/documents.test.tsx[2m > [22mDocuments Page[2m > [22mCombined Filters[2m > [22mshould apply search, status, and framework filters[32m 185[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/gap-analysis.test.tsx[2m > [22mGap Analysis Page[2m > [22mFramework Coverage Tab[2m > [22mshould display framework status badges[32m 126[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/documents.test.tsx[2m > [22mDocuments Page[2m > [22mDocument Actions[2m > [22mshould render edit buttons for each document[32m 33[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/documents.test.tsx[2m > [22mDocuments Page[2m > [22mDocument Actions[2m > [22mshould render download buttons for each document[32m 29[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/documents.test.tsx[2m > [22mDocuments Page[2m > [22mDocument Actions[2m > [22mshould render delete buttons for each document in desktop view[32m 46[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/gap-analysis.test.tsx[2m > [22mGap Analysis Page[2m > [22mImplementation Roadmap Tab[2m > [22mshould display timeline alert[32m 121[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/documents.test.tsx[2m > [22mDocuments Page[2m > [22mDocument Actions[2m > [22mshould have accessible labels for action buttons[32m 39[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/gap-analysis.test.tsx[2m > [22mGap Analysis Page[2m > [22mImplementation Roadmap Tab[2m > [22mshould display all four phases[32m 109[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/documents.test.tsx[2m > [22mDocuments Page[2m > [22mNew Document Dialog[2m > [22mshould open new document dialog when button is clicked[32m 133[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/documents.test.tsx[2m > [22mDocuments Page[2m > [22mExport All Button[2m > [22mshould render export all button[32m 47[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/documents.test.tsx[2m > [22mDocuments Page[2m > [22mExport All Button[2m > [22mshould have accessible label for export button[32m 29[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/gap-analysis.test.tsx[2m > [22mGap Analysis Page[2m > [22mImplementation Roadmap Tab[2m > [22mshould display phase timelines[32m 138[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/documents.test.tsx[2m > [22mDocuments Page[2m > [22mAccessibility[2m > [22mshould have proper ARIA labels for search input[32m 42[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/documents.test.tsx[2m > [22mDocuments Page[2m > [22mAccessibility[2m > [22mshould have proper ARIA labels for status filter[32m 41[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/gap-analysis.test.tsx[2m > [22mGap Analysis Page[2m > [22mImplementation Roadmap Tab[2m > [22mshould display phase items[32m 126[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/documents.test.tsx[2m > [22mDocuments Page[2m > [22mAccessibility[2m > [22mshould have proper table ARIA attributes[32m 59[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/documents.test.tsx[2m > [22mDocuments Page[2m > [22mAccessibility[2m > [22mshould have proper loading state ARIA attributes[32m 11[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/documents.test.tsx[2m > [22mDocuments Page[2m > [22mAccessibility[2m > [22mshould hide decorative icons from screen readers[32m 54[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/gap-analysis.test.tsx[2m > [22mGap Analysis Page[2m > [22mImplementation Roadmap Tab[2m > [22mshould display priority badges for each phase[32m 154[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/documents.test.tsx[2m > [22mDocuments Page[2m > [22mResponsive Behavior[2m > [22mshould render table headers in desktop view[32m 38[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/documents.test.tsx[2m > [22mDocuments Page[2m > [22mResponsive Behavior[2m > [22mshould display document count in card header[32m 22[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/documents.test.tsx[2m > [22mDocuments Page[2m > [22mError Handling[2m > [22mshould handle API errors gracefully[32m 27[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/documents.test.tsx[2m > [22mDocuments Page[2m > [22mError Handling[2m > [22mshould handle empty document array[32m 33[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/documents.test.tsx[2m > [22mDocuments Page[2m > [22mError Handling[2m > [22mshould handle documents without descriptions[32m 29[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/documents.test.tsx[2m > [22mDocuments Page[2m > [22mQuery Integration[2m > [22mshould use correct query key for fetching documents[32m 4[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/documents.test.tsx[2m > [22mDocuments Page[2m > [22mQuery Integration[2m > [22mshould refetch documents on query invalidation[32m 60[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/ai-doc-generator.test.tsx[2m > [22mAI Document Generator Page[2m > [22mStep 2: Infrastructure & Security[2m > [22mshould render all cloud provider checkboxes[33m 1096[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/gap-analysis.test.tsx[2m > [22mGap Analysis Page[2m > [22mPriority Actions Tab[2m > [22mshould display priority recommendations[32m 92[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/gap-analysis.test.tsx[2m > [22mGap Analysis Page[2m > [22mPriority Actions Tab[2m > [22mshould display timeframes for each recommendation[32m 145[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/gap-analysis.test.tsx[2m > [22mGap Analysis Page[2m > [22mPriority Actions Tab[2m > [22mshould display effort levels[32m 133[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/gap-analysis.test.tsx[2m > [22mGap Analysis Page[2m > [22mPriority Actions Tab[2m > [22mshould display impact descriptions[32m 108[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/gap-analysis.test.tsx[2m > [22mGap Analysis Page[2m > [22mPriority Actions Tab[2m > [22mshould display priority badges[32m 123[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/gap-analysis.test.tsx[2m > [22mGap Analysis Page[2m > [22mImmediate Action Section[2m > [22mshould display immediate action card[32m 28[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/gap-analysis.test.tsx[2m > [22mGap Analysis Page[2m > [22mImmediate Action Section[2m > [22mshould display critical priority alert[32m 28[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/gap-analysis.test.tsx[2m > [22mGap Analysis Page[2m > [22mImmediate Action Section[2m > [22mshould display action buttons[32m 80[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/gap-analysis.test.tsx[2m > [22mGap Analysis Page[2m > [22mUI Components[2m > [22mshould display progress bars[32m 48[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/gap-analysis.test.tsx[2m > [22mGap Analysis Page[2m > [22mUI Components[2m > [22mshould display icons throughout the page[32m 42[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/gap-analysis.test.tsx[2m > [22mGap Analysis Page[2m > [22mUI Components[2m > [22mshould use proper card components[32m 34[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/gap-analysis.test.tsx[2m > [22mGap Analysis Page[2m > [22mResponsive Behavior[2m > [22mshould render mobile-friendly text alternatives[32m 31[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/gap-analysis.test.tsx[2m > [22mGap Analysis Page[2m > [22mResponsive Behavior[2m > [22mshould render tab labels with responsive text[32m 41[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/gap-analysis.test.tsx[2m > [22mGap Analysis Page[2m > [22mAccessibility[2m > [22mshould have proper heading hierarchy[32m 33[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/gap-analysis.test.tsx[2m > [22mGap Analysis Page[2m > [22mAccessibility[2m > [22mshould have accessible button labels[32m 60[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/gap-analysis.test.tsx[2m > [22mGap Analysis Page[2m > [22mAccessibility[2m > [22mshould have proper ARIA roles[32m 79[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/gap-analysis.test.tsx[2m > [22mGap Analysis Page[2m > [22mAccessibility[2m > [22mshould have progress bars with proper ARIA attributes[32m 36[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/gap-analysis.test.tsx[2m > [22mGap Analysis Page[2m > [22mData Calculations[2m > [22mshould correctly calculate overall score[32m 42[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/gap-analysis.test.tsx[2m > [22mGap Analysis Page[2m > [22mData Calculations[2m > [22mshould correctly sum total gaps[32m 43[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/gap-analysis.test.tsx[2m > [22mGap Analysis Page[2m > [22mData Calculations[2m > [22mshould correctly count critical gaps[32m 38[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/ai-doc-generator.test.tsx[2m > [22mAI Document Generator Page[2m > [22mStep 2: Infrastructure & Security[2m > [22mshould allow selecting multiple cloud providers[33m 1235[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/ai-doc-generator.test.tsx[2m > [22mAI Document Generator Page[2m > [22mStep 2: Infrastructure & Security[2m > [22mshould require at least one cloud provider[33m 1101[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/ai-doc-generator.test.tsx[2m > [22mAI Document Generator Page[2m > [22mStep 2: Infrastructure & Security[2m > [22mshould allow data classification selection[33m 1207[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/ai-doc-generator.test.tsx[2m > [22mAI Document Generator Page[2m > [22mStep 2: Infrastructure & Security[2m > [22mshould allow business applications input[33m 1769[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/ai-doc-generator.test.tsx[2m > [22mAI Document Generator Page[2m > [22mStep 2: Infrastructure & Security[2m > [22mshould allow going back to step 1[33m 1111[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/ai-doc-generator.test.tsx[2m > [22mAI Document Generator Page[2m > [22mStep 2: Infrastructure & Security[2m > [22mshould proceed to step 3 with valid data[33m 1504[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/ai-doc-generator.test.tsx[2m > [22mAI Document Generator Page[2m > [22mStep 3: Framework Selection[2m > [22mshould render framework selection fields[33m 1692[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/ai-doc-generator.test.tsx[2m > [22mAI Document Generator Page[2m > [22mStep 3: Framework Selection[2m > [22mshould allow selecting multiple frameworks[33m 1829[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/ai-doc-generator.test.tsx[2m > [22mAI Document Generator Page[2m > [22mStep 3: Framework Selection[2m > [22mshould show SOC2 trust principles when SOC2 is selected[33m 1796[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/ai-doc-generator.test.tsx[2m > [22mAI Document Generator Page[2m > [22mStep 3: Framework Selection[2m > [22mshould hide SOC2 trust principles when SOC2 is deselected[33m 1838[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/ai-doc-generator.test.tsx[2m > [22mAI Document Generator Page[2m > [22mStep 3: Framework Selection[2m > [22mshould show FedRAMP level when FedRAMP is selected[33m 1800[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/ai-doc-generator.test.tsx[2m > [22mAI Document Generator Page[2m > [22mStep 3: Framework Selection[2m > [22mshould allow selecting FedRAMP level[33m 1829[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/ai-doc-generator.test.tsx[2m > [22mAI Document Generator Page[2m > [22mStep 3: Framework Selection[2m > [22mshould require at least one framework[33m 1722[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/ai-doc-generator.test.tsx[2m > [22mAI Document Generator Page[2m > [22mStep 3: Framework Selection[2m > [22mshould proceed to step 4 with valid data[33m 1759[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/ai-doc-generator.test.tsx[2m > [22mAI Document Generator Page[2m > [22mStep 4: Review & Generate[2m > [22mshould display company information review[33m 1645[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/ai-doc-generator.test.tsx[2m > [22mAI Document Generator Page[2m > [22mStep 4: Review & Generate[2m > [22mshould display infrastructure review[33m 1819[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/ai-doc-generator.test.tsx[2m > [22mAI Document Generator Page[2m > [22mStep 4: Review & Generate[2m > [22mshould display selected frameworks[33m 1735[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/ai-doc-generator.test.tsx[2m > [22mAI Document Generator Page[2m > [22mStep 4: Review & Generate[2m > [22mshould show estimated document count[33m 1776[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/ai-doc-generator.test.tsx[2m > [22mAI Document Generator Page[2m > [22mStep 4: Review & Generate[2m > [22mshould render generate button[33m 1775[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/ai-doc-generator.test.tsx[2m > [22mAI Document Generator Page[2m > [22mStep 4: Review & Generate[2m > [22mshould only show previous button, not next[33m 1807[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/ai-doc-generator.test.tsx[2m > [22mAI Document Generator Page[2m > [22mStep 4: Review & Generate[2m > [22mshould allow going back to step 3[33m 1862[2mms[22m[39m
stderr | tests/components/ai-doc-generator.test.tsx > AI Document Generator Page > Step 5: Generation Results > should show loading state during generation
Not implemented: HTMLFormElement's requestSubmit() method

 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/ai-doc-generator.test.tsx[2m > [22mAI Document Generator Page[2m > [22mStep 5: Generation Results[2m > [22mshould show loading state during generation[33m 1872[2mms[22m[39m
stderr | tests/components/ai-doc-generator.test.tsx > AI Document Generator Page > Step 5: Generation Results > should show error state on generation failure
Not implemented: HTMLFormElement's requestSubmit() method

 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/ai-doc-generator.test.tsx[2m > [22mAI Document Generator Page[2m > [22mStep 5: Generation Results[2m > [22mshould show error state on generation failure[33m 1862[2mms[22m[39m
stderr | tests/components/ai-doc-generator.test.tsx > AI Document Generator Page > Step 5: Generation Results > should show completed state with generated documents
Not implemented: HTMLFormElement's requestSubmit() method

 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/ai-doc-generator.test.tsx[2m > [22mAI Document Generator Page[2m > [22mStep 5: Generation Results[2m > [22mshould show completed state with generated documents[33m 1903[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/ai-doc-generator.test.tsx[2m > [22mAI Document Generator Page[2m > [22mForm Validation[2m > [22mshould validate company name length[32m 143[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/ai-doc-generator.test.tsx[2m > [22mAI Document Generator Page[2m > [22mForm Validation[2m > [22mshould validate headquarters is required[32m 58[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/ai-doc-generator.test.tsx[2m > [22mAI Document Generator Page[2m > [22mForm Validation[2m > [22mshould validate business applications minimum length[33m 1393[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/ai-doc-generator.test.tsx[2m > [22mAI Document Generator Page[2m > [22mNavigation[2m > [22mshould maintain form data when navigating back and forth[33m 1037[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/ai-doc-generator.test.tsx[2m > [22mAI Document Generator Page[2m > [22mAccessibility[2m > [22mshould have proper form labels[32m 18[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/ai-doc-generator.test.tsx[2m > [22mAI Document Generator Page[2m > [22mAccessibility[2m > [22mshould have accessible buttons[32m 24[2mms[22m[39m
 [32mÎ“Â£Ã´[39m [30m[45m components [49m[39m tests/components/ai-doc-generator.test.tsx[2m > [22mAI Document Generator Page[2m > [22mAccessibility[2m > [22mshould show validation errors with proper messaging[32m 31[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 3 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL   storybook  stories/Button.stories.ts [ stories/Button.stories.ts ]
 FAIL   storybook  stories/Header.stories.ts [ stories/Header.stories.ts ]
 FAIL   storybook  stories/Page.stories.ts [ stories/Page.stories.ts ]
Error: @vitest/browser/context can be imported only inside the Browser Mode. Your test is running in forks pool. Make sure your regular tests are excluded from the "test.include" glob pattern.
 Î“Â¥Â» node_modules/@vitest/browser/context.js:13:7
 Î“Â¥Â» node_modules/@storybook/addon-vitest/dist/vitest-plugin/test-utils.js:3:1
      1| // src/vitest-plugin/test-utils.ts
      2| import { getStoryChildren, isStory } from "storybook/internal/csf";
      3| import { server } from "@vitest/browser/context";
       | ^
      4| import { composeStory, getCsfFactoryAnnotations } from "storybook/prevÎ“Ã‡Âª
      5| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/3]Î“Ã„Â»


[2m Test Files [22m [1m[31m3 failed[39m[22m[2m | [22m[1m[32m99 passed[39m[22m[90m (102)[39m
[2m      Tests [22m [1m[32m1158 passed[39m[22m[2m | [22m[33m4 skipped[39m[90m (1162)[39m
[2m   Start at [22m 08:48:54
[2m   Duration [22m 62.91s[2m (transform 20.99s, setup 75.20s, collect 123.02s, tests 108.11s, environment 91.56s, prepare 33.01s)[22m

